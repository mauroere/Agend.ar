(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[130],{3962:function(e,t,n){Promise.resolve().then(n.bind(n,4342)),Promise.resolve().then(n.bind(n,2572)),Promise.resolve().then(n.bind(n,59)),Promise.resolve().then(n.bind(n,281))},4342:function(e,t,n){"use strict";n.d(t,{Shell:function(){return d}});var r=n(7437),a=n(2265),i=n(7648),s=n(9376),l=n(2381),o=n(8933),c=n(3448);let u=[{href:"/calendar",label:"Calendario"},{href:"/today",label:"Hoy"},{href:"/patients",label:"Pacientes"},{href:"/settings",label:"Automatizaci\xf3n"}];function d(e){let{children:t,hideNav:n=!1}=e,d=(0,s.useRouter)(),h=(0,s.usePathname)(),[f,x]=(0,a.useState)(!1),m=async()=>{if(!f){x(!0);try{let e=(0,o.o)(),{error:t}=await e.auth.signOut();if(t)throw t;d.replace("/login"),d.refresh()}catch(e){console.error("Error signing out",e),x(!1)}}};return(0,r.jsxs)("div",{className:"flex min-h-screen flex-col gap-8",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm uppercase tracking-[0.3em] text-slate-500",children:"Agend.ar"}),(0,r.jsx)("h1",{className:"text-3xl font-semibold",children:"Autopilot"})]}),!n&&(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("nav",{className:"flex gap-4 rounded-full border border-slate-200 bg-white/70 px-4 py-2 backdrop-blur",children:u.map(e=>(0,r.jsx)(i.default,{href:e.href,className:(0,c.cn)("rounded-full px-3 py-1 text-sm font-medium transition",(null==h?void 0:h.startsWith(e.href))?"bg-slate-900 text-white":"text-slate-500 hover:text-slate-900"),children:e.label},e.href))}),(0,r.jsx)(l.z,{variant:"outline",size:"sm",onClick:m,disabled:f,children:f?"Saliendo...":"Cerrar sesi\xf3n"})]})]}),t]})}},2572:function(e,t,n){"use strict";n.d(t,{LocationSwitcher:function(){return l}});var r=n(7437),a=n(2265),i=n(9376),s=n(5291);function l(e){let{locations:t,activeId:n}=e,l=(0,i.useRouter)(),o=(0,i.useSearchParams)(),[c,u]=(0,a.useTransition)();return t.length<=1?null:(0,r.jsx)(s.P,{value:n,onChange:e=>{var t;return t=e.target.value,void u(()=>{let e=new URLSearchParams(o.toString());e.set("location",t),l.push("?".concat(e.toString()))})},disabled:c,children:t.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))})}},2381:function(e,t,n){"use strict";n.d(t,{d:function(){return l},z:function(){return o}});var r=n(7437),a=n(535),i=n(2265),s=n(3448);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{primary:"bg-brand-600 text-white hover:bg-brand-500",outline:"border border-slate-200 bg-white text-slate-900 hover:bg-slate-50",ghost:"text-slate-600 hover:bg-slate-100",secondary:"bg-slate-100 text-slate-900 hover:bg-slate-200",destructive:"bg-red-600 text-white hover:bg-red-500"},size:{default:"h-10 px-4 py-2",sm:"h-8 px-3",lg:"h-12 px-6 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"primary",size:"default"}}),o=(0,i.forwardRef)((e,t)=>{let{className:n,variant:a,size:i,...o}=e;return(0,r.jsx)("button",{ref:t,className:(0,s.cn)(l({variant:a,size:i,className:n})),...o})});o.displayName="Button"},279:function(e,t,n){"use strict";n.d(t,{I:function(){return s}});var r=n(7437),a=n(2265),i=n(3448);let s=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("input",{ref:t,className:(0,i.cn)("flex h-10 w-full rounded-lg border border-slate-200 bg-white px-3 text-sm text-slate-900 shadow-sm placeholder:text-slate-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500",n),...a})});s.displayName="Input"},5291:function(e,t,n){"use strict";n.d(t,{P:function(){return i}});var r=n(7437),a=n(3448);function i(e){let{className:t,children:n,...i}=e;return(0,r.jsx)("select",{className:(0,a.cn)("flex h-10 w-full rounded-lg border border-slate-200 bg-white px-3 text-sm text-slate-900 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500",t),...i,children:n})}},59:function(e,t,n){"use strict";n.d(t,{WaitlistForm:function(){return c}});var r=n(7437),a=n(2265),i=n(9376),s=n(2381),l=n(279),o=n(5291);function c(e){let{onCreated:t}=e,[n,c]=(0,a.useState)(""),[u,d]=(0,a.useState)(""),[h,f]=(0,a.useState)(1),[x,m]=(0,a.useState)(""),[v,p]=(0,a.useState)([]),[b,g]=(0,a.useState)(!1),[j,y]=(0,a.useState)(null),w=v.length>0,N=(0,i.useRouter)(),S=e=>/^\+?[1-9]\d{7,14}$/.test(e.trim());async function P(e){if(e.preventDefault(),g(!0),y(null),!w){y("Primero crea una ubicaci\xf3n en Configuraci\xf3n"),g(!1);return}if(!S(u)){y("Tel\xe9fono debe estar en formato E.164 (+549...) y sin espacios"),g(!1);return}try{let e=await fetch("/api/waitlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient:n,phone:u,priority:h,location_id:x})}),a=await e.json();if(!e.ok){var r;y(null!==(r=a.error)&&void 0!==r?r:"No se pudo agregar a la lista");return}c(""),d(""),f(1),N.refresh(),null==t||t()}catch(e){y("Error inesperado. Intent\xe1 nuevamente.")}finally{g(!1)}}return(0,a.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/locations"),i=await a.json();if(a.ok){var e,t,n,r;p(null!==(n=i.locations)&&void 0!==n?n:[]),m(null!==(r=null===(t=i.locations)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.id)&&void 0!==r?r:"")}}catch(e){console.error("No se pudo cargar ubicaciones",e)}})()},[]),(0,r.jsxs)("form",{onSubmit:P,className:"space-y-3",children:[(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-4",children:[(0,r.jsx)(l.I,{required:!0,placeholder:"Paciente",value:n,onChange:e=>c(e.target.value)}),(0,r.jsx)(l.I,{required:!0,placeholder:"Tel\xe9fono E.164",value:u,onChange:e=>d(e.target.value)}),(0,r.jsx)(l.I,{required:!0,type:"number",min:1,max:10,value:h,onChange:e=>f(Number(e.target.value)),placeholder:"Prioridad"}),(0,r.jsx)(o.P,{value:x,onChange:e=>m(e.target.value),disabled:!w,children:v.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))})]}),j&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:j}),(0,r.jsx)(s.z,{type:"submit",disabled:b||!w,children:b?"Guardando...":"Agregar a lista"})]})}},281:function(e,t,n){"use strict";n.d(t,{WaitlistTable:function(){return o}});var r=n(7437),a=n(9376),i=n(2265),s=n(2381),l=n(3448);function o(e){let{rows:t}=e,[n,o]=(0,i.useState)(null),[c,u]=(0,i.useState)(t),d=(0,a.useRouter)();async function h(e){o(e);try{let n=await fetch("/api/waitlist/".concat(e),{method:"PATCH"});if(!n.ok){var t;let e=await n.json().catch(()=>({}));alert(null!==(t=e.error)&&void 0!==t?t:"No se pudo actualizar");return}u(t=>t.filter(t=>t.id!==e)),d.refresh()}finally{o(null)}}return(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"text-slate-500",children:[(0,r.jsx)("th",{className:"py-2",children:"Paciente"}),(0,r.jsx)("th",{children:"Tel\xe9fono"}),(0,r.jsx)("th",{children:"Prioridad"}),(0,r.jsx)("th",{children:"Opt-out"}),(0,r.jsx)("th",{children:"Activo"}),(0,r.jsx)("th",{})]})}),(0,r.jsxs)("tbody",{children:[c.map(e=>(0,r.jsxs)("tr",{className:"border-t border-slate-100",children:[(0,r.jsx)("td",{className:"py-3 font-medium",children:e.patient}),(0,r.jsx)("td",{children:e.phone}),(0,r.jsx)("td",{children:e.priority}),(0,r.jsx)("td",{children:e.optOut?"STOP":"OK"}),(0,r.jsx)("td",{className:(0,l.cn)(e.active?"text-green-700":"text-slate-500"),children:e.active?"S\xed":"No"}),(0,r.jsx)("td",{children:e.active&&(0,r.jsx)(s.z,{size:"sm",variant:"secondary",onClick:()=>h(e.id),disabled:n===e.id,children:n===e.id?"Guardando...":"Resolver"})})]},e.id)),0===c.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"py-4 text-center text-slate-500",children:"Sin pacientes en espera."})})]})]})})}},8933:function(e,t,n){"use strict";n.d(t,{o:function(){return a}});var r=n(5452);function a(){return(0,r.createClientComponentClient)()}},3448:function(e,t,n){"use strict";n.d(t,{cn:function(){return i}});var r=n(1994),a=n(3335);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,r.W)(t))}}},function(e){e.O(0,[851,679,971,117,744],function(){return e(e.s=3962)}),_N_E=e.O()}]);