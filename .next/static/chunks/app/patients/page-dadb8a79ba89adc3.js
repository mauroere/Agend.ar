(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[333],{1682:function(e,t,s){Promise.resolve().then(s.bind(s,4342)),Promise.resolve().then(s.bind(s,6560))},8930:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},6560:function(e,t,s){"use strict";s.d(t,{PatientTable:function(){return w}});var a=s(7437),n=s(2265),l=s(9376),r=s(279),o=s(2381),i=s(9820),c=s(1012),d=s(3804),u=s(3247),m=s(7806),x=s(9205);let f=(0,x.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);var p=s(1047),h=s(9322);let j=(0,x.Z)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var N=s(8930),b=s(9174),v=s(8752);function w(e){let{data:t}=e,[s,x]=(0,n.useState)(""),[w,y]=(0,n.useState)(!1),[S,g]=(0,n.useState)(t),[T,E]=(0,n.useState)(null),[C,A]=(0,n.useState)(null),O=(0,l.useRouter)(),{toast:_}=(0,v.pm)();(0,n.useEffect)(()=>{g(t)},[t]);let k=(e,t)=>{var s,a,n;let l="boolean"==typeof e.opt_out?e.opt_out:"boolean"==typeof(null==t?void 0:t.optOut)&&t.optOut,r="string"==typeof e.notes?e.notes:null===e.notes?null:null!==(s=null==t?void 0:t.notes)&&void 0!==s?s:null;return{id:e.id,fullName:e.full_name,phone:e.phone_e164,optOut:l,notes:r,nextAppointment:null!==(a=null==t?void 0:t.nextAppointment)&&void 0!==a?a:null,noShowCount:null!==(n=null==t?void 0:t.noShowCount)&&void 0!==n?n:0}},M=(0,n.useMemo)(()=>{let e=s.toLowerCase();return S.filter(t=>{let s=t.phone.replace(/\D/g,""),a=e.replace(/\D/g,""),n=t.fullName.toLowerCase().includes(e),l=a.length>2?s.includes(a):t.phone.includes(e);return n||l})},[S,s]),R=e=>{g(t=>[...t,k(e)]),_({title:"Paciente creado",description:"La ficha se agreg\xf3 a la base."}),y(!1)},D=(e,t)=>{let s=k(e,t);g(e=>e.map(e=>e.id===s.id?{...e,...s}:e)),_({title:"Paciente actualizado",description:"Los datos fueron guardados."}),E(null)};async function I(e){if(window.confirm("\xbfEliminar a ".concat(e.fullName,"? Esta acci\xf3n es permanente."))){A(e.id);try{let t=await fetch("/api/patients/".concat(e.id),{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"No se pudo eliminar")}g(t=>t.filter(t=>t.id!==e.id)),_({title:"Paciente eliminado"}),O.refresh()}catch(e){_({title:"Error al eliminar",description:e instanceof Error?e.message:"Intenta nuevamente.",variant:"destructive"})}finally{A(null)}}}return(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0 pb-6",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(i.ll,{children:"Base de Pacientes"}),(0,a.jsx)(i.SZ,{children:"Visualiza y gestiona la informaci\xf3n de tus pacientes por sede."})]}),(0,a.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,a.jsxs)("div",{className:"relative flex-1 sm:w-64",children:[(0,a.jsx)(u.Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-500"}),(0,a.jsx)(r.I,{className:"pl-9",placeholder:"Buscar por nombre o tel\xe9fono...",value:s,onChange:e=>x(e.target.value)})]}),(0,a.jsxs)(o.z,{onClick:()=>y(!0),children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4"})," Nuevo"]})]})]}),(0,a.jsxs)(i.aY,{children:[w&&(0,a.jsx)(c.C,{onClose:()=>y(!1),onSuccess:e=>{R(e),O.refresh()}}),T&&(0,a.jsx)(c._,{mode:"edit",patientId:T.id,defaultValues:{fullName:T.fullName,phone:T.phone,notes:T.notes,optOut:T.optOut},onClose:()=>E(null),onSuccess:e=>{D(e,T),O.refresh()}}),(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(d.iA,{children:[(0,a.jsx)(d.xD,{children:(0,a.jsxs)(d.SC,{children:[(0,a.jsx)(d.ss,{children:"Paciente"}),(0,a.jsx)(d.ss,{children:"Contacto"}),(0,a.jsx)(d.ss,{children:"Pr\xf3ximo Turno"}),(0,a.jsx)(d.ss,{children:"Estado"}),(0,a.jsx)(d.ss,{className:"text-right",children:"Acciones"})]})}),(0,a.jsxs)(d.RM,{children:[M.map(e=>(0,a.jsxs)(d.SC,{children:[(0,a.jsx)(d.pj,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-semibold text-xs",children:e.fullName.slice(0,2).toUpperCase()}),e.fullName]})}),(0,a.jsx)(d.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-slate-600",children:[(0,a.jsx)(f,{className:"h-3 w-3"}),e.phone]})}),(0,a.jsx)(d.pj,{children:e.nextAppointment?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-blue-600 bg-blue-50 px-2 py-1 rounded-md w-fit text-xs font-medium",children:[(0,a.jsx)(p.Z,{className:"h-3 w-3"}),e.nextAppointment]}):(0,a.jsx)("span",{className:"text-slate-400 text-xs italic",children:"Sin turno agendado"})}),(0,a.jsx)(d.pj,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[e.optOut&&(0,a.jsx)(b.C,{label:"Opt-Out",color:"canceled"}),e.noShowCount>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-orange-600 font-medium",children:[(0,a.jsx)(h.Z,{className:"h-3 w-3"})," ",e.noShowCount," No-Show"]}),!e.optOut&&0===e.noShowCount&&(0,a.jsx)("span",{className:"text-slate-500 text-xs",children:"Activo"})]})}),(0,a.jsx)(d.pj,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsxs)(o.z,{size:"sm",variant:"ghost",onClick:()=>E(e),children:[(0,a.jsx)(j,{className:"mr-1 h-4 w-4"})," Editar"]}),(0,a.jsxs)(o.z,{size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>I(e),disabled:C===e.id,children:[(0,a.jsx)(N.Z,{className:"mr-1 h-4 w-4"}),C===e.id?"Eliminando":"Eliminar"]})]})})]},e.id)),0===M.length&&(0,a.jsx)(d.SC,{children:(0,a.jsx)(d.pj,{colSpan:5,className:"h-24 text-center text-slate-500",children:"No se encontraron pacientes que coincidan con tu b\xfasqueda."})})]})]})})]})]})}},3804:function(e,t,s){"use strict";s.d(t,{RM:function(){return i},SC:function(){return c},iA:function(){return r},pj:function(){return u},ss:function(){return d},xD:function(){return o}});var a=s(7437),n=s(2265),l=s(3448);let r=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",s),...n})})});r.displayName="Table";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",s),...n})});o.displayName="TableHeader";let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...n})});i.displayName="TableBody",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...n})}).displayName="TableFooter";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...n})});c.displayName="TableRow";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("th",{ref:t,className:(0,l.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...n})});d.displayName="TableHead";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("td",{ref:t,className:(0,l.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...n})});u.displayName="TableCell",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...n})}).displayName="TableCaption"},8752:function(e,t,s){"use strict";s.d(t,{pm:function(){return m}});var a=s(2265);let n=0,l=new Map,r=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?r(s):e.toasts.forEach(e=>{r(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===t.toastId?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],c={toasts:[]};function d(e){c=o(c,e),i.forEach(e=>{e(c)})}function u(e){let{...t}=e,s=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>d({type:"UPDATE_TOAST",id:s,toast:e})}}function m(){let[e,t]=a.useState(c);return a.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}}},function(e){e.O(0,[851,679,641,118,971,117,744],function(){return e(e.s=1682)}),_N_E=e.O()}]);