"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n\nconst PUBLIC_PATHS = [\n    \"/login\",\n    \"/register\",\n    \"/api/auth/register\",\n    \"/api/webhooks/whatsapp\"\n];\nfunction resolveTenantId(host) {\n    if (!host) return \"tenant_1\";\n    const lower = host.toLowerCase();\n    if (lower.startsWith(\"localhost\") || lower.startsWith(\"127.\")) {\n        return \"tenant_1\";\n    }\n    const parts = lower.split(\".\");\n    if (parts.length < 3) return \"tenant_1\";\n    const subdomain = parts[0];\n    if (!subdomain || subdomain === \"www\") return \"tenant_1\";\n    return subdomain;\n}\nfunction middleware(request) {\n    const { pathname, host } = request.nextUrl;\n    const isPublic = PUBLIC_PATHS.some((path)=>pathname.startsWith(path));\n    const hasSession = Boolean(request.cookies.get(\"sb-access-token\"));\n    if (!isPublic && !hasSession) {\n        const url = request.nextUrl.clone();\n        url.pathname = \"/login\";\n        url.searchParams.set(\"redirect\", pathname);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    const tenantId = resolveTenantId(host);\n    const requestHeaders = new Headers(request.headers);\n    requestHeaders.set(\"x-tenant-id\", tenantId);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next({\n        request: {\n            headers: requestHeaders\n        }\n    });\n}\nconst config = {\n    matcher: [\n        \"/((?!_next/static|_next/image|favicon.ico).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL21pZGRsZXdhcmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXdEO0FBRXhELE1BQU1DLGVBQWU7SUFDbkI7SUFDQTtJQUNBO0lBQ0E7Q0FDRDtBQUVELFNBQVNDLGdCQUFnQkMsSUFBbUI7SUFDMUMsSUFBSSxDQUFDQSxNQUFNLE9BQU87SUFDbEIsTUFBTUMsUUFBUUQsS0FBS0UsV0FBVztJQUM5QixJQUFJRCxNQUFNRSxVQUFVLENBQUMsZ0JBQWdCRixNQUFNRSxVQUFVLENBQUMsU0FBUztRQUM3RCxPQUFPO0lBQ1Q7SUFDQSxNQUFNQyxRQUFRSCxNQUFNSSxLQUFLLENBQUM7SUFDMUIsSUFBSUQsTUFBTUUsTUFBTSxHQUFHLEdBQUcsT0FBTztJQUM3QixNQUFNQyxZQUFZSCxLQUFLLENBQUMsRUFBRTtJQUMxQixJQUFJLENBQUNHLGFBQWFBLGNBQWMsT0FBTyxPQUFPO0lBQzlDLE9BQU9BO0FBQ1Q7QUFFTyxTQUFTQyxXQUFXQyxPQUFvQjtJQUM3QyxNQUFNLEVBQUVDLFFBQVEsRUFBRVYsSUFBSSxFQUFFLEdBQUdTLFFBQVFFLE9BQU87SUFFMUMsTUFBTUMsV0FBV2QsYUFBYWUsSUFBSSxDQUFDLENBQUNDLE9BQVNKLFNBQVNQLFVBQVUsQ0FBQ1c7SUFDakUsTUFBTUMsYUFBYUMsUUFBUVAsUUFBUVEsT0FBTyxDQUFDQyxHQUFHLENBQUM7SUFFL0MsSUFBSSxDQUFDTixZQUFZLENBQUNHLFlBQVk7UUFDNUIsTUFBTUksTUFBTVYsUUFBUUUsT0FBTyxDQUFDUyxLQUFLO1FBQ2pDRCxJQUFJVCxRQUFRLEdBQUc7UUFDZlMsSUFBSUUsWUFBWSxDQUFDQyxHQUFHLENBQUMsWUFBWVo7UUFDakMsT0FBT2IscURBQVlBLENBQUMwQixRQUFRLENBQUNKO0lBQy9CO0lBRUEsTUFBTUssV0FBV3pCLGdCQUFnQkM7SUFDakMsTUFBTXlCLGlCQUFpQixJQUFJQyxRQUFRakIsUUFBUWtCLE9BQU87SUFDbERGLGVBQWVILEdBQUcsQ0FBQyxlQUFlRTtJQUVsQyxPQUFPM0IscURBQVlBLENBQUMrQixJQUFJLENBQUM7UUFDdkJuQixTQUFTO1lBQ1BrQixTQUFTRjtRQUNYO0lBQ0Y7QUFDRjtBQUVPLE1BQU1JLFNBQVM7SUFDcEJDLFNBQVM7UUFBQztLQUFnRDtBQUM1RCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9taWRkbGV3YXJlLnRzP2QxOTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xyXG5cclxuY29uc3QgUFVCTElDX1BBVEhTID0gW1xyXG4gIFwiL2xvZ2luXCIsXHJcbiAgXCIvcmVnaXN0ZXJcIixcclxuICBcIi9hcGkvYXV0aC9yZWdpc3RlclwiLFxyXG4gIFwiL2FwaS93ZWJob29rcy93aGF0c2FwcFwiLFxyXG5dO1xyXG5cclxuZnVuY3Rpb24gcmVzb2x2ZVRlbmFudElkKGhvc3Q6IHN0cmluZyB8IG51bGwpOiBzdHJpbmcge1xyXG4gIGlmICghaG9zdCkgcmV0dXJuIFwidGVuYW50XzFcIjtcclxuICBjb25zdCBsb3dlciA9IGhvc3QudG9Mb3dlckNhc2UoKTtcclxuICBpZiAobG93ZXIuc3RhcnRzV2l0aChcImxvY2FsaG9zdFwiKSB8fCBsb3dlci5zdGFydHNXaXRoKFwiMTI3LlwiKSkge1xyXG4gICAgcmV0dXJuIFwidGVuYW50XzFcIjtcclxuICB9XHJcbiAgY29uc3QgcGFydHMgPSBsb3dlci5zcGxpdChcIi5cIik7XHJcbiAgaWYgKHBhcnRzLmxlbmd0aCA8IDMpIHJldHVybiBcInRlbmFudF8xXCI7XHJcbiAgY29uc3Qgc3ViZG9tYWluID0gcGFydHNbMF07XHJcbiAgaWYgKCFzdWJkb21haW4gfHwgc3ViZG9tYWluID09PSBcInd3d1wiKSByZXR1cm4gXCJ0ZW5hbnRfMVwiO1xyXG4gIHJldHVybiBzdWJkb21haW47XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgY29uc3QgeyBwYXRobmFtZSwgaG9zdCB9ID0gcmVxdWVzdC5uZXh0VXJsO1xyXG5cclxuICBjb25zdCBpc1B1YmxpYyA9IFBVQkxJQ19QQVRIUy5zb21lKChwYXRoKSA9PiBwYXRobmFtZS5zdGFydHNXaXRoKHBhdGgpKTtcclxuICBjb25zdCBoYXNTZXNzaW9uID0gQm9vbGVhbihyZXF1ZXN0LmNvb2tpZXMuZ2V0KFwic2ItYWNjZXNzLXRva2VuXCIpKTtcclxuXHJcbiAgaWYgKCFpc1B1YmxpYyAmJiAhaGFzU2Vzc2lvbikge1xyXG4gICAgY29uc3QgdXJsID0gcmVxdWVzdC5uZXh0VXJsLmNsb25lKCk7XHJcbiAgICB1cmwucGF0aG5hbWUgPSBcIi9sb2dpblwiO1xyXG4gICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJyZWRpcmVjdFwiLCBwYXRobmFtZSk7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KHVybCk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0ZW5hbnRJZCA9IHJlc29sdmVUZW5hbnRJZChob3N0KTtcclxuICBjb25zdCByZXF1ZXN0SGVhZGVycyA9IG5ldyBIZWFkZXJzKHJlcXVlc3QuaGVhZGVycyk7XHJcbiAgcmVxdWVzdEhlYWRlcnMuc2V0KFwieC10ZW5hbnQtaWRcIiwgdGVuYW50SWQpO1xyXG5cclxuICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoe1xyXG4gICAgcmVxdWVzdDoge1xyXG4gICAgICBoZWFkZXJzOiByZXF1ZXN0SGVhZGVycyxcclxuICAgIH0sXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgbWF0Y2hlcjogW1wiLygoPyFfbmV4dC9zdGF0aWN8X25leHQvaW1hZ2V8ZmF2aWNvbi5pY28pLiopXCJdLFxyXG59O1xyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiUFVCTElDX1BBVEhTIiwicmVzb2x2ZVRlbmFudElkIiwiaG9zdCIsImxvd2VyIiwidG9Mb3dlckNhc2UiLCJzdGFydHNXaXRoIiwicGFydHMiLCJzcGxpdCIsImxlbmd0aCIsInN1YmRvbWFpbiIsIm1pZGRsZXdhcmUiLCJyZXF1ZXN0IiwicGF0aG5hbWUiLCJuZXh0VXJsIiwiaXNQdWJsaWMiLCJzb21lIiwicGF0aCIsImhhc1Nlc3Npb24iLCJCb29sZWFuIiwiY29va2llcyIsImdldCIsInVybCIsImNsb25lIiwic2VhcmNoUGFyYW1zIiwic2V0IiwicmVkaXJlY3QiLCJ0ZW5hbnRJZCIsInJlcXVlc3RIZWFkZXJzIiwiSGVhZGVycyIsImhlYWRlcnMiLCJuZXh0IiwiY29uZmlnIiwibWF0Y2hlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});