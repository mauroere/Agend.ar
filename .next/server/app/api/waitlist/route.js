"use strict";(()=>{var e={};e.id=6282,e.ids=[6282],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4878:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var s={};a.r(s),a.d(s,{POST:()=>d});var n=a(9303),r=a(8716),i=a(670),o=a(7070),u=a(3837),l=a(5072);async function d(e){let t=(0,u.j)(),{data:a}=await t.auth.getSession(),s=a.session?.user?.app_metadata?.tenant_id??a.session?.user?.user_metadata?.tenant_id??null,n=e.headers.get("x-tenant-id"),r=s??n;if(!a.session||!r)return o.NextResponse.json({error:"Unauthorized"},{status:401});if(n&&s&&n!==s)return o.NextResponse.json({error:"Tenant mismatch"},{status:403});let i=l.o??t,{patient:d,phone:p,priority:c=1,location_id:m}=await e.json()??{};if(!d||!p)return o.NextResponse.json({error:"Missing patient or phone"},{status:400});let x=p.startsWith("+")?p:`+${p}`,{data:g}=await i.from("agenda_patients").select("id, opt_out").eq("tenant_id",r).eq("phone_e164",x).maybeSingle();if(g?.opt_out)return o.NextResponse.json({error:"Patient opted out"},{status:400});let _=g?.id;if(!_){let{data:e,error:t}=await i.from("agenda_patients").insert({tenant_id:r,full_name:d,phone_e164:x,opt_out:!1}).select("id").single();if(t)return o.NextResponse.json({error:t.message},{status:400});_=e.id}let f=null;if(m){let{data:e}=await i.from("agenda_locations").select("id").eq("tenant_id",r).eq("id",m).maybeSingle();f=e?.id??null}if(!f){let{data:e}=await i.from("agenda_locations").select("id").eq("tenant_id",r).order("name",{ascending:!0}).limit(1).maybeSingle();f=e?.id??null}if(!f)return o.NextResponse.json({error:"Debe crear una ubicaci\xf3n primero"},{status:400});let{error:h}=await i.from("agenda_waitlist").insert({tenant_id:r,location_id:f,patient_id:_,priority:c,active:!0});return h?o.NextResponse.json({error:h.message},{status:400}):o.NextResponse.json({ok:!0})}let p=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/waitlist/route",pathname:"/api/waitlist",filename:"route",bundlePath:"app/api/waitlist/route"},resolvedPagePath:"C:\\Users\\rementeriama\\Downloads\\Code\\Agend.ar\\src\\app\\api\\waitlist\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:x}=p,g="/api/waitlist/route";function _(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},3837:(e,t,a)=>{a.d(t,{j:()=>r});var s=a(1615),n=a(344);function r(){return(0,n.createRouteHandlerClient)({cookies:s.cookies})}},5072:(e,t,a)=>{a.d(t,{o:()=>i});var s=a(7857);let n="https://oaxielrsiogvnxradtsw.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;n&&r||console.warn("Supabase service client is not fully configured.");let i=n&&r?(0,s.eI)(n,r,{auth:{persistSession:!1}}):null}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[9276,7857,5972,958],()=>a(4878));module.exports=s})();