"use strict";(()=>{var e={};e.id=9325,e.ids=[9325],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4957:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>c});var a=r(9303),i=r(8716),o=r(670),s=r(7070),u=r(3837),l=r(5072),d=r(3155);async function c(e){let t=(0,u.j)(),{data:r}=await t.auth.getSession(),n=r.session?.user?.app_metadata?.tenant_id;if(!r.session||!n)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:a}=new URL(e.url),i=a.get("date"),o=a.get("locationId"),c=a.get("duration"),p=a.get("providerId");if(!i||!o)return s.NextResponse.json({error:"Date and Location required"},{status:400});let m=Number.parseInt(c??"30",10),f=l.o??t;try{let e=await (0,d.w)({db:f,tenantId:n,date:i,locationId:o,durationMinutes:m,providerId:p});return s.NextResponse.json({slots:e})}catch(e){if(e instanceof d.T)return s.NextResponse.json({error:e.message},{status:e.status});return console.error("availability.private_unexpected_error",e),s.NextResponse.json({error:"Error inesperado"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/availability/route",pathname:"/api/availability",filename:"route",bundlePath:"app/api/availability/route"},resolvedPagePath:"C:\\Users\\rementeriama\\Downloads\\Code\\Agend.ar\\src\\app\\api\\availability\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:g}=p,w="/api/availability/route";function v(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},259:(e,t,r)=>{function n(e){let{start:t,end:r,businessHours:n,timeZone:a}=e,i=new Intl.DateTimeFormat("en-US",{timeZone:a,weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}),o=Object.fromEntries(i.formatToParts(t).map(e=>[e.type,e.value])),s=Object.fromEntries(i.formatToParts(r).map(e=>[e.type,e.value])),u=(o.weekday??"").slice(0,3).toLowerCase();if(u!==(s.weekday??"").slice(0,3).toLowerCase())return!1;let l=n?.[u];if(!l||0===l.length)return!1;let d=(e,t)=>60*Number(e)+Number(t),c=d(o.hour??"0",o.minute??"0"),p=d(s.hour??"0",s.minute??"0");return l.some(([e,t])=>{let[r,n]=e.split(":"),[a,i]=t.split(":"),o=d(r,n),s=d(a,i);return c>=o&&p<=s})}r.d(t,{U:()=>n})},3837:(e,t,r)=>{r.d(t,{j:()=>i});var n=r(1615),a=r(344);function i(){return(0,a.createRouteHandlerClient)({cookies:n.cookies})}},5072:(e,t,r)=>{r.d(t,{o:()=>o});var n=r(7857);let a="https://oaxielrsiogvnxradtsw.supabase.co",i=process.env.SUPABASE_SERVICE_ROLE_KEY;a&&i||console.warn("Supabase service client is not fully configured.");let o=a&&i?(0,n.eI)(a,i,{auth:{persistSession:!1}}):null},3155:(e,t,r)=>{r.d(t,{T:()=>u,w:()=>l});var n=r(6727),a=r(1155),i=r(9109),o=r(7563),s=r(259);class u extends Error{constructor(e,t=400){super(e),this.status=t}}async function l(e){var t;let{db:r,tenantId:l,date:d,locationId:c,durationMinutes:p,providerId:m}=e,f=Math.max(5,Number.isFinite(p)?p:30);if(!d||!c)throw new u("Date and location required",400);let g=new Date(d);if(!Number.isFinite(g.getTime()))throw new u("Invalid date",400);let{data:w,error:v}=await r.from("agenda_locations").select("business_hours, timezone, buffer_minutes").eq("tenant_id",l).eq("id",c).maybeSingle();if(v)throw new u(v.message,400);if(!w)throw new u("Consultorio no encontrado",404);let h=w.business_hours??{};0===Object.keys(h).length&&(h={mon:[["09:00","18:00"]],tue:[["09:00","18:00"]],wed:[["09:00","18:00"]],thu:[["09:00","18:00"]],fri:[["09:00","18:00"]]});let x=w.timezone??"America/Argentina/Buenos_Aires",_=w.buffer_minutes??0,b=(0,n.b)(g),y=(0,a.m)(b,1440),{data:j,error:q}=await r.from("agenda_appointments").select("start_at, end_at, provider_id, location_id").eq("tenant_id",l).neq("status","canceled").gte("end_at",b.toISOString()).lte("start_at",y.toISOString());if(q)throw new u(q.message,400);let S=(j??[]).filter(e=>m?e.provider_id===m||!e.provider_id&&e.location_id===c:e.location_id===c),R=[],T=b,E=(0,n.b)(new Date).getTime()===b.getTime();for(;t=T,+(0,i.Q)(t)<+(0,i.Q)(y);){let e=(0,a.m)(T,f);(0,s.U)({start:T,end:e,businessHours:h,timeZone:x})&&!S.some(t=>{let r=new Date(t.start_at),n=new Date(t.end_at),i=(0,a.m)(r,-_),o=(0,a.m)(n,_);return T<o&&e>i})&&(!E||function(e,t){let r=(0,i.Q)(e),n=(0,i.Q)(t);return r.getTime()>n.getTime()}(T,new Date))&&R.push((0,o.WU)(T,"HH:mm")),T=(0,a.m)(T,30)}return R}},1459:(e,t,r)=>{r.d(t,{n:()=>i});var n=r(9109),a=r(4549);function i(e,t){let r=+(0,n.Q)(e);return(0,a.L)(e,r+t)}},1155:(e,t,r)=>{r.d(t,{m:()=>i});var n=r(1459),a=r(2313);function i(e,t){return(0,n.n)(e,t*a.yJ)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,7857,5972,958,7563],()=>r(4957));module.exports=n})();