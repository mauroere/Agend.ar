"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/public/appointments/route";
exports.ids = ["app/api/public/appointments/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Fappointments%2Froute&page=%2Fapi%2Fpublic%2Fappointments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Fappointments%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Fappointments%2Froute&page=%2Fapi%2Fpublic%2Fappointments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Fappointments%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_rementeriama_Downloads_Code_Agend_ar_src_app_api_public_appointments_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/public/appointments/route.ts */ \"(rsc)/./src/app/api/public/appointments/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/public/appointments/route\",\n        pathname: \"/api/public/appointments\",\n        filename: \"route\",\n        bundlePath: \"app/api/public/appointments/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\rementeriama\\\\Downloads\\\\Code\\\\Agend.ar\\\\src\\\\app\\\\api\\\\public\\\\appointments\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_rementeriama_Downloads_Code_Agend_ar_src_app_api_public_appointments_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/public/appointments/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwdWJsaWMlMkZhcHBvaW50bWVudHMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnB1YmxpYyUyRmFwcG9pbnRtZW50cyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnB1YmxpYyUyRmFwcG9pbnRtZW50cyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNyZW1lbnRlcmlhbWElNUNEb3dubG9hZHMlNUNDb2RlJTVDQWdlbmQuYXIlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q3JlbWVudGVyaWFtYSU1Q0Rvd25sb2FkcyU1Q0NvZGUlNUNBZ2VuZC5hciZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDaUQ7QUFDOUg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8/ZjM1YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxyZW1lbnRlcmlhbWFcXFxcRG93bmxvYWRzXFxcXENvZGVcXFxcQWdlbmQuYXJcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccHVibGljXFxcXGFwcG9pbnRtZW50c1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcHVibGljL2FwcG9pbnRtZW50cy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3B1YmxpYy9hcHBvaW50bWVudHNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3B1YmxpYy9hcHBvaW50bWVudHMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxyZW1lbnRlcmlhbWFcXFxcRG93bmxvYWRzXFxcXENvZGVcXFxcQWdlbmQuYXJcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccHVibGljXFxcXGFwcG9pbnRtZW50c1xcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvcHVibGljL2FwcG9pbnRtZW50cy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Fappointments%2Froute&page=%2Fapi%2Fpublic%2Fappointments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Fappointments%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/public/appointments/route.ts":
/*!**************************************************!*\
  !*** ./src/app/api/public/appointments/route.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase/service */ \"(rsc)/./src/lib/supabase/service.ts\");\n/* harmony import */ var _server_appointments_createAppointment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/appointments/createAppointment */ \"(rsc)/./src/server/appointments/createAppointment.ts\");\n/* harmony import */ var _server_tenant_headers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/tenant-headers */ \"(rsc)/./src/server/tenant-headers.ts\");\n/* harmony import */ var _server_tenant_routing__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/tenant-routing */ \"(rsc)/./src/server/tenant-routing.ts\");\n\n\n\n\n\nasync function POST(request) {\n    if (!_lib_supabase_service__WEBPACK_IMPORTED_MODULE_1__.serviceClient) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Service client is not configured\"\n        }, {\n            status: 500\n        });\n    }\n    const body = await request.json();\n    const headerInfo = (0,_server_tenant_headers__WEBPACK_IMPORTED_MODULE_3__.getTenantHeaderInfo)(request.headers);\n    const { tenantId: tenantParam, tenantSlug, patient, phone, start, duration, service, notes, location_id, serviceId, providerId } = body ?? {};\n    const tenantId = headerInfo.internalId ?? await (0,_server_tenant_routing__WEBPACK_IMPORTED_MODULE_4__.resolveTenantIdFromPublicIdentifier)({\n        tenantId: tenantParam,\n        tenantSlug: tenantSlug ?? tenantParam\n    });\n    if (!tenantId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Tenant requerido\"\n        }, {\n            status: 400\n        });\n    }\n    if (headerInfo.internalId && headerInfo.internalId !== tenantId && !headerInfo.isDevBypass) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Tenant mismatch\"\n        }, {\n            status: 403\n        });\n    }\n    try {\n        const { appointment } = await (0,_server_appointments_createAppointment__WEBPACK_IMPORTED_MODULE_2__.createAppointmentForTenant)({\n            db: _lib_supabase_service__WEBPACK_IMPORTED_MODULE_1__.serviceClient,\n            tenantId,\n            input: {\n                patient,\n                phone,\n                start,\n                duration,\n                serviceName: service ?? null,\n                notes: notes ?? null,\n                locationId: location_id ?? null,\n                serviceId: serviceId ?? null,\n                providerId: providerId ?? null\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: true,\n            appointment\n        });\n    } catch (error) {\n        if (error instanceof _server_appointments_createAppointment__WEBPACK_IMPORTED_MODULE_2__.AppointmentCreationError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: error.message\n            }, {\n                status: error.status\n            });\n        }\n        console.error(\"public.appointment.create_unexpected_error\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Error inesperado\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9wdWJsaWMvYXBwb2ludG1lbnRzL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUF3RDtBQUNEO0FBQ3dEO0FBQ2pEO0FBQ2dCO0FBRXZFLGVBQWVNLEtBQUtDLE9BQW9CO0lBQzdDLElBQUksQ0FBQ04sZ0VBQWFBLEVBQUU7UUFDbEIsT0FBT0QscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQW1DLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3hGO0lBRUEsTUFBTUMsT0FBTyxNQUFNSixRQUFRQyxJQUFJO0lBQy9CLE1BQU1JLGFBQWFSLDJFQUFtQkEsQ0FBQ0csUUFBUU0sT0FBTztJQUN0RCxNQUFNLEVBQ0pDLFVBQVVDLFdBQVcsRUFDckJDLFVBQVUsRUFDVkMsT0FBTyxFQUNQQyxLQUFLLEVBQ0xDLEtBQUssRUFDTEMsUUFBUSxFQUNSQyxPQUFPLEVBQ1BDLEtBQUssRUFDTEMsV0FBVyxFQUNYQyxTQUFTLEVBQ1RDLFVBQVUsRUFDWCxHQUFHZCxRQUFRLENBQUM7SUFFYixNQUFNRyxXQUFXRixXQUFXYyxVQUFVLElBQ2hDLE1BQU1yQiwyRkFBbUNBLENBQUM7UUFBRVMsVUFBVUM7UUFBYUMsWUFBWUEsY0FBY0Q7SUFBWTtJQUUvRyxJQUFJLENBQUNELFVBQVU7UUFDYixPQUFPZCxxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBbUIsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDeEU7SUFFQSxJQUFJRSxXQUFXYyxVQUFVLElBQUlkLFdBQVdjLFVBQVUsS0FBS1osWUFBWSxDQUFDRixXQUFXZSxXQUFXLEVBQUU7UUFDMUYsT0FBTzNCLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFrQixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUN2RTtJQUVBLElBQUk7UUFDRixNQUFNLEVBQUVrQixXQUFXLEVBQUUsR0FBRyxNQUFNekIsa0dBQTBCQSxDQUFDO1lBQ3ZEMEIsSUFBSTVCLGdFQUFhQTtZQUNqQmE7WUFDQWdCLE9BQU87Z0JBQ0xiO2dCQUNBQztnQkFDQUM7Z0JBQ0FDO2dCQUNBVyxhQUFhVixXQUFXO2dCQUN4QkMsT0FBT0EsU0FBUztnQkFDaEJVLFlBQVlULGVBQWU7Z0JBQzNCQyxXQUFXQSxhQUFhO2dCQUN4QkMsWUFBWUEsY0FBYztZQUM1QjtRQUNGO1FBRUEsT0FBT3pCLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRXlCLElBQUk7WUFBTUw7UUFBWTtJQUNuRCxFQUFFLE9BQU9uQixPQUFPO1FBQ2QsSUFBSUEsaUJBQWlCUCw0RkFBd0JBLEVBQUU7WUFDN0MsT0FBT0YscURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBT0EsTUFBTXlCLE9BQU87WUFBQyxHQUFHO2dCQUFFeEIsUUFBUUQsTUFBTUMsTUFBTTtZQUFDO1FBQzVFO1FBRUF5QixRQUFRMUIsS0FBSyxDQUFDLDhDQUE4Q0E7UUFDNUQsT0FBT1QscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQW1CLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3hFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9hcHAvYXBpL3B1YmxpYy9hcHBvaW50bWVudHMvcm91dGUudHM/YjcxOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB7IHNlcnZpY2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Uvc2VydmljZVwiO1xyXG5pbXBvcnQgeyBBcHBvaW50bWVudENyZWF0aW9uRXJyb3IsIGNyZWF0ZUFwcG9pbnRtZW50Rm9yVGVuYW50IH0gZnJvbSBcIkAvc2VydmVyL2FwcG9pbnRtZW50cy9jcmVhdGVBcHBvaW50bWVudFwiO1xyXG5pbXBvcnQgeyBnZXRUZW5hbnRIZWFkZXJJbmZvIH0gZnJvbSBcIkAvc2VydmVyL3RlbmFudC1oZWFkZXJzXCI7XHJcbmltcG9ydCB7IHJlc29sdmVUZW5hbnRJZEZyb21QdWJsaWNJZGVudGlmaWVyIH0gZnJvbSBcIkAvc2VydmVyL3RlbmFudC1yb3V0aW5nXCI7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIGlmICghc2VydmljZUNsaWVudCkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiU2VydmljZSBjbGllbnQgaXMgbm90IGNvbmZpZ3VyZWRcIiB9LCB7IHN0YXR1czogNTAwIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG4gIGNvbnN0IGhlYWRlckluZm8gPSBnZXRUZW5hbnRIZWFkZXJJbmZvKHJlcXVlc3QuaGVhZGVycyBhcyBIZWFkZXJzKTtcclxuICBjb25zdCB7XHJcbiAgICB0ZW5hbnRJZDogdGVuYW50UGFyYW0sXHJcbiAgICB0ZW5hbnRTbHVnLFxyXG4gICAgcGF0aWVudCxcclxuICAgIHBob25lLFxyXG4gICAgc3RhcnQsXHJcbiAgICBkdXJhdGlvbixcclxuICAgIHNlcnZpY2UsXHJcbiAgICBub3RlcyxcclxuICAgIGxvY2F0aW9uX2lkLFxyXG4gICAgc2VydmljZUlkLFxyXG4gICAgcHJvdmlkZXJJZCxcclxuICB9ID0gYm9keSA/PyB7fTtcclxuXHJcbiAgY29uc3QgdGVuYW50SWQgPSBoZWFkZXJJbmZvLmludGVybmFsSWRcclxuICAgID8/IChhd2FpdCByZXNvbHZlVGVuYW50SWRGcm9tUHVibGljSWRlbnRpZmllcih7IHRlbmFudElkOiB0ZW5hbnRQYXJhbSwgdGVuYW50U2x1ZzogdGVuYW50U2x1ZyA/PyB0ZW5hbnRQYXJhbSB9KSk7XHJcblxyXG4gIGlmICghdGVuYW50SWQpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlRlbmFudCByZXF1ZXJpZG9cIiB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gIH1cclxuXHJcbiAgaWYgKGhlYWRlckluZm8uaW50ZXJuYWxJZCAmJiBoZWFkZXJJbmZvLmludGVybmFsSWQgIT09IHRlbmFudElkICYmICFoZWFkZXJJbmZvLmlzRGV2QnlwYXNzKSB7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJUZW5hbnQgbWlzbWF0Y2hcIiB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgYXBwb2ludG1lbnQgfSA9IGF3YWl0IGNyZWF0ZUFwcG9pbnRtZW50Rm9yVGVuYW50KHtcclxuICAgICAgZGI6IHNlcnZpY2VDbGllbnQsXHJcbiAgICAgIHRlbmFudElkLFxyXG4gICAgICBpbnB1dDoge1xyXG4gICAgICAgIHBhdGllbnQsXHJcbiAgICAgICAgcGhvbmUsXHJcbiAgICAgICAgc3RhcnQsXHJcbiAgICAgICAgZHVyYXRpb24sXHJcbiAgICAgICAgc2VydmljZU5hbWU6IHNlcnZpY2UgPz8gbnVsbCxcclxuICAgICAgICBub3Rlczogbm90ZXMgPz8gbnVsbCxcclxuICAgICAgICBsb2NhdGlvbklkOiBsb2NhdGlvbl9pZCA/PyBudWxsLFxyXG4gICAgICAgIHNlcnZpY2VJZDogc2VydmljZUlkID8/IG51bGwsXHJcbiAgICAgICAgcHJvdmlkZXJJZDogcHJvdmlkZXJJZCA/PyBudWxsLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgb2s6IHRydWUsIGFwcG9pbnRtZW50IH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBBcHBvaW50bWVudENyZWF0aW9uRXJyb3IpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IGVycm9yLnN0YXR1cyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmVycm9yKFwicHVibGljLmFwcG9pbnRtZW50LmNyZWF0ZV91bmV4cGVjdGVkX2Vycm9yXCIsIGVycm9yKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkVycm9yIGluZXNwZXJhZG9cIiB9LCB7IHN0YXR1czogNTAwIH0pO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwic2VydmljZUNsaWVudCIsIkFwcG9pbnRtZW50Q3JlYXRpb25FcnJvciIsImNyZWF0ZUFwcG9pbnRtZW50Rm9yVGVuYW50IiwiZ2V0VGVuYW50SGVhZGVySW5mbyIsInJlc29sdmVUZW5hbnRJZEZyb21QdWJsaWNJZGVudGlmaWVyIiwiUE9TVCIsInJlcXVlc3QiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJib2R5IiwiaGVhZGVySW5mbyIsImhlYWRlcnMiLCJ0ZW5hbnRJZCIsInRlbmFudFBhcmFtIiwidGVuYW50U2x1ZyIsInBhdGllbnQiLCJwaG9uZSIsInN0YXJ0IiwiZHVyYXRpb24iLCJzZXJ2aWNlIiwibm90ZXMiLCJsb2NhdGlvbl9pZCIsInNlcnZpY2VJZCIsInByb3ZpZGVySWQiLCJpbnRlcm5hbElkIiwiaXNEZXZCeXBhc3MiLCJhcHBvaW50bWVudCIsImRiIiwiaW5wdXQiLCJzZXJ2aWNlTmFtZSIsImxvY2F0aW9uSWQiLCJvayIsIm1lc3NhZ2UiLCJjb25zb2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/public/appointments/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/constants.ts":
/*!******************************!*\
  !*** ./src/lib/constants.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   APPOINTMENT_STATUS: () => (/* binding */ APPOINTMENT_STATUS),\n/* harmony export */   APP_TIMEZONE: () => (/* binding */ APP_TIMEZONE),\n/* harmony export */   CRON_SECRET_HEADER: () => (/* binding */ CRON_SECRET_HEADER),\n/* harmony export */   DEFAULT_SLOT_DURATION_MIN: () => (/* binding */ DEFAULT_SLOT_DURATION_MIN),\n/* harmony export */   SLOT_LOOKAHEAD_DAYS: () => (/* binding */ SLOT_LOOKAHEAD_DAYS),\n/* harmony export */   WAITLIST_LOOKAHEAD_HOURS: () => (/* binding */ WAITLIST_LOOKAHEAD_HOURS)\n/* harmony export */ });\nconst APP_TIMEZONE = \"America/Argentina/Buenos_Aires\";\nconst DEFAULT_SLOT_DURATION_MIN = 30;\nconst SLOT_LOOKAHEAD_DAYS = 7;\nconst WAITLIST_LOOKAHEAD_HOURS = 48;\nconst APPOINTMENT_STATUS = [\n    \"pending\",\n    \"confirmed\",\n    \"reschedule_requested\",\n    \"canceled\",\n    \"completed\",\n    \"no_show\"\n];\nconst CRON_SECRET_HEADER = \"x-cron-secret\";\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2NvbnN0YW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBTyxNQUFNQSxlQUFlLGlDQUEwQztBQUMvRCxNQUFNQyw0QkFBNEIsR0FBRztBQUNyQyxNQUFNQyxzQkFBc0IsRUFBRTtBQUM5QixNQUFNQywyQkFBMkIsR0FBRztBQUVwQyxNQUFNQyxxQkFBcUI7SUFDaEM7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0NBQ0QsQ0FBVTtBQUlKLE1BQU1DLHFCQUFxQixnQkFBZ0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9saWIvY29uc3RhbnRzLnRzP2ZiZjkiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IEFQUF9USU1FWk9ORSA9IFwiQW1lcmljYS9BcmdlbnRpbmEvQnVlbm9zX0FpcmVzXCIgYXMgY29uc3Q7XHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NMT1RfRFVSQVRJT05fTUlOID0gMzA7XHJcbmV4cG9ydCBjb25zdCBTTE9UX0xPT0tBSEVBRF9EQVlTID0gNztcclxuZXhwb3J0IGNvbnN0IFdBSVRMSVNUX0xPT0tBSEVBRF9IT1VSUyA9IDQ4O1xyXG5cclxuZXhwb3J0IGNvbnN0IEFQUE9JTlRNRU5UX1NUQVRVUyA9IFtcclxuICBcInBlbmRpbmdcIixcclxuICBcImNvbmZpcm1lZFwiLFxyXG4gIFwicmVzY2hlZHVsZV9yZXF1ZXN0ZWRcIixcclxuICBcImNhbmNlbGVkXCIsXHJcbiAgXCJjb21wbGV0ZWRcIixcclxuICBcIm5vX3Nob3dcIixcclxuXSBhcyBjb25zdDtcclxuXHJcbmV4cG9ydCB0eXBlIEFwcG9pbnRtZW50U3RhdHVzID0gKHR5cGVvZiBBUFBPSU5UTUVOVF9TVEFUVVMpW251bWJlcl07XHJcblxyXG5leHBvcnQgY29uc3QgQ1JPTl9TRUNSRVRfSEVBREVSID0gXCJ4LWNyb24tc2VjcmV0XCI7XHJcbiJdLCJuYW1lcyI6WyJBUFBfVElNRVpPTkUiLCJERUZBVUxUX1NMT1RfRFVSQVRJT05fTUlOIiwiU0xPVF9MT09LQUhFQURfREFZUyIsIldBSVRMSVNUX0xPT0tBSEVBRF9IT1VSUyIsIkFQUE9JTlRNRU5UX1NUQVRVUyIsIkNST05fU0VDUkVUX0hFQURFUiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/constants.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/logging.ts":
/*!****************************!*\
  !*** ./src/lib/logging.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   log: () => (/* binding */ log),\n/* harmony export */   logError: () => (/* binding */ logError),\n/* harmony export */   logInfo: () => (/* binding */ logInfo),\n/* harmony export */   logWarn: () => (/* binding */ logWarn)\n/* harmony export */ });\nfunction log(level, message, ctx = {}) {\n    const base = {\n        level,\n        message,\n        timestamp: new Date().toISOString(),\n        ...ctx\n    };\n    // eslint-disable-next-line no-console\n    console[level === \"error\" ? \"error\" : level === \"warn\" ? \"warn\" : \"log\"](JSON.stringify(base));\n    return base;\n}\nfunction logInfo(message, ctx) {\n    return log(\"info\", message, ctx);\n}\nfunction logWarn(message, ctx) {\n    return log(\"warn\", message, ctx);\n}\nfunction logError(message, ctx) {\n    return log(\"error\", message, ctx);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2xvZ2dpbmcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQVlPLFNBQVNBLElBQUlDLEtBQWUsRUFBRUMsT0FBZSxFQUFFQyxNQUFrQixDQUFDLENBQUM7SUFDeEUsTUFBTUMsT0FBTztRQUFFSDtRQUFPQztRQUFTRyxXQUFXLElBQUlDLE9BQU9DLFdBQVc7UUFBSSxHQUFHSixHQUFHO0lBQUM7SUFDM0Usc0NBQXNDO0lBQ3RDSyxPQUFPLENBQUNQLFVBQVUsVUFBVSxVQUFVQSxVQUFVLFNBQVMsU0FBUyxNQUFNLENBQUNRLEtBQUtDLFNBQVMsQ0FBQ047SUFDeEYsT0FBT0E7QUFDVDtBQUVPLFNBQVNPLFFBQVFULE9BQWUsRUFBRUMsR0FBZ0I7SUFDdkQsT0FBT0gsSUFBSSxRQUFRRSxTQUFTQztBQUM5QjtBQUVPLFNBQVNTLFFBQVFWLE9BQWUsRUFBRUMsR0FBZ0I7SUFDdkQsT0FBT0gsSUFBSSxRQUFRRSxTQUFTQztBQUM5QjtBQUVPLFNBQVNVLFNBQVNYLE9BQWUsRUFBRUMsR0FBZ0I7SUFDeEQsT0FBT0gsSUFBSSxTQUFTRSxTQUFTQztBQUMvQiIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL2xpYi9sb2dnaW5nLnRzP2FlMGYiXSwic291cmNlc0NvbnRlbnQiOlsidHlwZSBMb2dMZXZlbCA9IFwiaW5mb1wiIHwgXCJ3YXJuXCIgfCBcImVycm9yXCI7XHJcblxyXG50eXBlIExvZ0NvbnRleHQgPSB7XHJcbiAgdGVuYW50X2lkPzogc3RyaW5nIHwgbnVsbDtcclxuICBsb2NhdGlvbl9pZD86IHN0cmluZyB8IG51bGw7XHJcbiAgYXBwb2ludG1lbnRfaWQ/OiBzdHJpbmcgfCBudWxsO1xyXG4gIHBhdGllbnRfaWQ/OiBzdHJpbmcgfCBudWxsO1xyXG4gIGpvYj86IHN0cmluZztcclxuICBwYXlsb2FkPzogdW5rbm93bjtcclxuICBlcnJvcj86IHVua25vd247XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbG9nKGxldmVsOiBMb2dMZXZlbCwgbWVzc2FnZTogc3RyaW5nLCBjdHg6IExvZ0NvbnRleHQgPSB7fSkge1xyXG4gIGNvbnN0IGJhc2UgPSB7IGxldmVsLCBtZXNzYWdlLCB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwgLi4uY3R4IH07XHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcclxuICBjb25zb2xlW2xldmVsID09PSBcImVycm9yXCIgPyBcImVycm9yXCIgOiBsZXZlbCA9PT0gXCJ3YXJuXCIgPyBcIndhcm5cIiA6IFwibG9nXCJdKEpTT04uc3RyaW5naWZ5KGJhc2UpKTtcclxuICByZXR1cm4gYmFzZTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvZ0luZm8obWVzc2FnZTogc3RyaW5nLCBjdHg/OiBMb2dDb250ZXh0KSB7XHJcbiAgcmV0dXJuIGxvZyhcImluZm9cIiwgbWVzc2FnZSwgY3R4KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvZ1dhcm4obWVzc2FnZTogc3RyaW5nLCBjdHg/OiBMb2dDb250ZXh0KSB7XHJcbiAgcmV0dXJuIGxvZyhcIndhcm5cIiwgbWVzc2FnZSwgY3R4KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvZ0Vycm9yKG1lc3NhZ2U6IHN0cmluZywgY3R4PzogTG9nQ29udGV4dCkge1xyXG4gIHJldHVybiBsb2coXCJlcnJvclwiLCBtZXNzYWdlLCBjdHgpO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJsb2ciLCJsZXZlbCIsIm1lc3NhZ2UiLCJjdHgiLCJiYXNlIiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiY29uc29sZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJsb2dJbmZvIiwibG9nV2FybiIsImxvZ0Vycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/logging.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/messages.ts":
/*!*****************************!*\
  !*** ./src/lib/messages.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TEMPLATE_NAMES: () => (/* binding */ TEMPLATE_NAMES),\n/* harmony export */   templatePreview: () => (/* binding */ templatePreview)\n/* harmony export */ });\nconst TEMPLATE_NAMES = {\n    appointmentCreated: \"appointment_created\",\n    appointmentConfirmed: \"appointment_confirmed\",\n    reminder24h: \"reminder_24h\",\n    reminder2h: \"reminder_2h\",\n    waitlistOffer: \"waitlist_offer\"\n};\nconst templatePreview = {\n    [TEMPLATE_NAMES.appointmentCreated]: \"Hola {{1}}, agendamos tu turno para {{2}} a las {{3}} en {{4}} con {{5}}. Respond\\xe9 1 Confirmar \\xb7 2 Reprogramar \\xb7 3 Cancelar \\xb7 STOP para salir.\",\n    [TEMPLATE_NAMES.appointmentConfirmed]: \"\\xa1Turno confirmado {{1}}! Te esperamos el {{2}} a las {{3}}. Gracias por confirmar.\",\n    [TEMPLATE_NAMES.reminder24h]: \"Recordatorio {{1}} ma\\xf1ana {{2}}. Respond\\xe9 1 Confirmar \\xb7 2 Reprogramar \\xb7 3 Cancelar \\xb7 STOP.\",\n    [TEMPLATE_NAMES.reminder2h]: \"Nos vemos hoy {{1}} a las {{2}}. Si necesit\\xe1s moverlo respond\\xe9 2, cancelar 3.\",\n    [TEMPLATE_NAMES.waitlistOffer]: \"Se liber\\xf3 un turno {{1}} a las {{2}}. Respond\\xe9 SI para tomarlo o STOP para salir.\"\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL21lc3NhZ2VzLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQU8sTUFBTUEsaUJBQWlCO0lBQzVCQyxvQkFBb0I7SUFDcEJDLHNCQUFzQjtJQUN0QkMsYUFBYTtJQUNiQyxZQUFZO0lBQ1pDLGVBQWU7QUFDakIsRUFBVztBQVVKLE1BQU1DLGtCQUFrQjtJQUM3QixDQUFDTixlQUFlQyxrQkFBa0IsQ0FBQyxFQUNqQztJQUNGLENBQUNELGVBQWVFLG9CQUFvQixDQUFDLEVBQ25DO0lBQ0YsQ0FBQ0YsZUFBZUcsV0FBVyxDQUFDLEVBQzFCO0lBQ0YsQ0FBQ0gsZUFBZUksVUFBVSxDQUFDLEVBQ3pCO0lBQ0YsQ0FBQ0osZUFBZUssYUFBYSxDQUFDLEVBQzVCO0FBQ0osRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL2xpYi9tZXNzYWdlcy50cz9iNDY1Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBURU1QTEFURV9OQU1FUyA9IHtcclxuICBhcHBvaW50bWVudENyZWF0ZWQ6IFwiYXBwb2ludG1lbnRfY3JlYXRlZFwiLFxyXG4gIGFwcG9pbnRtZW50Q29uZmlybWVkOiBcImFwcG9pbnRtZW50X2NvbmZpcm1lZFwiLFxyXG4gIHJlbWluZGVyMjRoOiBcInJlbWluZGVyXzI0aFwiLFxyXG4gIHJlbWluZGVyMmg6IFwicmVtaW5kZXJfMmhcIixcclxuICB3YWl0bGlzdE9mZmVyOiBcIndhaXRsaXN0X29mZmVyXCIsXHJcbn0gYXMgY29uc3Q7XHJcblxyXG5leHBvcnQgdHlwZSBUZW1wbGF0ZVJ1bkNvbnRleHQgPSB7XHJcbiAgcGF0aWVudE5hbWU6IHN0cmluZztcclxuICBkYXRlOiBzdHJpbmc7XHJcbiAgdGltZTogc3RyaW5nO1xyXG4gIGxvY2F0aW9uOiBzdHJpbmc7XHJcbiAgcHJvdmlkZXI6IHN0cmluZzsgLy8gQWRkZWQgcHJvdmlkZXJcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCB0ZW1wbGF0ZVByZXZpZXcgPSB7XHJcbiAgW1RFTVBMQVRFX05BTUVTLmFwcG9pbnRtZW50Q3JlYXRlZF06XHJcbiAgICBcIkhvbGEge3sxfX0sIGFnZW5kYW1vcyB0dSB0dXJubyBwYXJhIHt7Mn19IGEgbGFzIHt7M319IGVuIHt7NH19IGNvbiB7ezV9fS4gUmVzcG9uZMOpIDEgQ29uZmlybWFyIMK3IDIgUmVwcm9ncmFtYXIgwrcgMyBDYW5jZWxhciDCtyBTVE9QIHBhcmEgc2FsaXIuXCIsXHJcbiAgW1RFTVBMQVRFX05BTUVTLmFwcG9pbnRtZW50Q29uZmlybWVkXTpcclxuICAgIFwiwqFUdXJubyBjb25maXJtYWRvIHt7MX19ISBUZSBlc3BlcmFtb3MgZWwge3syfX0gYSBsYXMge3szfX0uIEdyYWNpYXMgcG9yIGNvbmZpcm1hci5cIixcclxuICBbVEVNUExBVEVfTkFNRVMucmVtaW5kZXIyNGhdOlxyXG4gICAgXCJSZWNvcmRhdG9yaW8ge3sxfX0gbWHDsWFuYSB7ezJ9fS4gUmVzcG9uZMOpIDEgQ29uZmlybWFyIMK3IDIgUmVwcm9ncmFtYXIgwrcgMyBDYW5jZWxhciDCtyBTVE9QLlwiLFxyXG4gIFtURU1QTEFURV9OQU1FUy5yZW1pbmRlcjJoXTpcclxuICAgIFwiTm9zIHZlbW9zIGhveSB7ezF9fSBhIGxhcyB7ezJ9fS4gU2kgbmVjZXNpdMOhcyBtb3ZlcmxvIHJlc3BvbmTDqSAyLCBjYW5jZWxhciAzLlwiLFxyXG4gIFtURU1QTEFURV9OQU1FUy53YWl0bGlzdE9mZmVyXTpcclxuICAgIFwiU2UgbGliZXLDsyB1biB0dXJubyB7ezF9fSBhIGxhcyB7ezJ9fS4gUmVzcG9uZMOpIFNJIHBhcmEgdG9tYXJsbyBvIFNUT1AgcGFyYSBzYWxpci5cIixcclxufTtcclxuIl0sIm5hbWVzIjpbIlRFTVBMQVRFX05BTUVTIiwiYXBwb2ludG1lbnRDcmVhdGVkIiwiYXBwb2ludG1lbnRDb25maXJtZWQiLCJyZW1pbmRlcjI0aCIsInJlbWluZGVyMmgiLCJ3YWl0bGlzdE9mZmVyIiwidGVtcGxhdGVQcmV2aWV3Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/messages.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/normalization.ts":
/*!**********************************!*\
  !*** ./src/lib/normalization.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   normalizePhoneNumber: () => (/* binding */ normalizePhoneNumber)\n/* harmony export */ });\n/* harmony import */ var _phone_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./phone-utils */ \"(rsc)/./src/lib/phone-utils.ts\");\n\n/**\r\n * Normalizes a phone number to E.164 format.\r\n * Uses libphonenumber-js via validateAndFormatPhone.\r\n * \r\n * Replaces previous regex logic.\r\n */ function normalizePhoneNumber(phone) {\n    if (!phone) return \"\";\n    const normalized = (0,_phone_utils__WEBPACK_IMPORTED_MODULE_0__.normalizeForStorage)(phone);\n    return normalized || phone; // Return original if fails (fallback behavior)\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL25vcm1hbGl6YXRpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBb0Q7QUFFcEQ7Ozs7O0NBS0MsR0FDTSxTQUFTQyxxQkFBcUJDLEtBQWE7SUFDaEQsSUFBSSxDQUFDQSxPQUFPLE9BQU87SUFDbkIsTUFBTUMsYUFBYUgsaUVBQW1CQSxDQUFDRTtJQUN2QyxPQUFPQyxjQUFjRCxPQUFPLCtDQUErQztBQUM3RSIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL2xpYi9ub3JtYWxpemF0aW9uLnRzP2U1YTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbm9ybWFsaXplRm9yU3RvcmFnZSB9IGZyb20gXCIuL3Bob25lLXV0aWxzXCI7XHJcblxyXG4vKipcclxuICogTm9ybWFsaXplcyBhIHBob25lIG51bWJlciB0byBFLjE2NCBmb3JtYXQuXHJcbiAqIFVzZXMgbGlicGhvbmVudW1iZXItanMgdmlhIHZhbGlkYXRlQW5kRm9ybWF0UGhvbmUuXHJcbiAqIFxyXG4gKiBSZXBsYWNlcyBwcmV2aW91cyByZWdleCBsb2dpYy5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVQaG9uZU51bWJlcihwaG9uZTogc3RyaW5nKTogc3RyaW5nIHtcclxuICBpZiAoIXBob25lKSByZXR1cm4gXCJcIjtcclxuICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplRm9yU3RvcmFnZShwaG9uZSk7XHJcbiAgcmV0dXJuIG5vcm1hbGl6ZWQgfHwgcGhvbmU7IC8vIFJldHVybiBvcmlnaW5hbCBpZiBmYWlscyAoZmFsbGJhY2sgYmVoYXZpb3IpXHJcbn1cclxuIl0sIm5hbWVzIjpbIm5vcm1hbGl6ZUZvclN0b3JhZ2UiLCJub3JtYWxpemVQaG9uZU51bWJlciIsInBob25lIiwibm9ybWFsaXplZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/normalization.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/phone-utils.ts":
/*!********************************!*\
  !*** ./src/lib/phone-utils.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   normalizeForStorage: () => (/* binding */ normalizeForStorage),\n/* harmony export */   suggestMobileFix: () => (/* binding */ suggestMobileFix),\n/* harmony export */   validateAndFormatPhone: () => (/* binding */ validateAndFormatPhone)\n/* harmony export */ });\n/* harmony import */ var libphonenumber_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! libphonenumber-js */ \"(rsc)/./node_modules/libphonenumber-js/min/exports/parsePhoneNumberWithError.js\");\n\n// Default to Argentina if no country code is provided in the input\nconst DEFAULT_COUNTRY = \"AR\";\n/**\r\n * Validates and formats a phone number ensuring it is mobile-friendly (WhatsApp).\r\n * Prefers E.164 for storage.\r\n */ function validateAndFormatPhone(input) {\n    if (!input || input.trim() === \"\") {\n        return {\n            isValid: true,\n            formatted: \"\",\n            display: \"\"\n        }; // Allow empty if not required (handled by UI)\n    }\n    try {\n        const phoneNumber = (0,libphonenumber_js__WEBPACK_IMPORTED_MODULE_0__.parsePhoneNumberWithError)(input, DEFAULT_COUNTRY);\n        if (!phoneNumber) {\n            return {\n                isValid: false,\n                error: \"N\\xfamero inv\\xe1lido.\"\n            };\n        }\n        if (!phoneNumber.isValid()) {\n            return {\n                isValid: false,\n                error: \"El n\\xfamero no parece ser v\\xe1lido para la regi\\xf3n.\"\n            };\n        }\n        // Check if it's a possible mobile number (optional, but good for WhatsApp)\n        // getType() returns 'MOBILE', 'FIXED_LINE', etc. E.g. +54 9 ... is mobile in AR.\n        return {\n            isValid: true,\n            formatted: phoneNumber.number,\n            display: phoneNumber.formatInternational()\n        };\n    } catch (error) {\n        return {\n            isValid: false,\n            error: \"Formato irreconocible.\"\n        };\n    }\n}\n/**\r\n * Normalizes a phone number to E.164 format for storage/API.\r\n * Returns null if invalid.\r\n */ function normalizeForStorage(input) {\n    const { isValid, formatted } = validateAndFormatPhone(input);\n    return isValid && formatted ? formatted : null;\n}\n/**\r\n * Heuristic to check if a phone number likely belongs to Argentina but is missing the '9' for mobile\r\n * which is a common error (e.g. entering +54 11... instead of +54 9 11...)\r\n */ function suggestMobileFix(input) {\n    // This is complex, relies on specific country rules. \n    // For now, we rely on libphonenumber-js validation.\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3Bob25lLXV0aWxzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBc0Y7QUFFdEYsbUVBQW1FO0FBQ25FLE1BQU1DLGtCQUFrQjtBQVN4Qjs7O0NBR0MsR0FDTSxTQUFTQyx1QkFBdUJDLEtBQWE7SUFDbEQsSUFBSSxDQUFDQSxTQUFTQSxNQUFNQyxJQUFJLE9BQU8sSUFBSTtRQUNqQyxPQUFPO1lBQUVDLFNBQVM7WUFBTUMsV0FBVztZQUFJQyxTQUFTO1FBQUcsR0FBRyw4Q0FBOEM7SUFDdEc7SUFFQSxJQUFJO1FBQ0YsTUFBTUMsY0FBY1IsNEVBQWdCQSxDQUFDRyxPQUFPRjtRQUU1QyxJQUFJLENBQUNPLGFBQWE7WUFDZCxPQUFPO2dCQUFFSCxTQUFTO2dCQUFPSSxPQUFPO1lBQW1CO1FBQ3ZEO1FBRUEsSUFBSSxDQUFDRCxZQUFZSCxPQUFPLElBQUk7WUFDMUIsT0FBTztnQkFBRUEsU0FBUztnQkFBT0ksT0FBTztZQUFpRDtRQUNuRjtRQUVBLDJFQUEyRTtRQUMzRSxpRkFBaUY7UUFFakYsT0FBTztZQUNMSixTQUFTO1lBQ1RDLFdBQVdFLFlBQVlFLE1BQU07WUFDN0JILFNBQVNDLFlBQVlHLG1CQUFtQjtRQUMxQztJQUNGLEVBQUUsT0FBT0YsT0FBTztRQUNkLE9BQU87WUFBRUosU0FBUztZQUFPSSxPQUFPO1FBQXlCO0lBQzNEO0FBQ0Y7QUFFQTs7O0NBR0MsR0FDTSxTQUFTRyxvQkFBb0JULEtBQWE7SUFDL0MsTUFBTSxFQUFFRSxPQUFPLEVBQUVDLFNBQVMsRUFBRSxHQUFHSix1QkFBdUJDO0lBQ3RELE9BQU9FLFdBQVdDLFlBQVlBLFlBQVk7QUFDNUM7QUFFQTs7O0NBR0MsR0FDTSxTQUFTTyxpQkFBaUJWLEtBQWE7SUFDMUMsc0RBQXNEO0lBQ3RELG9EQUFvRDtJQUNwRCxPQUFPO0FBQ1giLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9saWIvcGhvbmUtdXRpbHMudHM/N2JjNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwYXJzZVBob25lTnVtYmVyLCBpc1ZhbGlkUGhvbmVOdW1iZXIsIFBob25lTnVtYmVyIH0gZnJvbSAnbGlicGhvbmVudW1iZXItanMnO1xyXG5cclxuLy8gRGVmYXVsdCB0byBBcmdlbnRpbmEgaWYgbm8gY291bnRyeSBjb2RlIGlzIHByb3ZpZGVkIGluIHRoZSBpbnB1dFxyXG5jb25zdCBERUZBVUxUX0NPVU5UUlkgPSAnQVInO1xyXG5cclxuZXhwb3J0IHR5cGUgUGhvbmVWYWxpZGF0aW9uUmVzdWx0ID0ge1xyXG4gIGlzVmFsaWQ6IGJvb2xlYW47XHJcbiAgZm9ybWF0dGVkPzogc3RyaW5nOyAvLyBFLjE2NCBmb3JtYXQgKCs1NDkxMS4uLilcclxuICBkaXNwbGF5Pzogc3RyaW5nOyAgIC8vIE5hdGlvbmFsIG9yIEludGVybmF0aW9uYWwgZm9ybWF0IGZvciBkaXNwbGF5XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn07XHJcblxyXG4vKipcclxuICogVmFsaWRhdGVzIGFuZCBmb3JtYXRzIGEgcGhvbmUgbnVtYmVyIGVuc3VyaW5nIGl0IGlzIG1vYmlsZS1mcmllbmRseSAoV2hhdHNBcHApLlxyXG4gKiBQcmVmZXJzIEUuMTY0IGZvciBzdG9yYWdlLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQW5kRm9ybWF0UGhvbmUoaW5wdXQ6IHN0cmluZyk6IFBob25lVmFsaWRhdGlvblJlc3VsdCB7XHJcbiAgaWYgKCFpbnB1dCB8fCBpbnB1dC50cmltKCkgPT09ICcnKSB7XHJcbiAgICByZXR1cm4geyBpc1ZhbGlkOiB0cnVlLCBmb3JtYXR0ZWQ6ICcnLCBkaXNwbGF5OiAnJyB9OyAvLyBBbGxvdyBlbXB0eSBpZiBub3QgcmVxdWlyZWQgKGhhbmRsZWQgYnkgVUkpXHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgcGhvbmVOdW1iZXIgPSBwYXJzZVBob25lTnVtYmVyKGlucHV0LCBERUZBVUxUX0NPVU5UUlkpO1xyXG5cclxuICAgIGlmICghcGhvbmVOdW1iZXIpIHtcclxuICAgICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6ICdOw7ptZXJvIGludsOhbGlkby4nIH07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFwaG9uZU51bWJlci5pc1ZhbGlkKCkpIHtcclxuICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiAnRWwgbsO6bWVybyBubyBwYXJlY2Ugc2VyIHbDoWxpZG8gcGFyYSBsYSByZWdpw7NuLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayBpZiBpdCdzIGEgcG9zc2libGUgbW9iaWxlIG51bWJlciAob3B0aW9uYWwsIGJ1dCBnb29kIGZvciBXaGF0c0FwcClcclxuICAgIC8vIGdldFR5cGUoKSByZXR1cm5zICdNT0JJTEUnLCAnRklYRURfTElORScsIGV0Yy4gRS5nLiArNTQgOSAuLi4gaXMgbW9iaWxlIGluIEFSLlxyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpc1ZhbGlkOiB0cnVlLFxyXG4gICAgICBmb3JtYXR0ZWQ6IHBob25lTnVtYmVyLm51bWJlciwgLy8gRS4xNjRcclxuICAgICAgZGlzcGxheTogcGhvbmVOdW1iZXIuZm9ybWF0SW50ZXJuYXRpb25hbCgpLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiAnRm9ybWF0byBpcnJlY29ub2NpYmxlLicgfTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBOb3JtYWxpemVzIGEgcGhvbmUgbnVtYmVyIHRvIEUuMTY0IGZvcm1hdCBmb3Igc3RvcmFnZS9BUEkuXHJcbiAqIFJldHVybnMgbnVsbCBpZiBpbnZhbGlkLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUZvclN0b3JhZ2UoaW5wdXQ6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xyXG4gIGNvbnN0IHsgaXNWYWxpZCwgZm9ybWF0dGVkIH0gPSB2YWxpZGF0ZUFuZEZvcm1hdFBob25lKGlucHV0KTtcclxuICByZXR1cm4gaXNWYWxpZCAmJiBmb3JtYXR0ZWQgPyBmb3JtYXR0ZWQgOiBudWxsO1xyXG59XHJcblxyXG4vKipcclxuICogSGV1cmlzdGljIHRvIGNoZWNrIGlmIGEgcGhvbmUgbnVtYmVyIGxpa2VseSBiZWxvbmdzIHRvIEFyZ2VudGluYSBidXQgaXMgbWlzc2luZyB0aGUgJzknIGZvciBtb2JpbGVcclxuICogd2hpY2ggaXMgYSBjb21tb24gZXJyb3IgKGUuZy4gZW50ZXJpbmcgKzU0IDExLi4uIGluc3RlYWQgb2YgKzU0IDkgMTEuLi4pXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gc3VnZ2VzdE1vYmlsZUZpeChpbnB1dDogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XHJcbiAgICAvLyBUaGlzIGlzIGNvbXBsZXgsIHJlbGllcyBvbiBzcGVjaWZpYyBjb3VudHJ5IHJ1bGVzLiBcclxuICAgIC8vIEZvciBub3csIHdlIHJlbHkgb24gbGlicGhvbmVudW1iZXItanMgdmFsaWRhdGlvbi5cclxuICAgIHJldHVybiBudWxsOyBcclxufVxyXG4iXSwibmFtZXMiOlsicGFyc2VQaG9uZU51bWJlciIsIkRFRkFVTFRfQ09VTlRSWSIsInZhbGlkYXRlQW5kRm9ybWF0UGhvbmUiLCJpbnB1dCIsInRyaW0iLCJpc1ZhbGlkIiwiZm9ybWF0dGVkIiwiZGlzcGxheSIsInBob25lTnVtYmVyIiwiZXJyb3IiLCJudW1iZXIiLCJmb3JtYXRJbnRlcm5hdGlvbmFsIiwibm9ybWFsaXplRm9yU3RvcmFnZSIsInN1Z2dlc3RNb2JpbGVGaXgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/phone-utils.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/scheduling.ts":
/*!*******************************!*\
  !*** ./src/lib/scheduling.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   calculateAvailability: () => (/* binding */ calculateAvailability),\n/* harmony export */   isWithinBusinessHours: () => (/* binding */ isWithinBusinessHours)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! __barrel_optimize__?names=addMinutes,isBefore!=!date-fns */ \"(rsc)/./node_modules/date-fns/isBefore.mjs\");\n/* harmony import */ var _barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! __barrel_optimize__?names=addMinutes,isBefore!=!date-fns */ \"(rsc)/./node_modules/date-fns/addMinutes.mjs\");\n/* harmony import */ var _lib_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/constants */ \"(rsc)/./src/lib/constants.ts\");\n\n\nfunction isWithinBusinessHours(options) {\n    const { start, end, businessHours, timeZone } = options;\n    const fmt = new Intl.DateTimeFormat(\"en-US\", {\n        timeZone,\n        weekday: \"short\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hour12: false\n    });\n    const partsStart = Object.fromEntries(fmt.formatToParts(start).map((p)=>[\n            p.type,\n            p.value\n        ]));\n    const partsEnd = Object.fromEntries(fmt.formatToParts(end).map((p)=>[\n            p.type,\n            p.value\n        ]));\n    const dayKey = (partsStart.weekday ?? \"\").slice(0, 3).toLowerCase(); // mon/tue...\n    if (dayKey !== (partsEnd.weekday ?? \"\").slice(0, 3).toLowerCase()) return false;\n    const intervals = businessHours?.[dayKey];\n    if (!intervals || intervals.length === 0) return false;\n    const toMinutes = (h, m)=>Number(h) * 60 + Number(m);\n    const startMinutes = toMinutes(partsStart.hour ?? \"0\", partsStart.minute ?? \"0\");\n    const endMinutes = toMinutes(partsEnd.hour ?? \"0\", partsEnd.minute ?? \"0\");\n    return intervals.some(([from, to])=>{\n        const [fh, fm] = from.split(\":\");\n        const [th, tm] = to.split(\":\");\n        const fromM = toMinutes(fh, fm);\n        const toM = toMinutes(th, tm);\n        return startMinutes >= fromM && endMinutes <= toM;\n    });\n}\nfunction calculateAvailability({ start, end, appointments, durationMinutes = _lib_constants__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SLOT_DURATION_MIN, bufferMinutes = 0 }) {\n    const slots = [];\n    let cursor = new Date(start);\n    while((0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_1__.isBefore)((0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__.addMinutes)(cursor, durationMinutes), end)){\n        const candidateEnd = (0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__.addMinutes)(cursor, durationMinutes);\n        const overlaps = appointments.some((appt)=>{\n            const apptStart = new Date(appt.start_at);\n            const apptEnd = new Date(appt.end_at);\n            return cursor < apptEnd && candidateEnd > apptStart;\n        });\n        if (!overlaps) {\n            slots.push({\n                start: new Date(cursor),\n                end: candidateEnd\n            });\n        }\n        cursor = (0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__.addMinutes)(cursor, durationMinutes + bufferMinutes);\n    }\n    return slots;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NjaGVkdWxpbmcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBZ0Q7QUFDWTtBQU9yRCxTQUFTRyxzQkFBc0JDLE9BS3JDO0lBQ0MsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLEdBQUcsRUFBRUMsYUFBYSxFQUFFQyxRQUFRLEVBQUUsR0FBR0o7SUFDaEQsTUFBTUssTUFBTSxJQUFJQyxLQUFLQyxjQUFjLENBQUMsU0FBUztRQUMzQ0g7UUFDQUksU0FBUztRQUNUQyxNQUFNO1FBQ05DLFFBQVE7UUFDUkMsUUFBUTtJQUNWO0lBRUEsTUFBTUMsYUFBYUMsT0FBT0MsV0FBVyxDQUFDVCxJQUFJVSxhQUFhLENBQUNkLE9BQU9lLEdBQUcsQ0FBQyxDQUFDQyxJQUFNO1lBQUNBLEVBQUVDLElBQUk7WUFBRUQsRUFBRUUsS0FBSztTQUFDO0lBQzNGLE1BQU1DLFdBQVdQLE9BQU9DLFdBQVcsQ0FBQ1QsSUFBSVUsYUFBYSxDQUFDYixLQUFLYyxHQUFHLENBQUMsQ0FBQ0MsSUFBTTtZQUFDQSxFQUFFQyxJQUFJO1lBQUVELEVBQUVFLEtBQUs7U0FBQztJQUV2RixNQUFNRSxTQUFTLENBQUNULFdBQVdKLE9BQU8sSUFBSSxFQUFDLEVBQUdjLEtBQUssQ0FBQyxHQUFHLEdBQUdDLFdBQVcsSUFBSSxhQUFhO0lBQ2xGLElBQUlGLFdBQVcsQ0FBQ0QsU0FBU1osT0FBTyxJQUFJLEVBQUMsRUFBR2MsS0FBSyxDQUFDLEdBQUcsR0FBR0MsV0FBVyxJQUFJLE9BQU87SUFFMUUsTUFBTUMsWUFBWXJCLGVBQWUsQ0FBQ2tCLE9BQU87SUFDekMsSUFBSSxDQUFDRyxhQUFhQSxVQUFVQyxNQUFNLEtBQUssR0FBRyxPQUFPO0lBRWpELE1BQU1DLFlBQVksQ0FBQ0MsR0FBV0MsSUFBY0MsT0FBT0YsS0FBSyxLQUFLRSxPQUFPRDtJQUNwRSxNQUFNRSxlQUFlSixVQUFVZCxXQUFXSCxJQUFJLElBQUksS0FBS0csV0FBV0YsTUFBTSxJQUFJO0lBQzVFLE1BQU1xQixhQUFhTCxVQUFVTixTQUFTWCxJQUFJLElBQUksS0FBS1csU0FBU1YsTUFBTSxJQUFJO0lBRXRFLE9BQU9jLFVBQVVRLElBQUksQ0FBQyxDQUFDLENBQUNDLE1BQU1DLEdBQUc7UUFDL0IsTUFBTSxDQUFDQyxJQUFJQyxHQUFHLEdBQUdILEtBQUtJLEtBQUssQ0FBQztRQUM1QixNQUFNLENBQUNDLElBQUlDLEdBQUcsR0FBR0wsR0FBR0csS0FBSyxDQUFDO1FBQzFCLE1BQU1HLFFBQVFkLFVBQVVTLElBQUlDO1FBQzVCLE1BQU1LLE1BQU1mLFVBQVVZLElBQUlDO1FBQzFCLE9BQU9ULGdCQUFnQlUsU0FBU1QsY0FBY1U7SUFDaEQ7QUFDRjtBQUVPLFNBQVNDLHNCQUFzQixFQUNwQ3pDLEtBQUssRUFDTEMsR0FBRyxFQUNIeUMsWUFBWSxFQUNaQyxrQkFBa0I5QyxxRUFBeUIsRUFDM0MrQyxnQkFBZ0IsQ0FBQyxFQU9sQjtJQUNDLE1BQU1DLFFBQXNDLEVBQUU7SUFDOUMsSUFBSUMsU0FBUyxJQUFJQyxLQUFLL0M7SUFFdEIsTUFBT0osNkZBQVFBLENBQUNELCtGQUFVQSxDQUFDbUQsUUFBUUgsa0JBQWtCMUMsS0FBTTtRQUN6RCxNQUFNK0MsZUFBZXJELCtGQUFVQSxDQUFDbUQsUUFBUUg7UUFDeEMsTUFBTU0sV0FBV1AsYUFBYVgsSUFBSSxDQUFDLENBQUNtQjtZQUNsQyxNQUFNQyxZQUFZLElBQUlKLEtBQUtHLEtBQUtFLFFBQVE7WUFDeEMsTUFBTUMsVUFBVSxJQUFJTixLQUFLRyxLQUFLSSxNQUFNO1lBQ3BDLE9BQU9SLFNBQVNPLFdBQVdMLGVBQWVHO1FBQzVDO1FBRUEsSUFBSSxDQUFDRixVQUFVO1lBQ2JKLE1BQU1VLElBQUksQ0FBQztnQkFBRXZELE9BQU8sSUFBSStDLEtBQUtEO2dCQUFTN0MsS0FBSytDO1lBQWE7UUFDMUQ7UUFFQUYsU0FBU25ELCtGQUFVQSxDQUFDbUQsUUFBUUgsa0JBQWtCQztJQUNoRDtJQUVBLE9BQU9DO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9saWIvc2NoZWR1bGluZy50cz8zZWYzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFkZE1pbnV0ZXMsIGlzQmVmb3JlIH0gZnJvbSBcImRhdGUtZm5zXCI7XHJcbmltcG9ydCB7IERFRkFVTFRfU0xPVF9EVVJBVElPTl9NSU4gfSBmcm9tIFwiQC9saWIvY29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSBcIkAvdHlwZXMvZGF0YWJhc2VcIjtcclxuXHJcbmV4cG9ydCB0eXBlIEFwcG9pbnRtZW50Um93ID0gRGF0YWJhc2VbXCJwdWJsaWNcIl1bXCJUYWJsZXNcIl1bXCJhZ2VuZGFfYXBwb2ludG1lbnRzXCJdW1wiUm93XCJdO1xyXG5cclxudHlwZSBCdXNpbmVzc0hvdXJzID0gUmVjb3JkPHN0cmluZywgW3N0cmluZywgc3RyaW5nXVtdPjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1dpdGhpbkJ1c2luZXNzSG91cnMob3B0aW9uczoge1xyXG4gIHN0YXJ0OiBEYXRlO1xyXG4gIGVuZDogRGF0ZTtcclxuICBidXNpbmVzc0hvdXJzOiBCdXNpbmVzc0hvdXJzO1xyXG4gIHRpbWVab25lOiBzdHJpbmc7XHJcbn0pIHtcclxuICBjb25zdCB7IHN0YXJ0LCBlbmQsIGJ1c2luZXNzSG91cnMsIHRpbWVab25lIH0gPSBvcHRpb25zO1xyXG4gIGNvbnN0IGZtdCA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KFwiZW4tVVNcIiwge1xyXG4gICAgdGltZVpvbmUsXHJcbiAgICB3ZWVrZGF5OiBcInNob3J0XCIsXHJcbiAgICBob3VyOiBcIjItZGlnaXRcIixcclxuICAgIG1pbnV0ZTogXCIyLWRpZ2l0XCIsXHJcbiAgICBob3VyMTI6IGZhbHNlLFxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBwYXJ0c1N0YXJ0ID0gT2JqZWN0LmZyb21FbnRyaWVzKGZtdC5mb3JtYXRUb1BhcnRzKHN0YXJ0KS5tYXAoKHApID0+IFtwLnR5cGUsIHAudmFsdWVdKSk7XHJcbiAgY29uc3QgcGFydHNFbmQgPSBPYmplY3QuZnJvbUVudHJpZXMoZm10LmZvcm1hdFRvUGFydHMoZW5kKS5tYXAoKHApID0+IFtwLnR5cGUsIHAudmFsdWVdKSk7XHJcblxyXG4gIGNvbnN0IGRheUtleSA9IChwYXJ0c1N0YXJ0LndlZWtkYXkgPz8gXCJcIikuc2xpY2UoMCwgMykudG9Mb3dlckNhc2UoKTsgLy8gbW9uL3R1ZS4uLlxyXG4gIGlmIChkYXlLZXkgIT09IChwYXJ0c0VuZC53ZWVrZGF5ID8/IFwiXCIpLnNsaWNlKDAsIDMpLnRvTG93ZXJDYXNlKCkpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgY29uc3QgaW50ZXJ2YWxzID0gYnVzaW5lc3NIb3Vycz8uW2RheUtleV07XHJcbiAgaWYgKCFpbnRlcnZhbHMgfHwgaW50ZXJ2YWxzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICBjb25zdCB0b01pbnV0ZXMgPSAoaDogc3RyaW5nLCBtOiBzdHJpbmcpID0+IE51bWJlcihoKSAqIDYwICsgTnVtYmVyKG0pO1xyXG4gIGNvbnN0IHN0YXJ0TWludXRlcyA9IHRvTWludXRlcyhwYXJ0c1N0YXJ0LmhvdXIgPz8gXCIwXCIsIHBhcnRzU3RhcnQubWludXRlID8/IFwiMFwiKTtcclxuICBjb25zdCBlbmRNaW51dGVzID0gdG9NaW51dGVzKHBhcnRzRW5kLmhvdXIgPz8gXCIwXCIsIHBhcnRzRW5kLm1pbnV0ZSA/PyBcIjBcIik7XHJcblxyXG4gIHJldHVybiBpbnRlcnZhbHMuc29tZSgoW2Zyb20sIHRvXSkgPT4ge1xyXG4gICAgY29uc3QgW2ZoLCBmbV0gPSBmcm9tLnNwbGl0KFwiOlwiKTtcclxuICAgIGNvbnN0IFt0aCwgdG1dID0gdG8uc3BsaXQoXCI6XCIpO1xyXG4gICAgY29uc3QgZnJvbU0gPSB0b01pbnV0ZXMoZmgsIGZtKTtcclxuICAgIGNvbnN0IHRvTSA9IHRvTWludXRlcyh0aCwgdG0pO1xyXG4gICAgcmV0dXJuIHN0YXJ0TWludXRlcyA+PSBmcm9tTSAmJiBlbmRNaW51dGVzIDw9IHRvTTtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSh7XHJcbiAgc3RhcnQsXHJcbiAgZW5kLFxyXG4gIGFwcG9pbnRtZW50cyxcclxuICBkdXJhdGlvbk1pbnV0ZXMgPSBERUZBVUxUX1NMT1RfRFVSQVRJT05fTUlOLFxyXG4gIGJ1ZmZlck1pbnV0ZXMgPSAwLFxyXG59OiB7XHJcbiAgc3RhcnQ6IERhdGU7XHJcbiAgZW5kOiBEYXRlO1xyXG4gIGFwcG9pbnRtZW50czogQXBwb2ludG1lbnRSb3dbXTtcclxuICBkdXJhdGlvbk1pbnV0ZXM/OiBudW1iZXI7XHJcbiAgYnVmZmVyTWludXRlcz86IG51bWJlcjtcclxufSkge1xyXG4gIGNvbnN0IHNsb3RzOiB7IHN0YXJ0OiBEYXRlOyBlbmQ6IERhdGUgfVtdID0gW107XHJcbiAgbGV0IGN1cnNvciA9IG5ldyBEYXRlKHN0YXJ0KTtcclxuXHJcbiAgd2hpbGUgKGlzQmVmb3JlKGFkZE1pbnV0ZXMoY3Vyc29yLCBkdXJhdGlvbk1pbnV0ZXMpLCBlbmQpKSB7XHJcbiAgICBjb25zdCBjYW5kaWRhdGVFbmQgPSBhZGRNaW51dGVzKGN1cnNvciwgZHVyYXRpb25NaW51dGVzKTtcclxuICAgIGNvbnN0IG92ZXJsYXBzID0gYXBwb2ludG1lbnRzLnNvbWUoKGFwcHQpID0+IHtcclxuICAgICAgY29uc3QgYXBwdFN0YXJ0ID0gbmV3IERhdGUoYXBwdC5zdGFydF9hdCk7XHJcbiAgICAgIGNvbnN0IGFwcHRFbmQgPSBuZXcgRGF0ZShhcHB0LmVuZF9hdCk7XHJcbiAgICAgIHJldHVybiBjdXJzb3IgPCBhcHB0RW5kICYmIGNhbmRpZGF0ZUVuZCA+IGFwcHRTdGFydDtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghb3ZlcmxhcHMpIHtcclxuICAgICAgc2xvdHMucHVzaCh7IHN0YXJ0OiBuZXcgRGF0ZShjdXJzb3IpLCBlbmQ6IGNhbmRpZGF0ZUVuZCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjdXJzb3IgPSBhZGRNaW51dGVzKGN1cnNvciwgZHVyYXRpb25NaW51dGVzICsgYnVmZmVyTWludXRlcyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc2xvdHM7XHJcbn1cclxuIl0sIm5hbWVzIjpbImFkZE1pbnV0ZXMiLCJpc0JlZm9yZSIsIkRFRkFVTFRfU0xPVF9EVVJBVElPTl9NSU4iLCJpc1dpdGhpbkJ1c2luZXNzSG91cnMiLCJvcHRpb25zIiwic3RhcnQiLCJlbmQiLCJidXNpbmVzc0hvdXJzIiwidGltZVpvbmUiLCJmbXQiLCJJbnRsIiwiRGF0ZVRpbWVGb3JtYXQiLCJ3ZWVrZGF5IiwiaG91ciIsIm1pbnV0ZSIsImhvdXIxMiIsInBhcnRzU3RhcnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImZvcm1hdFRvUGFydHMiLCJtYXAiLCJwIiwidHlwZSIsInZhbHVlIiwicGFydHNFbmQiLCJkYXlLZXkiLCJzbGljZSIsInRvTG93ZXJDYXNlIiwiaW50ZXJ2YWxzIiwibGVuZ3RoIiwidG9NaW51dGVzIiwiaCIsIm0iLCJOdW1iZXIiLCJzdGFydE1pbnV0ZXMiLCJlbmRNaW51dGVzIiwic29tZSIsImZyb20iLCJ0byIsImZoIiwiZm0iLCJzcGxpdCIsInRoIiwidG0iLCJmcm9tTSIsInRvTSIsImNhbGN1bGF0ZUF2YWlsYWJpbGl0eSIsImFwcG9pbnRtZW50cyIsImR1cmF0aW9uTWludXRlcyIsImJ1ZmZlck1pbnV0ZXMiLCJzbG90cyIsImN1cnNvciIsIkRhdGUiLCJjYW5kaWRhdGVFbmQiLCJvdmVybGFwcyIsImFwcHQiLCJhcHB0U3RhcnQiLCJzdGFydF9hdCIsImFwcHRFbmQiLCJlbmRfYXQiLCJwdXNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/scheduling.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase/service.ts":
/*!*************************************!*\
  !*** ./src/lib/supabase/service.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   serviceClient: () => (/* binding */ serviceClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n\nconst url = \"https://oaxielrsiogvnxradtsw.supabase.co\";\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!url || !serviceKey) {\n    console.warn(\"Supabase service client is not fully configured.\");\n}\nconst serviceClient = url && serviceKey ? (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, serviceKey, {\n    auth: {\n        persistSession: false\n    }\n}) : null;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlL3NlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBcUQ7QUFHckQsTUFBTUMsTUFBTUMsMENBQW9DO0FBQ2hELE1BQU1HLGFBQWFILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRXhELElBQUksQ0FBQ0wsT0FBTyxDQUFDSSxZQUFZO0lBQ3ZCRSxRQUFRQyxJQUFJLENBQUM7QUFDZjtBQUVPLE1BQU1DLGdCQUFnQlIsT0FBT0ksYUFDaENMLG1FQUFZQSxDQUFXQyxLQUFLSSxZQUFZO0lBQ3RDSyxNQUFNO1FBQUVDLGdCQUFnQjtJQUFNO0FBQ2hDLEtBQ0EsS0FBSyIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL2xpYi9zdXBhYmFzZS9zZXJ2aWNlLnRzP2MyMGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gXCJAL3R5cGVzL2RhdGFiYXNlXCI7XHJcblxyXG5jb25zdCB1cmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XHJcbmNvbnN0IHNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZO1xyXG5cclxuaWYgKCF1cmwgfHwgIXNlcnZpY2VLZXkpIHtcclxuICBjb25zb2xlLndhcm4oXCJTdXBhYmFzZSBzZXJ2aWNlIGNsaWVudCBpcyBub3QgZnVsbHkgY29uZmlndXJlZC5cIik7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzZXJ2aWNlQ2xpZW50ID0gdXJsICYmIHNlcnZpY2VLZXlcclxuICA/IGNyZWF0ZUNsaWVudDxEYXRhYmFzZT4odXJsLCBzZXJ2aWNlS2V5LCB7XHJcbiAgICAgIGF1dGg6IHsgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0sXHJcbiAgICB9KVxyXG4gIDogbnVsbDtcclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImNvbnNvbGUiLCJ3YXJuIiwic2VydmljZUNsaWVudCIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase/service.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/whatsapp.ts":
/*!*****************************!*\
  !*** ./src/lib/whatsapp.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   sendTemplateMessage: () => (/* binding */ sendTemplateMessage),\n/* harmony export */   sendTextMessage: () => (/* binding */ sendTextMessage)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/types.js\");\n\nconst baseUrl = \"https://graph.facebook.com/v18.0\";\nconst templateSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    name: zod__WEBPACK_IMPORTED_MODULE_0__.string(),\n    language: zod__WEBPACK_IMPORTED_MODULE_0__.object({\n        code: zod__WEBPACK_IMPORTED_MODULE_0__.string()\n    }),\n    components: zod__WEBPACK_IMPORTED_MODULE_0__.array(zod__WEBPACK_IMPORTED_MODULE_0__.any()).optional()\n});\nasync function callWhatsAppAPI({ credentials, path, init }) {\n    const { accessToken, phoneNumberId } = credentials;\n    if (!accessToken || !phoneNumberId) {\n        throw new Error(\"WhatsApp credentials missing\");\n    }\n    // Debug log to verify Identity\n    console.log(`[WhatsApp API] Sending via PhoneID: ${phoneNumberId}`);\n    const res = await fetch(`${baseUrl}/${phoneNumberId}/${path}`, {\n        ...init,\n        headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${accessToken}`,\n            ...init.headers\n        }\n    });\n    if (!res.ok) {\n        const errorText = await res.text();\n        console.error(`[WhatsApp API Error] Status: ${res.status}, Body: ${errorText}`);\n        throw new Error(`WhatsApp API error: ${res.status} ${errorText}`);\n    }\n    return res.json();\n}\nasync function sendTemplateMessage({ to, template, variables = [], languageCode = \"es\", nameOverride, credentials }) {\n    const templateName = nameOverride ?? template;\n    const parsedTemplate = templateSchema.parse({\n        name: templateName,\n        language: {\n            code: languageCode\n        }\n    });\n    // Sanitize phone number: remove non-numeric characters (e.g. +)\n    const cleanTo = to.replace(/\\D/g, \"\");\n    return callWhatsAppAPI({\n        credentials,\n        path: \"messages\",\n        init: {\n            method: \"POST\",\n            body: JSON.stringify({\n                messaging_product: \"whatsapp\",\n                to: cleanTo,\n                type: \"template\",\n                template: {\n                    ...parsedTemplate,\n                    components: [\n                        {\n                            type: \"body\",\n                            parameters: variables.map((value)=>({\n                                    type: \"text\",\n                                    text: value\n                                }))\n                        }\n                    ]\n                }\n            })\n        }\n    });\n}\nasync function sendTextMessage({ to, text, credentials }) {\n    return callWhatsAppAPI({\n        credentials,\n        path: \"messages\",\n        init: {\n            method: \"POST\",\n            body: JSON.stringify({\n                messaging_product: \"whatsapp\",\n                to,\n                type: \"text\",\n                text: {\n                    body: text\n                }\n            })\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3doYXRzYXBwLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF3QjtBQUd4QixNQUFNQyxVQUFVO0FBRWhCLE1BQU1DLGlCQUFpQkYsdUNBQVEsQ0FBQztJQUM5QkksTUFBTUosdUNBQVE7SUFDZE0sVUFBVU4sdUNBQVEsQ0FBQztRQUFFTyxNQUFNUCx1Q0FBUTtJQUFHO0lBQ3RDUSxZQUFZUixzQ0FBTyxDQUFDQSxvQ0FBSyxJQUFJVyxRQUFRO0FBQ3ZDO0FBRUEsZUFBZUMsZ0JBQWdCLEVBQzdCQyxXQUFXLEVBQ1hDLElBQUksRUFDSkMsSUFBSSxFQUtMO0lBQ0MsTUFBTSxFQUFFQyxXQUFXLEVBQUVDLGFBQWEsRUFBRSxHQUFHSjtJQUV2QyxJQUFJLENBQUNHLGVBQWUsQ0FBQ0MsZUFBZTtRQUNsQyxNQUFNLElBQUlDLE1BQU07SUFDbEI7SUFFQSwrQkFBK0I7SUFDL0JDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLG9DQUFvQyxFQUFFSCxjQUFjLENBQUM7SUFFbEUsTUFBTUksTUFBTSxNQUFNQyxNQUFNLENBQUMsRUFBRXJCLFFBQVEsQ0FBQyxFQUFFZ0IsY0FBYyxDQUFDLEVBQUVILEtBQUssQ0FBQyxFQUFFO1FBQzdELEdBQUdDLElBQUk7UUFDUFEsU0FBUztZQUNQLGdCQUFnQjtZQUNoQkMsZUFBZSxDQUFDLE9BQU8sRUFBRVIsWUFBWSxDQUFDO1lBQ3RDLEdBQUdELEtBQUtRLE9BQU87UUFDakI7SUFDRjtJQUVBLElBQUksQ0FBQ0YsSUFBSUksRUFBRSxFQUFFO1FBQ1gsTUFBTUMsWUFBWSxNQUFNTCxJQUFJTSxJQUFJO1FBQ2hDUixRQUFRUyxLQUFLLENBQUMsQ0FBQyw2QkFBNkIsRUFBRVAsSUFBSVEsTUFBTSxDQUFDLFFBQVEsRUFBRUgsVUFBVSxDQUFDO1FBQzlFLE1BQU0sSUFBSVIsTUFBTSxDQUFDLG9CQUFvQixFQUFFRyxJQUFJUSxNQUFNLENBQUMsQ0FBQyxFQUFFSCxVQUFVLENBQUM7SUFDbEU7SUFFQSxPQUFPTCxJQUFJUyxJQUFJO0FBQ2pCO0FBRU8sZUFBZUMsb0JBQW9CLEVBQ3hDQyxFQUFFLEVBQ0ZDLFFBQVEsRUFDUkMsWUFBWSxFQUFFLEVBQ2RDLGVBQWUsSUFBSSxFQUNuQkMsWUFBWSxFQUNadkIsV0FBVyxFQVFaO0lBQ0MsTUFBTXdCLGVBQWVELGdCQUFnQkg7SUFDckMsTUFBTUssaUJBQWlCcEMsZUFBZXFDLEtBQUssQ0FBQztRQUMxQ25DLE1BQU1pQztRQUNOL0IsVUFBVTtZQUFFQyxNQUFNNEI7UUFBYTtJQUNqQztJQUVBLGdFQUFnRTtJQUNoRSxNQUFNSyxVQUFVUixHQUFHUyxPQUFPLENBQUMsT0FBTztJQUVsQyxPQUFPN0IsZ0JBQWdCO1FBQ3JCQztRQUNBQyxNQUFNO1FBQ05DLE1BQU07WUFDSjJCLFFBQVE7WUFDUkMsTUFBTUMsS0FBS0MsU0FBUyxDQUFDO2dCQUNuQkMsbUJBQW1CO2dCQUNuQmQsSUFBSVE7Z0JBQ0pPLE1BQU07Z0JBQ05kLFVBQVU7b0JBQ1IsR0FBR0ssY0FBYztvQkFDakI5QixZQUFZO3dCQUNWOzRCQUNFdUMsTUFBTTs0QkFDTkMsWUFBWWQsVUFBVWUsR0FBRyxDQUFDLENBQUNDLFFBQVc7b0NBQUVILE1BQU07b0NBQVFwQixNQUFNdUI7Z0NBQU07d0JBQ3BFO3FCQUNEO2dCQUNIO1lBQ0Y7UUFDRjtJQUNGO0FBQ0Y7QUFFTyxlQUFlQyxnQkFBZ0IsRUFDcENuQixFQUFFLEVBQ0ZMLElBQUksRUFDSmQsV0FBVyxFQUtaO0lBQ0MsT0FBT0QsZ0JBQWdCO1FBQ3JCQztRQUNBQyxNQUFNO1FBQ05DLE1BQU07WUFDSjJCLFFBQVE7WUFDUkMsTUFBTUMsS0FBS0MsU0FBUyxDQUFDO2dCQUNuQkMsbUJBQW1CO2dCQUNuQmQ7Z0JBQ0FlLE1BQU07Z0JBQ05wQixNQUFNO29CQUFFZ0IsTUFBTWhCO2dCQUFLO1lBQ3JCO1FBQ0Y7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYWdlbmRhci1hcHAvLi9zcmMvbGliL3doYXRzYXBwLnRzP2RmOTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcclxuaW1wb3J0IHR5cGUgeyBXaGF0c0FwcENyZWRlbnRpYWxzIH0gZnJvbSBcIkAvc2VydmVyL3doYXRzYXBwLWNvbmZpZ1wiO1xyXG5cclxuY29uc3QgYmFzZVVybCA9IFwiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE4LjBcIjtcclxuXHJcbmNvbnN0IHRlbXBsYXRlU2NoZW1hID0gei5vYmplY3Qoe1xyXG4gIG5hbWU6IHouc3RyaW5nKCksXHJcbiAgbGFuZ3VhZ2U6IHoub2JqZWN0KHsgY29kZTogei5zdHJpbmcoKSB9KSxcclxuICBjb21wb25lbnRzOiB6LmFycmF5KHouYW55KCkpLm9wdGlvbmFsKCksXHJcbn0pO1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gY2FsbFdoYXRzQXBwQVBJKHtcclxuICBjcmVkZW50aWFscyxcclxuICBwYXRoLFxyXG4gIGluaXQsXHJcbn06IHtcclxuICBjcmVkZW50aWFsczogV2hhdHNBcHBDcmVkZW50aWFscztcclxuICBwYXRoOiBzdHJpbmc7XHJcbiAgaW5pdDogUmVxdWVzdEluaXQ7XHJcbn0pIHtcclxuICBjb25zdCB7IGFjY2Vzc1Rva2VuLCBwaG9uZU51bWJlcklkIH0gPSBjcmVkZW50aWFscztcclxuXHJcbiAgaWYgKCFhY2Nlc3NUb2tlbiB8fCAhcGhvbmVOdW1iZXJJZCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiV2hhdHNBcHAgY3JlZGVudGlhbHMgbWlzc2luZ1wiKTtcclxuICB9XHJcblxyXG4gIC8vIERlYnVnIGxvZyB0byB2ZXJpZnkgSWRlbnRpdHlcclxuICBjb25zb2xlLmxvZyhgW1doYXRzQXBwIEFQSV0gU2VuZGluZyB2aWEgUGhvbmVJRDogJHtwaG9uZU51bWJlcklkfWApO1xyXG5cclxuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgJHtiYXNlVXJsfS8ke3Bob25lTnVtYmVySWR9LyR7cGF0aH1gLCB7XHJcbiAgICAuLi5pbml0LFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FjY2Vzc1Rva2VufWAsXHJcbiAgICAgIC4uLmluaXQuaGVhZGVycyxcclxuICAgIH0sXHJcbiAgfSk7XHJcblxyXG4gIGlmICghcmVzLm9rKSB7XHJcbiAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xyXG4gICAgY29uc29sZS5lcnJvcihgW1doYXRzQXBwIEFQSSBFcnJvcl0gU3RhdHVzOiAke3Jlcy5zdGF0dXN9LCBCb2R5OiAke2Vycm9yVGV4dH1gKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgV2hhdHNBcHAgQVBJIGVycm9yOiAke3Jlcy5zdGF0dXN9ICR7ZXJyb3JUZXh0fWApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kVGVtcGxhdGVNZXNzYWdlKHtcclxuICB0byxcclxuICB0ZW1wbGF0ZSxcclxuICB2YXJpYWJsZXMgPSBbXSxcclxuICBsYW5ndWFnZUNvZGUgPSBcImVzXCIsXHJcbiAgbmFtZU92ZXJyaWRlLFxyXG4gIGNyZWRlbnRpYWxzLFxyXG59OiB7XHJcbiAgdG86IHN0cmluZztcclxuICB0ZW1wbGF0ZTogc3RyaW5nO1xyXG4gIHZhcmlhYmxlcz86IHN0cmluZ1tdO1xyXG4gIGxhbmd1YWdlQ29kZT86IHN0cmluZztcclxuICBuYW1lT3ZlcnJpZGU/OiBzdHJpbmcgfCBudWxsO1xyXG4gIGNyZWRlbnRpYWxzOiBXaGF0c0FwcENyZWRlbnRpYWxzO1xyXG59KSB7XHJcbiAgY29uc3QgdGVtcGxhdGVOYW1lID0gbmFtZU92ZXJyaWRlID8/IHRlbXBsYXRlO1xyXG4gIGNvbnN0IHBhcnNlZFRlbXBsYXRlID0gdGVtcGxhdGVTY2hlbWEucGFyc2Uoe1xyXG4gICAgbmFtZTogdGVtcGxhdGVOYW1lLFxyXG4gICAgbGFuZ3VhZ2U6IHsgY29kZTogbGFuZ3VhZ2VDb2RlIH0sXHJcbiAgfSk7XHJcblxyXG4gIC8vIFNhbml0aXplIHBob25lIG51bWJlcjogcmVtb3ZlIG5vbi1udW1lcmljIGNoYXJhY3RlcnMgKGUuZy4gKylcclxuICBjb25zdCBjbGVhblRvID0gdG8ucmVwbGFjZSgvXFxEL2csIFwiXCIpO1xyXG5cclxuICByZXR1cm4gY2FsbFdoYXRzQXBwQVBJKHtcclxuICAgIGNyZWRlbnRpYWxzLFxyXG4gICAgcGF0aDogXCJtZXNzYWdlc1wiLFxyXG4gICAgaW5pdDoge1xyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbWVzc2FnaW5nX3Byb2R1Y3Q6IFwid2hhdHNhcHBcIixcclxuICAgICAgICB0bzogY2xlYW5UbyxcclxuICAgICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXHJcbiAgICAgICAgdGVtcGxhdGU6IHtcclxuICAgICAgICAgIC4uLnBhcnNlZFRlbXBsYXRlLFxyXG4gICAgICAgICAgY29tcG9uZW50czogW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgdHlwZTogXCJib2R5XCIsXHJcbiAgICAgICAgICAgICAgcGFyYW1ldGVyczogdmFyaWFibGVzLm1hcCgodmFsdWUpID0+ICh7IHR5cGU6IFwidGV4dFwiLCB0ZXh0OiB2YWx1ZSB9KSksXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICBdLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pLFxyXG4gICAgfSxcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRUZXh0TWVzc2FnZSh7XHJcbiAgdG8sXHJcbiAgdGV4dCxcclxuICBjcmVkZW50aWFscyxcclxufToge1xyXG4gIHRvOiBzdHJpbmc7XHJcbiAgdGV4dDogc3RyaW5nO1xyXG4gIGNyZWRlbnRpYWxzOiBXaGF0c0FwcENyZWRlbnRpYWxzO1xyXG59KSB7XHJcbiAgcmV0dXJuIGNhbGxXaGF0c0FwcEFQSSh7XHJcbiAgICBjcmVkZW50aWFscyxcclxuICAgIHBhdGg6IFwibWVzc2FnZXNcIixcclxuICAgIGluaXQ6IHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG1lc3NhZ2luZ19wcm9kdWN0OiBcIndoYXRzYXBwXCIsXHJcbiAgICAgICAgdG8sXHJcbiAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXHJcbiAgICAgICAgdGV4dDogeyBib2R5OiB0ZXh0IH0sXHJcbiAgICAgIH0pLFxyXG4gICAgfSxcclxuICB9KTtcclxufVxyXG4iXSwibmFtZXMiOlsieiIsImJhc2VVcmwiLCJ0ZW1wbGF0ZVNjaGVtYSIsIm9iamVjdCIsIm5hbWUiLCJzdHJpbmciLCJsYW5ndWFnZSIsImNvZGUiLCJjb21wb25lbnRzIiwiYXJyYXkiLCJhbnkiLCJvcHRpb25hbCIsImNhbGxXaGF0c0FwcEFQSSIsImNyZWRlbnRpYWxzIiwicGF0aCIsImluaXQiLCJhY2Nlc3NUb2tlbiIsInBob25lTnVtYmVySWQiLCJFcnJvciIsImNvbnNvbGUiLCJsb2ciLCJyZXMiLCJmZXRjaCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwib2siLCJlcnJvclRleHQiLCJ0ZXh0IiwiZXJyb3IiLCJzdGF0dXMiLCJqc29uIiwic2VuZFRlbXBsYXRlTWVzc2FnZSIsInRvIiwidGVtcGxhdGUiLCJ2YXJpYWJsZXMiLCJsYW5ndWFnZUNvZGUiLCJuYW1lT3ZlcnJpZGUiLCJ0ZW1wbGF0ZU5hbWUiLCJwYXJzZWRUZW1wbGF0ZSIsInBhcnNlIiwiY2xlYW5UbyIsInJlcGxhY2UiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm1lc3NhZ2luZ19wcm9kdWN0IiwidHlwZSIsInBhcmFtZXRlcnMiLCJtYXAiLCJ2YWx1ZSIsInNlbmRUZXh0TWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/whatsapp.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/appointments/createAppointment.ts":
/*!******************************************************!*\
  !*** ./src/server/appointments/createAppointment.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AppointmentCreationError: () => (/* binding */ AppointmentCreationError),\n/* harmony export */   createAppointmentForTenant: () => (/* binding */ createAppointmentForTenant)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_addMinutes_date_fns__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! __barrel_optimize__?names=addMinutes!=!date-fns */ \"(rsc)/./node_modules/date-fns/addMinutes.mjs\");\n/* harmony import */ var _lib_normalization__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/normalization */ \"(rsc)/./src/lib/normalization.ts\");\n/* harmony import */ var _lib_scheduling__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/scheduling */ \"(rsc)/./src/lib/scheduling.ts\");\n/* harmony import */ var _lib_whatsapp__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/whatsapp */ \"(rsc)/./src/lib/whatsapp.ts\");\n/* harmony import */ var _lib_messages__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/messages */ \"(rsc)/./src/lib/messages.ts\");\n/* harmony import */ var _server_whatsapp_config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/whatsapp-config */ \"(rsc)/./src/server/whatsapp-config.ts\");\n/* harmony import */ var _lib_logging__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/logging */ \"(rsc)/./src/lib/logging.ts\");\n/* harmony import */ var _server_integrations_google_calendar__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/server/integrations/google-calendar */ \"(rsc)/./src/server/integrations/google-calendar.ts\");\n\n\n\n\n\n\n\nclass AppointmentCreationError extends Error {\n    constructor(message, status = 400){\n        super(message);\n        this.status = status;\n    }\n}\n\nasync function createAppointmentForTenant(options) {\n    const { db, tenantId, input, sendNotifications = true } = options;\n    const { patient, phone, email, start, duration, serviceName, notes, locationId: rawLocationId, serviceId, providerId } = input;\n    if (!patient || !phone || !start) {\n        throw new AppointmentCreationError(\"Missing required fields\", 400);\n    }\n    const startAt = new Date(start);\n    if (!Number.isFinite(startAt.getTime())) {\n        throw new AppointmentCreationError(\"Invalid start date\", 400);\n    }\n    // Phone normalization using centralized utility\n    const normalizedPhone = (0,_lib_normalization__WEBPACK_IMPORTED_MODULE_0__.normalizePhoneNumber)(phone);\n    let resolvedService = null;\n    if (serviceId) {\n        const { data: serviceRow, error: serviceError } = await db.from(\"agenda_services\").select(\"id, tenant_id, name, description, duration_minutes, price_minor_units, currency, color, active\").eq(\"tenant_id\", tenantId).eq(\"id\", serviceId).maybeSingle();\n        if (serviceError || !serviceRow) {\n            throw new AppointmentCreationError(\"Servicio inv\\xe1lido\", 400);\n        }\n        if (!serviceRow.active) {\n            throw new AppointmentCreationError(\"El servicio est\\xe1 pausado\", 400);\n        }\n        resolvedService = serviceRow;\n    }\n    let resolvedProvider = null;\n    if (providerId) {\n        const { data: providerRow, error: providerError } = await db.from(\"agenda_providers\").select(\"id, tenant_id, full_name, active, default_location_id, metadata\").eq(\"tenant_id\", tenantId).eq(\"id\", providerId).maybeSingle();\n        if (providerError || !providerRow) {\n            throw new AppointmentCreationError(\"Profesional inv\\xe1lido\", 400);\n        }\n        if (!providerRow.active) {\n            throw new AppointmentCreationError(\"El profesional est\\xe1 pausado\", 400);\n        }\n        resolvedProvider = providerRow;\n    } else {\n        // Audit: Enforce provider assignment.\n        // If no providerId is supplied, try to auto-assign the first available active provider.\n        const { data: anyProvider } = await db.from(\"agenda_providers\").select(\"id, tenant_id, full_name, active, default_location_id, metadata\").eq(\"tenant_id\", tenantId).eq(\"active\", true).limit(1).maybeSingle();\n        if (anyProvider) {\n            resolvedProvider = anyProvider;\n        } else {\n        // If absolutely no providers exist, we might allow it (legacy) or fail.\n        // Based on user request \"asignar obligatoriamente\", we should likely ensure one exists.\n        // But for now, we'll proceed only if we found one.\n        // throw new AppointmentCreationError(\"No hay profesionales disponibles para asignar el turno\", 400); \n        }\n    }\n    const durationSource = Number(duration ?? resolvedService?.duration_minutes ?? 30);\n    const durationMinutes = Math.max(5, Number.isFinite(durationSource) ? durationSource : 30);\n    const endAt = (0,_barrel_optimize_names_addMinutes_date_fns__WEBPACK_IMPORTED_MODULE_7__.addMinutes)(startAt, durationMinutes);\n    const { data: existingPatient } = await db.from(\"agenda_patients\").select(\"id\").eq(\"tenant_id\", tenantId).eq(\"phone_e164\", normalizedPhone).maybeSingle();\n    let patientId = existingPatient?.id ?? null;\n    if (!patientId) {\n        const insertPayload = {\n            tenant_id: tenantId,\n            full_name: patient,\n            phone_e164: normalizedPhone,\n            email: email && email.length > 0 ? email : null,\n            opt_out: false\n        };\n        const { data: inserted, error: patientError } = await db.from(\"agenda_patients\").insert(insertPayload).select(\"id\").single();\n        if (patientError) {\n            throw new AppointmentCreationError(patientError.message, 400);\n        }\n        patientId = inserted.id;\n    } else {\n        // Upsert email if provided\n        const updatePayload = {\n            full_name: patient\n        };\n        if (email && email.length > 0) updatePayload.email = email;\n        await db.from(\"agenda_patients\").update(updatePayload).eq(\"id\", patientId).eq(\"tenant_id\", tenantId);\n    }\n    let locationId = rawLocationId ?? resolvedProvider?.default_location_id ?? null;\n    let locationName = \"Consultorio\";\n    let locationTimezone = \"America/Argentina/Buenos_Aires\";\n    let bufferMinutes = 0;\n    let businessHours = {};\n    const assignLocation = (row)=>{\n        if (row) {\n            locationId = row.id;\n            locationName = row.name;\n            locationTimezone = row.timezone;\n            bufferMinutes = row.buffer_minutes ?? 0;\n            businessHours = row.business_hours ?? {};\n        } else {\n            locationId = null;\n        }\n    };\n    if (locationId) {\n        const { data: locationRow } = await db.from(\"agenda_locations\").select(\"id, name, timezone, buffer_minutes, business_hours\").eq(\"tenant_id\", tenantId).eq(\"id\", locationId).maybeSingle();\n        assignLocation(locationRow ?? null);\n    }\n    if (!locationId) {\n        const { data: fallback } = await db.from(\"agenda_locations\").select(\"id, name, timezone, buffer_minutes, business_hours\").eq(\"tenant_id\", tenantId).order(\"name\", {\n            ascending: true\n        }).limit(1).maybeSingle();\n        assignLocation(fallback ?? null);\n    }\n    if (!locationId) {\n        throw new AppointmentCreationError(\"Debe crear una ubicaci\\xf3n primero\", 400);\n    }\n    // 1. Check Provider Override\n    if (resolvedProvider) {\n        const provSchedule = resolvedProvider.metadata?.schedule;\n        if (provSchedule && Object.keys(provSchedule).length > 0) {\n            businessHours = provSchedule;\n        }\n    }\n    // 2. Fallback default hours if empty (Matches getSlots behavior)\n    if (Object.keys(businessHours).length === 0) {\n        businessHours = {\n            mon: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            tue: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            wed: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            thu: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            fri: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ]\n        };\n    }\n    const validHours = (0,_lib_scheduling__WEBPACK_IMPORTED_MODULE_1__.isWithinBusinessHours)({\n        start: startAt,\n        end: endAt,\n        businessHours,\n        timeZone: locationTimezone\n    });\n    if (!validHours) {\n        const debugInfo = `Start: ${startAt.toISOString()}, LocTZ: ${locationTimezone}, LocalDay: ${new Intl.DateTimeFormat(\"en-US\", {\n            timeZone: locationTimezone,\n            weekday: \"short\",\n            hour: \"numeric\"\n        }).format(startAt)}`;\n        console.error(`[AppointmentError] Outside Business Hours. ${debugInfo}`);\n        throw new AppointmentCreationError(`Fuera del horario de atencin (${debugInfo})`, 400);\n    }\n    const conflictWindowStart = (0,_barrel_optimize_names_addMinutes_date_fns__WEBPACK_IMPORTED_MODULE_7__.addMinutes)(startAt, -bufferMinutes);\n    const conflictWindowEnd = (0,_barrel_optimize_names_addMinutes_date_fns__WEBPACK_IMPORTED_MODULE_7__.addMinutes)(endAt, bufferMinutes);\n    let conflictQuery = db.from(\"agenda_appointments\").select(\"id\").eq(\"tenant_id\", tenantId).eq(\"location_id\", locationId).neq(\"status\", \"canceled\").lt(\"start_at\", conflictWindowEnd.toISOString()).gt(\"end_at\", conflictWindowStart.toISOString());\n    /*\r\n  // Disabled until DB migration is applied\r\n  if (resolvedProvider?.id) {\r\n    conflictQuery = conflictQuery.or(`provider_id.eq.${resolvedProvider.id},provider_id.is.null`);\r\n  }\r\n  */ const { data: conflicts, error: conflictError } = await conflictQuery.limit(1);\n    if (conflictError) {\n        throw new AppointmentCreationError(conflictError.message, 400);\n    }\n    if (conflicts && conflicts.length > 0) {\n        throw new AppointmentCreationError(\"Ya hay un turno en ese horario\", 409);\n    }\n    const serviceSnapshot = resolvedService ? {\n        id: resolvedService.id,\n        name: resolvedService.name,\n        description: resolvedService.description,\n        duration_minutes: resolvedService.duration_minutes,\n        price_minor_units: resolvedService.price_minor_units,\n        currency: resolvedService.currency,\n        color: resolvedService.color\n    } : null;\n    const normalizedServiceName = resolvedService?.name ?? (serviceName?.trim().length ? serviceName?.trim() : null);\n    const appointmentInsert = {\n        tenant_id: tenantId,\n        location_id: locationId,\n        patient_id: patientId,\n        start_at: startAt.toISOString(),\n        end_at: endAt.toISOString(),\n        status: \"pending\",\n        service_id: resolvedService?.id ?? null,\n        provider_id: resolvedProvider?.id ?? null,\n        service_name: normalizedServiceName,\n        // service_snapshot: serviceSnapshot, // TODO: Run migration to add this column\n        internal_notes: notes ?? null\n    };\n    const { error: apptError, data: appt } = await db.from(\"agenda_appointments\").insert(appointmentInsert).select(\"id, start_at, end_at, status\").single();\n    if (apptError) {\n        if (apptError.code === \"23P01\" || apptError.message?.includes(\"agenda_chk_no_overlap\")) {\n            throw new AppointmentCreationError(\"El horario seleccionado ya est\\xe1 ocupado por otro turno (conflicto detectado).\", 409);\n        }\n        throw new AppointmentCreationError(apptError.message, 400);\n    }\n    // Fire & Forget: Sync to Google Calendar\n    if (providerId) {\n        void (0,_server_integrations_google_calendar__WEBPACK_IMPORTED_MODULE_6__.createGoogleCalendarEvent)(db, {\n            ...appt,\n            agenda_patients: {\n                full_name: patient\n            },\n            agenda_services: {\n                name: resolvedService?.name ?? serviceName ?? \"Servicio\"\n            }\n        }, providerId).catch(console.error);\n    }\n    if (sendNotifications) {\n        try {\n            const [credentials, templateMap] = await Promise.all([\n                (0,_server_whatsapp_config__WEBPACK_IMPORTED_MODULE_4__.getWhatsAppIntegrationByTenant)(db, tenantId),\n                (0,_server_whatsapp_config__WEBPACK_IMPORTED_MODULE_4__.getTenantTemplateMap)(db, tenantId)\n            ]);\n            if (!credentials) {\n                // Critical error for auditing\n                console.error(`[AppointmentCreation] Missing WhatsApp credentials for tenant ${tenantId}. Message NOT sent.`);\n                throw new Error(\"WhatsApp integration missing for tenant\");\n            }\n            // REAL LOGIC: Use configured template or default to system name\n            const templateKey = _lib_messages__WEBPACK_IMPORTED_MODULE_3__.TEMPLATE_NAMES.appointmentCreated;\n            const templateToSend = templateMap?.get(templateKey)?.metaTemplateName ?? templateKey;\n            const providerName = resolvedProvider?.full_name ?? \"el especialista\";\n            const dateStr = startAt.toLocaleDateString(\"es-AR\", {\n                day: \"numeric\",\n                month: \"long\",\n                timeZone: locationTimezone\n            });\n            const timeStr = startAt.toLocaleTimeString(\"es-AR\", {\n                hour: \"2-digit\",\n                minute: \"2-digit\",\n                timeZone: locationTimezone\n            });\n            // Based on real template structure:\n            // {{1}} Patient\n            // {{2}} Date (Body)\n            // {{3}} Date (Label: Fecha)\n            // {{4}} Time (Label: Hora)\n            // {{5}} Location + Provider (Label: Dnde)\n            const variablesToSend = [\n                patient,\n                dateStr,\n                dateStr,\n                timeStr,\n                `${locationName ?? \"nuestro consultorio\"} con ${providerName}`\n            ];\n            console.log(`[AppointmentCreation] Sending WhatsApp to ${normalizedPhone} (Template: ${templateToSend})`);\n            await (0,_lib_whatsapp__WEBPACK_IMPORTED_MODULE_2__.sendTemplateMessage)({\n                to: normalizedPhone,\n                template: templateToSend,\n                variables: variablesToSend,\n                credentials,\n                languageCode: \"es\"\n            });\n            await db.from(\"agenda_message_log\").insert({\n                tenant_id: tenantId,\n                patient_id: patientId,\n                appointment_id: appt.id,\n                direction: \"out\",\n                type: _lib_messages__WEBPACK_IMPORTED_MODULE_3__.TEMPLATE_NAMES.appointmentCreated,\n                status: \"sent\",\n                // @ts-ignore - The type definition in DB types might not include payload_json yet if not generated\n                // but we want to save it as JSONB\n                payload_json: {\n                    template: templateToSend,\n                    variables: variablesToSend,\n                    type: \"template\"\n                }\n            });\n            (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logInfo)(\"appointment.created_notification_sent\", {\n                tenant_id: tenantId,\n                appointment_id: appt.id,\n                patient_id: patientId\n            });\n        } catch (err) {\n            (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logError)(\"appointment.created_notification_failed\", {\n                tenant_id: tenantId,\n                appointment_id: appt.id,\n                error: err?.message ?? String(err)\n            });\n        }\n    }\n    return {\n        appointment: appt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwcG9pbnRtZW50cy9jcmVhdGVBcHBvaW50bWVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQXNDO0FBQ3FCO0FBR0Y7QUFDSjtBQUNMO0FBQ2dEO0FBQzlDO0FBK0IzQyxNQUFNUyxpQ0FBaUNDO0lBRzVDQyxZQUFZQyxPQUFlLEVBQUVDLFNBQVMsR0FBRyxDQUFFO1FBQ3pDLEtBQUssQ0FBQ0Q7UUFDTixJQUFJLENBQUNDLE1BQU0sR0FBR0E7SUFDaEI7QUFDRjtBQUVrRjtBQUUzRSxlQUFlRSwyQkFBMkJDLE9BS2hEO0lBQ0MsTUFBTSxFQUFFQyxFQUFFLEVBQUVDLFFBQVEsRUFBRUMsS0FBSyxFQUFFQyxvQkFBb0IsSUFBSSxFQUFFLEdBQUdKO0lBQzFELE1BQU0sRUFBRUssT0FBTyxFQUFFQyxLQUFLLEVBQUVDLEtBQUssRUFBRUMsS0FBSyxFQUFFQyxRQUFRLEVBQUVDLFdBQVcsRUFBRUMsS0FBSyxFQUFFQyxZQUFZQyxhQUFhLEVBQUVDLFNBQVMsRUFBRUMsVUFBVSxFQUFFLEdBQUdaO0lBRXpILElBQUksQ0FBQ0UsV0FBVyxDQUFDQyxTQUFTLENBQUNFLE9BQU87UUFDaEMsTUFBTSxJQUFJZix5QkFBeUIsMkJBQTJCO0lBQ2hFO0lBRUEsTUFBTXVCLFVBQVUsSUFBSUMsS0FBS1Q7SUFDekIsSUFBSSxDQUFDVSxPQUFPQyxRQUFRLENBQUNILFFBQVFJLE9BQU8sS0FBSztRQUN2QyxNQUFNLElBQUkzQix5QkFBeUIsc0JBQXNCO0lBQzNEO0lBRUEsZ0RBQWdEO0lBQ2hELE1BQU00QixrQkFBa0JwQyx3RUFBb0JBLENBQUNxQjtJQUU3QyxJQUFJZ0Isa0JBQXdDO0lBQzVDLElBQUlSLFdBQVc7UUFDYixNQUFNLEVBQUVTLE1BQU1DLFVBQVUsRUFBRUMsT0FBT0MsWUFBWSxFQUFFLEdBQUcsTUFBTXpCLEdBQ3JEMEIsSUFBSSxDQUFDLG1CQUNMQyxNQUFNLENBQUMsa0dBQ1BDLEVBQUUsQ0FBQyxhQUFhM0Is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Z0JBQzNDa0UsWUFBWW5FO1lBQ2Q7UUFDRixFQUFFLE9BQU80RyxLQUFLO1lBQ1pqSyxzREFBUUEsQ0FBQywyQ0FBMkM7Z0JBQ2xEd0QsV0FBVzdDO2dCQUNYa0osZ0JBQWdCLEtBQXlCdkcsRUFBRTtnQkFDM0NwQixPQUFPLEtBQWdCN0IsV0FBVzZKLE9BQU9EO1lBQzNDO1FBQ0Y7SUFDRjtJQUVBLE9BQU87UUFBRUUsYUFBYW5DO0lBQUs7QUFDN0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9zZXJ2ZXIvYXBwb2ludG1lbnRzL2NyZWF0ZUFwcG9pbnRtZW50LnRzP2VhMmMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYWRkTWludXRlcyB9IGZyb20gXCJkYXRlLWZuc1wiO1xyXG5pbXBvcnQgeyBub3JtYWxpemVQaG9uZU51bWJlciB9IGZyb20gXCJAL2xpYi9ub3JtYWxpemF0aW9uXCI7XHJcbmltcG9ydCB7IFN1cGFiYXNlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gXCJAL3R5cGVzL2RhdGFiYXNlXCI7XHJcbmltcG9ydCB7IGlzV2l0aGluQnVzaW5lc3NIb3VycyB9IGZyb20gXCJAL2xpYi9zY2hlZHVsaW5nXCI7XHJcbmltcG9ydCB7IHNlbmRUZW1wbGF0ZU1lc3NhZ2UgfSBmcm9tIFwiQC9saWIvd2hhdHNhcHBcIjtcclxuaW1wb3J0IHsgVEVNUExBVEVfTkFNRVMgfSBmcm9tIFwiQC9saWIvbWVzc2FnZXNcIjtcclxuaW1wb3J0IHsgZ2V0VGVuYW50VGVtcGxhdGVNYXAsIGdldFdoYXRzQXBwSW50ZWdyYXRpb25CeVRlbmFudCB9IGZyb20gXCJAL3NlcnZlci93aGF0c2FwcC1jb25maWdcIjtcclxuaW1wb3J0IHsgbG9nRXJyb3IsIGxvZ0luZm8gfSBmcm9tIFwiQC9saWIvbG9nZ2luZ1wiO1xyXG5cclxudHlwZSBQYXRpZW50Um93ID0gRGF0YWJhc2VbXCJwdWJsaWNcIl1bXCJUYWJsZXNcIl1bXCJhZ2VuZGFfcGF0aWVudHNcIl1bXCJSb3dcIl07XHJcbnR5cGUgTG9jYXRpb25Sb3cgPSBEYXRhYmFzZVtcInB1YmxpY1wiXVtcIlRhYmxlc1wiXVtcImFnZW5kYV9sb2NhdGlvbnNcIl1bXCJSb3dcIl07XHJcbnR5cGUgQXBwb2ludG1lbnRJbnNlcnQgPSBEYXRhYmFzZVtcInB1YmxpY1wiXVtcIlRhYmxlc1wiXVtcImFnZW5kYV9hcHBvaW50bWVudHNcIl1bXCJJbnNlcnRcIl07XHJcbnR5cGUgQXBwb2ludG1lbnRSb3cgPSBEYXRhYmFzZVtcInB1YmxpY1wiXVtcIlRhYmxlc1wiXVtcImFnZW5kYV9hcHBvaW50bWVudHNcIl1bXCJSb3dcIl07XHJcbnR5cGUgU2VydmljZVJvdyA9IERhdGFiYXNlW1wicHVibGljXCJdW1wiVGFibGVzXCJdW1wiYWdlbmRhX3NlcnZpY2VzXCJdW1wiUm93XCJdO1xyXG50eXBlIFByb3ZpZGVyUm93ID0gRGF0YWJhc2VbXCJwdWJsaWNcIl1bXCJUYWJsZXNcIl1bXCJhZ2VuZGFfcHJvdmlkZXJzXCJdW1wiUm93XCJdO1xyXG5cclxudHlwZSBTZXJ2aWNlTG9va3VwID0gUGljazxcclxuICBTZXJ2aWNlUm93LFxyXG4gIFwiaWRcIiB8IFwibmFtZVwiIHwgXCJkZXNjcmlwdGlvblwiIHwgXCJkdXJhdGlvbl9taW51dGVzXCIgfCBcInByaWNlX21pbm9yX3VuaXRzXCIgfCBcImN1cnJlbmN5XCIgfCBcImNvbG9yXCIgfCBcImFjdGl2ZVwiXHJcbj47XHJcblxyXG50eXBlIFByb3ZpZGVyTG9va3VwID0gUGljazxQcm92aWRlclJvdywgXCJpZFwiIHwgXCJ0ZW5hbnRfaWRcIiB8IFwiZnVsbF9uYW1lXCIgfCBcImFjdGl2ZVwiIHwgXCJkZWZhdWx0X2xvY2F0aW9uX2lkXCIgfCBcIm1ldGFkYXRhXCI+O1xyXG5cclxudHlwZSBMb2NhdGlvbkxvb2t1cCA9IFBpY2s8TG9jYXRpb25Sb3csIFwiaWRcIiB8IFwibmFtZVwiIHwgXCJ0aW1lem9uZVwiIHwgXCJidWZmZXJfbWludXRlc1wiIHwgXCJidXNpbmVzc19ob3Vyc1wiPjtcclxuXHJcbmV4cG9ydCB0eXBlIEFwcG9pbnRtZW50Q3JlYXRpb25JbnB1dCA9IHtcclxuICBwYXRpZW50OiBzdHJpbmc7XHJcbiAgcGhvbmU6IHN0cmluZztcclxuICBlbWFpbD86IHN0cmluZzsgLy8gQWRkZWRcclxuICBzdGFydDogc3RyaW5nO1xyXG4gIGR1cmF0aW9uPzogbnVtYmVyO1xyXG4gIHNlcnZpY2VOYW1lPzogc3RyaW5nIHwgbnVsbDtcclxuICBub3Rlcz86IHN0cmluZyB8IG51bGw7XHJcbiAgbG9jYXRpb25JZD86IHN0cmluZyB8IG51bGw7XHJcbiAgc2VydmljZUlkPzogc3RyaW5nIHwgbnVsbDtcclxuICBwcm92aWRlcklkPzogc3RyaW5nIHwgbnVsbDtcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBBcHBvaW50bWVudENyZWF0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7XHJcbiAgc3RhdHVzOiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgc3RhdHVzID0gNDAwKSB7XHJcbiAgICBzdXBlcihtZXNzYWdlKTtcclxuICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xyXG4gIH1cclxufVxyXG5cclxuaW1wb3J0IHsgY3JlYXRlR29vZ2xlQ2FsZW5kYXJFdmVudCB9IGZyb20gXCJAL3NlcnZlci9pbnRlZ3JhdGlvbnMvZ29vZ2xlLWNhbGVuZGFyXCI7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXBwb2ludG1lbnRGb3JUZW5hbnQob3B0aW9uczoge1xyXG4gIGRiOiBTdXBhYmFzZUNsaWVudDxEYXRhYmFzZT47XHJcbiAgdGVuYW50SWQ6IHN0cmluZztcclxuICBpbnB1dDogQXBwb2ludG1lbnRDcmVhdGlvbklucHV0O1xyXG4gIHNlbmROb3RpZmljYXRpb25zPzogYm9vbGVhbjtcclxufSkge1xyXG4gIGNvbnN0IHsgZGIsIHRlbmFudElkLCBpbnB1dCwgc2VuZE5vdGlmaWNhdGlvbnMgPSB0cnVlIH0gPSBvcHRpb25zO1xyXG4gIGNvbnN0IHsgcGF0aWVudCwgcGhvbmUsIGVtYWlsLCBzdGFydCwgZHVyYXRpb24sIHNlcnZpY2VOYW1lLCBub3RlcywgbG9jYXRpb25JZDogcmF3TG9jYXRpb25JZCwgc2VydmljZUlkLCBwcm92aWRlcklkIH0gPSBpbnB1dDtcclxuXHJcbiAgaWYgKCFwYXRpZW50IHx8ICFwaG9uZSB8fCAhc3RhcnQpIHtcclxuICAgIHRocm93IG5ldyBBcHBvaW50bWVudENyZWF0aW9uRXJyb3IoXCJNaXNzaW5nIHJlcXVpcmVkIGZpZWxkc1wiLCA0MDApO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc3RhcnRBdCA9IG5ldyBEYXRlKHN0YXJ0KTtcclxuICBpZiAoIU51bWJlci5pc0Zpbml0ZShzdGFydEF0LmdldFRpbWUoKSkpIHtcclxuICAgIHRocm93IG5ldyBBcHBvaW50bWVudENyZWF0aW9uRXJyb3IoXCJJbnZhbGlkIHN0YXJ0IGRhdGVcIiwgNDAwKTtcclxuICB9XHJcblxyXG4gIC8vIFBob25lIG5vcm1hbGl6YXRpb24gdXNpbmcgY2VudHJhbGl6ZWQgdXRpbGl0eVxyXG4gIGNvbnN0IG5vcm1hbGl6ZWRQaG9uZSA9IG5vcm1hbGl6ZVBob25lTnVtYmVyKHBob25lKTtcclxuXHJcbiAgbGV0IHJlc29sdmVkU2VydmljZTogU2VydmljZUxvb2t1cCB8IG51bGwgPSBudWxsO1xyXG4gIGlmIChzZXJ2aWNlSWQpIHtcclxuICAgIGNvbnN0IHsgZGF0YTogc2VydmljZVJvdywgZXJyb3I6IHNlcnZpY2VFcnJvciB9ID0gYXdhaXQgZGJcclxuICAgICAgLmZyb20oXCJhZ2VuZGFfc2VydmljZXNcIilcclxuICAgICAgLnNlbGVjdChcImlkLCB0ZW5hbnRfaWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBkdXJhdGlvbl9taW51dGVzLCBwcmljZV9taW5vcl91bml0cywgY3VycmVuY3ksIGNvbG9yLCBhY3RpdmVcIilcclxuICAgICAgLmVxKFwidGVuYW50X2lkXCIsIHRlbmFudElkKVxyXG4gICAgICAuZXEoXCJpZFwiLCBzZXJ2aWNlSWQpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChzZXJ2aWNlRXJyb3IgfHwgIXNlcnZpY2VSb3cpIHtcclxuICAgICAgdGhyb3cgbmV3IEFwcG9pbnRtZW50Q3JlYXRpb25FcnJvcihcIlNlcnZpY2lvIGludsOhbGlkb1wiLCA0MDApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghc2VydmljZVJvdy5hY3RpdmUpIHtcclxuICAgICAgdGhyb3cgbmV3IEFwcG9pbnRtZW50Q3JlYXRpb25FcnJvcihcIkVsIHNlcnZpY2lvIGVzdMOhIHBhdXNhZG9cIiwgNDAwKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNvbHZlZFNlcnZpY2UgPSBzZXJ2aWNlUm93IGFzIFNlcnZpY2VMb29rdXA7XHJcbiAgfVxyXG5cclxuICBsZXQgcmVzb2x2ZWRQcm92aWRlcjogUHJvdmlkZXJMb29rdXAgfCBudWxsID0gbnVsbDtcclxuICBpZiAocHJvdmlkZXJJZCkge1xyXG4gICAgY29uc3QgeyBkYXRhOiBwcm92aWRlclJvdywgZXJyb3I6IHByb3ZpZGVyRXJyb3IgfSA9IGF3YWl0IGRiXHJcbiAgICAgIC5mcm9tKFwiYWdlbmRhX3Byb3ZpZGVyc1wiKVxyXG4gICAgICAuc2VsZWN0KFwiaWQsIHRlbmFudF9pZCwgZnVsbF9uYW1lLCBhY3RpdmUsIGRlZmF1bHRfbG9jYXRpb25faWQsIG1ldGFkYXRhXCIpXHJcbiAgICAgIC5lcShcInRlbmFudF9pZFwiLCB0ZW5hbnRJZClcclxuICAgICAgLmVxKFwiaWRcIiwgcHJvdmlkZXJJZClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHByb3ZpZGVyRXJyb3IgfHwgIXByb3ZpZGVyUm93KSB7XHJcbiAgICAgIHRocm93IG5ldyBBcHBvaW50bWVudENyZWF0aW9uRXJyb3IoXCJQcm9mZXNpb25hbCBpbnbDoWxpZG9cIiwgNDAwKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXByb3ZpZGVyUm93LmFjdGl2ZSkge1xyXG4gICAgICB0aHJvdyBuZXcgQXBwb2ludG1lbnRDcmVhdGlvbkVycm9yKFwiRWwgcHJvZmVzaW9uYWwgZXN0w6EgcGF1c2Fkb1wiLCA0MDApO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc29sdmVkUHJvdmlkZXIgPSBwcm92aWRlclJvdyBhcyBQcm92aWRlckxvb2t1cDtcclxuICB9IGVsc2Uge1xyXG4gICAgLy8gQXVkaXQ6IEVuZm9yY2UgcHJvdmlkZXIgYXNzaWdubWVudC5cclxuICAgIC8vIElmIG5vIHByb3ZpZGVySWQgaXMgc3VwcGxpZWQsIHRyeSB0byBhdXRvLWFzc2lnbiB0aGUgZmlyc3QgYXZhaWxhYmxlIGFjdGl2ZSBwcm92aWRlci5cclxuICAgIGNvbnN0IHsgZGF0YTogYW55UHJvdmlkZXIgfSA9IGF3YWl0IGRiXHJcbiAgICAgIC5mcm9tKFwiYWdlbmRhX3Byb3ZpZGVyc1wiKVxyXG4gICAgICAuc2VsZWN0KFwiaWQsIHRlbmFudF9pZCwgZnVsbF9uYW1lLCBhY3RpdmUsIGRlZmF1bHRfbG9jYXRpb25faWQsIG1ldGFkYXRhXCIpXHJcbiAgICAgIC5lcShcInRlbmFudF9pZFwiLCB0ZW5hbnRJZClcclxuICAgICAgLmVxKFwiYWN0aXZlXCIsIHRydWUpXHJcbiAgICAgIC5saW1pdCgxKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoYW55UHJvdmlkZXIpIHtcclxuICAgICAgcmVzb2x2ZWRQcm92aWRlciA9IGFueVByb3ZpZGVyIGFzIFByb3ZpZGVyTG9va3VwO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gSWYgYWJzb2x1dGVseSBubyBwcm92aWRlcnMgZXhpc3QsIHdlIG1pZ2h0IGFsbG93IGl0IChsZWdhY3kpIG9yIGZhaWwuXHJcbiAgICAgIC8vIEJhc2VkIG9uIHVzZXIgcmVxdWVzdCBcImFzaWduYXIgb2JsaWdhdG9yaWFtZW50ZVwiLCB3ZSBzaG91bGQgbGlrZWx5IGVuc3VyZSBvbmUgZXhpc3RzLlxyXG4gICAgICAvLyBCdXQgZm9yIG5vdywgd2UnbGwgcHJvY2VlZCBvbmx5IGlmIHdlIGZvdW5kIG9uZS5cclxuICAgICAgLy8gdGhyb3cgbmV3IEFwcG9pbnRtZW50Q3JlYXRpb25FcnJvcihcIk5vIGhheSBwcm9mZXNpb25hbGVzIGRpc3BvbmlibGVzIHBhcmEgYXNpZ25hciBlbCB0dXJub1wiLCA0MDApOyBcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0IGR1cmF0aW9uU291cmNlID0gTnVtYmVyKGR1cmF0aW9uID8/IHJlc29sdmVkU2VydmljZT8uZHVyYXRpb25fbWludXRlcyA/PyAzMCk7XHJcbiAgY29uc3QgZHVyYXRpb25NaW51dGVzID0gTWF0aC5tYXgoNSwgTnVtYmVyLmlzRmluaXRlKGR1cmF0aW9uU291cmNlKSA/IGR1cmF0aW9uU291cmNlIDogMzApO1xyXG4gIGNvbnN0IGVuZEF0ID0gYWRkTWludXRlcyhzdGFydEF0LCBkdXJhdGlvbk1pbnV0ZXMpO1xyXG5cclxuICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUGF0aWVudCB9ID0gYXdhaXQgZGJcclxuICAgIC5mcm9tKFwiYWdlbmRhX3BhdGllbnRzXCIpXHJcbiAgICAuc2VsZWN0KFwiaWRcIilcclxuICAgIC5lcShcInRlbmFudF9pZFwiLCB0ZW5hbnRJZClcclxuICAgIC5lcShcInBob25lX2UxNjRcIiwgbm9ybWFsaXplZFBob25lKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGxldCBwYXRpZW50SWQgPSAoZXhpc3RpbmdQYXRpZW50IGFzIFBpY2s8UGF0aWVudFJvdywgXCJpZFwiPiB8IG51bGwpPy5pZCA/PyBudWxsO1xyXG4gIGlmICghcGF0aWVudElkKSB7XHJcbiAgICBjb25zdCBpbnNlcnRQYXlsb2FkID0ge1xyXG4gICAgICB0ZW5hbnRfaWQ6IHRlbmFudElkLFxyXG4gICAgICBmdWxsX25hbWU6IHBhdGllbnQsXHJcbiAgICAgIHBob25lX2UxNjQ6IG5vcm1hbGl6ZWRQaG9uZSxcclxuICAgICAgZW1haWw6IGVtYWlsICYmIGVtYWlsLmxlbmd0aCA+IDAgPyBlbWFpbCA6IG51bGwsIC8vIEFkZGVkXHJcbiAgICAgIG9wdF9vdXQ6IGZhbHNlLFxyXG4gICAgfSBzYXRpc2ZpZXMgRGF0YWJhc2VbXCJwdWJsaWNcIl1bXCJUYWJsZXNcIl1bXCJhZ2VuZGFfcGF0aWVudHNcIl1bXCJJbnNlcnRcIl07XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3I6IHBhdGllbnRFcnJvciB9ID0gYXdhaXQgZGJcclxuICAgICAgLmZyb20oXCJhZ2VuZGFfcGF0aWVudHNcIilcclxuICAgICAgLmluc2VydChpbnNlcnRQYXlsb2FkKVxyXG4gICAgICAuc2VsZWN0KFwiaWRcIilcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChwYXRpZW50RXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEFwcG9pbnRtZW50Q3JlYXRpb25FcnJvcihwYXRpZW50RXJyb3IubWVzc2FnZSwgNDAwKTtcclxuICAgIH1cclxuXHJcbiAgICBwYXRpZW50SWQgPSAoaW5zZXJ0ZWQgYXMgUGljazxQYXRpZW50Um93LCBcImlkXCI+KS5pZDtcclxuICB9IGVsc2Uge1xyXG4gICAgLy8gVXBzZXJ0IGVtYWlsIGlmIHByb3ZpZGVkXHJcbiAgICBjb25zdCB1cGRhdGVQYXlsb2FkOiBhbnkgPSB7IGZ1bGxfbmFtZTogcGF0aWVudCB9O1xyXG4gICAgaWYgKGVtYWlsICYmIGVtYWlsLmxlbmd0aCA+IDApIHVwZGF0ZVBheWxvYWQuZW1haWwgPSBlbWFpbDtcclxuICAgIFxyXG4gICAgYXdhaXQgZGIuZnJvbShcImFnZW5kYV9wYXRpZW50c1wiKS51cGRhdGUodXBkYXRlUGF5bG9hZCkuZXEoXCJpZFwiLCBwYXRpZW50SWQpLmVxKFwidGVuYW50X2lkXCIsIHRlbmFudElkKTtcclxuICB9XHJcblxyXG4gIGxldCBsb2NhdGlvbklkOiBzdHJpbmcgfCBudWxsID0gcmF3TG9jYXRpb25JZCA/PyByZXNvbHZlZFByb3ZpZGVyPy5kZWZhdWx0X2xvY2F0aW9uX2lkID8/IG51bGw7XHJcbiAgbGV0IGxvY2F0aW9uTmFtZSA9IFwiQ29uc3VsdG9yaW9cIjtcclxuICBsZXQgbG9jYXRpb25UaW1lem9uZSA9IFwiQW1lcmljYS9BcmdlbnRpbmEvQnVlbm9zX0FpcmVzXCI7XHJcbiAgbGV0IGJ1ZmZlck1pbnV0ZXMgPSAwO1xyXG4gIGxldCBidXNpbmVzc0hvdXJzOiBSZWNvcmQ8c3RyaW5nLCBbc3RyaW5nLCBzdHJpbmddW10+ID0ge307XHJcblxyXG4gIGNvbnN0IGFzc2lnbkxvY2F0aW9uID0gKHJvdzogTG9jYXRpb25Mb29rdXAgfCBudWxsKSA9PiB7XHJcbiAgICBpZiAocm93KSB7XHJcbiAgICAgIGxvY2F0aW9uSWQgPSByb3cuaWQ7XHJcbiAgICAgIGxvY2F0aW9uTmFtZSA9IHJvdy5uYW1lO1xyXG4gICAgICBsb2NhdGlvblRpbWV6b25lID0gcm93LnRpbWV6b25lO1xyXG4gICAgICBidWZmZXJNaW51dGVzID0gcm93LmJ1ZmZlcl9taW51dGVzID8/IDA7XHJcbiAgICAgIGJ1c2luZXNzSG91cnMgPSAocm93LmJ1c2luZXNzX2hvdXJzIGFzIFJlY29yZDxzdHJpbmcsIFtzdHJpbmcsIHN0cmluZ11bXT4pID8/IHt9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbG9jYXRpb25JZCA9IG51bGw7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgaWYgKGxvY2F0aW9uSWQpIHtcclxuICAgIGNvbnN0IHsgZGF0YTogbG9jYXRpb25Sb3cgfSA9IGF3YWl0IGRiXHJcbiAgICAgIC5mcm9tKFwiYWdlbmRhX2xvY2F0aW9uc1wiKVxyXG4gICAgICAuc2VsZWN0KFwiaWQsIG5hbWUsIHRpbWV6b25lLCBidWZmZXJfbWludXRlcywgYnVzaW5lc3NfaG91cnNcIilcclxuICAgICAgLmVxKFwidGVuYW50X2lkXCIsIHRlbmFudElkKVxyXG4gICAgICAuZXEoXCJpZFwiLCBsb2NhdGlvbklkKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBhc3NpZ25Mb2NhdGlvbigobG9jYXRpb25Sb3cgYXMgTG9jYXRpb25Mb29rdXAgfCBudWxsKSA/PyBudWxsKTtcclxuICB9XHJcblxyXG4gIGlmICghbG9jYXRpb25JZCkge1xyXG4gICAgY29uc3QgeyBkYXRhOiBmYWxsYmFjayB9ID0gYXdhaXQgZGJcclxuICAgICAgLmZyb20oXCJhZ2VuZGFfbG9jYXRpb25zXCIpXHJcbiAgICAgIC5zZWxlY3QoXCJpZCwgbmFtZSwgdGltZXpvbmUsIGJ1ZmZlcl9taW51dGVzLCBidXNpbmVzc19ob3Vyc1wiKVxyXG4gICAgICAuZXEoXCJ0ZW5hbnRfaWRcIiwgdGVuYW50SWQpXHJcbiAgICAgIC5vcmRlcihcIm5hbWVcIiwgeyBhc2NlbmRpbmc6IHRydWUgfSlcclxuICAgICAgLmxpbWl0KDEpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGFzc2lnbkxvY2F0aW9uKChmYWxsYmFjayBhcyBMb2NhdGlvbkxvb2t1cCB8IG51bGwpID8/IG51bGwpO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFsb2NhdGlvbklkKSB7XHJcbiAgICB0aHJvdyBuZXcgQXBwb2ludG1lbnRDcmVhdGlvbkVycm9yKFwiRGViZSBjcmVhciB1bmEgdWJpY2FjacOzbiBwcmltZXJvXCIsIDQwMCk7XHJcbiAgfVxyXG5cclxuICAvLyAxLiBDaGVjayBQcm92aWRlciBPdmVycmlkZVxyXG4gIGlmIChyZXNvbHZlZFByb3ZpZGVyKSB7XHJcbiAgICAgIGNvbnN0IHByb3ZTY2hlZHVsZSA9IChyZXNvbHZlZFByb3ZpZGVyLm1ldGFkYXRhIGFzIGFueSk/LnNjaGVkdWxlO1xyXG4gICAgICBpZiAocHJvdlNjaGVkdWxlICYmIE9iamVjdC5rZXlzKHByb3ZTY2hlZHVsZSkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgYnVzaW5lc3NIb3VycyA9IHByb3ZTY2hlZHVsZTtcclxuICAgICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gMi4gRmFsbGJhY2sgZGVmYXVsdCBob3VycyBpZiBlbXB0eSAoTWF0Y2hlcyBnZXRTbG90cyBiZWhhdmlvcilcclxuICBpZiAoT2JqZWN0LmtleXMoYnVzaW5lc3NIb3VycykubGVuZ3RoID09PSAwKSB7XHJcbiAgICBidXNpbmVzc0hvdXJzID0ge1xyXG4gICAgICBtb246IFtbXCIwOTowMFwiLCBcIjE4OjAwXCJdXSxcclxuICAgICAgdHVlOiBbW1wiMDk6MDBcIiwgXCIxODowMFwiXV0sXHJcbiAgICAgIHdlZDogW1tcIjA5OjAwXCIsIFwiMTg6MDBcIl1dLFxyXG4gICAgICB0aHU6IFtbXCIwOTowMFwiLCBcIjE4OjAwXCJdXSxcclxuICAgICAgZnJpOiBbW1wiMDk6MDBcIiwgXCIxODowMFwiXV0sXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdmFsaWRIb3VycyA9IGlzV2l0aGluQnVzaW5lc3NIb3Vycyh7XHJcbiAgICBzdGFydDogc3RhcnRBdCxcclxuICAgIGVuZDogZW5kQXQsXHJcbiAgICBidXNpbmVzc0hvdXJzLFxyXG4gICAgdGltZVpvbmU6IGxvY2F0aW9uVGltZXpvbmUsXHJcbiAgfSk7XHJcblxyXG4gIGlmICghdmFsaWRIb3Vycykge1xyXG4gICAgY29uc3QgZGVidWdJbmZvID0gYFN0YXJ0OiAke3N0YXJ0QXQudG9JU09TdHJpbmcoKX0sIExvY1RaOiAke2xvY2F0aW9uVGltZXpvbmV9LCBMb2NhbERheTogJHtuZXcgSW50bC5EYXRlVGltZUZvcm1hdChcImVuLVVTXCIsIHsgdGltZVpvbmU6IGxvY2F0aW9uVGltZXpvbmUsIHdlZWtkYXk6IFwic2hvcnRcIiwgaG91cjogJ251bWVyaWMnIH0pLmZvcm1hdChzdGFydEF0KX1gO1xyXG4gICAgY29uc29sZS5lcnJvcihgW0FwcG9pbnRtZW50RXJyb3JdIE91dHNpZGUgQnVzaW5lc3MgSG91cnMuICR7ZGVidWdJbmZvfWApO1xyXG4gICAgdGhyb3cgbmV3IEFwcG9pbnRtZW50Q3JlYXRpb25FcnJvcihgRnVlcmEgZGVsIGhvcmFyaW8gZGUgYXRlbmNpw7NuICgke2RlYnVnSW5mb30pYCwgNDAwKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNvbmZsaWN0V2luZG93U3RhcnQgPSBhZGRNaW51dGVzKHN0YXJ0QXQsIC1idWZmZXJNaW51dGVzKTtcclxuICBjb25zdCBjb25mbGljdFdpbmRvd0VuZCA9IGFkZE1pbnV0ZXMoZW5kQXQsIGJ1ZmZlck1pbnV0ZXMpO1xyXG5cclxuICBsZXQgY29uZmxpY3RRdWVyeSA9IGRiXHJcbiAgICAuZnJvbShcImFnZW5kYV9hcHBvaW50bWVudHNcIilcclxuICAgIC5zZWxlY3QoXCJpZFwiKVxyXG4gICAgLmVxKFwidGVuYW50X2lkXCIsIHRlbmFudElkKVxyXG4gICAgLmVxKFwibG9jYXRpb25faWRcIiwgbG9jYXRpb25JZClcclxuICAgIC5uZXEoXCJzdGF0dXNcIiwgXCJjYW5jZWxlZFwiKVxyXG4gICAgLmx0KFwic3RhcnRfYXRcIiwgY29uZmxpY3RXaW5kb3dFbmQudG9JU09TdHJpbmcoKSlcclxuICAgIC5ndChcImVuZF9hdFwiLCBjb25mbGljdFdpbmRvd1N0YXJ0LnRvSVNPU3RyaW5nKCkpO1xyXG5cclxuICAvKlxyXG4gIC8vIERpc2FibGVkIHVudGlsIERCIG1pZ3JhdGlvbiBpcyBhcHBsaWVkXHJcbiAgaWYgKHJlc29sdmVkUHJvdmlkZXI/LmlkKSB7XHJcbiAgICBjb25mbGljdFF1ZXJ5ID0gY29uZmxpY3RRdWVyeS5vcihgcHJvdmlkZXJfaWQuZXEuJHtyZXNvbHZlZFByb3ZpZGVyLmlkfSxwcm92aWRlcl9pZC5pcy5udWxsYCk7XHJcbiAgfVxyXG4gICovXHJcblxyXG4gIGNvbnN0IHsgZGF0YTogY29uZmxpY3RzLCBlcnJvcjogY29uZmxpY3RFcnJvciB9ID0gYXdhaXQgY29uZmxpY3RRdWVyeS5saW1pdCgxKTtcclxuXHJcbiAgaWYgKGNvbmZsaWN0RXJyb3IpIHtcclxuICAgIHRocm93IG5ldyBBcHBvaW50bWVudENyZWF0aW9uRXJyb3IoY29uZmxpY3RFcnJvci5tZXNzYWdlLCA0MDApO1xyXG4gIH1cclxuXHJcbiAgaWYgKGNvbmZsaWN0cyAmJiBjb25mbGljdHMubGVuZ3RoID4gMCkge1xyXG4gICAgdGhyb3cgbmV3IEFwcG9pbnRtZW50Q3JlYXRpb25FcnJvcihcIllhIGhheSB1biB0dXJubyBlbiBlc2UgaG9yYXJpb1wiLCA0MDkpO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc2VydmljZVNuYXBzaG90ID0gcmVzb2x2ZWRTZXJ2aWNlXHJcbiAgICA/IHtcclxuICAgICAgICBpZDogcmVzb2x2ZWRTZXJ2aWNlLmlkLFxyXG4gICAgICAgIG5hbWU6IHJlc29sdmVkU2VydmljZS5uYW1lLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiByZXNvbHZlZFNlcnZpY2UuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgZHVyYXRpb25fbWludXRlczogcmVzb2x2ZWRTZXJ2aWNlLmR1cmF0aW9uX21pbnV0ZXMsXHJcbiAgICAgICAgcHJpY2VfbWlub3JfdW5pdHM6IHJlc29sdmVkU2VydmljZS5wcmljZV9taW5vcl91bml0cyxcclxuICAgICAgICBjdXJyZW5jeTogcmVzb2x2ZWRTZXJ2aWNlLmN1cnJlbmN5LFxyXG4gICAgICAgIGNvbG9yOiByZXNvbHZlZFNlcnZpY2UuY29sb3IsXHJcbiAgICAgIH1cclxuICAgIDogbnVsbDtcclxuXHJcbiAgY29uc3Qgbm9ybWFsaXplZFNlcnZpY2VOYW1lID0gcmVzb2x2ZWRTZXJ2aWNlPy5uYW1lID8/IChzZXJ2aWNlTmFtZT8udHJpbSgpLmxlbmd0aCA/IHNlcnZpY2VOYW1lPy50cmltKCkgOiBudWxsKTtcclxuXHJcbiAgY29uc3QgYXBwb2ludG1lbnRJbnNlcnQgPSB7XHJcbiAgICB0ZW5hbnRfaWQ6IHRlbmFudElkLFxyXG4gICAgbG9jYXRpb25faWQ6IGxvY2F0aW9uSWQsXHJcbiAgICBwYXRpZW50X2lkOiBwYXRpZW50SWQsXHJcbiAgICBzdGFydF9hdDogc3RhcnRBdC50b0lTT1N0cmluZygpLFxyXG4gICAgZW5kX2F0OiBlbmRBdC50b0lTT1N0cmluZygpLFxyXG4gICAgc3RhdHVzOiBcInBlbmRpbmdcIixcclxuICAgIHNlcnZpY2VfaWQ6IHJlc29sdmVkU2VydmljZT8uaWQgPz8gbnVsbCxcclxuICAgIHByb3ZpZGVyX2lkOiByZXNvbHZlZFByb3ZpZGVyPy5pZCA/PyBudWxsLFxyXG4gICAgc2VydmljZV9uYW1lOiBub3JtYWxpemVkU2VydmljZU5hbWUsXHJcbiAgICAvLyBzZXJ2aWNlX3NuYXBzaG90OiBzZXJ2aWNlU25hcHNob3QsIC8vIFRPRE86IFJ1biBtaWdyYXRpb24gdG8gYWRkIHRoaXMgY29sdW1uXHJcbiAgICBpbnRlcm5hbF9ub3Rlczogbm90ZXMgPz8gbnVsbCxcclxuICB9IHNhdGlzZmllcyBBcHBvaW50bWVudEluc2VydDtcclxuXHJcbiAgY29uc3QgeyBlcnJvcjogYXBwdEVycm9yLCBkYXRhOiBhcHB0IH0gPSBhd2FpdCBkYlxyXG4gICAgLmZyb20oXCJhZ2VuZGFfYXBwb2ludG1lbnRzXCIpXHJcbiAgICAuaW5zZXJ0KGFwcG9pbnRtZW50SW5zZXJ0KVxyXG4gICAgLnNlbGVjdChcImlkLCBzdGFydF9hdCwgZW5kX2F0LCBzdGF0dXNcIilcclxuICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgaWYgKGFwcHRFcnJvcikge1xyXG4gICAgaWYgKGFwcHRFcnJvci5jb2RlID09PSBcIjIzUDAxXCIgfHwgYXBwdEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKFwiYWdlbmRhX2Noa19ub19vdmVybGFwXCIpKSB7XHJcbiAgICAgIHRocm93IG5ldyBBcHBvaW50bWVudENyZWF0aW9uRXJyb3IoXCJFbCBob3JhcmlvIHNlbGVjY2lvbmFkbyB5YSBlc3TDoSBvY3VwYWRvIHBvciBvdHJvIHR1cm5vIChjb25mbGljdG8gZGV0ZWN0YWRvKS5cIiwgNDA5KTtcclxuICAgIH1cclxuICAgIHRocm93IG5ldyBBcHBvaW50bWVudENyZWF0aW9uRXJyb3IoYXBwdEVycm9yLm1lc3NhZ2UsIDQwMCk7XHJcbiAgfVxyXG5cclxuICAvLyBGaXJlICYgRm9yZ2V0OiBTeW5jIHRvIEdvb2dsZSBDYWxlbmRhclxyXG4gIGlmIChwcm92aWRlcklkKSB7XHJcbiAgICAgdm9pZCBjcmVhdGVHb29nbGVDYWxlbmRhckV2ZW50KGRiLCB7XHJcbiAgICAgICAgIC4uLmFwcHQgYXMgYW55LCBcclxuICAgICAgICAgYWdlbmRhX3BhdGllbnRzOiB7IGZ1bGxfbmFtZTogcGF0aWVudCB9LFxyXG4gICAgICAgICBhZ2VuZGFfc2VydmljZXM6IHsgbmFtZTogKHJlc29sdmVkU2VydmljZT8ubmFtZSA/PyBzZXJ2aWNlTmFtZSA/PyBcIlNlcnZpY2lvXCIpIH1cclxuICAgICB9LCBwcm92aWRlcklkKS5jYXRjaChjb25zb2xlLmVycm9yKTtcclxuICB9XHJcblxyXG4gIGlmIChzZW5kTm90aWZpY2F0aW9ucykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgW2NyZWRlbnRpYWxzLCB0ZW1wbGF0ZU1hcF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgICAgZ2V0V2hhdHNBcHBJbnRlZ3JhdGlvbkJ5VGVuYW50KGRiLCB0ZW5hbnRJZCksXHJcbiAgICAgICAgZ2V0VGVuYW50VGVtcGxhdGVNYXAoZGIsIHRlbmFudElkKSxcclxuICAgICAgXSk7XHJcblxyXG4gICAgICBpZiAoIWNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgLy8gQ3JpdGljYWwgZXJyb3IgZm9yIGF1ZGl0aW5nXHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgW0FwcG9pbnRtZW50Q3JlYXRpb25dIE1pc3NpbmcgV2hhdHNBcHAgY3JlZGVudGlhbHMgZm9yIHRlbmFudCAke3RlbmFudElkfS4gTWVzc2FnZSBOT1Qgc2VudC5gKTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJXaGF0c0FwcCBpbnRlZ3JhdGlvbiBtaXNzaW5nIGZvciB0ZW5hbnRcIik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFJFQUwgTE9HSUM6IFVzZSBjb25maWd1cmVkIHRlbXBsYXRlIG9yIGRlZmF1bHQgdG8gc3lzdGVtIG5hbWVcclxuICAgICAgY29uc3QgdGVtcGxhdGVLZXkgPSBURU1QTEFURV9OQU1FUy5hcHBvaW50bWVudENyZWF0ZWQ7XHJcbiAgICAgIGNvbnN0IHRlbXBsYXRlVG9TZW5kID0gdGVtcGxhdGVNYXA/LmdldCh0ZW1wbGF0ZUtleSk/Lm1ldGFUZW1wbGF0ZU5hbWUgPz8gdGVtcGxhdGVLZXk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBwcm92aWRlck5hbWUgPSByZXNvbHZlZFByb3ZpZGVyPy5mdWxsX25hbWUgPz8gXCJlbCBlc3BlY2lhbGlzdGFcIjtcclxuICAgICAgY29uc3QgZGF0ZVN0ciA9IHN0YXJ0QXQudG9Mb2NhbGVEYXRlU3RyaW5nKFwiZXMtQVJcIiwgeyBkYXk6ICdudW1lcmljJywgbW9udGg6ICdsb25nJywgdGltZVpvbmU6IGxvY2F0aW9uVGltZXpvbmUgfSk7XHJcbiAgICAgIGNvbnN0IHRpbWVTdHIgPSBzdGFydEF0LnRvTG9jYWxlVGltZVN0cmluZyhcImVzLUFSXCIsIHsgaG91cjogXCIyLWRpZ2l0XCIsIG1pbnV0ZTogXCIyLWRpZ2l0XCIsIHRpbWVab25lOiBsb2NhdGlvblRpbWV6b25lIH0pO1xyXG5cclxuICAgICAgLy8gQmFzZWQgb24gcmVhbCB0ZW1wbGF0ZSBzdHJ1Y3R1cmU6XHJcbiAgICAgIC8vIHt7MX19IFBhdGllbnRcclxuICAgICAgLy8ge3syfX0gRGF0ZSAoQm9keSlcclxuICAgICAgLy8ge3szfX0gRGF0ZSAoTGFiZWw6IEZlY2hhKVxyXG4gICAgICAvLyB7ezR9fSBUaW1lIChMYWJlbDogSG9yYSlcclxuICAgICAgLy8ge3s1fX0gTG9jYXRpb24gKyBQcm92aWRlciAoTGFiZWw6IETDs25kZSlcclxuICAgICAgY29uc3QgdmFyaWFibGVzVG9TZW5kID0gW1xyXG4gICAgICAgICAgcGF0aWVudCxcclxuICAgICAgICAgIGRhdGVTdHIsXHJcbiAgICAgICAgICBkYXRlU3RyLFxyXG4gICAgICAgICAgdGltZVN0cixcclxuICAgICAgICAgIGAke2xvY2F0aW9uTmFtZSA/PyBcIm51ZXN0cm8gY29uc3VsdG9yaW9cIn0gY29uICR7cHJvdmlkZXJOYW1lfWAsXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FwcG9pbnRtZW50Q3JlYXRpb25dIFNlbmRpbmcgV2hhdHNBcHAgdG8gJHtub3JtYWxpemVkUGhvbmV9IChUZW1wbGF0ZTogJHt0ZW1wbGF0ZVRvU2VuZH0pYCk7XHJcblxyXG4gICAgICBhd2FpdCBzZW5kVGVtcGxhdGVNZXNzYWdlKHtcclxuICAgICAgICB0bzogbm9ybWFsaXplZFBob25lLFxyXG4gICAgICAgIHRlbXBsYXRlOiB0ZW1wbGF0ZVRvU2VuZCxcclxuICAgICAgICB2YXJpYWJsZXM6IHZhcmlhYmxlc1RvU2VuZCxcclxuICAgICAgICBjcmVkZW50aWFscyxcclxuICAgICAgICBsYW5ndWFnZUNvZGU6IFwiZXNcIlxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGF3YWl0IGRiLmZyb20oXCJhZ2VuZGFfbWVzc2FnZV9sb2dcIikuaW5zZXJ0KHtcclxuICAgICAgICB0ZW5hbnRfaWQ6IHRlbmFudElkLFxyXG4gICAgICAgIHBhdGllbnRfaWQ6IHBhdGllbnRJZCxcclxuICAgICAgICBhcHBvaW50bWVudF9pZDogKGFwcHQgYXMgQXBwb2ludG1lbnRSb3cpLmlkLFxyXG4gICAgICAgIGRpcmVjdGlvbjogXCJvdXRcIixcclxuICAgICAgICB0eXBlOiBURU1QTEFURV9OQU1FUy5hcHBvaW50bWVudENyZWF0ZWQsXHJcbiAgICAgICAgc3RhdHVzOiBcInNlbnRcIixcclxuICAgICAgICAvLyBAdHMtaWdub3JlIC0gVGhlIHR5cGUgZGVmaW5pdGlvbiBpbiBEQiB0eXBlcyBtaWdodCBub3QgaW5jbHVkZSBwYXlsb2FkX2pzb24geWV0IGlmIG5vdCBnZW5lcmF0ZWRcclxuICAgICAgICAvLyBidXQgd2Ugd2FudCB0byBzYXZlIGl0IGFzIEpTT05CXHJcbiAgICAgICAgcGF5bG9hZF9qc29uOiB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiB0ZW1wbGF0ZVRvU2VuZCxcclxuICAgICAgICAgICAgdmFyaWFibGVzOiB2YXJpYWJsZXNUb1NlbmQsXHJcbiAgICAgICAgICAgIHR5cGU6IFwidGVtcGxhdGVcIlxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBsb2dJbmZvKFwiYXBwb2ludG1lbnQuY3JlYXRlZF9ub3RpZmljYXRpb25fc2VudFwiLCB7XHJcbiAgICAgICAgdGVuYW50X2lkOiB0ZW5hbnRJZCxcclxuICAgICAgICBhcHBvaW50bWVudF9pZDogKGFwcHQgYXMgQXBwb2ludG1lbnRSb3cpLmlkLFxyXG4gICAgICAgIHBhdGllbnRfaWQ6IHBhdGllbnRJZCxcclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgbG9nRXJyb3IoXCJhcHBvaW50bWVudC5jcmVhdGVkX25vdGlmaWNhdGlvbl9mYWlsZWRcIiwge1xyXG4gICAgICAgIHRlbmFudF9pZDogdGVuYW50SWQsXHJcbiAgICAgICAgYXBwb2ludG1lbnRfaWQ6IChhcHB0IGFzIEFwcG9pbnRtZW50Um93KS5pZCxcclxuICAgICAgICBlcnJvcjogKGVyciBhcyBFcnJvcik/Lm1lc3NhZ2UgPz8gU3RyaW5nKGVyciksXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHsgYXBwb2ludG1lbnQ6IGFwcHQgfTtcclxufVxyXG4iXSwibmFtZXMiOlsiYWRkTWludXRlcyIsIm5vcm1hbGl6ZVBob25lTnVtYmVyIiwiaXNXaXRoaW5CdXNpbmVzc0hvdXJzIiwic2VuZFRlbXBsYXRlTWVzc2FnZSIsIlRFTVBMQVRFX05BTUVTIiwiZ2V0VGVuYW50VGVtcGxhdGVNYXAiLCJnZXRXaGF0c0FwcEludGVncmF0aW9uQnlUZW5hbnQiLCJsb2dFcnJvciIsImxvZ0luZm8iLCJBcHBvaW50bWVudENyZWF0aW9uRXJyb3IiLCJFcnJvciIsImNvbnN0cnVjdG9yIiwibWVzc2FnZSIsInN0YXR1cyIsImNyZWF0ZUdvb2dsZUNhbGVuZGFyRXZlbnQiLCJjcmVhdGVBcHBvaW50bWVudEZvclRlbmFudCIsIm9wdGlvbnMiLCJkYiIsInRlbmFudElkIiwiaW5wdXQiLCJzZW5kTm90aWZpY2F0aW9ucyIsInBhdGllbnQiLCJwaG9uZSIsImVtYWlsIiwic3RhcnQiLCJkdXJhdGlvbiIsInNlcnZpY2VOYW1lIiwibm90ZXMiLCJsb2NhdGlvbklkIiwicmF3TG9jYXRpb25JZCIsInNlcnZpY2VJZCIsInByb3ZpZGVySWQiLCJzdGFydEF0IiwiRGF0ZSIsIk51bWJlciIsImlzRmluaXRlIiwiZ2V0VGltZSIsIm5vcm1hbGl6ZWRQaG9uZSIsInJlc29sdmVkU2VydmljZSIsImRhdGEiLCJzZXJ2aWNlUm93IiwiZXJyb3IiLCJzZXJ2aWNlRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJtYXliZVNpbmdsZSIsImFjdGl2ZSIsInJlc29sdmVkUHJvdmlkZXIiLCJwcm92aWRlclJvdyIsInByb3ZpZGVyRXJyb3IiLCJhbnlQcm92aWRlciIsImxpbWl0IiwiZHVyYXRpb25Tb3VyY2UiLCJkdXJhdGlvbl9taW51dGVzIiwiZHVyYXRpb25NaW51dGVzIiwiTWF0aCIsIm1heCIsImVuZEF0IiwiZXhpc3RpbmdQYXRpZW50IiwicGF0aWVudElkIiwiaWQiLCJpbnNlcnRQYXlsb2FkIiwidGVuYW50X2lkIiwiZnVsbF9uYW1lIiwicGhvbmVfZTE2NCIsImxlbmd0aCIsIm9wdF9vdXQiLCJpbnNlcnRlZCIsInBhdGllbnRFcnJvciIsImluc2VydCIsInNpbmdsZSIsInVwZGF0ZVBheWxvYWQiLCJ1cGRhdGUiLCJkZWZhdWx0X2xvY2F0aW9uX2lkIiwibG9jYXRpb25OYW1lIiwibG9jYXRpb25UaW1lem9uZSIsImJ1ZmZlck1pbnV0ZXMiLCJidXNpbmVzc0hvdXJzIiwiYXNzaWduTG9jYXRpb24iLCJyb3ciLCJuYW1lIiwidGltZXpvbmUiLCJidWZmZXJfbWludXRlcyIsImJ1c2luZXNzX2hvdXJzIiwibG9jYXRpb25Sb3ciLCJmYWxsYmFjayIsIm9yZGVyIiwiYXNjZW5kaW5nIiwicHJvdlNjaGVkdWxlIiwibWV0YWRhdGEiLCJzY2hlZHVsZSIsIk9iamVjdCIsImtleXMiLCJtb24iLCJ0dWUiLCJ3ZWQiLCJ0aHUiLCJmcmkiLCJ2YWxpZEhvdXJzIiwiZW5kIiwidGltZVpvbmUiLCJkZWJ1Z0luZm8iLCJ0b0lTT1N0cmluZyIsIkludGwiLCJEYXRlVGltZUZvcm1hdCIsIndlZWtkYXkiLCJob3VyIiwiZm9ybWF0IiwiY29uc29sZSIsImNvbmZsaWN0V2luZG93U3RhcnQiLCJjb25mbGljdFdpbmRvd0VuZCIsImNvbmZsaWN0UXVlcnkiLCJuZXEiLCJsdCIsImd0IiwiY29uZmxpY3RzIiwiY29uZmxpY3RFcnJvciIsInNlcnZpY2VTbmFwc2hvdCIsImRlc2NyaXB0aW9uIiwicHJpY2VfbWlub3JfdW5pdHMiLCJjdXJyZW5jeSIsImNvbG9yIiwibm9ybWFsaXplZFNlcnZpY2VOYW1lIiwidHJpbSIsImFwcG9pbnRtZW50SW5zZXJ0IiwibG9jYXRpb25faWQiLCJwYXRpZW50X2lkIiwic3RhcnRfYXQiLCJlbmRfYXQiLCJzZXJ2aWNlX2lkIiwicHJvdmlkZXJfaWQiLCJzZXJ2aWNlX25hbWUiLCJpbnRlcm5hbF9ub3RlcyIsImFwcHRFcnJvciIsImFwcHQiLCJjb2RlIiwiaW5jbHVkZXMiLCJhZ2VuZGFfcGF0aWVudHMiLCJhZ2VuZGFfc2VydmljZXMiLCJjYXRjaCIsImNyZWRlbnRpYWxzIiwidGVtcGxhdGVNYXAiLCJQcm9taXNlIiwiYWxsIiwidGVtcGxhdGVLZXkiLCJhcHBvaW50bWVudENyZWF0ZWQiLCJ0ZW1wbGF0ZVRvU2VuZCIsImdldCIsIm1ldGFUZW1wbGF0ZU5hbWUiLCJwcm92aWRlck5hbWUiLCJkYXRlU3RyIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwiZGF5IiwibW9udGgiLCJ0aW1lU3RyIiwidG9Mb2NhbGVUaW1lU3RyaW5nIiwibWludXRlIiwidmFyaWFibGVzVG9TZW5kIiwibG9nIiwidG8iLCJ0ZW1wbGF0ZSIsInZhcmlhYmxlcyIsImxhbmd1YWdlQ29kZSIsImFwcG9pbnRtZW50X2lkIiwiZGlyZWN0aW9uIiwidHlwZSIsInBheWxvYWRfanNvbiIsImVyciIsIlN0cmluZyIsImFwcG9pbnRtZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/appointments/createAppointment.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/integrations/google-calendar.ts":
/*!****************************************************!*\
  !*** ./src/server/integrations/google-calendar.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createGoogleCalendarEvent: () => (/* binding */ createGoogleCalendarEvent)\n/* harmony export */ });\nconst CLIENT_ID = process.env.GOOGLE_CLIENT_ID;\nconst CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET;\n/**\r\n * Ensures we have a valid access token.\r\n * Refreshes it if expired.\r\n */ async function getValidToken(db, integration) {\n    const credentials = integration.credentials;\n    const expiresAt = new Date(credentials.expires_at ?? 0);\n    const nowBuffer = new Date(Date.now() + 5 * 60 * 1000); // 5 min buffer\n    if (expiresAt > nowBuffer) {\n        return credentials.access_token;\n    }\n    // Need refresh\n    if (!credentials.refresh_token || !CLIENT_ID || !CLIENT_SECRET) {\n        console.error(\"Cannot refresh token: missing refresh token or env vars\");\n        return null;\n    }\n    try {\n        const res = await fetch(\"https://oauth2.googleapis.com/token\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            body: new URLSearchParams({\n                client_id: CLIENT_ID,\n                client_secret: CLIENT_SECRET,\n                refresh_token: credentials.refresh_token,\n                grant_type: \"refresh_token\"\n            })\n        });\n        const data = await res.json();\n        if (!res.ok) throw new Error(JSON.stringify(data));\n        // Update DB\n        const newExpiry = new Date(Date.now() + (data.expires_in ?? 3600) * 1000).toISOString();\n        const newCreds = {\n            ...credentials,\n            access_token: data.access_token,\n            expires_at: newExpiry\n        };\n        await db.from(\"agenda_integrations\").update({\n            credentials: newCreds,\n            updated_at: new Date().toISOString()\n        }).eq(\"id\", integration.id);\n        return data.access_token;\n    } catch (e) {\n        console.error(\"Failed to refresh Google Token\", e);\n        return null;\n    }\n}\nasync function createGoogleCalendarEvent(db, appointment, providerId) {\n    // 1. Find integration for the provider\n    // Since we moved to Tenant-wide integration in agenda_integrations, we use tenant_id\n    const tenantId = appointment.tenant_id;\n    const { data } = await db.from(\"agenda_integrations\").select(\"*\").eq(\"tenant_id\", tenantId).eq(\"provider\", \"google_calendar\").eq(\"enabled\", true).maybeSingle();\n    const integration = data;\n    if (!integration) return;\n    const credentials = integration.credentials;\n    if (!credentials?.access_token) return;\n    const token = await getValidToken(db, integration);\n    if (!token) return;\n    // 2. Create Event\n    const patientName = appointment.agenda_patients?.full_name ?? \"Paciente\";\n    const serviceName = appointment.agenda_services?.name ?? \"Consulta\";\n    const start = new Date(appointment.start_at);\n    const end = new Date(appointment.end_at);\n    const eventBody = {\n        summary: `${serviceName} - ${patientName}`,\n        description: `Notas: ${appointment.internal_notes ?? \"Sin notas\"}\\nAgendado via Agend.ar`,\n        start: {\n            dateTime: start.toISOString()\n        },\n        end: {\n            dateTime: end.toISOString()\n        }\n    };\n    try {\n        const res = await fetch(\"https://www.googleapis.com/calendar/v3/calendars/primary/events\", {\n            method: \"POST\",\n            headers: {\n                Authorization: `Bearer ${token}`,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(eventBody)\n        });\n        if (res.ok) {\n            const json = await res.json();\n            // Save external ID to allow updates/deletes later\n            await db.from(\"agenda_appointments\").update({\n                external_calendar_id: json.id,\n                external_calendar_provider: \"google_calendar\"\n            }).eq(\"id\", appointment.id);\n        } else {\n            console.error(\"Google Calendar API Error\", await res.text());\n        }\n    } catch (e) {\n        console.error(\"Google Sync Exception\", e);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2ludGVncmF0aW9ucy9nb29nbGUtY2FsZW5kYXIudHMiLCJtYXBwaW5ncyI6Ijs7OztBQU1BLE1BQU1BLFlBQVlDLFFBQVFDLEdBQUcsQ0FBQ0MsZ0JBQWdCO0FBQzlDLE1BQU1DLGdCQUFnQkgsUUFBUUMsR0FBRyxDQUFDRyxvQkFBb0I7QUFFdEQ7OztDQUdDLEdBQ0QsZUFBZUMsY0FBY0MsRUFBNEIsRUFBRUMsV0FBd0I7SUFDakYsTUFBTUMsY0FBY0QsWUFBWUMsV0FBVztJQUMzQyxNQUFNQyxZQUFZLElBQUlDLEtBQUtGLFlBQVlHLFVBQVUsSUFBSTtJQUNyRCxNQUFNQyxZQUFZLElBQUlGLEtBQUtBLEtBQUtHLEdBQUcsS0FBSyxJQUFJLEtBQUssT0FBTyxlQUFlO0lBRXZFLElBQUlKLFlBQVlHLFdBQVc7UUFDekIsT0FBT0osWUFBWU0sWUFBWTtJQUNqQztJQUVBLGVBQWU7SUFDZixJQUFJLENBQUNOLFlBQVlPLGFBQWEsSUFBSSxDQUFDaEIsYUFBYSxDQUFDSSxlQUFlO1FBQzlEYSxRQUFRQyxLQUFLLENBQUM7UUFDZCxPQUFPO0lBQ1Q7SUFFQSxJQUFJO1FBQ0YsTUFBTUMsTUFBTSxNQUFNQyxNQUFNLHVDQUF1QztZQUM3REMsUUFBUTtZQUNSQyxTQUFTO2dCQUFFLGdCQUFnQjtZQUFvQztZQUMvREMsTUFBTSxJQUFJQyxnQkFBZ0I7Z0JBQ3hCQyxXQUFXekI7Z0JBQ1gwQixlQUFldEI7Z0JBQ2ZZLGVBQWVQLFlBQVlPLGFBQWE7Z0JBQ3hDVyxZQUFZO1lBQ2Q7UUFDRjtRQUVBLE1BQU1DLE9BQU8sTUFBTVQsSUFBSVUsSUFBSTtRQUMzQixJQUFJLENBQUNWLElBQUlXLEVBQUUsRUFBRSxNQUFNLElBQUlDLE1BQU1DLEtBQUtDLFNBQVMsQ0FBQ0w7UUFFNUMsWUFBWTtRQUNaLE1BQU1NLFlBQVksSUFBSXZCLEtBQUtBLEtBQUtHLEdBQUcsS0FBSyxDQUFDYyxLQUFLTyxVQUFVLElBQUksSUFBRyxJQUFLLE1BQU1DLFdBQVc7UUFDckYsTUFBTUMsV0FBVztZQUFFLEdBQUc1QixXQUFXO1lBQUVNLGNBQWNhLEtBQUtiLFlBQVk7WUFBRUgsWUFBWXNCO1FBQVU7UUFFMUYsTUFBTTNCLEdBQUcrQixJQUFJLENBQUMsdUJBQXVCQyxNQUFNLENBQUM7WUFDMUM5QixhQUFhNEI7WUFDYkcsWUFBWSxJQUFJN0IsT0FBT3lCLFdBQVc7UUFDcEMsR0FBR0ssRUFBRSxDQUFDLE1BQU1qQyxZQUFZa0MsRUFBRTtRQUUxQixPQUFPZCxLQUFLYixZQUFZO0lBQzFCLEVBQUUsT0FBTzRCLEdBQUc7UUFDVjFCLFFBQVFDLEtBQUssQ0FBQyxrQ0FBa0N5QjtRQUNoRCxPQUFPO0lBQ1Q7QUFDRjtBQUVPLGVBQWVDLDBCQUNwQnJDLEVBQTRCLEVBQzVCc0MsV0FJQyxFQUNEQyxVQUFrQjtJQUVsQix1Q0FBdUM7SUFDdkMscUZBQXFGO0lBQ3JGLE1BQU1DLFdBQVdGLFlBQVlHLFNBQVM7SUFFdEMsTUFBTSxFQUFFcEIsSUFBSSxFQUFFLEdBQUcsTUFBTXJCLEdBQ3BCK0IsSUFBSSxDQUFDLHVCQUNMVyxNQUFNLENBQUMsS0FDUFIsRUFBRSxDQUFDLGFBQWFNLFVBQ2hCTixFQUFFLENBQUMsWUFBWSxtQkFDZkEsRUFBRSxDQUFDLFdBQVcsTUFDZFMsV0FBVztJQUVkLE1BQU0xQyxjQUFjb0I7SUFFcEIsSUFBSSxDQUFDcEIsYUFBYTtJQUVsQixNQUFNQyxjQUFjRCxZQUFZQyxXQUFXO0lBQzNDLElBQUksQ0FBQ0EsYUFBYU0sY0FBYztJQUVoQyxNQUFNb0MsUUFBUSxNQUFNN0MsY0FBY0MsSUFBSUM7SUFDdEMsSUFBSSxDQUFDMkMsT0FBTztJQUVaLGtCQUFrQjtJQUNsQixNQUFNQyxjQUFjUCxZQUFZUSxlQUFlLEVBQUVDLGFBQWE7SUFDOUQsTUFBTUMsY0FBY1YsWUFBWVcsZUFBZSxFQUFFQyxRQUFRO0lBRXpELE1BQU1DLFFBQVEsSUFBSS9DLEtBQUtrQyxZQUFZYyxRQUFRO0lBQzNDLE1BQU1DLE1BQU0sSUFBSWpELEtBQUtrQyxZQUFZZ0IsTUFBTTtJQUV2QyxNQUFNQyxZQUFZO1FBQ2hCQyxTQUFTLENBQUMsRUFBRVIsWUFBWSxHQUFHLEVBQUVILFlBQVksQ0FBQztRQUMxQ1ksYUFBYSxDQUFDLE9BQU8sRUFBRW5CLFlBQVlvQixjQUFjLElBQUksWUFBWSx1QkFBdUIsQ0FBQztRQUN6RlAsT0FBTztZQUFFUSxVQUFVUixNQUFNdEIsV0FBVztRQUFHO1FBQ3ZDd0IsS0FBSztZQUFFTSxVQUFVTixJQUFJeEIsV0FBVztRQUFHO0lBQ3JDO0lBRUEsSUFBSTtRQUNELE1BQU1qQixNQUFNLE1BQU1DLE1BQU0sbUVBQW1FO1lBQ3hGQyxRQUFRO1lBQ1JDLFNBQVM7Z0JBQ042QyxlQUFlLENBQUMsT0FBTyxFQUFFaEIsTUFBTSxDQUFDO2dCQUNoQyxnQkFBZ0I7WUFDbkI7WUFDQTVCLE1BQU1TLEtBQUtDLFNBQVMsQ0FBQzZCO1FBQ3hCO1FBRUEsSUFBSTNDLElBQUlXLEVBQUUsRUFBRTtZQUNULE1BQU1ELE9BQU8sTUFBTVYsSUFBSVUsSUFBSTtZQUMzQixrREFBa0Q7WUFDbEQsTUFBTXRCLEdBQUcrQixJQUFJLENBQUMsdUJBQXVCQyxNQUFNLENBQUM7Z0JBQ3pDNkIsc0JBQXNCdkMsS0FBS2EsRUFBRTtnQkFDN0IyQiw0QkFBNEI7WUFDL0IsR0FBRzVCLEVBQUUsQ0FBQyxNQUFNSSxZQUFZSCxFQUFFO1FBQzdCLE9BQU87WUFDSnpCLFFBQVFDLEtBQUssQ0FBQyw2QkFBNkIsTUFBTUMsSUFBSW1ELElBQUk7UUFDNUQ7SUFDSCxFQUFFLE9BQU8zQixHQUFHO1FBQ1QxQixRQUFRQyxLQUFLLENBQUMseUJBQXlCeUI7SUFDMUM7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL3NlcnZlci9pbnRlZ3JhdGlvbnMvZ29vZ2xlLWNhbGVuZGFyLnRzP2RlZDIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3VwYWJhc2VDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XHJcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSBcIkAvdHlwZXMvZGF0YWJhc2VcIjtcclxuaW1wb3J0IHsgZm9ybWF0IH0gZnJvbSBcImRhdGUtZm5zXCI7XHJcblxyXG50eXBlIEludGVncmF0aW9uID0gRGF0YWJhc2VbXCJwdWJsaWNcIl1bXCJUYWJsZXNcIl1bXCJhZ2VuZGFfaW50ZWdyYXRpb25zXCJdW1wiUm93XCJdO1xyXG5cclxuY29uc3QgQ0xJRU5UX0lEID0gcHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9JRDtcclxuY29uc3QgQ0xJRU5UX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfU0VDUkVUO1xyXG5cclxuLyoqXHJcbiAqIEVuc3VyZXMgd2UgaGF2ZSBhIHZhbGlkIGFjY2VzcyB0b2tlbi5cclxuICogUmVmcmVzaGVzIGl0IGlmIGV4cGlyZWQuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBnZXRWYWxpZFRva2VuKGRiOiBTdXBhYmFzZUNsaWVudDxEYXRhYmFzZT4sIGludGVncmF0aW9uOiBJbnRlZ3JhdGlvbik6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xyXG4gIGNvbnN0IGNyZWRlbnRpYWxzID0gaW50ZWdyYXRpb24uY3JlZGVudGlhbHMgYXMgYW55O1xyXG4gIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKGNyZWRlbnRpYWxzLmV4cGlyZXNfYXQgPz8gMCk7XHJcbiAgY29uc3Qgbm93QnVmZmVyID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDUgKiA2MCAqIDEwMDApOyAvLyA1IG1pbiBidWZmZXJcclxuXHJcbiAgaWYgKGV4cGlyZXNBdCA+IG5vd0J1ZmZlcikge1xyXG4gICAgcmV0dXJuIGNyZWRlbnRpYWxzLmFjY2Vzc190b2tlbjtcclxuICB9XHJcblxyXG4gIC8vIE5lZWQgcmVmcmVzaFxyXG4gIGlmICghY3JlZGVudGlhbHMucmVmcmVzaF90b2tlbiB8fCAhQ0xJRU5UX0lEIHx8ICFDTElFTlRfU0VDUkVUKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiQ2Fubm90IHJlZnJlc2ggdG9rZW46IG1pc3NpbmcgcmVmcmVzaCB0b2tlbiBvciBlbnYgdmFyc1wiKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW5cIiwge1xyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIgfSxcclxuICAgICAgYm9keTogbmV3IFVSTFNlYXJjaFBhcmFtcyh7XHJcbiAgICAgICAgY2xpZW50X2lkOiBDTElFTlRfSUQsXHJcbiAgICAgICAgY2xpZW50X3NlY3JldDogQ0xJRU5UX1NFQ1JFVCxcclxuICAgICAgICByZWZyZXNoX3Rva2VuOiBjcmVkZW50aWFscy5yZWZyZXNoX3Rva2VuLFxyXG4gICAgICAgIGdyYW50X3R5cGU6IFwicmVmcmVzaF90b2tlblwiLFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xyXG4gICAgaWYgKCFyZXMub2spIHRocm93IG5ldyBFcnJvcihKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICBcclxuICAgIC8vIFVwZGF0ZSBEQlxyXG4gICAgY29uc3QgbmV3RXhwaXJ5ID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIChkYXRhLmV4cGlyZXNfaW4gPz8gMzYwMCkgKiAxMDAwKS50b0lTT1N0cmluZygpO1xyXG4gICAgY29uc3QgbmV3Q3JlZHMgPSB7IC4uLmNyZWRlbnRpYWxzLCBhY2Nlc3NfdG9rZW46IGRhdGEuYWNjZXNzX3Rva2VuLCBleHBpcmVzX2F0OiBuZXdFeHBpcnkgfTtcclxuICAgIFxyXG4gICAgYXdhaXQgZGIuZnJvbShcImFnZW5kYV9pbnRlZ3JhdGlvbnNcIikudXBkYXRlKHtcclxuICAgICAgY3JlZGVudGlhbHM6IG5ld0NyZWRzLFxyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9KS5lcShcImlkXCIsIGludGVncmF0aW9uLmlkKTtcclxuXHJcbiAgICByZXR1cm4gZGF0YS5hY2Nlc3NfdG9rZW47XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byByZWZyZXNoIEdvb2dsZSBUb2tlblwiLCBlKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUdvb2dsZUNhbGVuZGFyRXZlbnQoXHJcbiAgZGI6IFN1cGFiYXNlQ2xpZW50PERhdGFiYXNlPixcclxuICBhcHBvaW50bWVudDogRGF0YWJhc2VbXCJwdWJsaWNcIl1bXCJUYWJsZXNcIl1bXCJhZ2VuZGFfYXBwb2ludG1lbnRzXCJdW1wiUm93XCJdICYgeyBcclxuICAgICAvLyBXZSBuZWVkIGpvaW5lZCBkYXRhIGZvciB0aGUgZXZlbnQgdGl0bGVcclxuICAgICBhZ2VuZGFfcGF0aWVudHM6IHsgZnVsbF9uYW1lOiBzdHJpbmcgfSB8IG51bGwsXHJcbiAgICAgYWdlbmRhX3NlcnZpY2VzOiB7IG5hbWU6IHN0cmluZyB9IHwgbnVsbFxyXG4gIH0sXHJcbiAgcHJvdmlkZXJJZDogc3RyaW5nXHJcbikge1xyXG4gIC8vIDEuIEZpbmQgaW50ZWdyYXRpb24gZm9yIHRoZSBwcm92aWRlclxyXG4gIC8vIFNpbmNlIHdlIG1vdmVkIHRvIFRlbmFudC13aWRlIGludGVncmF0aW9uIGluIGFnZW5kYV9pbnRlZ3JhdGlvbnMsIHdlIHVzZSB0ZW5hbnRfaWRcclxuICBjb25zdCB0ZW5hbnRJZCA9IGFwcG9pbnRtZW50LnRlbmFudF9pZDtcclxuICBcclxuICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGRiXHJcbiAgICAuZnJvbShcImFnZW5kYV9pbnRlZ3JhdGlvbnNcIilcclxuICAgIC5zZWxlY3QoXCIqXCIpXHJcbiAgICAuZXEoXCJ0ZW5hbnRfaWRcIiwgdGVuYW50SWQpXHJcbiAgICAuZXEoXCJwcm92aWRlclwiLCBcImdvb2dsZV9jYWxlbmRhclwiKVxyXG4gICAgLmVxKFwiZW5hYmxlZFwiLCB0cnVlKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGNvbnN0IGludGVncmF0aW9uID0gZGF0YSBhcyBJbnRlZ3JhdGlvbiB8IG51bGw7XHJcblxyXG4gIGlmICghaW50ZWdyYXRpb24pIHJldHVybjtcclxuXHJcbiAgY29uc3QgY3JlZGVudGlhbHMgPSBpbnRlZ3JhdGlvbi5jcmVkZW50aWFscyBhcyBhbnk7XHJcbiAgaWYgKCFjcmVkZW50aWFscz8uYWNjZXNzX3Rva2VuKSByZXR1cm47XHJcblxyXG4gIGNvbnN0IHRva2VuID0gYXdhaXQgZ2V0VmFsaWRUb2tlbihkYiwgaW50ZWdyYXRpb24pO1xyXG4gIGlmICghdG9rZW4pIHJldHVybjtcclxuXHJcbiAgLy8gMi4gQ3JlYXRlIEV2ZW50XHJcbiAgY29uc3QgcGF0aWVudE5hbWUgPSBhcHBvaW50bWVudC5hZ2VuZGFfcGF0aWVudHM/LmZ1bGxfbmFtZSA/PyBcIlBhY2llbnRlXCI7XHJcbiAgY29uc3Qgc2VydmljZU5hbWUgPSBhcHBvaW50bWVudC5hZ2VuZGFfc2VydmljZXM/Lm5hbWUgPz8gXCJDb25zdWx0YVwiO1xyXG4gIFxyXG4gIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoYXBwb2ludG1lbnQuc3RhcnRfYXQpO1xyXG4gIGNvbnN0IGVuZCA9IG5ldyBEYXRlKGFwcG9pbnRtZW50LmVuZF9hdCk7XHJcblxyXG4gIGNvbnN0IGV2ZW50Qm9keSA9IHtcclxuICAgIHN1bW1hcnk6IGAke3NlcnZpY2VOYW1lfSAtICR7cGF0aWVudE5hbWV9YCxcclxuICAgIGRlc2NyaXB0aW9uOiBgTm90YXM6ICR7YXBwb2ludG1lbnQuaW50ZXJuYWxfbm90ZXMgPz8gXCJTaW4gbm90YXNcIn1cXG5BZ2VuZGFkbyB2aWEgQWdlbmQuYXJgLFxyXG4gICAgc3RhcnQ6IHsgZGF0ZVRpbWU6IHN0YXJ0LnRvSVNPU3RyaW5nKCkgfSxcclxuICAgIGVuZDogeyBkYXRlVGltZTogZW5kLnRvSVNPU3RyaW5nKCkgfSxcclxuICB9O1xyXG5cclxuICB0cnkge1xyXG4gICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vY2FsZW5kYXIvdjMvY2FsZW5kYXJzL3ByaW1hcnkvZXZlbnRzXCIsIHtcclxuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCxcclxuICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZXZlbnRCb2R5KVxyXG4gICAgIH0pO1xyXG4gICAgIFxyXG4gICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzLmpzb24oKTtcclxuICAgICAgICAvLyBTYXZlIGV4dGVybmFsIElEIHRvIGFsbG93IHVwZGF0ZXMvZGVsZXRlcyBsYXRlclxyXG4gICAgICAgIGF3YWl0IGRiLmZyb20oXCJhZ2VuZGFfYXBwb2ludG1lbnRzXCIpLnVwZGF0ZSh7XHJcbiAgICAgICAgICAgZXh0ZXJuYWxfY2FsZW5kYXJfaWQ6IGpzb24uaWQsXHJcbiAgICAgICAgICAgZXh0ZXJuYWxfY2FsZW5kYXJfcHJvdmlkZXI6IFwiZ29vZ2xlX2NhbGVuZGFyXCJcclxuICAgICAgICB9KS5lcShcImlkXCIsIGFwcG9pbnRtZW50LmlkKTtcclxuICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJHb29nbGUgQ2FsZW5kYXIgQVBJIEVycm9yXCIsIGF3YWl0IHJlcy50ZXh0KCkpO1xyXG4gICAgIH1cclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICAgY29uc29sZS5lcnJvcihcIkdvb2dsZSBTeW5jIEV4Y2VwdGlvblwiLCBlKTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkNMSUVOVF9JRCIsInByb2Nlc3MiLCJlbnYiLCJHT09HTEVfQ0xJRU5UX0lEIiwiQ0xJRU5UX1NFQ1JFVCIsIkdPT0dMRV9DTElFTlRfU0VDUkVUIiwiZ2V0VmFsaWRUb2tlbiIsImRiIiwiaW50ZWdyYXRpb24iLCJjcmVkZW50aWFscyIsImV4cGlyZXNBdCIsIkRhdGUiLCJleHBpcmVzX2F0Iiwibm93QnVmZmVyIiwibm93IiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaF90b2tlbiIsImNvbnNvbGUiLCJlcnJvciIsInJlcyIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJVUkxTZWFyY2hQYXJhbXMiLCJjbGllbnRfaWQiLCJjbGllbnRfc2VjcmV0IiwiZ3JhbnRfdHlwZSIsImRhdGEiLCJqc29uIiwib2siLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJuZXdFeHBpcnkiLCJleHBpcmVzX2luIiwidG9JU09TdHJpbmciLCJuZXdDcmVkcyIsImZyb20iLCJ1cGRhdGUiLCJ1cGRhdGVkX2F0IiwiZXEiLCJpZCIsImUiLCJjcmVhdGVHb29nbGVDYWxlbmRhckV2ZW50IiwiYXBwb2ludG1lbnQiLCJwcm92aWRlcklkIiwidGVuYW50SWQiLCJ0ZW5hbnRfaWQiLCJzZWxlY3QiLCJtYXliZVNpbmdsZSIsInRva2VuIiwicGF0aWVudE5hbWUiLCJhZ2VuZGFfcGF0aWVudHMiLCJmdWxsX25hbWUiLCJzZXJ2aWNlTmFtZSIsImFnZW5kYV9zZXJ2aWNlcyIsIm5hbWUiLCJzdGFydCIsInN0YXJ0X2F0IiwiZW5kIiwiZW5kX2F0IiwiZXZlbnRCb2R5Iiwic3VtbWFyeSIsImRlc2NyaXB0aW9uIiwiaW50ZXJuYWxfbm90ZXMiLCJkYXRlVGltZSIsIkF1dGhvcml6YXRpb24iLCJleHRlcm5hbF9jYWxlbmRhcl9pZCIsImV4dGVybmFsX2NhbGVuZGFyX3Byb3ZpZGVyIiwidGV4dCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/integrations/google-calendar.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/tenant-headers.ts":
/*!**************************************!*\
  !*** ./src/server/tenant-headers.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getTenantHeaderInfo: () => (/* binding */ getTenantHeaderInfo)\n/* harmony export */ });\nconst DEV_TENANT_SLUG = process.env.NEXT_PUBLIC_DEV_TENANT_SLUG ?? \"tenant_1\";\nfunction getTenantHeaderInfo(headerBag) {\n    const slug = headerBag.get(\"x-tenant-id\");\n    const internalId = headerBag.get(\"x-tenant-internal-id\");\n    const isDevBypass =  true && slug === DEV_TENANT_SLUG;\n    return {\n        slug,\n        internalId,\n        isDevBypass\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3RlbmFudC1oZWFkZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNQSxrQkFBa0JDLFFBQVFDLEdBQUcsQ0FBQ0MsMkJBQTJCLElBQUk7QUFFNUQsU0FBU0Msb0JBQW9CQyxTQUFrQjtJQUNwRCxNQUFNQyxPQUFPRCxVQUFVRSxHQUFHLENBQUM7SUFDM0IsTUFBTUMsYUFBYUgsVUFBVUUsR0FBRyxDQUFDO0lBQ2pDLE1BQU1FLGNBQWNSLEtBQXNDLElBQUlLLFNBQVNOO0lBQ3ZFLE9BQU87UUFBRU07UUFBTUU7UUFBWUM7SUFBWTtBQUN6QyIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL3NlcnZlci90ZW5hbnQtaGVhZGVycy50cz9mYjk5Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IERFVl9URU5BTlRfU0xVRyA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0RFVl9URU5BTlRfU0xVRyA/PyBcInRlbmFudF8xXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VGVuYW50SGVhZGVySW5mbyhoZWFkZXJCYWc6IEhlYWRlcnMpIHtcclxuICBjb25zdCBzbHVnID0gaGVhZGVyQmFnLmdldChcIngtdGVuYW50LWlkXCIpO1xyXG4gIGNvbnN0IGludGVybmFsSWQgPSBoZWFkZXJCYWcuZ2V0KFwieC10ZW5hbnQtaW50ZXJuYWwtaWRcIik7XHJcbiAgY29uc3QgaXNEZXZCeXBhc3MgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJkZXZlbG9wbWVudFwiICYmIHNsdWcgPT09IERFVl9URU5BTlRfU0xVRztcclxuICByZXR1cm4geyBzbHVnLCBpbnRlcm5hbElkLCBpc0RldkJ5cGFzcyB9O1xyXG59XHJcbiJdLCJuYW1lcyI6WyJERVZfVEVOQU5UX1NMVUciLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfREVWX1RFTkFOVF9TTFVHIiwiZ2V0VGVuYW50SGVhZGVySW5mbyIsImhlYWRlckJhZyIsInNsdWciLCJnZXQiLCJpbnRlcm5hbElkIiwiaXNEZXZCeXBhc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/tenant-headers.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/tenant-routing.ts":
/*!**************************************!*\
  !*** ./src/server/tenant-routing.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findTenantByPublicIdentifier: () => (/* binding */ findTenantByPublicIdentifier),\n/* harmony export */   resolveTenantIdFromPublicIdentifier: () => (/* binding */ resolveTenantIdFromPublicIdentifier)\n/* harmony export */ });\n/* harmony import */ var _lib_supabase_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/supabase/service */ \"(rsc)/./src/lib/supabase/service.ts\");\n\nconst CACHE_TTL_MS = 5 * 60 * 1000;\nconst tenantCache = new Map();\nfunction readCache(key) {\n    if (!key) return null;\n    const cached = tenantCache.get(key);\n    if (cached && cached.expiresAt > Date.now()) {\n        return cached.tenant;\n    }\n    if (cached) {\n        tenantCache.delete(key);\n    }\n    return null;\n}\nfunction writeCache(keys, tenant) {\n    const expiresAt = Date.now() + CACHE_TTL_MS;\n    keys.forEach((key)=>{\n        if (key) {\n            tenantCache.set(key, {\n                tenant,\n                expiresAt\n            });\n        }\n    });\n}\nasync function findTenantByPublicIdentifier(params) {\n    const normalizedSlug = params.slug?.trim().toLowerCase() ?? null;\n    const normalizedDomain = params.domain?.trim().toLowerCase() ?? null;\n    const normalizedId = params.id?.trim() ?? null;\n    const cacheKeys = [\n        normalizedId ? `id:${normalizedId}` : null,\n        normalizedSlug ? `slug:${normalizedSlug}` : null,\n        normalizedDomain ? `domain:${normalizedDomain}` : null\n    ];\n    for (const key of cacheKeys){\n        const tenant = readCache(key ?? undefined);\n        if (tenant) {\n            return tenant;\n        }\n    }\n    if (!_lib_supabase_service__WEBPACK_IMPORTED_MODULE_0__.serviceClient) {\n        console.warn(\"findTenantByPublicIdentifier: service client not configured\");\n        return null;\n    }\n    const identifiers = [];\n    if (normalizedId) {\n        identifiers.push({\n            column: \"id\",\n            value: normalizedId,\n            cacheKey: `id:${normalizedId}`\n        });\n    }\n    if (normalizedSlug) {\n        identifiers.push({\n            column: \"public_slug\",\n            value: normalizedSlug,\n            cacheKey: `slug:${normalizedSlug}`\n        });\n    }\n    if (normalizedDomain) {\n        identifiers.push({\n            column: \"custom_domain\",\n            value: normalizedDomain,\n            cacheKey: `domain:${normalizedDomain}`\n        });\n    }\n    if (identifiers.length === 0) {\n        return null;\n    }\n    let query = _lib_supabase_service__WEBPACK_IMPORTED_MODULE_0__.serviceClient.from(\"agenda_tenants\").select(\"id, name, public_slug, custom_domain, public_metadata\").limit(1);\n    if (identifiers.length === 1) {\n        const identifier = identifiers[0];\n        query = query.eq(identifier.column, identifier.value);\n    } else {\n        const orFilter = identifiers.map((item)=>`${item.column}.eq.${item.value}`).join(\",\");\n        query = query.or(orFilter);\n    }\n    const { data, error } = await query.maybeSingle();\n    if (error) {\n        console.error(\"findTenantByPublicIdentifier: query failed\", error);\n        return null;\n    }\n    if (!data) {\n        return null;\n    }\n    const tenant = data;\n    writeCache([\n        `id:${tenant.id}`,\n        tenant.public_slug ? `slug:${tenant.public_slug}` : null,\n        tenant.custom_domain ? `domain:${tenant.custom_domain}` : null\n    ], tenant);\n    return tenant;\n}\nasync function resolveTenantIdFromPublicIdentifier(params) {\n    if (params.tenantId) {\n        return params.tenantId;\n    }\n    const tenant = await findTenantByPublicIdentifier({\n        slug: params.tenantSlug ?? null,\n        domain: params.domain ?? null\n    });\n    return tenant?.id ?? null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q25CO0lBRUEsTUFBTSxFQUFFSyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1aLE1BQU1hLFdBQVc7SUFFL0MsSUFBSUQsT0FBTztRQUNUcEIsUUFBUW9CLEtBQUssQ0FBQyw4Q0FBOENBO1FBQzVELE9BQU87SUFDVDtJQUVBLElBQUksQ0FBQ0QsTUFBTTtRQUNULE9BQU87SUFDVDtJQUVBLE1BQU1yQyxTQUFTcUM7SUFDZm5DLFdBQ0U7UUFDRSxDQUFDLEdBQUcsRUFBRUYsT0FBT2UsRUFBRSxDQUFDLENBQUM7UUFDakJmLE9BQU93QyxXQUFXLEdBQUcsQ0FBQyxLQUFLLEVBQUV4QyxPQUFPd0MsV0FBVyxDQUFDLENBQUMsR0FBRztRQUNwRHhDLE9BQU95QyxhQUFhLEdBQUcsQ0FBQyxPQUFPLEVBQUV6QyxPQUFPeUMsYUFBYSxDQUFDLENBQUMsR0FBRztLQUMzRCxFQUNEekM7SUFHRixPQUFPQTtBQUNUO0FBRU8sZUFBZTBDLG9DQUFvQ25DLE1BSXpEO0lBQ0MsSUFBSUEsT0FBT29DLFFBQVEsRUFBRTtRQUNuQixPQUFPcEMsT0FBT29DLFFBQVE7SUFDeEI7SUFFQSxNQUFNM0MsU0FBUyxNQUFNTSw2QkFBNkI7UUFBRUcsTUFBTUYsT0FBT3FDLFVBQVUsSUFBSTtRQUFNL0IsUUFBUU4sT0FBT00sTUFBTSxJQUFJO0lBQUs7SUFDbkgsT0FBT2IsUUFBUWUsTUFBTTtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL3NlcnZlci90ZW5hbnQtcm91dGluZy50cz8xYzRhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNlcnZpY2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Uvc2VydmljZVwiO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gXCJAL3R5cGVzL2RhdGFiYXNlXCI7XHJcblxyXG5leHBvcnQgdHlwZSBUZW5hbnRQdWJsaWNSZWNvcmQgPSBQaWNrPFxyXG4gIERhdGFiYXNlW1wicHVibGljXCJdW1wiVGFibGVzXCJdW1wiYWdlbmRhX3RlbmFudHNcIl1bXCJSb3dcIl0sXHJcbiAgXCJpZFwiIHwgXCJuYW1lXCIgfCBcInB1YmxpY19zbHVnXCIgfCBcImN1c3RvbV9kb21haW5cIiB8IFwicHVibGljX21ldGFkYXRhXCJcclxuPjtcclxuXHJcbnR5cGUgSWRlbnRpZmllciA9IHtcclxuICBjb2x1bW46IFwiaWRcIiB8IFwicHVibGljX3NsdWdcIiB8IFwiY3VzdG9tX2RvbWFpblwiO1xyXG4gIHZhbHVlOiBzdHJpbmc7XHJcbiAgY2FjaGVLZXk6IHN0cmluZztcclxufTtcclxuXHJcbmNvbnN0IENBQ0hFX1RUTF9NUyA9IDUgKiA2MCAqIDEwMDA7XHJcbmNvbnN0IHRlbmFudENhY2hlID0gbmV3IE1hcDxzdHJpbmcsIHsgdGVuYW50OiBUZW5hbnRQdWJsaWNSZWNvcmQ7IGV4cGlyZXNBdDogbnVtYmVyIH0+KCk7XHJcblxyXG5mdW5jdGlvbiByZWFkQ2FjaGUoa2V5OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKSB7XHJcbiAgaWYgKCFrZXkpIHJldHVybiBudWxsO1xyXG4gIGNvbnN0IGNhY2hlZCA9IHRlbmFudENhY2hlLmdldChrZXkpO1xyXG4gIGlmIChjYWNoZWQgJiYgY2FjaGVkLmV4cGlyZXNBdCA+IERhdGUubm93KCkpIHtcclxuICAgIHJldHVybiBjYWNoZWQudGVuYW50O1xyXG4gIH1cclxuICBpZiAoY2FjaGVkKSB7XHJcbiAgICB0ZW5hbnRDYWNoZS5kZWxldGUoa2V5KTtcclxuICB9XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHdyaXRlQ2FjaGUoa2V5czogKHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpW10sIHRlbmFudDogVGVuYW50UHVibGljUmVjb3JkKSB7XHJcbiAgY29uc3QgZXhwaXJlc0F0ID0gRGF0ZS5ub3coKSArIENBQ0hFX1RUTF9NUztcclxuICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgaWYgKGtleSkge1xyXG4gICAgICB0ZW5hbnRDYWNoZS5zZXQoa2V5LCB7IHRlbmFudCwgZXhwaXJlc0F0IH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluZFRlbmFudEJ5UHVibGljSWRlbnRpZmllcihwYXJhbXM6IHtcclxuICBpZD86IHN0cmluZyB8IG51bGw7XHJcbiAgc2x1Zz86IHN0cmluZyB8IG51bGw7XHJcbiAgZG9tYWluPzogc3RyaW5nIHwgbnVsbDtcclxufSk6IFByb21pc2U8VGVuYW50UHVibGljUmVjb3JkIHwgbnVsbD4ge1xyXG4gIGNvbnN0IG5vcm1hbGl6ZWRTbHVnID0gcGFyYW1zLnNsdWc/LnRyaW0oKS50b0xvd2VyQ2FzZSgpID8/IG51bGw7XHJcbiAgY29uc3Qgbm9ybWFsaXplZERvbWFpbiA9IHBhcmFtcy5kb21haW4/LnRyaW0oKS50b0xvd2VyQ2FzZSgpID8/IG51bGw7XHJcbiAgY29uc3Qgbm9ybWFsaXplZElkID0gcGFyYW1zLmlkPy50cmltKCkgPz8gbnVsbDtcclxuXHJcbiAgY29uc3QgY2FjaGVLZXlzID0gW1xyXG4gICAgbm9ybWFsaXplZElkID8gYGlkOiR7bm9ybWFsaXplZElkfWAgOiBudWxsLFxyXG4gICAgbm9ybWFsaXplZFNsdWcgPyBgc2x1Zzoke25vcm1hbGl6ZWRTbHVnfWAgOiBudWxsLFxyXG4gICAgbm9ybWFsaXplZERvbWFpbiA/IGBkb21haW46JHtub3JtYWxpemVkRG9tYWlufWAgOiBudWxsLFxyXG4gIF07XHJcblxyXG4gIGZvciAoY29uc3Qga2V5IG9mIGNhY2hlS2V5cykge1xyXG4gICAgY29uc3QgdGVuYW50ID0gcmVhZENhY2hlKGtleSA/PyB1bmRlZmluZWQpO1xyXG4gICAgaWYgKHRlbmFudCkge1xyXG4gICAgICByZXR1cm4gdGVuYW50O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaWYgKCFzZXJ2aWNlQ2xpZW50KSB7XHJcbiAgICBjb25zb2xlLndhcm4oXCJmaW5kVGVuYW50QnlQdWJsaWNJZGVudGlmaWVyOiBzZXJ2aWNlIGNsaWVudCBub3QgY29uZmlndXJlZFwiKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgaWRlbnRpZmllcnM6IElkZW50aWZpZXJbXSA9IFtdO1xyXG4gIGlmIChub3JtYWxpemVkSWQpIHtcclxuICAgIGlkZW50aWZpZXJzLnB1c2goeyBjb2x1bW46IFwiaWRcIiwgdmFsdWU6IG5vcm1hbGl6ZWRJZCwgY2FjaGVLZXk6IGBpZDoke25vcm1hbGl6ZWRJZH1gIH0pO1xyXG4gIH1cclxuICBpZiAobm9ybWFsaXplZFNsdWcpIHtcclxuICAgIGlkZW50aWZpZXJzLnB1c2goeyBjb2x1bW46IFwicHVibGljX3NsdWdcIiwgdmFsdWU6IG5vcm1hbGl6ZWRTbHVnLCBjYWNoZUtleTogYHNsdWc6JHtub3JtYWxpemVkU2x1Z31gIH0pO1xyXG4gIH1cclxuICBpZiAobm9ybWFsaXplZERvbWFpbikge1xyXG4gICAgaWRlbnRpZmllcnMucHVzaCh7IGNvbHVtbjogXCJjdXN0b21fZG9tYWluXCIsIHZhbHVlOiBub3JtYWxpemVkRG9tYWluLCBjYWNoZUtleTogYGRvbWFpbjoke25vcm1hbGl6ZWREb21haW59YCB9KTtcclxuICB9XHJcblxyXG4gIGlmIChpZGVudGlmaWVycy5sZW5ndGggPT09IDApIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgbGV0IHF1ZXJ5ID0gc2VydmljZUNsaWVudFxyXG4gICAgLmZyb20oXCJhZ2VuZGFfdGVuYW50c1wiKVxyXG4gICAgLnNlbGVjdChcImlkLCBuYW1lLCBwdWJsaWNfc2x1ZywgY3VzdG9tX2RvbWFpbiwgcHVibGljX21ldGFkYXRhXCIpXHJcbiAgICAubGltaXQoMSk7XHJcblxyXG4gIGlmIChpZGVudGlmaWVycy5sZW5ndGggPT09IDEpIHtcclxuICAgIGNvbnN0IGlkZW50aWZpZXIgPSBpZGVudGlmaWVyc1swXTtcclxuICAgIHF1ZXJ5ID0gcXVlcnkuZXEoaWRlbnRpZmllci5jb2x1bW4sIGlkZW50aWZpZXIudmFsdWUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCBvckZpbHRlciA9IGlkZW50aWZpZXJzLm1hcCgoaXRlbSkgPT4gYCR7aXRlbS5jb2x1bW59LmVxLiR7aXRlbS52YWx1ZX1gKS5qb2luKFwiLFwiKTtcclxuICAgIHF1ZXJ5ID0gcXVlcnkub3Iob3JGaWx0ZXIpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiZmluZFRlbmFudEJ5UHVibGljSWRlbnRpZmllcjogcXVlcnkgZmFpbGVkXCIsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFkYXRhKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIGNvbnN0IHRlbmFudCA9IGRhdGEgYXMgVGVuYW50UHVibGljUmVjb3JkO1xyXG4gIHdyaXRlQ2FjaGUoXHJcbiAgICBbXHJcbiAgICAgIGBpZDoke3RlbmFudC5pZH1gLFxyXG4gICAgICB0ZW5hbnQucHVibGljX3NsdWcgPyBgc2x1Zzoke3RlbmFudC5wdWJsaWNfc2x1Z31gIDogbnVsbCxcclxuICAgICAgdGVuYW50LmN1c3RvbV9kb21haW4gPyBgZG9tYWluOiR7dGVuYW50LmN1c3RvbV9kb21haW59YCA6IG51bGwsXHJcbiAgICBdLFxyXG4gICAgdGVuYW50LFxyXG4gICk7XHJcblxyXG4gIHJldHVybiB0ZW5hbnQ7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXNvbHZlVGVuYW50SWRGcm9tUHVibGljSWRlbnRpZmllcihwYXJhbXM6IHtcclxuICB0ZW5hbnRJZD86IHN0cmluZyB8IG51bGw7XHJcbiAgdGVuYW50U2x1Zz86IHN0cmluZyB8IG51bGw7XHJcbiAgZG9tYWluPzogc3RyaW5nIHwgbnVsbDtcclxufSk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xyXG4gIGlmIChwYXJhbXMudGVuYW50SWQpIHtcclxuICAgIHJldHVybiBwYXJhbXMudGVuYW50SWQ7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0ZW5hbnQgPSBhd2FpdCBmaW5kVGVuYW50QnlQdWJsaWNJZGVudGlmaWVyKHsgc2x1ZzogcGFyYW1zLnRlbmFudFNsdWcgPz8gbnVsbCwgZG9tYWluOiBwYXJhbXMuZG9tYWluID8/IG51bGwgfSk7XHJcbiAgcmV0dXJuIHRlbmFudD8uaWQgPz8gbnVsbDtcclxufVxyXG4iXSwibmFtZXMiOlsic2VydmljZUNsaWVudCIsIkNBQ0hFX1RUTF9NUyIsInRlbmFudENhY2hlIiwiTWFwIiwicmVhZENhY2hlIiwia2V5IiwiY2FjaGVkIiwiZ2V0IiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsInRlbmFudCIsImRlbGV0ZSIsIndyaXRlQ2FjaGUiLCJrZXlzIiwiZm9yRWFjaCIsInNldCIsImZpbmRUZW5hbnRCeVB1YmxpY0lkZW50aWZpZXIiLCJwYXJhbXMiLCJub3JtYWxpemVkU2x1ZyIsInNsdWciLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJub3JtYWxpemVkRG9tYWluIiwiZG9tYWluIiwibm9ybWFsaXplZElkIiwiaWQiLCJjYWNoZUtleXMiLCJ1bmRlZmluZWQiLCJjb25zb2xlIiwid2FybiIsImlkZW50aWZpZXJzIiwicHVzaCIsImNvbHVtbiIsInZhbHVlIiwiY2FjaGVLZXkiLCJsZW5ndGgiLCJxdWVyeSIsImZyb20iLCJzZWxlY3QiLCJsaW1pdCIsImlkZW50aWZpZXIiLCJlcSIsIm9yRmlsdGVyIiwibWFwIiwiaXRlbSIsImpvaW4iLCJvciIsImRhdGEiLCJlcnJvciIsIm1heWJlU2luZ2xlIiwicHVibGljX3NsdWciLCJjdXN0b21fZG9tYWluIiwicmVzb2x2ZVRlbmFudElkRnJvbVB1YmxpY0lkZW50aWZpZXIiLCJ0ZW5hbnRJZCIsInRlbmFudFNsdWciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/tenant-routing.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/whatsapp-config.ts":
/*!***************************************!*\
  !*** ./src/server/whatsapp-config.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getTenantTemplateMap: () => (/* binding */ getTenantTemplateMap),\n/* harmony export */   getWhatsAppIntegrationByPhoneId: () => (/* binding */ getWhatsAppIntegrationByPhoneId),\n/* harmony export */   getWhatsAppIntegrationByTenant: () => (/* binding */ getWhatsAppIntegrationByTenant),\n/* harmony export */   getWhatsAppIntegrationByVerifyToken: () => (/* binding */ getWhatsAppIntegrationByVerifyToken)\n/* harmony export */ });\nconst PROVIDER = \"meta_whatsapp\";\nfunction parseCredentials(credentials) {\n    if (!credentials || typeof credentials !== \"object\") return null;\n    const maybeCreds = credentials;\n    const phoneNumberId = typeof maybeCreds.phoneNumberId === \"string\" ? maybeCreds.phoneNumberId : undefined;\n    const accessToken = typeof maybeCreds.accessToken === \"string\" ? maybeCreds.accessToken : undefined;\n    const businessAccountId = typeof maybeCreds.businessAccountId === \"string\" ? maybeCreds.businessAccountId : null;\n    const verifyToken = typeof maybeCreds.verifyToken === \"string\" ? maybeCreds.verifyToken : null;\n    if (!phoneNumberId || !accessToken) {\n        return null;\n    }\n    return {\n        phoneNumberId,\n        accessToken,\n        businessAccountId,\n        verifyToken\n    };\n}\nasync function fetchIntegration(db, filters) {\n    let query = db.from(\"agenda_integrations\").select(\"id, tenant_id, provider, credentials, created_at, updated_at, enabled\").eq(\"provider\", PROVIDER).limit(1);\n    for (const [path, value] of Object.entries(filters)){\n        query = query.filter(path, \"eq\", value);\n    }\n    const { data, error } = await query.maybeSingle();\n    if (error || !data) return null;\n    const parsed = parseCredentials(data.credentials);\n    if (!parsed) return null;\n    return {\n        ...data,\n        credentials_parsed: parsed\n    };\n}\nasync function getWhatsAppIntegrationByTenant(db, tenantId) {\n    const record = await db.from(\"agenda_integrations\").select(\"tenant_id, provider, credentials, created_at, updated_at\").eq(\"tenant_id\", tenantId).eq(\"provider\", PROVIDER).maybeSingle();\n    if (record.error || !record.data) return null;\n    return parseCredentials(record.data.credentials);\n}\nasync function getWhatsAppIntegrationByPhoneId(db, phoneNumberId) {\n    const record = await fetchIntegration(db, {\n        \"credentials->>phoneNumberId\": phoneNumberId\n    });\n    if (!record) return null;\n    return {\n        tenantId: record.tenant_id,\n        credentials: record.credentials_parsed\n    };\n}\nasync function getWhatsAppIntegrationByVerifyToken(db, verifyToken) {\n    const record = await fetchIntegration(db, {\n        \"credentials->>verifyToken\": verifyToken\n    });\n    if (!record) return null;\n    return {\n        tenantId: record.tenant_id,\n        credentials: record.credentials_parsed\n    };\n}\nasync function getTenantTemplateMap(db, tenantId) {\n    const map = new Map();\n    const { data } = await db.from(\"agenda_message_templates\").select(\"name, meta_template_name, status\").eq(\"tenant_id\", tenantId);\n    for (const row of data ?? []){\n        map.set(row.name, {\n            metaTemplateName: row.meta_template_name,\n            status: row.status\n        });\n    }\n    return map;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQU1RLE9BQVFkLFFBQVEsRUFBRSxDQUF5RTtRQUNwR1ksSUFBSUcsR0FBRyxDQUFDRCxJQUFJRSxJQUFJLEVBQUU7WUFDaEJDLGtCQUFrQkgsSUFBSUksa0JBQWtCO1lBQ3hDQyxRQUFRTCxJQUFJSyxNQUFNO1FBQ3BCO0lBQ0Y7SUFFQSxPQUFPUDtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYWdlbmRhci1hcHAvLi9zcmMvc2VydmVyL3doYXRzYXBwLWNvbmZpZy50cz8wMmQwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1cGFiYXNlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gXCJAL3R5cGVzL2RhdGFiYXNlXCI7XHJcblxyXG5jb25zdCBQUk9WSURFUiA9IFwibWV0YV93aGF0c2FwcFwiO1xyXG5cclxudHlwZSBJbnRlZ3JhdGlvblJvdyA9IERhdGFiYXNlW1wicHVibGljXCJdW1wiVGFibGVzXCJdW1wiYWdlbmRhX2ludGVncmF0aW9uc1wiXVtcIlJvd1wiXTtcclxudHlwZSBUZW1wbGF0ZVJvdyA9IERhdGFiYXNlW1wicHVibGljXCJdW1wiVGFibGVzXCJdW1wiYWdlbmRhX21lc3NhZ2VfdGVtcGxhdGVzXCJdW1wiUm93XCJdO1xyXG5cclxuZXhwb3J0IHR5cGUgV2hhdHNBcHBDcmVkZW50aWFscyA9IHtcclxuICBwaG9uZU51bWJlcklkOiBzdHJpbmc7XHJcbiAgYWNjZXNzVG9rZW46IHN0cmluZztcclxuICBidXNpbmVzc0FjY291bnRJZD86IHN0cmluZyB8IG51bGw7XHJcbiAgdmVyaWZ5VG9rZW4/OiBzdHJpbmcgfCBudWxsO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gcGFyc2VDcmVkZW50aWFscyhjcmVkZW50aWFsczogSW50ZWdyYXRpb25Sb3dbXCJjcmVkZW50aWFsc1wiXSk6IFdoYXRzQXBwQ3JlZGVudGlhbHMgfCBudWxsIHtcclxuICBpZiAoIWNyZWRlbnRpYWxzIHx8IHR5cGVvZiBjcmVkZW50aWFscyAhPT0gXCJvYmplY3RcIikgcmV0dXJuIG51bGw7XHJcblxyXG4gIGNvbnN0IG1heWJlQ3JlZHMgPSBjcmVkZW50aWFscyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcclxuICBjb25zdCBwaG9uZU51bWJlcklkID0gdHlwZW9mIG1heWJlQ3JlZHMucGhvbmVOdW1iZXJJZCA9PT0gXCJzdHJpbmdcIiA/IG1heWJlQ3JlZHMucGhvbmVOdW1iZXJJZCA6IHVuZGVmaW5lZDtcclxuICBjb25zdCBhY2Nlc3NUb2tlbiA9IHR5cGVvZiBtYXliZUNyZWRzLmFjY2Vzc1Rva2VuID09PSBcInN0cmluZ1wiID8gbWF5YmVDcmVkcy5hY2Nlc3NUb2tlbiA6IHVuZGVmaW5lZDtcclxuICBjb25zdCBidXNpbmVzc0FjY291bnRJZCA9IHR5cGVvZiBtYXliZUNyZWRzLmJ1c2luZXNzQWNjb3VudElkID09PSBcInN0cmluZ1wiID8gbWF5YmVDcmVkcy5idXNpbmVzc0FjY291bnRJZCA6IG51bGw7XHJcbiAgY29uc3QgdmVyaWZ5VG9rZW4gPSB0eXBlb2YgbWF5YmVDcmVkcy52ZXJpZnlUb2tlbiA9PT0gXCJzdHJpbmdcIiA/IG1heWJlQ3JlZHMudmVyaWZ5VG9rZW4gOiBudWxsO1xyXG5cclxuICBpZiAoIXBob25lTnVtYmVySWQgfHwgIWFjY2Vzc1Rva2VuKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBwaG9uZU51bWJlcklkLFxyXG4gICAgYWNjZXNzVG9rZW4sXHJcbiAgICBidXNpbmVzc0FjY291bnRJZCxcclxuICAgIHZlcmlmeVRva2VuLFxyXG4gIH07XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGZldGNoSW50ZWdyYXRpb24oXHJcbiAgZGI6IFN1cGFiYXNlQ2xpZW50PERhdGFiYXNlPixcclxuICBmaWx0ZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+LFxyXG4pOiBQcm9taXNlPChJbnRlZ3JhdGlvblJvdyAmIHsgY3JlZGVudGlhbHNfcGFyc2VkOiBXaGF0c0FwcENyZWRlbnRpYWxzIH0pIHwgbnVsbD4ge1xyXG4gIGxldCBxdWVyeSA9IGRiXHJcbiAgICAuZnJvbShcImFnZW5kYV9pbnRlZ3JhdGlvbnNcIilcclxuICAgIC5zZWxlY3QoXCJpZCwgdGVuYW50X2lkLCBwcm92aWRlciwgY3JlZGVudGlhbHMsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQsIGVuYWJsZWRcIilcclxuICAgIC5lcShcInByb3ZpZGVyXCIsIFBST1ZJREVSKVxyXG4gICAgLmxpbWl0KDEpO1xyXG5cclxuICBmb3IgKGNvbnN0IFtwYXRoLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZmlsdGVycykpIHtcclxuICAgIHF1ZXJ5ID0gcXVlcnkuZmlsdGVyKHBhdGgsIFwiZXFcIiwgdmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuICBpZiAoZXJyb3IgfHwgIWRhdGEpIHJldHVybiBudWxsO1xyXG5cclxuICBjb25zdCBwYXJzZWQgPSBwYXJzZUNyZWRlbnRpYWxzKGRhdGEuY3JlZGVudGlhbHMpO1xyXG4gIGlmICghcGFyc2VkKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgcmV0dXJuIHsgLi4uZGF0YSwgY3JlZGVudGlhbHNfcGFyc2VkOiBwYXJzZWQgfTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFdoYXRzQXBwSW50ZWdyYXRpb25CeVRlbmFudChcclxuICBkYjogU3VwYWJhc2VDbGllbnQ8RGF0YWJhc2U+LFxyXG4gIHRlbmFudElkOiBzdHJpbmcsXHJcbik6IFByb21pc2U8V2hhdHNBcHBDcmVkZW50aWFscyB8IG51bGw+IHtcclxuICBjb25zdCByZWNvcmQgPSBhd2FpdCBkYlxyXG4gICAgLmZyb20oXCJhZ2VuZGFfaW50ZWdyYXRpb25zXCIpXHJcbiAgICAuc2VsZWN0KFwidGVuYW50X2lkLCBwcm92aWRlciwgY3JlZGVudGlhbHMsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRcIilcclxuICAgIC5lcShcInRlbmFudF9pZFwiLCB0ZW5hbnRJZClcclxuICAgIC5lcShcInByb3ZpZGVyXCIsIFBST1ZJREVSKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGlmIChyZWNvcmQuZXJyb3IgfHwgIXJlY29yZC5kYXRhKSByZXR1cm4gbnVsbDtcclxuICByZXR1cm4gcGFyc2VDcmVkZW50aWFscyhyZWNvcmQuZGF0YS5jcmVkZW50aWFscyk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRXaGF0c0FwcEludGVncmF0aW9uQnlQaG9uZUlkKFxyXG4gIGRiOiBTdXBhYmFzZUNsaWVudDxEYXRhYmFzZT4sXHJcbiAgcGhvbmVOdW1iZXJJZDogc3RyaW5nLFxyXG4pOiBQcm9taXNlPHsgdGVuYW50SWQ6IHN0cmluZzsgY3JlZGVudGlhbHM6IFdoYXRzQXBwQ3JlZGVudGlhbHMgfSB8IG51bGw+IHtcclxuICBjb25zdCByZWNvcmQgPSBhd2FpdCBmZXRjaEludGVncmF0aW9uKGRiLCB7IFwiY3JlZGVudGlhbHMtPj5waG9uZU51bWJlcklkXCI6IHBob25lTnVtYmVySWQgfSk7XHJcbiAgaWYgKCFyZWNvcmQpIHJldHVybiBudWxsO1xyXG4gIHJldHVybiB7IHRlbmFudElkOiByZWNvcmQudGVuYW50X2lkLCBjcmVkZW50aWFsczogcmVjb3JkLmNyZWRlbnRpYWxzX3BhcnNlZCB9O1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0V2hhdHNBcHBJbnRlZ3JhdGlvbkJ5VmVyaWZ5VG9rZW4oXHJcbiAgZGI6IFN1cGFiYXNlQ2xpZW50PERhdGFiYXNlPixcclxuICB2ZXJpZnlUb2tlbjogc3RyaW5nLFxyXG4pOiBQcm9taXNlPHsgdGVuYW50SWQ6IHN0cmluZzsgY3JlZGVudGlhbHM6IFdoYXRzQXBwQ3JlZGVudGlhbHMgfSB8IG51bGw+IHtcclxuICBjb25zdCByZWNvcmQgPSBhd2FpdCBmZXRjaEludGVncmF0aW9uKGRiLCB7IFwiY3JlZGVudGlhbHMtPj52ZXJpZnlUb2tlblwiOiB2ZXJpZnlUb2tlbiB9KTtcclxuICBpZiAoIXJlY29yZCkgcmV0dXJuIG51bGw7XHJcbiAgcmV0dXJuIHsgdGVuYW50SWQ6IHJlY29yZC50ZW5hbnRfaWQsIGNyZWRlbnRpYWxzOiByZWNvcmQuY3JlZGVudGlhbHNfcGFyc2VkIH07XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIFRlbmFudFRlbXBsYXRlQ29uZmlnID0ge1xyXG4gIG1ldGFUZW1wbGF0ZU5hbWU/OiBzdHJpbmcgfCBudWxsO1xyXG4gIHN0YXR1cz86IHN0cmluZyB8IG51bGw7XHJcbn07XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VGVuYW50VGVtcGxhdGVNYXAoXHJcbiAgZGI6IFN1cGFiYXNlQ2xpZW50PERhdGFiYXNlPixcclxuICB0ZW5hbnRJZDogc3RyaW5nLFxyXG4pOiBQcm9taXNlPE1hcDxzdHJpbmcsIFRlbmFudFRlbXBsYXRlQ29uZmlnPj4ge1xyXG4gIGNvbnN0IG1hcCA9IG5ldyBNYXA8c3RyaW5nLCBUZW5hbnRUZW1wbGF0ZUNvbmZpZz4oKTtcclxuICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGRiXHJcbiAgICAuZnJvbShcImFnZW5kYV9tZXNzYWdlX3RlbXBsYXRlc1wiKVxyXG4gICAgLnNlbGVjdChcIm5hbWUsIG1ldGFfdGVtcGxhdGVfbmFtZSwgc3RhdHVzXCIpXHJcbiAgICAuZXEoXCJ0ZW5hbnRfaWRcIiwgdGVuYW50SWQpO1xyXG5cclxuICBmb3IgKGNvbnN0IHJvdyBvZiAoZGF0YSA/PyBbXSkgYXMgQXJyYXk8UGljazxUZW1wbGF0ZVJvdywgXCJuYW1lXCIgfCBcIm1ldGFfdGVtcGxhdGVfbmFtZVwiIHwgXCJzdGF0dXNcIj4+KSB7XHJcbiAgICBtYXAuc2V0KHJvdy5uYW1lLCB7XHJcbiAgICAgIG1ldGFUZW1wbGF0ZU5hbWU6IHJvdy5tZXRhX3RlbXBsYXRlX25hbWUsXHJcbiAgICAgIHN0YXR1czogcm93LnN0YXR1cyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG1hcDtcclxufVxyXG4iXSwibmFtZXMiOlsiUFJPVklERVIiLCJwYXJzZUNyZWRlbnRpYWxzIiwiY3JlZGVudGlhbHMiLCJtYXliZUNyZWRzIiwicGhvbmVOdW1iZXJJZCIsInVuZGVmaW5lZCIsImFjY2Vzc1Rva2VuIiwiYnVzaW5lc3NBY2NvdW50SWQiLCJ2ZXJpZnlUb2tlbiIsImZldGNoSW50ZWdyYXRpb24iLCJkYiIsImZpbHRlcnMiLCJxdWVyeSIsImZyb20iLCJzZWxlY3QiLCJlcSIsImxpbWl0IiwicGF0aCIsInZhbHVlIiwiT2JqZWN0IiwiZW50cmllcyIsImZpbHRlciIsImRhdGEiLCJlcnJvciIsIm1heWJlU2luZ2xlIiwicGFyc2VkIiwiY3JlZGVudGlhbHNfcGFyc2VkIiwiZ2V0V2hhdHNBcHBJbnRlZ3JhdGlvbkJ5VGVuYW50IiwidGVuYW50SWQiLCJyZWNvcmQiLCJnZXRXaGF0c0FwcEludGVncmF0aW9uQnlQaG9uZUlkIiwidGVuYW50X2lkIiwiZ2V0V2hhdHNBcHBJbnRlZ3JhdGlvbkJ5VmVyaWZ5VG9rZW4iLCJnZXRUZW5hbnRUZW1wbGF0ZU1hcCIsIm1hcCIsIk1hcCIsInJvdyIsInNldCIsIm5hbWUiLCJtZXRhVGVtcGxhdGVOYW1lIiwibWV0YV90ZW1wbGF0ZV9uYW1lIiwic3RhdHVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/whatsapp-config.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/date-fns","vendor-chunks/libphonenumber-js","vendor-chunks/zod"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Fappointments%2Froute&page=%2Fapi%2Fpublic%2Fappointments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Fappointments%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();