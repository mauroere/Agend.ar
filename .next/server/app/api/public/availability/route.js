"use strict";(()=>{var e={};e.id=4192,e.ids=[4192],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2805:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>d});var a=r(9303),i=r(8716),o=r(670),s=r(7070),u=r(5072),l=r(3155);async function d(e){if(!u.o)return s.NextResponse.json({error:"Service client is not configured"},{status:500});let{searchParams:t}=new URL(e.url),r=t.get("tenantId"),n=t.get("date"),a=t.get("locationId"),i=t.get("duration"),o=t.get("providerId");if(!r)return s.NextResponse.json({error:"Tenant requerido"},{status:400});if(!n||!a)return s.NextResponse.json({error:"Date and Location required"},{status:400});let d=Number.parseInt(i??"30",10);try{let e=await (0,l.w)({db:u.o,tenantId:r,date:n,locationId:a,durationMinutes:d,providerId:o});return s.NextResponse.json({slots:e})}catch(e){if(e instanceof l.T)return s.NextResponse.json({error:e.message},{status:e.status});return console.error("availability.public_unexpected_error",e),s.NextResponse.json({error:"Error inesperado"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/public/availability/route",pathname:"/api/public/availability",filename:"route",bundlePath:"app/api/public/availability/route"},resolvedPagePath:"C:\\Users\\rementeriama\\Downloads\\Code\\Agend.ar\\src\\app\\api\\public\\availability\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:f}=p,g="/api/public/availability/route";function w(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},259:(e,t,r)=>{function n(e){let{start:t,end:r,businessHours:n,timeZone:a}=e,i=new Intl.DateTimeFormat("en-US",{timeZone:a,weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}),o=Object.fromEntries(i.formatToParts(t).map(e=>[e.type,e.value])),s=Object.fromEntries(i.formatToParts(r).map(e=>[e.type,e.value])),u=(o.weekday??"").slice(0,3).toLowerCase();if(u!==(s.weekday??"").slice(0,3).toLowerCase())return!1;let l=n?.[u];if(!l||0===l.length)return!1;let d=(e,t)=>60*Number(e)+Number(t),p=d(o.hour??"0",o.minute??"0"),c=d(s.hour??"0",s.minute??"0");return l.some(([e,t])=>{let[r,n]=e.split(":"),[a,i]=t.split(":"),o=d(r,n),s=d(a,i);return p>=o&&c<=s})}r.d(t,{U:()=>n})},5072:(e,t,r)=>{r.d(t,{o:()=>o});var n=r(7857);let a="https://oaxielrsiogvnxradtsw.supabase.co",i=process.env.SUPABASE_SERVICE_ROLE_KEY;a&&i||console.warn("Supabase service client is not fully configured.");let o=a&&i?(0,n.eI)(a,i,{auth:{persistSession:!1}}):null},3155:(e,t,r)=>{r.d(t,{T:()=>u,w:()=>l});var n=r(6727),a=r(1155),i=r(9109),o=r(7563),s=r(259);class u extends Error{constructor(e,t=400){super(e),this.status=t}}async function l(e){var t;let{db:r,tenantId:l,date:d,locationId:p,durationMinutes:c,providerId:m}=e,f=Math.max(5,Number.isFinite(c)?c:30);if(!d||!p)throw new u("Date and location required",400);let g=new Date(d);if(!Number.isFinite(g.getTime()))throw new u("Invalid date",400);let{data:w,error:b}=await r.from("agenda_locations").select("business_hours, timezone, buffer_minutes").eq("tenant_id",l).eq("id",p).maybeSingle();if(b)throw new u(b.message,400);if(!w)throw new u("Consultorio no encontrado",404);let v=w.business_hours??{};0===Object.keys(v).length&&(v={mon:[["09:00","18:00"]],tue:[["09:00","18:00"]],wed:[["09:00","18:00"]],thu:[["09:00","18:00"]],fri:[["09:00","18:00"]]});let h=w.timezone??"America/Argentina/Buenos_Aires",_=w.buffer_minutes??0,x=(0,n.b)(g),y=(0,a.m)(x,1440),{data:S,error:T}=await r.from("agenda_appointments").select("start_at, end_at, provider_id, location_id").eq("tenant_id",l).neq("status","canceled").gte("end_at",x.toISOString()).lte("start_at",y.toISOString());if(T)throw new u(T.message,400);let j=(S??[]).filter(e=>m?e.provider_id===m||!e.provider_id&&e.location_id===p:e.location_id===p),R=[],q=x,E=(0,n.b)(new Date).getTime()===x.getTime();for(;t=q,+(0,i.Q)(t)<+(0,i.Q)(y);){let e=(0,a.m)(q,f);(0,s.U)({start:q,end:e,businessHours:v,timeZone:h})&&!j.some(t=>{let r=new Date(t.start_at),n=new Date(t.end_at),i=(0,a.m)(r,-_),o=(0,a.m)(n,_);return q<o&&e>i})&&(!E||function(e,t){let r=(0,i.Q)(e),n=(0,i.Q)(t);return r.getTime()>n.getTime()}(q,new Date))&&R.push((0,o.WU)(q,"HH:mm")),q=(0,a.m)(q,30)}return R}},1459:(e,t,r)=>{r.d(t,{n:()=>i});var n=r(9109),a=r(4549);function i(e,t){let r=+(0,n.Q)(e);return(0,a.L)(e,r+t)}},1155:(e,t,r)=>{r.d(t,{m:()=>i});var n=r(1459),a=r(2313);function i(e,t){return(0,n.n)(e,t*a.yJ)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,7857,5972,7563],()=>r(2805));module.exports=n})();