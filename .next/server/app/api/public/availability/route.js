"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/public/availability/route";
exports.ids = ["app/api/public/availability/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Favailability%2Froute&page=%2Fapi%2Fpublic%2Favailability%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Favailability%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Favailability%2Froute&page=%2Fapi%2Fpublic%2Favailability%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Favailability%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_rementeriama_Downloads_Code_Agend_ar_src_app_api_public_availability_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/public/availability/route.ts */ \"(rsc)/./src/app/api/public/availability/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/public/availability/route\",\n        pathname: \"/api/public/availability\",\n        filename: \"route\",\n        bundlePath: \"app/api/public/availability/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\rementeriama\\\\Downloads\\\\Code\\\\Agend.ar\\\\src\\\\app\\\\api\\\\public\\\\availability\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_rementeriama_Downloads_Code_Agend_ar_src_app_api_public_availability_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/public/availability/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwdWJsaWMlMkZhdmFpbGFiaWxpdHklMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnB1YmxpYyUyRmF2YWlsYWJpbGl0eSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnB1YmxpYyUyRmF2YWlsYWJpbGl0eSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNyZW1lbnRlcmlhbWElNUNEb3dubG9hZHMlNUNDb2RlJTVDQWdlbmQuYXIlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q3JlbWVudGVyaWFtYSU1Q0Rvd25sb2FkcyU1Q0NvZGUlNUNBZ2VuZC5hciZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDaUQ7QUFDOUg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8/ZWRiYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxyZW1lbnRlcmlhbWFcXFxcRG93bmxvYWRzXFxcXENvZGVcXFxcQWdlbmQuYXJcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccHVibGljXFxcXGF2YWlsYWJpbGl0eVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcHVibGljL2F2YWlsYWJpbGl0eS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3B1YmxpYy9hdmFpbGFiaWxpdHlcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3B1YmxpYy9hdmFpbGFiaWxpdHkvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxyZW1lbnRlcmlhbWFcXFxcRG93bmxvYWRzXFxcXENvZGVcXFxcQWdlbmQuYXJcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccHVibGljXFxcXGF2YWlsYWJpbGl0eVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvcHVibGljL2F2YWlsYWJpbGl0eS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Favailability%2Froute&page=%2Fapi%2Fpublic%2Favailability%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Favailability%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/public/availability/route.ts":
/*!**************************************************!*\
  !*** ./src/app/api/public/availability/route.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase/service */ \"(rsc)/./src/lib/supabase/service.ts\");\n/* harmony import */ var _server_availability_getSlots__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/availability/getSlots */ \"(rsc)/./src/server/availability/getSlots.ts\");\n/* harmony import */ var _server_tenant_headers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/tenant-headers */ \"(rsc)/./src/server/tenant-headers.ts\");\n/* harmony import */ var _server_tenant_routing__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/tenant-routing */ \"(rsc)/./src/server/tenant-routing.ts\");\n\n\n\n\n\nasync function GET(request) {\n    if (!_lib_supabase_service__WEBPACK_IMPORTED_MODULE_1__.serviceClient) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Service client is not configured\"\n        }, {\n            status: 500\n        });\n    }\n    const { searchParams } = new URL(request.url);\n    const headerInfo = (0,_server_tenant_headers__WEBPACK_IMPORTED_MODULE_3__.getTenantHeaderInfo)(request.headers);\n    const tenantParam = searchParams.get(\"tenantId\");\n    const tenantSlugParam = searchParams.get(\"tenantSlug\") ?? tenantParam;\n    const tenantId = headerInfo.internalId ?? await (0,_server_tenant_routing__WEBPACK_IMPORTED_MODULE_4__.resolveTenantIdFromPublicIdentifier)({\n        tenantId: tenantParam,\n        tenantSlug: tenantSlugParam\n    });\n    const dateStr = searchParams.get(\"date\");\n    const locationId = searchParams.get(\"locationId\");\n    const durationStr = searchParams.get(\"duration\");\n    const providerId = searchParams.get(\"providerId\");\n    if (!tenantId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Tenant requerido\"\n        }, {\n            status: 400\n        });\n    }\n    if (headerInfo.internalId && headerInfo.internalId !== tenantId && !headerInfo.isDevBypass) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Tenant mismatch\"\n        }, {\n            status: 403\n        });\n    }\n    if (!dateStr || !locationId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Date and Location required\"\n        }, {\n            status: 400\n        });\n    }\n    const duration = Number.parseInt(durationStr ?? \"30\", 10);\n    try {\n        const slots = await (0,_server_availability_getSlots__WEBPACK_IMPORTED_MODULE_2__.getAvailabilitySlots)({\n            db: _lib_supabase_service__WEBPACK_IMPORTED_MODULE_1__.serviceClient,\n            tenantId,\n            date: dateStr,\n            locationId,\n            durationMinutes: duration,\n            providerId\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            slots\n        });\n    } catch (error) {\n        if (error instanceof _server_availability_getSlots__WEBPACK_IMPORTED_MODULE_2__.AvailabilityError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: error.message\n            }, {\n                status: error.status\n            });\n        }\n        console.error(\"availability.public_unexpected_error\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Error inesperado\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9wdWJsaWMvYXZhaWxhYmlsaXR5L3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUF3RDtBQUNEO0FBQ2tDO0FBQzNCO0FBQ2dCO0FBRXZFLGVBQWVNLElBQUlDLE9BQW9CO0lBQzVDLElBQUksQ0FBQ04sZ0VBQWFBLEVBQUU7UUFDbEIsT0FBT0QscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQW1DLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3hGO0lBRUEsTUFBTSxFQUFFQyxZQUFZLEVBQUUsR0FBRyxJQUFJQyxJQUFJTCxRQUFRTSxHQUFHO0lBQzVDLE1BQU1DLGFBQWFWLDJFQUFtQkEsQ0FBQ0csUUFBUVEsT0FBTztJQUN0RCxNQUFNQyxjQUFjTCxhQUFhTSxHQUFHLENBQUM7SUFDckMsTUFBTUMsa0JBQWtCUCxhQUFhTSxHQUFHLENBQUMsaUJBQWlCRDtJQUMxRCxNQUFNRyxXQUFXTCxXQUFXTSxVQUFVLElBQ2hDLE1BQU1mLDJGQUFtQ0EsQ0FBQztRQUFFYyxVQUFVSDtRQUFhSyxZQUFZSDtJQUFnQjtJQUNyRyxNQUFNSSxVQUFVWCxhQUFhTSxHQUFHLENBQUM7SUFDakMsTUFBTU0sYUFBYVosYUFBYU0sR0FBRyxDQUFDO0lBQ3BDLE1BQU1PLGNBQWNiLGFBQWFNLEdBQUcsQ0FBQztJQUNyQyxNQUFNUSxhQUFhZCxhQUFhTSxHQUFHLENBQUM7SUFFcEMsSUFBSSxDQUFDRSxVQUFVO1FBQ2IsT0FBT25CLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFtQixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUN4RTtJQUVBLElBQUlJLFdBQVdNLFVBQVUsSUFBSU4sV0FBV00sVUFBVSxLQUFLRCxZQUFZLENBQUNMLFdBQVdZLFdBQVcsRUFBRTtRQUMxRixPQUFPMUIscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWtCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3ZFO0lBRUEsSUFBSSxDQUFDWSxXQUFXLENBQUNDLFlBQVk7UUFDM0IsT0FBT3ZCLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUE2QixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUNsRjtJQUVBLE1BQU1pQixXQUFXQyxPQUFPQyxRQUFRLENBQUNMLGVBQWUsTUFBTTtJQUV0RCxJQUFJO1FBQ0YsTUFBTU0sUUFBUSxNQUFNM0IsbUZBQW9CQSxDQUFDO1lBQ3ZDNEIsSUFBSTlCLGdFQUFhQTtZQUNqQmtCO1lBQ0FhLE1BQU1WO1lBQ05DO1lBQ0FVLGlCQUFpQk47WUFDakJGO1FBQ0Y7UUFFQSxPQUFPekIscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFc0I7UUFBTTtJQUNuQyxFQUFFLE9BQU9yQixPQUFPO1FBQ2QsSUFBSUEsaUJBQWlCUCw0RUFBaUJBLEVBQUU7WUFDdEMsT0FBT0YscURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBT0EsTUFBTXlCLE9BQU87WUFBQyxHQUFHO2dCQUFFeEIsUUFBUUQsTUFBTUMsTUFBTTtZQUFDO1FBQzVFO1FBRUF5QixRQUFRMUIsS0FBSyxDQUFDLHdDQUF3Q0E7UUFDdEQsT0FBT1QscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQW1CLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3hFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9hcHAvYXBpL3B1YmxpYy9hdmFpbGFiaWxpdHkvcm91dGUudHM/MmU2OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB7IHNlcnZpY2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Uvc2VydmljZVwiO1xyXG5pbXBvcnQgeyBBdmFpbGFiaWxpdHlFcnJvciwgZ2V0QXZhaWxhYmlsaXR5U2xvdHMgfSBmcm9tIFwiQC9zZXJ2ZXIvYXZhaWxhYmlsaXR5L2dldFNsb3RzXCI7XHJcbmltcG9ydCB7IGdldFRlbmFudEhlYWRlckluZm8gfSBmcm9tIFwiQC9zZXJ2ZXIvdGVuYW50LWhlYWRlcnNcIjtcclxuaW1wb3J0IHsgcmVzb2x2ZVRlbmFudElkRnJvbVB1YmxpY0lkZW50aWZpZXIgfSBmcm9tIFwiQC9zZXJ2ZXIvdGVuYW50LXJvdXRpbmdcIjtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBpZiAoIXNlcnZpY2VDbGllbnQpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlNlcnZpY2UgY2xpZW50IGlzIG5vdCBjb25maWd1cmVkXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcclxuICBjb25zdCBoZWFkZXJJbmZvID0gZ2V0VGVuYW50SGVhZGVySW5mbyhyZXF1ZXN0LmhlYWRlcnMgYXMgSGVhZGVycyk7XHJcbiAgY29uc3QgdGVuYW50UGFyYW0gPSBzZWFyY2hQYXJhbXMuZ2V0KFwidGVuYW50SWRcIik7XHJcbiAgY29uc3QgdGVuYW50U2x1Z1BhcmFtID0gc2VhcmNoUGFyYW1zLmdldChcInRlbmFudFNsdWdcIikgPz8gdGVuYW50UGFyYW07XHJcbiAgY29uc3QgdGVuYW50SWQgPSBoZWFkZXJJbmZvLmludGVybmFsSWRcclxuICAgID8/IChhd2FpdCByZXNvbHZlVGVuYW50SWRGcm9tUHVibGljSWRlbnRpZmllcih7IHRlbmFudElkOiB0ZW5hbnRQYXJhbSwgdGVuYW50U2x1ZzogdGVuYW50U2x1Z1BhcmFtIH0pKTtcclxuICBjb25zdCBkYXRlU3RyID0gc2VhcmNoUGFyYW1zLmdldChcImRhdGVcIik7XHJcbiAgY29uc3QgbG9jYXRpb25JZCA9IHNlYXJjaFBhcmFtcy5nZXQoXCJsb2NhdGlvbklkXCIpO1xyXG4gIGNvbnN0IGR1cmF0aW9uU3RyID0gc2VhcmNoUGFyYW1zLmdldChcImR1cmF0aW9uXCIpO1xyXG4gIGNvbnN0IHByb3ZpZGVySWQgPSBzZWFyY2hQYXJhbXMuZ2V0KFwicHJvdmlkZXJJZFwiKTtcclxuXHJcbiAgaWYgKCF0ZW5hbnRJZCkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiVGVuYW50IHJlcXVlcmlkb1wiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoaGVhZGVySW5mby5pbnRlcm5hbElkICYmIGhlYWRlckluZm8uaW50ZXJuYWxJZCAhPT0gdGVuYW50SWQgJiYgIWhlYWRlckluZm8uaXNEZXZCeXBhc3MpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlRlbmFudCBtaXNtYXRjaFwiIH0sIHsgc3RhdHVzOiA0MDMgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoIWRhdGVTdHIgfHwgIWxvY2F0aW9uSWQpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkRhdGUgYW5kIExvY2F0aW9uIHJlcXVpcmVkXCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGR1cmF0aW9uID0gTnVtYmVyLnBhcnNlSW50KGR1cmF0aW9uU3RyID8/IFwiMzBcIiwgMTApO1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3Qgc2xvdHMgPSBhd2FpdCBnZXRBdmFpbGFiaWxpdHlTbG90cyh7XHJcbiAgICAgIGRiOiBzZXJ2aWNlQ2xpZW50LFxyXG4gICAgICB0ZW5hbnRJZCxcclxuICAgICAgZGF0ZTogZGF0ZVN0cixcclxuICAgICAgbG9jYXRpb25JZCxcclxuICAgICAgZHVyYXRpb25NaW51dGVzOiBkdXJhdGlvbixcclxuICAgICAgcHJvdmlkZXJJZCxcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHNsb3RzIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBBdmFpbGFiaWxpdHlFcnJvcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9LCB7IHN0YXR1czogZXJyb3Iuc3RhdHVzIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUuZXJyb3IoXCJhdmFpbGFiaWxpdHkucHVibGljX3VuZXhwZWN0ZWRfZXJyb3JcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRXJyb3IgaW5lc3BlcmFkb1wiIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJzZXJ2aWNlQ2xpZW50IiwiQXZhaWxhYmlsaXR5RXJyb3IiLCJnZXRBdmFpbGFiaWxpdHlTbG90cyIsImdldFRlbmFudEhlYWRlckluZm8iLCJyZXNvbHZlVGVuYW50SWRGcm9tUHVibGljSWRlbnRpZmllciIsIkdFVCIsInJlcXVlc3QiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJoZWFkZXJJbmZvIiwiaGVhZGVycyIsInRlbmFudFBhcmFtIiwiZ2V0IiwidGVuYW50U2x1Z1BhcmFtIiwidGVuYW50SWQiLCJpbnRlcm5hbElkIiwidGVuYW50U2x1ZyIsImRhdGVTdHIiLCJsb2NhdGlvbklkIiwiZHVyYXRpb25TdHIiLCJwcm92aWRlcklkIiwiaXNEZXZCeXBhc3MiLCJkdXJhdGlvbiIsIk51bWJlciIsInBhcnNlSW50Iiwic2xvdHMiLCJkYiIsImRhdGUiLCJkdXJhdGlvbk1pbnV0ZXMiLCJtZXNzYWdlIiwiY29uc29sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/public/availability/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/constants.ts":
/*!******************************!*\
  !*** ./src/lib/constants.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   APPOINTMENT_STATUS: () => (/* binding */ APPOINTMENT_STATUS),\n/* harmony export */   APP_TIMEZONE: () => (/* binding */ APP_TIMEZONE),\n/* harmony export */   CRON_SECRET_HEADER: () => (/* binding */ CRON_SECRET_HEADER),\n/* harmony export */   DEFAULT_SLOT_DURATION_MIN: () => (/* binding */ DEFAULT_SLOT_DURATION_MIN),\n/* harmony export */   SLOT_LOOKAHEAD_DAYS: () => (/* binding */ SLOT_LOOKAHEAD_DAYS),\n/* harmony export */   WAITLIST_LOOKAHEAD_HOURS: () => (/* binding */ WAITLIST_LOOKAHEAD_HOURS)\n/* harmony export */ });\nconst APP_TIMEZONE = \"America/Argentina/Buenos_Aires\";\nconst DEFAULT_SLOT_DURATION_MIN = 30;\nconst SLOT_LOOKAHEAD_DAYS = 7;\nconst WAITLIST_LOOKAHEAD_HOURS = 48;\nconst APPOINTMENT_STATUS = [\n    \"pending\",\n    \"confirmed\",\n    \"reschedule_requested\",\n    \"canceled\",\n    \"completed\",\n    \"no_show\"\n];\nconst CRON_SECRET_HEADER = \"x-cron-secret\";\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2NvbnN0YW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBTyxNQUFNQSxlQUFlLGlDQUEwQztBQUMvRCxNQUFNQyw0QkFBNEIsR0FBRztBQUNyQyxNQUFNQyxzQkFBc0IsRUFBRTtBQUM5QixNQUFNQywyQkFBMkIsR0FBRztBQUVwQyxNQUFNQyxxQkFBcUI7SUFDaEM7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0NBQ0QsQ0FBVTtBQUlKLE1BQU1DLHFCQUFxQixnQkFBZ0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9saWIvY29uc3RhbnRzLnRzP2ZiZjkiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IEFQUF9USU1FWk9ORSA9IFwiQW1lcmljYS9BcmdlbnRpbmEvQnVlbm9zX0FpcmVzXCIgYXMgY29uc3Q7XHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NMT1RfRFVSQVRJT05fTUlOID0gMzA7XHJcbmV4cG9ydCBjb25zdCBTTE9UX0xPT0tBSEVBRF9EQVlTID0gNztcclxuZXhwb3J0IGNvbnN0IFdBSVRMSVNUX0xPT0tBSEVBRF9IT1VSUyA9IDQ4O1xyXG5cclxuZXhwb3J0IGNvbnN0IEFQUE9JTlRNRU5UX1NUQVRVUyA9IFtcclxuICBcInBlbmRpbmdcIixcclxuICBcImNvbmZpcm1lZFwiLFxyXG4gIFwicmVzY2hlZHVsZV9yZXF1ZXN0ZWRcIixcclxuICBcImNhbmNlbGVkXCIsXHJcbiAgXCJjb21wbGV0ZWRcIixcclxuICBcIm5vX3Nob3dcIixcclxuXSBhcyBjb25zdDtcclxuXHJcbmV4cG9ydCB0eXBlIEFwcG9pbnRtZW50U3RhdHVzID0gKHR5cGVvZiBBUFBPSU5UTUVOVF9TVEFUVVMpW251bWJlcl07XHJcblxyXG5leHBvcnQgY29uc3QgQ1JPTl9TRUNSRVRfSEVBREVSID0gXCJ4LWNyb24tc2VjcmV0XCI7XHJcbiJdLCJuYW1lcyI6WyJBUFBfVElNRVpPTkUiLCJERUZBVUxUX1NMT1RfRFVSQVRJT05fTUlOIiwiU0xPVF9MT09LQUhFQURfREFZUyIsIldBSVRMSVNUX0xPT0tBSEVBRF9IT1VSUyIsIkFQUE9JTlRNRU5UX1NUQVRVUyIsIkNST05fU0VDUkVUX0hFQURFUiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/constants.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/scheduling.ts":
/*!*******************************!*\
  !*** ./src/lib/scheduling.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   calculateAvailability: () => (/* binding */ calculateAvailability),\n/* harmony export */   isWithinBusinessHours: () => (/* binding */ isWithinBusinessHours)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! __barrel_optimize__?names=addMinutes,isBefore!=!date-fns */ \"(rsc)/./node_modules/date-fns/isBefore.mjs\");\n/* harmony import */ var _barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! __barrel_optimize__?names=addMinutes,isBefore!=!date-fns */ \"(rsc)/./node_modules/date-fns/addMinutes.mjs\");\n/* harmony import */ var _lib_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/constants */ \"(rsc)/./src/lib/constants.ts\");\n\n\nfunction isWithinBusinessHours(options) {\n    const { start, end, businessHours, timeZone } = options;\n    const fmt = new Intl.DateTimeFormat(\"en-US\", {\n        timeZone,\n        weekday: \"short\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hour12: false\n    });\n    const partsStart = Object.fromEntries(fmt.formatToParts(start).map((p)=>[\n            p.type,\n            p.value\n        ]));\n    const partsEnd = Object.fromEntries(fmt.formatToParts(end).map((p)=>[\n            p.type,\n            p.value\n        ]));\n    const dayKey = (partsStart.weekday ?? \"\").slice(0, 3).toLowerCase(); // mon/tue...\n    if (dayKey !== (partsEnd.weekday ?? \"\").slice(0, 3).toLowerCase()) return false;\n    const intervals = businessHours?.[dayKey];\n    if (!intervals || intervals.length === 0) return false;\n    const toMinutes = (h, m)=>Number(h) * 60 + Number(m);\n    const startMinutes = toMinutes(partsStart.hour ?? \"0\", partsStart.minute ?? \"0\");\n    const endMinutes = toMinutes(partsEnd.hour ?? \"0\", partsEnd.minute ?? \"0\");\n    return intervals.some(([from, to])=>{\n        const [fh, fm] = from.split(\":\");\n        const [th, tm] = to.split(\":\");\n        const fromM = toMinutes(fh, fm);\n        const toM = toMinutes(th, tm);\n        return startMinutes >= fromM && endMinutes <= toM;\n    });\n}\nfunction calculateAvailability({ start, end, appointments, durationMinutes = _lib_constants__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SLOT_DURATION_MIN, bufferMinutes = 0 }) {\n    const slots = [];\n    let cursor = new Date(start);\n    while((0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_1__.isBefore)((0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__.addMinutes)(cursor, durationMinutes), end)){\n        const candidateEnd = (0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__.addMinutes)(cursor, durationMinutes);\n        const overlaps = appointments.some((appt)=>{\n            const apptStart = new Date(appt.start_at);\n            const apptEnd = new Date(appt.end_at);\n            return cursor < apptEnd && candidateEnd > apptStart;\n        });\n        if (!overlaps) {\n            slots.push({\n                start: new Date(cursor),\n                end: candidateEnd\n            });\n        }\n        cursor = (0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__.addMinutes)(cursor, durationMinutes + bufferMinutes);\n    }\n    return slots;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LWFwcC8uL3NyYy9saWIvc2NoZWR1bGluZy50cz8zZWYzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFkZE1pbnV0ZXMsIGlzQmVmb3JlIH0gZnJvbSBcImRhdGUtZm5zXCI7XHJcbmltcG9ydCB7IERFRkFVTFRfU0xPVF9EVVJBVElPTl9NSU4gfSBmcm9tIFwiQC9saWIvY29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSBcIkAvdHlwZXMvZGF0YWJhc2VcIjtcclxuXHJcbmV4cG9ydCB0eXBlIEFwcG9pbnRtZW50Um93ID0gRGF0YWJhc2VbXCJwdWJsaWNcIl1bXCJUYWJsZXNcIl1bXCJhZ2VuZGFfYXBwb2ludG1lbnRzXCJdW1wiUm93XCJdO1xyXG5cclxudHlwZSBCdXNpbmVzc0hvdXJzID0gUmVjb3JkPHN0cmluZywgW3N0cmluZywgc3RyaW5nXVtdPjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1dpdGhpbkJ1c2luZXNzSG91cnMob3B0aW9uczoge1xyXG4gIHN0YXJ0OiBEYXRlO1xyXG4gIGVuZDogRGF0ZTtcclxuICBidXNpbmVzc0hvdXJzOiBCdXNpbmVzc0hvdXJzO1xyXG4gIHRpbWVab25lOiBzdHJpbmc7XHJcbn0pIHtcclxuICBjb25zdCB7IHN0YXJ0LCBlbmQsIGJ1c2luZXNzSG91cnMsIHRpbWVab25lIH0gPSBvcHRpb25zO1xyXG4gIGNvbnN0IGZtdCA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KFwiZW4tVVNcIiwge1xyXG4gICAgdGltZVpvbmUsXHJcbiAgICB3ZWVrZGF5OiBcInNob3J0XCIsXHJcbiAgICBob3VyOiBcIjItZGlnaXRcIixcclxuICAgIG1pbnV0ZTogXCIyLWRpZ2l0XCIsXHJcbiAgICBob3VyMTI6IGZhbHNlLFxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBwYXJ0c1N0YXJ0ID0gT2JqZWN0LmZyb21FbnRyaWVzKGZtdC5mb3JtYXRUb1BhcnRzKHN0YXJ0KS5tYXAoKHApID0+IFtwLnR5cGUsIHAudmFsdWVdKSk7XHJcbiAgY29uc3QgcGFydHNFbmQgPSBPYmplY3QuZnJvbUVudHJpZXMoZm10LmZvcm1hdFRvUGFydHMoZW5kKS5tYXAoKHApID0+IFtwLnR5cGUsIHAudmFsdWVdKSk7XHJcblxyXG4gIGNvbnN0IGRheUtleSA9IChwYXJ0c1N0YXJ0LndlZWtkYXkgPz8gXCJcIikuc2xpY2UoMCwgMykudG9Mb3dlckNhc2UoKTsgLy8gbW9uL3R1ZS4uLlxyXG4gIGlmIChkYXlLZXkgIT09IChwYXJ0c0VuZC53ZWVrZGF5ID8/IFwiXCIpLnNsaWNlKDAsIDMpLnRvTG93ZXJDYXNlKCkpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgY29uc3QgaW50ZXJ2YWxzID0gYnVzaW5lc3NIb3Vycz8uW2RheUtleV07XHJcbiAgaWYgKCFpbnRlcnZhbHMgfHwgaW50ZXJ2YWxzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICBjb25zdCB0b01pbnV0ZXMgPSAoaDogc3RyaW5nLCBtOiBzdHJpbmcpID0+IE51bWJlcihoKSAqIDYwICsgTnVtYmVyKG0pO1xyXG4gIGNvbnN0IHN0YXJ0TWludXRlcyA9IHRvTWludXRlcyhwYXJ0c1N0YXJ0LmhvdXIgPz8gXCIwXCIsIHBhcnRzU3RhcnQubWludXRlID8/IFwiMFwiKTtcclxuICBjb25zdCBlbmRNaW51dGVzID0gdG9NaW51dGVzKHBhcnRzRW5kLmhvdXIgPz8gXCIwXCIsIHBhcnRzRW5kLm1pbnV0ZSA/PyBcIjBcIik7XHJcblxyXG4gIHJldHVybiBpbnRlcnZhbHMuc29tZSgoW2Zyb20sIHRvXSkgPT4ge1xyXG4gICAgY29uc3QgW2ZoLCBmbV0gPSBmcm9tLnNwbGl0KFwiOlwiKTtcclxuICAgIGNvbnN0IFt0aCwgdG1dID0gdG8uc3BsaXQoXCI6XCIpO1xyXG4gICAgY29uc3QgZnJvbU0gPSB0b01pbnV0ZXMoZmgsIGZtKTtcclxuICAgIGNvbnN0IHRvTSA9IHRvTWludXRlcyh0aCwgdG0pO1xyXG4gICAgcmV0dXJuIHN0YXJ0TWludXRlcyA+PSBmcm9tTSAmJiBlbmRNaW51dGVzIDw9IHRvTTtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSh7XHJcbiAgc3RhcnQsXHJcbiAgZW5kLFxyXG4gIGFwcG9pbnRtZW50cyxcclxuICBkdXJhdGlvbk1pbnV0ZXMgPSBERUZBVUxUX1NMT1RfRFVSQVRJT05fTUlOLFxyXG4gIGJ1ZmZlck1pbnV0ZXMgPSAwLFxyXG59OiB7XHJcbiAgc3RhcnQ6IERhdGU7XHJcbiAgZW5kOiBEYXRlO1xyXG4gIGFwcG9pbnRtZW50czogQXBwb2ludG1lbnRSb3dbXTtcclxuICBkdXJhdGlvbk1pbnV0ZXM/OiBudW1iZXI7XHJcbiAgYnVmZmVyTWludXRlcz86IG51bWJlcjtcclxufSkge1xyXG4gIGNvbnN0IHNsb3RzOiB7IHN0YXJ0OiBEYXRlOyBlbmQ6IERhdGUgfVtdID0gW107XHJcbiAgbGV0IGN1cnNvciA9IG5ldyBEYXRlKHN0YXJ0KTtcclxuXHJcbiAgd2hpbGUgKGlzQmVmb3JlKGFkZE1pbnV0ZXMoY3Vyc29yLCBkdXJhdGlvbk1pbnV0ZXMpLCBlbmQpKSB7XHJcbiAgICBjb25zdCBjYW5kaWRhdGVFbmQgPSBhZGRNaW51dGVzKGN1cnNvciwgZHVyYXRpb25NaW51dGVzKTtcclxuICAgIGNvbnN0IG92ZXJsYXBzID0gYXBwb2ludG1lbnRzLnNvbWUoKGFwcHQpID0+IHtcclxuICAgICAgY29uc3QgYXBwdFN0YXJ0ID0gbmV3IERhdGUoYXBwdC5zdGFydF9hdCk7XHJcbiAgICAgIGNvbnN0IGFwcHRFbmQgPSBuZXcgRGF0ZShhcHB0LmVuZF9hdCk7XHJcbiAgICAgIHJldHVybiBjdXJzb3IgPCBhcHB0RW5kICYmIGNhbmRpZGF0ZUVuZCA+IGFwcHRTdGFydDtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghb3ZlcmxhcHMpIHtcclxuICAgICAgc2xvdHMucHVzaCh7IHN0YXJ0OiBuZXcgRGF0ZShjdXJzb3IpLCBlbmQ6IGNhbmRpZGF0ZUVuZCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjdXJzb3IgPSBhZGRNaW51dGVzKGN1cnNvciwgZHVyYXRpb25NaW51dGVzICsgYnVmZmVyTWludXRlcyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc2xvdHM7XHJcbn1cclxuIl0sIm5hbWVzIjpbImFkZE1pbnV0ZXMiLCJpc0JlZm9yZSIsIkRFRkFVTFRfU0xPVF9EVVJBVElPTl9NSU4iLCJpc1dpdGhpbkJ1c2luZXNzSG91cnMiLCJvcHRpb25zIiwic3RhcnQiLCJlbmQiLCJidXNpbmVzc0hvdXJzIiwidGltZVpvbmUiLCJmbXQiLCJJbnRsIiwiRGF0ZVRpbWVGb3JtYXQiLCJ3ZWVrZGF5IiwiaG91ciIsIm1pbnV0ZSIsImhvdXIxMiIsInBhcnRzU3RhcnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImZvcm1hdFRvUGFydHMiLCJtYXAiLCJwIiwidHlwZSIsInZhbHVlIiwicGFydHNFbmQiLCJkYXlLZXkiLCJzbGljZSIsInRvTG93ZXJDYXNlIiwiaW50ZXJ2YWxzIiwibGVuZ3RoIiwidG9NaW51dGVzIiwiaCIsIm0iLCJOdW1iZXIiLCJzdGFydE1pbnV0ZXMiLCJlbmRNaW51dGVzIiwic29tZSIsImZyb20iLCJ0byIsImZoIiwiZm0iLCJzcGxpdCIsInRoIiwidG0iLCJmcm9tTSIsInRvTSIsImNhbGN1bGF0ZUF2YWlsYWJpbGl0eSIsImFwcG9pbnRtZW50cyIsImR1cmF0aW9uTWludXRlcyIsImJ1ZmZlck1pbnV0ZXMiLCJzbG90cyIsImN1cnNvciIsIkRhdGUiLCJjYW5kaWRhdGVFbmQiLCJvdmVybGFwcyIsImFwcHQiLCJhcHB0U3RhcnQiLCJzdGFydF9hdCIsImFwcHRFbmQiLCJlbmRfYXQiLCJwdXNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/scheduling.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase/service.ts":
/*!*************************************!*\
  !*** ./src/lib/supabase/service.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   serviceClient: () => (/* binding */ serviceClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n\nconst url = \"https://oaxielrsiogvnxradtsw.supabase.co\";\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!url || !serviceKey) {\n    console.warn(\"Supabase service client is not fully configured.\");\n}\nconst serviceClient = url && serviceKey ? (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, serviceKey, {\n    auth: {\n        persistSession: false\n    }\n}) : null;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlL3NlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBcUQ7QUFHckQsTUFBTUMsTUFBTUMsMENBQW9DO0FBQ2hELE1BQU1HLGFBQWFILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRXhELElBQUksQ0FBQ0wsT0FBTyxDQUFDSSxZQUFZO0lBQ3ZCRSxRQUFRQyxJQUFJLENBQUM7QUFDZjtBQUVPLE1BQU1DLGdCQUFnQlIsT0FBT0ksYUFDaENMLG1FQUFZQSxDQUFXQyxLQUFLSSxZQUFZO0lBQ3RDSyxNQUFNO1FBQUVDLGdCQUFnQjtJQUFNO0FBQ2hDLEtBQ0EsS0FBSyIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL2xpYi9zdXBhYmFzZS9zZXJ2aWNlLnRzP2MyMGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gXCJAL3R5cGVzL2RhdGFiYXNlXCI7XHJcblxyXG5jb25zdCB1cmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XHJcbmNvbnN0IHNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZO1xyXG5cclxuaWYgKCF1cmwgfHwgIXNlcnZpY2VLZXkpIHtcclxuICBjb25zb2xlLndhcm4oXCJTdXBhYmFzZSBzZXJ2aWNlIGNsaWVudCBpcyBub3QgZnVsbHkgY29uZmlndXJlZC5cIik7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzZXJ2aWNlQ2xpZW50ID0gdXJsICYmIHNlcnZpY2VLZXlcclxuICA/IGNyZWF0ZUNsaWVudDxEYXRhYmFzZT4odXJsLCBzZXJ2aWNlS2V5LCB7XHJcbiAgICAgIGF1dGg6IHsgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0sXHJcbiAgICB9KVxyXG4gIDogbnVsbDtcclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImNvbnNvbGUiLCJ3YXJuIiwic2VydmljZUNsaWVudCIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase/service.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/availability/getSlots.ts":
/*!*********************************************!*\
  !*** ./src/server/availability/getSlots.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AvailabilityError: () => (/* binding */ AvailabilityError),\n/* harmony export */   calculateDailySlots: () => (/* binding */ calculateDailySlots),\n/* harmony export */   fetchAvailabilityConfig: () => (/* binding */ fetchAvailabilityConfig),\n/* harmony export */   fetchAvailabilityData: () => (/* binding */ fetchAvailabilityData),\n/* harmony export */   findNextAvailableSlots: () => (/* binding */ findNextAvailableSlots),\n/* harmony export */   getAvailabilitySlots: () => (/* binding */ getAvailabilitySlots)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/format.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/startOfDay.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/addMinutes.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/isBefore.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/isAfter.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/addDays.mjs\");\n/* harmony import */ var _lib_scheduling__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/scheduling */ \"(rsc)/./src/lib/scheduling.ts\");\n\n\nclass AvailabilityError extends Error {\n    constructor(message, status = 400){\n        super(message);\n        this.status = status;\n    }\n}\n// --- Core Helper Functions ---\n/**\r\n * 1. Fetch Configuration (Location Settings + Provider Schedule Override)\r\n */ async function fetchAvailabilityConfig(db, tenantId, locationId, providerId) {\n    const { data: locationData, error: locationError } = await db.from(\"agenda_locations\").select(\"business_hours, timezone, buffer_minutes\").eq(\"tenant_id\", tenantId).eq(\"id\", locationId).maybeSingle();\n    if (locationError) {\n        console.error(\"[getSlots] fetchAvailabilityConfig Error:\", locationError);\n        throw new AvailabilityError(`Location Error: ${locationError.message}`, 400);\n    }\n    if (!locationData) throw new AvailabilityError(\"Consultorio no encontrado\", 404);\n    let businessHours = locationData.business_hours ?? {};\n    if (providerId) {\n        const { data: provider, error: providerError } = await db.from(\"agenda_providers\").select(\"metadata\").eq(\"id\", providerId).maybeSingle();\n        if (providerError) {\n            console.warn(\"[getSlots] Provider Fetch Error:\", providerError);\n        }\n        const provSchedule = provider?.metadata?.schedule;\n        if (provSchedule && Object.keys(provSchedule).length > 0) {\n            businessHours = provSchedule;\n        }\n    }\n    // Fallback default hours if empty\n    if (Object.keys(businessHours).length === 0) {\n        businessHours = {\n            mon: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            tue: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            wed: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            thu: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            fri: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ]\n        };\n    }\n    // Ensure \"today\" check handles timezone diffs gracefully\n    // We use the start of day of the TARGET date and compare to \"now\"\n    // If target date is today, we filter past slots.\n    return {\n        businessHours,\n        timeZone: locationData.timezone ?? \"America/Argentina/Buenos_Aires\",\n        bufferMinutes: locationData.buffer_minutes ?? 0\n    };\n}\n/**\r\n * 2. Fetch Data (Appointments + Blocks) for a specific Date Range\r\n */ async function fetchAvailabilityData(db, tenantId, startRange, endRange) {\n    // Fetch Appointments\n    let appointments = [];\n    try {\n        // 2026-01-08: REMOVED provider_id selection temporarily if column is missing\n        const { data: apptData, error: appointmentsError } = await db.from(\"agenda_appointments\").select(\"start_at, end_at, location_id\") // Removed provider_id\n        .eq(\"tenant_id\", tenantId).neq(\"status\", \"canceled\").gte(\"end_at\", startRange.toISOString()).lte(\"start_at\", endRange.toISOString());\n        if (appointmentsError) {\n            console.error(\"[getSlots] Appointments Fetch Error:\", appointmentsError);\n        // Fallback for missing column?\n        } else {\n            appointments = apptData ?? [];\n        }\n    } catch (e) {\n        console.error(\"[getSlots] Appointments Unexpected Error:\", e);\n    }\n    // Fetch Blocks\n    let blocks = [];\n    // try {\n    const { data: blocksData, error: blocksError } = await db.from(\"agenda_availability_blocks\").select(\"start_at, end_at, provider_id, location_id\").eq(\"tenant_id\", tenantId).gte(\"end_at\", startRange.toISOString()).lte(\"start_at\", endRange.toISOString());\n    if (blocksError) {\n        console.error(\"[getSlots] Blocks Fetch Error:\", blocksError);\n    } else {\n        blocks = blocksData ?? [];\n    }\n    // } catch (e) {\n    //   console.error(\"Availability blocks fetch failed\", e);\n    // }\n    return {\n        appointments: appointments ?? [],\n        blocks\n    };\n}\n/**\r\n * 3. Calculate Slots for a Single Day\r\n */ function calculateDailySlots(dayOrDateStr, config, data, options) {\n    const { businessHours, timeZone, bufferMinutes } = config;\n    const { appointments, blocks } = data;\n    const { durationMinutes, locationId, providerId } = options;\n    // Determine the Target Date String (YYYY-MM-DD) for filtering\n    let targetDateString;\n    let seekStart;\n    if (typeof dayOrDateStr === \"string\") {\n        targetDateString = dayOrDateStr;\n        // Anchor at UTC noon to avoid edge cases, then scan +/- 24h\n        const anchor = new Date(`${dayOrDateStr}T12:00:00Z`);\n        if (isNaN(anchor.getTime())) {\n            // Fallback\n            targetDateString = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_1__.format)(new Date(), \"yyyy-MM-dd\");\n            seekStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__.startOfDay)(new Date());\n        } else {\n            seekStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(anchor, -12 * 60);\n        }\n    } else {\n        targetDateString = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_1__.format)(dayOrDateStr, \"yyyy-MM-dd\");\n        seekStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__.startOfDay)(dayOrDateStr);\n    }\n    // Scan window: 48 hours to be safe covering all timezones\n    // We strictly filter by \"Does this slot fall on targetDateString in targetTimeZone?\"\n    const startScan = typeof dayOrDateStr === \"string\" ? (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(new Date(`${targetDateString}T00:00:00Z`), -12 * 60) : (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__.startOfDay)(dayOrDateStr);\n    const endScan = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(startScan, 48 * 60);\n    const normalizedDuration = Math.max(5, Number.isFinite(durationMinutes) ? durationMinutes : 30);\n    const interval = 15;\n    const now = new Date();\n    console.log(`[Slots] Calc for ${targetDateString}. Scan: ${startScan.toISOString()} -> ${endScan.toISOString()}. TZ: ${timeZone}`);\n    // Pre-filter blockers for performance\n    const blockingAppointments = appointments.filter((appt)=>{\n        // If provider_id is missing from fetch, we can't filter by it.\n        // Assume appointments block the location unless we can prove otherwise.\n        /* \r\n    if (providerId) {\r\n      if (appt.provider_id === providerId) return true;\r\n      if (!appt.provider_id && appt.location_id === locationId) return true;\r\n      return false;\r\n    }\r\n    */ // Fallback: If appt is in this location, it blocks.\n        return appt.location_id === locationId;\n    });\n    const blockingBlocks = blocks.filter((b)=>{\n        // 1. Check Location Scope\n        // If the block is specific to a location, it only blocks that location.\n        if (b.location_id && b.location_id !== locationId) {\n            return false;\n        }\n        // 2. Check Provider Scope\n        // If the block is \"Global\" (no provider), it blocks everyone.\n        if (!b.provider_id) return true;\n        // If the request is for a specific provider, check if it matches.\n        if (providerId) {\n            return b.provider_id === providerId;\n        }\n        // CRITICAL FIX:\n        // If providerId is NOT filtering (Any Provider), the current \"Single Resource\" logic for appointments\n        // (where any appointment blocks the location) suggests we should treat Blocks similarly for safety.\n        // If one provider is blocked, we block the slot to prevent \"False Availability\" in single-provider contexts.\n        // Ideally query valid providers, but \"Block All\" is safer than \"Block None\".\n        return true;\n    });\n    const slots = [];\n    let current = startScan;\n    // Intl formatter for checking the \"Local Date\" of the slot\n    const dateFormatter = new Intl.DateTimeFormat(\"en-CA\", {\n        timeZone,\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\"\n    });\n    while((0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_4__.isBefore)(current, endScan)){\n        const slotEnd = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(current, normalizedDuration);\n        // 1. Check if 'current' is actually on the target day in the requested timezone\n        let slotDateLocal;\n        try {\n            slotDateLocal = dateFormatter.format(current);\n        } catch (e) {\n            console.error(\"Intl Error\", e);\n            current = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(current, interval);\n            continue;\n        }\n        if (slotDateLocal !== targetDateString) {\n            // Skip slots not belonging to the requested day\n            current = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(current, interval);\n            continue;\n        }\n        // 2. Check Business Hours\n        const isOpen = (0,_lib_scheduling__WEBPACK_IMPORTED_MODULE_0__.isWithinBusinessHours)({\n            start: current,\n            end: slotEnd,\n            businessHours,\n            timeZone\n        });\n        if (isOpen) {\n            // 3. Check Conflicts\n            const hasApptConflict = blockingAppointments.some((appt)=>{\n                const apptStart = new Date(appt.start_at);\n                const apptEnd = new Date(appt.end_at);\n                const bufferedStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(apptStart, -bufferMinutes);\n                const bufferedEnd = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(apptEnd, bufferMinutes);\n                return current < bufferedEnd && slotEnd > bufferedStart;\n            });\n            const hasBlockConflict = blockingBlocks.some((block)=>{\n                const bStart = new Date(block.start_at);\n                const bEnd = new Date(block.end_at);\n                return current < bEnd && slotEnd > bStart;\n            });\n            if (!hasApptConflict && !hasBlockConflict) {\n                // STRICTLY disallow past slots relative to Server Time (UTC)\n                // If today is target day, hide past hours.\n                // We use 'now' (UTC).\n                if ((0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_5__.isAfter)(current, now)) {\n                    // Push time in HH:mm format. \n                    // Note: format(current, \"HH:mm\") uses Local System Time formatting by default unless we pass options?\n                    // Wait, format() from date-fns follows the Date object's values which are based on system time if inspected via getters, \n                    // but 'current' is a Date object.\n                    // If we want HH:mm in the TARGET timezone, we must use Intl or formatInTimeZone.\n                    // Let's use Intl to ensure HH:mm matches the business hours check.\n                    const timeStr = new Intl.DateTimeFormat(\"en-GB\", {\n                        timeZone,\n                        hour: \"2-digit\",\n                        minute: \"2-digit\",\n                        hour12: false\n                    }).format(current);\n                    slots.push(timeStr);\n                }\n            }\n        }\n        current = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(current, interval);\n    }\n    // Deduplicate and Sort\n    return Array.from(new Set(slots)).sort();\n}\n// --- Main Exported Functions ---\nasync function getAvailabilitySlots(options) {\n    const { db, tenantId, date, locationId, durationMinutes, providerId } = options;\n    if (!date || !locationId) throw new AvailabilityError(\"Date and location required\", 400);\n    // 1. Config\n    const config = await fetchAvailabilityConfig(db, tenantId, locationId, providerId);\n    // 2. Data Scan Range\n    // We fetch a wide range to cover potential timezone shifts (UTC-12 to UTC+14)\n    // Anchor at UTC noon of the target string\n    const anchor = new Date(`${date}T12:00:00Z`);\n    if (isNaN(anchor.getTime())) throw new AvailabilityError(\"Invalid date format (YYYY-MM-DD required)\", 400);\n    const startRange = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(anchor, -24 * 60);\n    const endRange = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(anchor, 48 * 60);\n    const data = await fetchAvailabilityData(db, tenantId, startRange, endRange);\n    // 3. Calculate passing the string to ensure timezone-aware filtering\n    return calculateDailySlots(date, config, data, {\n        durationMinutes,\n        locationId,\n        providerId\n    });\n}\n/**\r\n * New: Suggest upcoming slots\r\n */ async function findNextAvailableSlots(options) {\n    const { db, tenantId, fromDate, locationId, durationMinutes, providerId, daysToScan = 14, limit = 5 } = options;\n    const startDate = new Date(fromDate);\n    if (!Number.isFinite(startDate.getTime())) throw new AvailabilityError(\"Invalid date\", 400);\n    // 1. Config (Once)\n    const config = await fetchAvailabilityConfig(db, tenantId, locationId, providerId);\n    // 2. Loop in chunks (e.g. 7 days) until we find 'limit' slots or 'daysToScan' is exhausted\n    const foundSlots = [];\n    const chunkSize = 7;\n    let currentStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__.startOfDay)(startDate);\n    const maxDate = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_6__.addDays)(currentStart, daysToScan);\n    while((0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_4__.isBefore)(currentStart, maxDate) && foundSlots.length < limit){\n        const currentEnd = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_6__.addDays)(currentStart, chunkSize);\n        // Fetch 7 days of data\n        const data = await fetchAvailabilityData(db, tenantId, currentStart, currentEnd);\n        // Process each day\n        for(let i = 0; i < chunkSize; i++){\n            const day = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_6__.addDays)(currentStart, i);\n            if ((0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_5__.isAfter)(day, maxDate)) break;\n            const dailySlots = calculateDailySlots(day, config, data, {\n                durationMinutes,\n                locationId,\n                providerId\n            });\n            if (dailySlots.length > 0) {\n                foundSlots.push({\n                    date: (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_1__.format)(day, \"yyyy-MM-dd\"),\n                    slots: dailySlots.slice(0, 5) // Return top 5 slots per day? Or just the days?\n                });\n            }\n            if (foundSlots.length >= limit) break;\n        }\n        currentStart = currentEnd;\n    }\n    return foundSlots;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2F2YWlsYWJpbGl0eS9nZXRTbG90cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQTZGO0FBR3BDO0FBeUJsRCxNQUFNTywwQkFBMEJDO0lBRXJDQyxZQUFZQyxPQUFlLEVBQUVDLFNBQVMsR0FBRyxDQUFFO1FBQ3pDLEtBQUssQ0FBQ0Q7UUFDTixJQUFJLENBQUNDLE1BQU0sR0FBR0E7SUFDaEI7QUFDRjtBQUlBLGdDQUFnQztBQUVoQzs7Q0FFQyxHQUNNLGVBQWVDLHdCQUNwQkMsRUFBcUIsRUFDckJDLFFBQWdCLEVBQ2hCQyxVQUFrQixFQUNsQkMsVUFBMEI7SUFFMUIsTUFBTSxFQUFFQyxNQUFNQyxZQUFZLEVBQUVDLE9BQU9DLGFBQWEsRUFBRSxHQUFHLE1BQU1QLEdBQ3hEUSxJQUFJLENBQUMsb0JBQ0xDLE1BQU0sQ0FBQyw0Q0FDUEMsRUFBRSxDQUFDLGFBQWFULFVBQ2hCUyxFQUFFLENBQUMsTUFBTVIsWUFDVFMsV0FBVztJQUVkLElBQUlKLGVBQWU7UUFDakJLLFFBQVFOLEtBQUssQ0FBQyw2Q0FBNkNDO1FBQzNELE1BQU0sSUFBSWIsa0JBQWtCLENBQUMsZ0JBQWdCLEVBQUVhLGNBQWNWLE9BQU8sQ0FBQyxDQUFDLEVBQUU7SUFDMUU7SUFDQSxJQUFJLENBQUNRLGNBQWMsTUFBTSxJQUFJWCxrQkFBa0IsNkJBQTZCO0lBRTVFLElBQUltQixnQkFBZ0IsYUFBY0MsY0FBYyxJQUEyQyxDQUFDO0lBRTVGLElBQUlYLFlBQVk7UUFDZCxNQUFNLEVBQUVDLE1BQU1XLFFBQVEsRUFBRVQsT0FBT1UsYUFBYSxFQUFFLEdBQUcsTUFBTWhCLEdBQ3BEUSxJQUFJLENBQUMsb0JBQ0xDLE1BQU0sQ0FBQyxZQUNQQyxFQUFFLENBQUMsTUFBTVAsWUFDVFEsV0FBVztRQUVkLElBQUlLLGVBQWU7WUFDZkosUUFBUUssSUFBSSxDQUFDLG9DQUFvQ0Q7UUFDckQ7UUFFQSxNQUFNRSxlQUFnQkgsVUFBVUksVUFBa0JDO1FB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TUFBTSxJQUFJL0Qsa0JBQWtCLGdCQUFnQjtJQUV2RixtQkFBbUI7SUFDbkIsTUFBTXVELFNBQVMsTUFBTWxELHdCQUF3QkMsSUFBSUMsVUFBVUMsWUFBWUM7SUFFdkUsMkZBQTJGO0lBQzNGLE1BQU1nSCxhQUF1RCxFQUFFO0lBQy9ELE1BQU1DLFlBQVk7SUFDbEIsSUFBSUMsZUFBZTlILGlJQUFVQSxDQUFDMkg7SUFDOUIsTUFBTUksVUFBVTlILDhIQUFPQSxDQUFDNkgsY0FBY0w7SUFFdEMsTUFBTzFILCtIQUFRQSxDQUFDK0gsY0FBY0MsWUFBWUgsV0FBVzVGLE1BQU0sR0FBRzBGLE1BQU87UUFDbEUsTUFBTU0sYUFBYS9ILDhIQUFPQSxDQUFDNkgsY0FBY0Q7UUFDekMsdUJBQXVCO1FBQ3ZCLE1BQU1oSCxPQUFPLE1BQU02QixzQkFBc0JqQyxJQUFJQyxVQUFVb0gsY0FBY0U7UUFFckUsbUJBQW1CO1FBQ25CLElBQUssSUFBSUMsSUFBSSxHQUFHQSxJQUFJSixXQUFXSSxJQUFLO1lBQ2pDLE1BQU10QyxNQUFNMUYsOEhBQU9BLENBQUM2SCxjQUFjRztZQUNsQyxJQUFJbkksOEhBQU9BLENBQUM2RixLQUFLb0MsVUFBVTtZQUUzQixNQUFNRyxhQUFhMUUsb0JBQW9CbUMsS0FBS2pDLFFBQVE3QyxNQUFNO2dCQUN2RCtDO2dCQUNBakQ7Z0JBQ0FDO1lBQ0g7WUFFQSxJQUFJc0gsV0FBV2xHLE1BQU0sR0FBRyxHQUFHO2dCQUN4QjRGLFdBQVdYLElBQUksQ0FBQztvQkFDYkssTUFBTXpILDZIQUFNQSxDQUFDOEYsS0FBSztvQkFDbEJQLE9BQU84QyxXQUFXQyxLQUFLLENBQUMsR0FBRyxHQUFHLGdEQUFnRDtnQkFDakY7WUFDSDtZQUVBLElBQUlQLFdBQVc1RixNQUFNLElBQUkwRixPQUFPO1FBQ25DO1FBQ0FJLGVBQWVFO0lBQ2xCO0lBRUEsT0FBT0o7QUFDViIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL3NlcnZlci9hdmFpbGFiaWxpdHkvZ2V0U2xvdHMudHM/ODMwNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhZGRNaW51dGVzLCBmb3JtYXQsIGlzQWZ0ZXIsIGlzQmVmb3JlLCBzdGFydE9mRGF5LCBhZGREYXlzLCBwYXJzZSB9IGZyb20gXCJkYXRlLWZuc1wiO1xyXG5pbXBvcnQgeyBTdXBhYmFzZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcclxuaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tIFwiQC90eXBlcy9kYXRhYmFzZVwiO1xyXG5pbXBvcnQgeyBpc1dpdGhpbkJ1c2luZXNzSG91cnMgfSBmcm9tIFwiQC9saWIvc2NoZWR1bGluZ1wiO1xyXG5cclxuLy8gLS0tIFR5cGVzIC0tLVxyXG5cclxuZXhwb3J0IHR5cGUgQXZhaWxhYmlsaXR5Q29uZmlnID0ge1xyXG4gIGJ1c2luZXNzSG91cnM6IFJlY29yZDxzdHJpbmcsIFtzdHJpbmcsIHN0cmluZ11bXT47XHJcbiAgdGltZVpvbmU6IHN0cmluZztcclxuICBidWZmZXJNaW51dGVzOiBudW1iZXI7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBBdmFpbGFiaWxpdHlEYXRhID0ge1xyXG4gIGFwcG9pbnRtZW50czogQXJyYXk8e1xyXG4gICAgc3RhcnRfYXQ6IHN0cmluZztcclxuICAgIGVuZF9hdDogc3RyaW5nO1xyXG4gICAgcHJvdmlkZXJfaWQ6IHN0cmluZyB8IG51bGw7XHJcbiAgICBsb2NhdGlvbl9pZDogc3RyaW5nO1xyXG4gIH0+O1xyXG4gIGJsb2NrczogQXJyYXk8e1xyXG4gICAgc3RhcnRfYXQ6IHN0cmluZztcclxuICAgIGVuZF9hdDogc3RyaW5nO1xyXG4gICAgcHJvdmlkZXJfaWQ6IHN0cmluZyB8IG51bGw7XHJcbiAgICBsb2NhdGlvbl9pZDogc3RyaW5nIHwgbnVsbDtcclxuICB9PjtcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBBdmFpbGFiaWxpdHlFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICBzdGF0dXM6IG51bWJlcjtcclxuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcsIHN0YXR1cyA9IDQwMCkge1xyXG4gICAgc3VwZXIobWVzc2FnZSk7XHJcbiAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcclxuICB9XHJcbn1cclxuXHJcbnR5cGUgQW55U3VwYWJhc2VDbGllbnQgPSBTdXBhYmFzZUNsaWVudDxEYXRhYmFzZSwgXCJwdWJsaWNcIiwgYW55PjtcclxuXHJcbi8vIC0tLSBDb3JlIEhlbHBlciBGdW5jdGlvbnMgLS0tXHJcblxyXG4vKipcclxuICogMS4gRmV0Y2ggQ29uZmlndXJhdGlvbiAoTG9jYXRpb24gU2V0dGluZ3MgKyBQcm92aWRlciBTY2hlZHVsZSBPdmVycmlkZSlcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaEF2YWlsYWJpbGl0eUNvbmZpZyhcclxuICBkYjogQW55U3VwYWJhc2VDbGllbnQsXHJcbiAgdGVuYW50SWQ6IHN0cmluZyxcclxuICBsb2NhdGlvbklkOiBzdHJpbmcsXHJcbiAgcHJvdmlkZXJJZD86IHN0cmluZyB8IG51bGxcclxuKTogUHJvbWlzZTxBdmFpbGFiaWxpdHlDb25maWc+IHtcclxuICBjb25zdCB7IGRhdGE6IGxvY2F0aW9uRGF0YSwgZXJyb3I6IGxvY2F0aW9uRXJyb3IgfSA9IGF3YWl0IGRiXHJcbiAgICAuZnJvbShcImFnZW5kYV9sb2NhdGlvbnNcIilcclxuICAgIC5zZWxlY3QoXCJidXNpbmVzc19ob3VycywgdGltZXpvbmUsIGJ1ZmZlcl9taW51dGVzXCIpXHJcbiAgICAuZXEoXCJ0ZW5hbnRfaWRcIiwgdGVuYW50SWQpXHJcbiAgICAuZXEoXCJpZFwiLCBsb2NhdGlvbklkKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGlmIChsb2NhdGlvbkVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiW2dldFNsb3RzXSBmZXRjaEF2YWlsYWJpbGl0eUNvbmZpZyBFcnJvcjpcIiwgbG9jYXRpb25FcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgQXZhaWxhYmlsaXR5RXJyb3IoYExvY2F0aW9uIEVycm9yOiAke2xvY2F0aW9uRXJyb3IubWVzc2FnZX1gLCA0MDApO1xyXG4gIH1cclxuICBpZiAoIWxvY2F0aW9uRGF0YSkgdGhyb3cgbmV3IEF2YWlsYWJpbGl0eUVycm9yKFwiQ29uc3VsdG9yaW8gbm8gZW5jb250cmFkb1wiLCA0MDQpO1xyXG5cclxuICBsZXQgYnVzaW5lc3NIb3VycyA9IChsb2NhdGlvbkRhdGEuYnVzaW5lc3NfaG91cnMgYXMgUmVjb3JkPHN0cmluZywgW3N0cmluZywgc3RyaW5nXVtdPikgPz8ge307XHJcblxyXG4gIGlmIChwcm92aWRlcklkKSB7XHJcbiAgICBjb25zdCB7IGRhdGE6IHByb3ZpZGVyLCBlcnJvcjogcHJvdmlkZXJFcnJvciB9ID0gYXdhaXQgZGJcclxuICAgICAgLmZyb20oXCJhZ2VuZGFfcHJvdmlkZXJzXCIgYXMgYW55KVxyXG4gICAgICAuc2VsZWN0KFwibWV0YWRhdGFcIilcclxuICAgICAgLmVxKFwiaWRcIiwgcHJvdmlkZXJJZClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcbiAgICBcclxuICAgIGlmIChwcm92aWRlckVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKFwiW2dldFNsb3RzXSBQcm92aWRlciBGZXRjaCBFcnJvcjpcIiwgcHJvdmlkZXJFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcHJvdlNjaGVkdWxlID0gKHByb3ZpZGVyPy5tZXRhZGF0YSBhcyBhbnkpPy5zY2hlZHVsZTtcclxuICAgIGlmIChwcm92U2NoZWR1bGUgJiYgT2JqZWN0LmtleXMocHJvdlNjaGVkdWxlKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGJ1c2luZXNzSG91cnMgPSBwcm92U2NoZWR1bGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBGYWxsYmFjayBkZWZhdWx0IGhvdXJzIGlmIGVtcHR5XHJcbiAgaWYgKE9iamVjdC5rZXlzKGJ1c2luZXNzSG91cnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgYnVzaW5lc3NIb3VycyA9IHtcclxuICAgICAgbW9uOiBbW1wiMDk6MDBcIiwgXCIxODowMFwiXV0sXHJcbiAgICAgIHR1ZTogW1tcIjA5OjAwXCIsIFwiMTg6MDBcIl1dLFxyXG4gICAgICB3ZWQ6IFtbXCIwOTowMFwiLCBcIjE4OjAwXCJdXSxcclxuICAgICAgdGh1OiBbW1wiMDk6MDBcIiwgXCIxODowMFwiXV0sXHJcbiAgICAgIGZyaTogW1tcIjA5OjAwXCIsIFwiMTg6MDBcIl1dLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIEVuc3VyZSBcInRvZGF5XCIgY2hlY2sgaGFuZGxlcyB0aW1lem9uZSBkaWZmcyBncmFjZWZ1bGx5XHJcbiAgLy8gV2UgdXNlIHRoZSBzdGFydCBvZiBkYXkgb2YgdGhlIFRBUkdFVCBkYXRlIGFuZCBjb21wYXJlIHRvIFwibm93XCJcclxuICAvLyBJZiB0YXJnZXQgZGF0ZSBpcyB0b2RheSwgd2UgZmlsdGVyIHBhc3Qgc2xvdHMuXHJcbiAgcmV0dXJuIHtcclxuICAgIGJ1c2luZXNzSG91cnMsXHJcbiAgICB0aW1lWm9uZTogbG9jYXRpb25EYXRhLnRpbWV6b25lID8/IFwiQW1lcmljYS9BcmdlbnRpbmEvQnVlbm9zX0FpcmVzXCIsXHJcbiAgICBidWZmZXJNaW51dGVzOiBsb2NhdGlvbkRhdGEuYnVmZmVyX21pbnV0ZXMgPz8gMCxcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogMi4gRmV0Y2ggRGF0YSAoQXBwb2ludG1lbnRzICsgQmxvY2tzKSBmb3IgYSBzcGVjaWZpYyBEYXRlIFJhbmdlXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmV0Y2hBdmFpbGFiaWxpdHlEYXRhKFxyXG4gIGRiOiBBbnlTdXBhYmFzZUNsaWVudCxcclxuICB0ZW5hbnRJZDogc3RyaW5nLFxyXG4gIHN0YXJ0UmFuZ2U6IERhdGUsXHJcbiAgZW5kUmFuZ2U6IERhdGVcclxuKTogUHJvbWlzZTxBdmFpbGFiaWxpdHlEYXRhPiB7XHJcbiAgLy8gRmV0Y2ggQXBwb2ludG1lbnRzXHJcbiAgbGV0IGFwcG9pbnRtZW50czogYW55W10gPSBbXTtcclxuICB0cnkge1xyXG4gICAgLy8gMjAyNi0wMS0wODogUkVNT1ZFRCBwcm92aWRlcl9pZCBzZWxlY3Rpb24gdGVtcG9yYXJpbHkgaWYgY29sdW1uIGlzIG1pc3NpbmdcclxuICAgIGNvbnN0IHsgZGF0YTogYXBwdERhdGEsIGVycm9yOiBhcHBvaW50bWVudHNFcnJvciB9ID0gYXdhaXQgZGJcclxuICAgICAgICAuZnJvbShcImFnZW5kYV9hcHBvaW50bWVudHNcIiBhcyBhbnkpXHJcbiAgICAgICAgLnNlbGVjdChcInN0YXJ0X2F0LCBlbmRfYXQsIGxvY2F0aW9uX2lkXCIpIC8vIFJlbW92ZWQgcHJvdmlkZXJfaWRcclxuICAgICAgICAuZXEoXCJ0ZW5hbnRfaWRcIiwgdGVuYW50SWQpXHJcbiAgICAgICAgLm5lcShcInN0YXR1c1wiLCBcImNhbmNlbGVkXCIpXHJcbiAgICAgICAgLmd0ZShcImVuZF9hdFwiLCBzdGFydFJhbmdlLnRvSVNPU3RyaW5nKCkpXHJcbiAgICAgICAgLmx0ZShcInN0YXJ0X2F0XCIsIGVuZFJhbmdlLnRvSVNPU3RyaW5nKCkpO1xyXG5cclxuICAgIGlmIChhcHBvaW50bWVudHNFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbZ2V0U2xvdHNdIEFwcG9pbnRtZW50cyBGZXRjaCBFcnJvcjpcIiwgYXBwb2ludG1lbnRzRXJyb3IpO1xyXG4gICAgICAgIC8vIEZhbGxiYWNrIGZvciBtaXNzaW5nIGNvbHVtbj9cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYXBwb2ludG1lbnRzID0gYXBwdERhdGEgPz8gW107XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiW2dldFNsb3RzXSBBcHBvaW50bWVudHMgVW5leHBlY3RlZCBFcnJvcjpcIiwgZSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLy8gRmV0Y2ggQmxvY2tzXHJcbiAgbGV0IGJsb2NrczogYW55W10gPSBbXTtcclxuICAvLyB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhOiBibG9ja3NEYXRhLCBlcnJvcjogYmxvY2tzRXJyb3IgfSA9IGF3YWl0IGRiXHJcbiAgICAgIC5mcm9tKFwiYWdlbmRhX2F2YWlsYWJpbGl0eV9ibG9ja3NcIiBhcyBhbnkpXHJcbiAgICAgIC5zZWxlY3QoXCJzdGFydF9hdCwgZW5kX2F0LCBwcm92aWRlcl9pZCwgbG9jYXRpb25faWRcIilcclxuICAgICAgLmVxKFwidGVuYW50X2lkXCIsIHRlbmFudElkKVxyXG4gICAgICAuZ3RlKFwiZW5kX2F0XCIsIHN0YXJ0UmFuZ2UudG9JU09TdHJpbmcoKSlcclxuICAgICAgLmx0ZShcInN0YXJ0X2F0XCIsIGVuZFJhbmdlLnRvSVNPU3RyaW5nKCkpO1xyXG4gICAgXHJcbiAgICBpZiAoYmxvY2tzRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiW2dldFNsb3RzXSBCbG9ja3MgRmV0Y2ggRXJyb3I6XCIsIGJsb2Nrc0Vycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYmxvY2tzID0gYmxvY2tzRGF0YSA/PyBbXTtcclxuICAgIH1cclxuICAvLyB9IGNhdGNoIChlKSB7XHJcbiAgLy8gICBjb25zb2xlLmVycm9yKFwiQXZhaWxhYmlsaXR5IGJsb2NrcyBmZXRjaCBmYWlsZWRcIiwgZSk7XHJcbiAgLy8gfVxyXG5cclxuXHJcbiAgcmV0dXJuIHsgXHJcbiAgICBhcHBvaW50bWVudHM6IGFwcG9pbnRtZW50cyA/PyBbXSwgXHJcbiAgICBibG9ja3MgXHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIDMuIENhbGN1bGF0ZSBTbG90cyBmb3IgYSBTaW5nbGUgRGF5XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlRGFpbHlTbG90cyhcclxuICBkYXlPckRhdGVTdHI6IERhdGUgfCBzdHJpbmcsXHJcbiAgY29uZmlnOiBBdmFpbGFiaWxpdHlDb25maWcsXHJcbiAgZGF0YTogQXZhaWxhYmlsaXR5RGF0YSxcclxuICBvcHRpb25zOiB7XHJcbiAgICBkdXJhdGlvbk1pbnV0ZXM6IG51bWJlcjtcclxuICAgIGxvY2F0aW9uSWQ6IHN0cmluZztcclxuICAgIHByb3ZpZGVySWQ/OiBzdHJpbmcgfCBudWxsO1xyXG4gIH1cclxuKTogc3RyaW5nW10ge1xyXG4gIGNvbnN0IHsgYnVzaW5lc3NIb3VycywgdGltZVpvbmUsIGJ1ZmZlck1pbnV0ZXMgfSA9IGNvbmZpZztcclxuICBjb25zdCB7IGFwcG9pbnRtZW50cywgYmxvY2tzIH0gPSBkYXRhO1xyXG4gIGNvbnN0IHsgZHVyYXRpb25NaW51dGVzLCBsb2NhdGlvbklkLCBwcm92aWRlcklkIH0gPSBvcHRpb25zO1xyXG4gIFxyXG4gIC8vIERldGVybWluZSB0aGUgVGFyZ2V0IERhdGUgU3RyaW5nIChZWVlZLU1NLUREKSBmb3IgZmlsdGVyaW5nXHJcbiAgbGV0IHRhcmdldERhdGVTdHJpbmc6IHN0cmluZztcclxuICBsZXQgc2Vla1N0YXJ0OiBEYXRlO1xyXG5cclxuICBpZiAodHlwZW9mIGRheU9yRGF0ZVN0ciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgdGFyZ2V0RGF0ZVN0cmluZyA9IGRheU9yRGF0ZVN0cjtcclxuICAgICAgLy8gQW5jaG9yIGF0IFVUQyBub29uIHRvIGF2b2lkIGVkZ2UgY2FzZXMsIHRoZW4gc2NhbiArLy0gMjRoXHJcbiAgICAgIGNvbnN0IGFuY2hvciA9IG5ldyBEYXRlKGAke2RheU9yRGF0ZVN0cn1UMTI6MDA6MDBaYCk7XHJcbiAgICAgIGlmIChpc05hTihhbmNob3IuZ2V0VGltZSgpKSkge1xyXG4gICAgICAgICAgLy8gRmFsbGJhY2tcclxuICAgICAgICAgIHRhcmdldERhdGVTdHJpbmcgPSBmb3JtYXQobmV3IERhdGUoKSwgXCJ5eXl5LU1NLWRkXCIpO1xyXG4gICAgICAgICAgc2Vla1N0YXJ0ID0gc3RhcnRPZkRheShuZXcgRGF0ZSgpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHNlZWtTdGFydCA9IGFkZE1pbnV0ZXMoYW5jaG9yLCAtMTIgKiA2MCk7IFxyXG4gICAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgICAgdGFyZ2V0RGF0ZVN0cmluZyA9IGZvcm1hdChkYXlPckRhdGVTdHIsIFwieXl5eS1NTS1kZFwiKTtcclxuICAgICAgc2Vla1N0YXJ0ID0gc3RhcnRPZkRheShkYXlPckRhdGVTdHIpO1xyXG4gIH1cclxuXHJcbiAgLy8gU2NhbiB3aW5kb3c6IDQ4IGhvdXJzIHRvIGJlIHNhZmUgY292ZXJpbmcgYWxsIHRpbWV6b25lc1xyXG4gIC8vIFdlIHN0cmljdGx5IGZpbHRlciBieSBcIkRvZXMgdGhpcyBzbG90IGZhbGwgb24gdGFyZ2V0RGF0ZVN0cmluZyBpbiB0YXJnZXRUaW1lWm9uZT9cIlxyXG4gIGNvbnN0IHN0YXJ0U2NhbiA9IHR5cGVvZiBkYXlPckRhdGVTdHIgPT09ICdzdHJpbmcnIFxyXG4gICAgICA/IGFkZE1pbnV0ZXMobmV3IERhdGUoYCR7dGFyZ2V0RGF0ZVN0cmluZ31UMDA6MDA6MDBaYCksIC0xMio2MCkgXHJcbiAgICAgIDogc3RhcnRPZkRheShkYXlPckRhdGVTdHIpO1xyXG4gICAgICBcclxuICBjb25zdCBlbmRTY2FuID0gYWRkTWludXRlcyhzdGFydFNjYW4sIDQ4ICogNjApO1xyXG5cclxuICBjb25zdCBub3JtYWxpemVkRHVyYXRpb24gPSBNYXRoLm1heCg1LCBOdW1iZXIuaXNGaW5pdGUoZHVyYXRpb25NaW51dGVzKSA/IGR1cmF0aW9uTWludXRlcyA6IDMwKTtcclxuICBjb25zdCBpbnRlcnZhbCA9IDE1O1xyXG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcblxyXG4gIGNvbnNvbGUubG9nKGBbU2xvdHNdIENhbGMgZm9yICR7dGFyZ2V0RGF0ZVN0cmluZ30uIFNjYW46ICR7c3RhcnRTY2FuLnRvSVNPU3RyaW5nKCl9IC0+ICR7ZW5kU2Nhbi50b0lTT1N0cmluZygpfS4gVFo6ICR7dGltZVpvbmV9YCk7XHJcbiAgXHJcbiAgLy8gUHJlLWZpbHRlciBibG9ja2VycyBmb3IgcGVyZm9ybWFuY2VcclxuICBjb25zdCBibG9ja2luZ0FwcG9pbnRtZW50cyA9IGFwcG9pbnRtZW50cy5maWx0ZXIoKGFwcHQpID0+IHtcclxuICAgIC8vIElmIHByb3ZpZGVyX2lkIGlzIG1pc3NpbmcgZnJvbSBmZXRjaCwgd2UgY2FuJ3QgZmlsdGVyIGJ5IGl0LlxyXG4gICAgLy8gQXNzdW1lIGFwcG9pbnRtZW50cyBibG9jayB0aGUgbG9jYXRpb24gdW5sZXNzIHdlIGNhbiBwcm92ZSBvdGhlcndpc2UuXHJcbiAgICAvKiBcclxuICAgIGlmIChwcm92aWRlcklkKSB7XHJcbiAgICAgIGlmIChhcHB0LnByb3ZpZGVyX2lkID09PSBwcm92aWRlcklkKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgaWYgKCFhcHB0LnByb3ZpZGVyX2lkICYmIGFwcHQubG9jYXRpb25faWQgPT09IGxvY2F0aW9uSWQpIHJldHVybiB0cnVlO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAqL1xyXG4gICAgLy8gRmFsbGJhY2s6IElmIGFwcHQgaXMgaW4gdGhpcyBsb2NhdGlvbiwgaXQgYmxvY2tzLlxyXG4gICAgcmV0dXJuIGFwcHQubG9jYXRpb25faWQgPT09IGxvY2F0aW9uSWQ7XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGJsb2NraW5nQmxvY2tzID0gYmxvY2tzLmZpbHRlcigoYikgPT4ge1xyXG4gICAgLy8gMS4gQ2hlY2sgTG9jYXRpb24gU2NvcGVcclxuICAgIC8vIElmIHRoZSBibG9jayBpcyBzcGVjaWZpYyB0byBhIGxvY2F0aW9uLCBpdCBvbmx5IGJsb2NrcyB0aGF0IGxvY2F0aW9uLlxyXG4gICAgaWYgKGIubG9jYXRpb25faWQgJiYgYi5sb2NhdGlvbl9pZCAhPT0gbG9jYXRpb25JZCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAyLiBDaGVjayBQcm92aWRlciBTY29wZVxyXG4gICAgLy8gSWYgdGhlIGJsb2NrIGlzIFwiR2xvYmFsXCIgKG5vIHByb3ZpZGVyKSwgaXQgYmxvY2tzIGV2ZXJ5b25lLlxyXG4gICAgaWYgKCFiLnByb3ZpZGVyX2lkKSByZXR1cm4gdHJ1ZTtcclxuICAgIFxyXG4gICAgLy8gSWYgdGhlIHJlcXVlc3QgaXMgZm9yIGEgc3BlY2lmaWMgcHJvdmlkZXIsIGNoZWNrIGlmIGl0IG1hdGNoZXMuXHJcbiAgICBpZiAocHJvdmlkZXJJZCkge1xyXG4gICAgICAgIHJldHVybiBiLnByb3ZpZGVyX2lkID09PSBwcm92aWRlcklkO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDUklUSUNBTCBGSVg6XHJcbiAgICAvLyBJZiBwcm92aWRlcklkIGlzIE5PVCBmaWx0ZXJpbmcgKEFueSBQcm92aWRlciksIHRoZSBjdXJyZW50IFwiU2luZ2xlIFJlc291cmNlXCIgbG9naWMgZm9yIGFwcG9pbnRtZW50c1xyXG4gICAgLy8gKHdoZXJlIGFueSBhcHBvaW50bWVudCBibG9ja3MgdGhlIGxvY2F0aW9uKSBzdWdnZXN0cyB3ZSBzaG91bGQgdHJlYXQgQmxvY2tzIHNpbWlsYXJseSBmb3Igc2FmZXR5LlxyXG4gICAgLy8gSWYgb25lIHByb3ZpZGVyIGlzIGJsb2NrZWQsIHdlIGJsb2NrIHRoZSBzbG90IHRvIHByZXZlbnQgXCJGYWxzZSBBdmFpbGFiaWxpdHlcIiBpbiBzaW5nbGUtcHJvdmlkZXIgY29udGV4dHMuXHJcbiAgICAvLyBJZGVhbGx5IHF1ZXJ5IHZhbGlkIHByb3ZpZGVycywgYnV0IFwiQmxvY2sgQWxsXCIgaXMgc2FmZXIgdGhhbiBcIkJsb2NrIE5vbmVcIi5cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBzbG90czogc3RyaW5nW10gPSBbXTtcclxuICBsZXQgY3VycmVudCA9IHN0YXJ0U2NhbjtcclxuXHJcbiAgLy8gSW50bCBmb3JtYXR0ZXIgZm9yIGNoZWNraW5nIHRoZSBcIkxvY2FsIERhdGVcIiBvZiB0aGUgc2xvdFxyXG4gIGNvbnN0IGRhdGVGb3JtYXR0ZXIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChcImVuLUNBXCIsIHsgLy8gWVlZWS1NTS1ERFxyXG4gICAgdGltZVpvbmUsXHJcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcclxuICAgIG1vbnRoOiBcIjItZGlnaXRcIixcclxuICAgIGRheTogXCIyLWRpZ2l0XCIsXHJcbiAgfSk7XHJcblxyXG4gIHdoaWxlIChpc0JlZm9yZShjdXJyZW50LCBlbmRTY2FuKSkge1xyXG4gICAgY29uc3Qgc2xvdEVuZCA9IGFkZE1pbnV0ZXMoY3VycmVudCwgbm9ybWFsaXplZER1cmF0aW9uKTtcclxuXHJcbiAgICAvLyAxLiBDaGVjayBpZiAnY3VycmVudCcgaXMgYWN0dWFsbHkgb24gdGhlIHRhcmdldCBkYXkgaW4gdGhlIHJlcXVlc3RlZCB0aW1lem9uZVxyXG4gICAgbGV0IHNsb3REYXRlTG9jYWw6IHN0cmluZztcclxuICAgIHRyeSB7XHJcbiAgICAgICAgc2xvdERhdGVMb2NhbCA9IGRhdGVGb3JtYXR0ZXIuZm9ybWF0KGN1cnJlbnQpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbnRsIEVycm9yXCIsIGUpO1xyXG4gICAgICAgIGN1cnJlbnQgPSBhZGRNaW51dGVzKGN1cnJlbnQsIGludGVydmFsKTtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc2xvdERhdGVMb2NhbCAhPT0gdGFyZ2V0RGF0ZVN0cmluZykge1xyXG4gICAgICAgIC8vIFNraXAgc2xvdHMgbm90IGJlbG9uZ2luZyB0byB0aGUgcmVxdWVzdGVkIGRheVxyXG4gICAgICAgIGN1cnJlbnQgPSBhZGRNaW51dGVzKGN1cnJlbnQsIGludGVydmFsKTtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAyLiBDaGVjayBCdXNpbmVzcyBIb3Vyc1xyXG4gICAgY29uc3QgaXNPcGVuID0gaXNXaXRoaW5CdXNpbmVzc0hvdXJzKHtcclxuICAgICAgc3RhcnQ6IGN1cnJlbnQsXHJcbiAgICAgIGVuZDogc2xvdEVuZCxcclxuICAgICAgYnVzaW5lc3NIb3VycyxcclxuICAgICAgdGltZVpvbmUsXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoaXNPcGVuKSB7XHJcbiAgICAgIC8vIDMuIENoZWNrIENvbmZsaWN0c1xyXG4gICAgICBjb25zdCBoYXNBcHB0Q29uZmxpY3QgPSBibG9ja2luZ0FwcG9pbnRtZW50cy5zb21lKChhcHB0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgYXBwdFN0YXJ0ID0gbmV3IERhdGUoYXBwdC5zdGFydF9hdCk7XHJcbiAgICAgICAgY29uc3QgYXBwdEVuZCA9IG5ldyBEYXRlKGFwcHQuZW5kX2F0KTtcclxuICAgICAgICBjb25zdCBidWZmZXJlZFN0YXJ0ID0gYWRkTWludXRlcyhhcHB0U3RhcnQsIC1idWZmZXJNaW51dGVzKTtcclxuICAgICAgICBjb25zdCBidWZmZXJlZEVuZCA9IGFkZE1pbnV0ZXMoYXBwdEVuZCwgYnVmZmVyTWludXRlcyk7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnQgPCBidWZmZXJlZEVuZCAmJiBzbG90RW5kID4gYnVmZmVyZWRTdGFydDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBoYXNCbG9ja0NvbmZsaWN0ID0gYmxvY2tpbmdCbG9ja3Muc29tZSgoYmxvY2spID0+IHtcclxuICAgICAgICBjb25zdCBiU3RhcnQgPSBuZXcgRGF0ZShibG9jay5zdGFydF9hdCk7XHJcbiAgICAgICAgY29uc3QgYkVuZCA9IG5ldyBEYXRlKGJsb2NrLmVuZF9hdCk7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnQgPCBiRW5kICYmIHNsb3RFbmQgPiBiU3RhcnQ7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKCFoYXNBcHB0Q29uZmxpY3QgJiYgIWhhc0Jsb2NrQ29uZmxpY3QpIHtcclxuICAgICAgICAvLyBTVFJJQ1RMWSBkaXNhbGxvdyBwYXN0IHNsb3RzIHJlbGF0aXZlIHRvIFNlcnZlciBUaW1lIChVVEMpXHJcbiAgICAgICAgLy8gSWYgdG9kYXkgaXMgdGFyZ2V0IGRheSwgaGlkZSBwYXN0IGhvdXJzLlxyXG4gICAgICAgIC8vIFdlIHVzZSAnbm93JyAoVVRDKS5cclxuICAgICAgICBpZiAoaXNBZnRlcihjdXJyZW50LCBub3cpKSB7XHJcbiAgICAgICAgICAgIC8vIFB1c2ggdGltZSBpbiBISDptbSBmb3JtYXQuIFxyXG4gICAgICAgICAgICAvLyBOb3RlOiBmb3JtYXQoY3VycmVudCwgXCJISDptbVwiKSB1c2VzIExvY2FsIFN5c3RlbSBUaW1lIGZvcm1hdHRpbmcgYnkgZGVmYXVsdCB1bmxlc3Mgd2UgcGFzcyBvcHRpb25zP1xyXG4gICAgICAgICAgICAvLyBXYWl0LCBmb3JtYXQoKSBmcm9tIGRhdGUtZm5zIGZvbGxvd3MgdGhlIERhdGUgb2JqZWN0J3MgdmFsdWVzIHdoaWNoIGFyZSBiYXNlZCBvbiBzeXN0ZW0gdGltZSBpZiBpbnNwZWN0ZWQgdmlhIGdldHRlcnMsIFxyXG4gICAgICAgICAgICAvLyBidXQgJ2N1cnJlbnQnIGlzIGEgRGF0ZSBvYmplY3QuXHJcbiAgICAgICAgICAgIC8vIElmIHdlIHdhbnQgSEg6bW0gaW4gdGhlIFRBUkdFVCB0aW1lem9uZSwgd2UgbXVzdCB1c2UgSW50bCBvciBmb3JtYXRJblRpbWVab25lLlxyXG4gICAgICAgICAgICAvLyBMZXQncyB1c2UgSW50bCB0byBlbnN1cmUgSEg6bW0gbWF0Y2hlcyB0aGUgYnVzaW5lc3MgaG91cnMgY2hlY2suXHJcbiAgICAgICAgICAgIGNvbnN0IHRpbWVTdHIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChcImVuLUdCXCIsIHsgLy8gSEg6bW1cclxuICAgICAgICAgICAgICAgIHRpbWVab25lLFxyXG4gICAgICAgICAgICAgICAgaG91cjogXCIyLWRpZ2l0XCIsXHJcbiAgICAgICAgICAgICAgICBtaW51dGU6IFwiMi1kaWdpdFwiLFxyXG4gICAgICAgICAgICAgICAgaG91cjEyOiBmYWxzZVxyXG4gICAgICAgICAgICB9KS5mb3JtYXQoY3VycmVudCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBzbG90cy5wdXNoKHRpbWVTdHIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY3VycmVudCA9IGFkZE1pbnV0ZXMoY3VycmVudCwgaW50ZXJ2YWwpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGVkdXBsaWNhdGUgYW5kIFNvcnRcclxuICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KHNsb3RzKSkuc29ydCgpO1xyXG59XHJcblxyXG4vLyAtLS0gTWFpbiBFeHBvcnRlZCBGdW5jdGlvbnMgLS0tXHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXZhaWxhYmlsaXR5U2xvdHMob3B0aW9uczoge1xyXG4gIGRiOiBBbnlTdXBhYmFzZUNsaWVudDtcclxuICB0ZW5hbnRJZDogc3RyaW5nO1xyXG4gIGRhdGU6IHN0cmluZztcclxuICBsb2NhdGlvbklkOiBzdHJpbmc7XHJcbiAgZHVyYXRpb25NaW51dGVzOiBudW1iZXI7XHJcbiAgcHJvdmlkZXJJZD86IHN0cmluZyB8IG51bGw7XHJcbn0pIHtcclxuICBjb25zdCB7IGRiLCB0ZW5hbnRJZCwgZGF0ZSwgbG9jYXRpb25JZCwgZHVyYXRpb25NaW51dGVzLCBwcm92aWRlcklkIH0gPSBvcHRpb25zO1xyXG5cclxuICBpZiAoIWRhdGUgfHwgIWxvY2F0aW9uSWQpIHRocm93IG5ldyBBdmFpbGFiaWxpdHlFcnJvcihcIkRhdGUgYW5kIGxvY2F0aW9uIHJlcXVpcmVkXCIsIDQwMCk7XHJcblxyXG4gIC8vIDEuIENvbmZpZ1xyXG4gIGNvbnN0IGNvbmZpZyA9IGF3YWl0IGZldGNoQXZhaWxhYmlsaXR5Q29uZmlnKGRiLCB0ZW5hbnRJZCwgbG9jYXRpb25JZCwgcHJvdmlkZXJJZCk7XHJcblxyXG4gIC8vIDIuIERhdGEgU2NhbiBSYW5nZVxyXG4gIC8vIFdlIGZldGNoIGEgd2lkZSByYW5nZSB0byBjb3ZlciBwb3RlbnRpYWwgdGltZXpvbmUgc2hpZnRzIChVVEMtMTIgdG8gVVRDKzE0KVxyXG4gIC8vIEFuY2hvciBhdCBVVEMgbm9vbiBvZiB0aGUgdGFyZ2V0IHN0cmluZ1xyXG4gIGNvbnN0IGFuY2hvciA9IG5ldyBEYXRlKGAke2RhdGV9VDEyOjAwOjAwWmApO1xyXG4gIGlmIChpc05hTihhbmNob3IuZ2V0VGltZSgpKSkgdGhyb3cgbmV3IEF2YWlsYWJpbGl0eUVycm9yKFwiSW52YWxpZCBkYXRlIGZvcm1hdCAoWVlZWS1NTS1ERCByZXF1aXJlZClcIiwgNDAwKTtcclxuXHJcbiAgY29uc3Qgc3RhcnRSYW5nZSA9IGFkZE1pbnV0ZXMoYW5jaG9yLCAtMjQgKiA2MCk7IFxyXG4gIGNvbnN0IGVuZFJhbmdlID0gYWRkTWludXRlcyhhbmNob3IsIDQ4ICogNjApO1xyXG5cclxuICBjb25zdCBkYXRhID0gYXdhaXQgZmV0Y2hBdmFpbGFiaWxpdHlEYXRhKGRiLCB0ZW5hbnRJZCwgc3RhcnRSYW5nZSwgZW5kUmFuZ2UpO1xyXG5cclxuICAvLyAzLiBDYWxjdWxhdGUgcGFzc2luZyB0aGUgc3RyaW5nIHRvIGVuc3VyZSB0aW1lem9uZS1hd2FyZSBmaWx0ZXJpbmdcclxuICByZXR1cm4gY2FsY3VsYXRlRGFpbHlTbG90cyhkYXRlLCBjb25maWcsIGRhdGEsIHtcclxuICAgIGR1cmF0aW9uTWludXRlcyxcclxuICAgIGxvY2F0aW9uSWQsXHJcbiAgICBwcm92aWRlcklkXHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBOZXc6IFN1Z2dlc3QgdXBjb21pbmcgc2xvdHNcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kTmV4dEF2YWlsYWJsZVNsb3RzKG9wdGlvbnM6IHtcclxuICBkYjogQW55U3VwYWJhc2VDbGllbnQ7XHJcbiAgdGVuYW50SWQ6IHN0cmluZztcclxuICBmcm9tRGF0ZTogc3RyaW5nO1xyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZztcclxuICBkdXJhdGlvbk1pbnV0ZXM6IG51bWJlcjtcclxuICBwcm92aWRlcklkPzogc3RyaW5nIHwgbnVsbDtcclxuICBkYXlzVG9TY2FuPzogbnVtYmVyO1xyXG4gIGxpbWl0PzogbnVtYmVyO1xyXG59KSB7XHJcbiAgIGNvbnN0IHsgZGIsIHRlbmFudElkLCBmcm9tRGF0ZSwgbG9jYXRpb25JZCwgZHVyYXRpb25NaW51dGVzLCBwcm92aWRlcklkLCBkYXlzVG9TY2FuID0gMTQsIGxpbWl0ID0gNSB9ID0gb3B0aW9ucztcclxuICAgXHJcbiAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKGZyb21EYXRlKTtcclxuICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUoc3RhcnREYXRlLmdldFRpbWUoKSkpIHRocm93IG5ldyBBdmFpbGFiaWxpdHlFcnJvcihcIkludmFsaWQgZGF0ZVwiLCA0MDApO1xyXG5cclxuICAgLy8gMS4gQ29uZmlnIChPbmNlKVxyXG4gICBjb25zdCBjb25maWcgPSBhd2FpdCBmZXRjaEF2YWlsYWJpbGl0eUNvbmZpZyhkYiwgdGVuYW50SWQsIGxvY2F0aW9uSWQsIHByb3ZpZGVySWQpO1xyXG5cclxuICAgLy8gMi4gTG9vcCBpbiBjaHVua3MgKGUuZy4gNyBkYXlzKSB1bnRpbCB3ZSBmaW5kICdsaW1pdCcgc2xvdHMgb3IgJ2RheXNUb1NjYW4nIGlzIGV4aGF1c3RlZFxyXG4gICBjb25zdCBmb3VuZFNsb3RzOiBBcnJheTx7IGRhdGU6IHN0cmluZzsgc2xvdHM6IHN0cmluZ1tdIH0+ID0gW107XHJcbiAgIGNvbnN0IGNodW5rU2l6ZSA9IDc7XHJcbiAgIGxldCBjdXJyZW50U3RhcnQgPSBzdGFydE9mRGF5KHN0YXJ0RGF0ZSk7XHJcbiAgIGNvbnN0IG1heERhdGUgPSBhZGREYXlzKGN1cnJlbnRTdGFydCwgZGF5c1RvU2Nhbik7XHJcbiAgIFxyXG4gICB3aGlsZSAoaXNCZWZvcmUoY3VycmVudFN0YXJ0LCBtYXhEYXRlKSAmJiBmb3VuZFNsb3RzLmxlbmd0aCA8IGxpbWl0KSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRFbmQgPSBhZGREYXlzKGN1cnJlbnRTdGFydCwgY2h1bmtTaXplKTtcclxuICAgICAgLy8gRmV0Y2ggNyBkYXlzIG9mIGRhdGFcclxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZldGNoQXZhaWxhYmlsaXR5RGF0YShkYiwgdGVuYW50SWQsIGN1cnJlbnRTdGFydCwgY3VycmVudEVuZCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBQcm9jZXNzIGVhY2ggZGF5XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2h1bmtTaXplOyBpKyspIHtcclxuICAgICAgICAgY29uc3QgZGF5ID0gYWRkRGF5cyhjdXJyZW50U3RhcnQsIGkpO1xyXG4gICAgICAgICBpZiAoaXNBZnRlcihkYXksIG1heERhdGUpKSBicmVhaztcclxuICAgICAgICAgXHJcbiAgICAgICAgIGNvbnN0IGRhaWx5U2xvdHMgPSBjYWxjdWxhdGVEYWlseVNsb3RzKGRheSwgY29uZmlnLCBkYXRhLCB7XHJcbiAgICAgICAgICAgIGR1cmF0aW9uTWludXRlcyxcclxuICAgICAgICAgICAgbG9jYXRpb25JZCxcclxuICAgICAgICAgICAgcHJvdmlkZXJJZFxyXG4gICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgIGlmIChkYWlseVNsb3RzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm91bmRTbG90cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgZGF0ZTogZm9ybWF0KGRheSwgXCJ5eXl5LU1NLWRkXCIpLFxyXG4gICAgICAgICAgICAgICBzbG90czogZGFpbHlTbG90cy5zbGljZSgwLCA1KSAvLyBSZXR1cm4gdG9wIDUgc2xvdHMgcGVyIGRheT8gT3IganVzdCB0aGUgZGF5cz9cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgIH1cclxuXHJcbiAgICAgICAgIGlmIChmb3VuZFNsb3RzLmxlbmd0aCA+PSBsaW1pdCkgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgY3VycmVudFN0YXJ0ID0gY3VycmVudEVuZDtcclxuICAgfVxyXG5cclxuICAgcmV0dXJuIGZvdW5kU2xvdHM7XHJcbn1cclxuIl0sIm5hbWVzIjpbImFkZE1pbnV0ZXMiLCJmb3JtYXQiLCJpc0FmdGVyIiwiaXNCZWZvcmUiLCJzdGFydE9mRGF5IiwiYWRkRGF5cyIsImlzV2l0aGluQnVzaW5lc3NIb3VycyIsIkF2YWlsYWJpbGl0eUVycm9yIiwiRXJyb3IiLCJjb25zdHJ1Y3RvciIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJmZXRjaEF2YWlsYWJpbGl0eUNvbmZpZyIsImRiIiwidGVuYW50SWQiLCJsb2NhdGlvbklkIiwicHJvdmlkZXJJZCIsImRhdGEiLCJsb2NhdGlvbkRhdGEiLCJlcnJvciIsImxvY2F0aW9uRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJtYXliZVNpbmdsZSIsImNvbnNvbGUiLCJidXNpbmVzc0hvdXJzIiwiYnVzaW5lc3NfaG91cnMiLCJwcm92aWRlciIsInByb3ZpZGVyRXJyb3IiLCJ3YXJuIiwicHJvdlNjaGVkdWxlIiwibWV0YWRhdGEiLCJzY2hlZHVsZSIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJtb24iLCJ0dWUiLCJ3ZWQiLCJ0aHUiLCJmcmkiLCJ0aW1lWm9uZSIsInRpbWV6b25lIiwiYnVmZmVyTWludXRlcyIsImJ1ZmZlcl9taW51dGVzIiwiZmV0Y2hBdmFpbGFiaWxpdHlEYXRhIiwic3RhcnRSYW5nZSIsImVuZFJhbmdlIiwiYXBwb2ludG1lbnRzIiwiYXBwdERhdGEiLCJhcHBvaW50bWVudHNFcnJvciIsIm5lcSIsImd0ZSIsInRvSVNPU3RyaW5nIiwibHRlIiwiZSIsImJsb2NrcyIsImJsb2Nrc0RhdGEiLCJibG9ja3NFcnJvciIsImNhbGN1bGF0ZURhaWx5U2xvdHMiLCJkYXlPckRhdGVTdHIiLCJjb25maWciLCJvcHRpb25zIiwiZHVyYXRpb25NaW51dGVzIiwidGFyZ2V0RGF0ZVN0cmluZyIsInNlZWtTdGFydCIsImFuY2hvciIsIkRhdGUiLCJpc05hTiIsImdldFRpbWUiLCJzdGFydFNjYW4iLCJlbmRTY2FuIiwibm9ybWFsaXplZER1cmF0aW9uIiwiTWF0aCIsIm1heCIsIk51bWJlciIsImlzRmluaXRlIiwiaW50ZXJ2YWwiLCJub3ciLCJsb2ciLCJibG9ja2luZ0FwcG9pbnRtZW50cyIsImZpbHRlciIsImFwcHQiLCJsb2NhdGlvbl9pZCIsImJsb2NraW5nQmxvY2tzIiwiYiIsInByb3ZpZGVyX2lkIiwic2xvdHMiLCJjdXJyZW50IiwiZGF0ZUZvcm1hdHRlciIsIkludGwiLCJEYXRlVGltZUZvcm1hdCIsInllYXIiLCJtb250aCIsImRheSIsInNsb3RFbmQiLCJzbG90RGF0ZUxvY2FsIiwiaXNPcGVuIiwic3RhcnQiLCJlbmQiLCJoYXNBcHB0Q29uZmxpY3QiLCJzb21lIiwiYXBwdFN0YXJ0Iiwic3RhcnRfYXQiLCJhcHB0RW5kIiwiZW5kX2F0IiwiYnVmZmVyZWRTdGFydCIsImJ1ZmZlcmVkRW5kIiwiaGFzQmxvY2tDb25mbGljdCIsImJsb2NrIiwiYlN0YXJ0IiwiYkVuZCIsInRpbWVTdHIiLCJob3VyIiwibWludXRlIiwiaG91cjEyIiwicHVzaCIsIkFycmF5IiwiU2V0Iiwic29ydCIsImdldEF2YWlsYWJpbGl0eVNsb3RzIiwiZGF0ZSIsImZpbmROZXh0QXZhaWxhYmxlU2xvdHMiLCJmcm9tRGF0ZSIsImRheXNUb1NjYW4iLCJsaW1pdCIsInN0YXJ0RGF0ZSIsImZvdW5kU2xvdHMiLCJjaHVua1NpemUiLCJjdXJyZW50U3RhcnQiLCJtYXhEYXRlIiwiY3VycmVudEVuZCIsImkiLCJkYWlseVNsb3RzIiwic2xpY2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/availability/getSlots.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/tenant-headers.ts":
/*!**************************************!*\
  !*** ./src/server/tenant-headers.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getTenantHeaderInfo: () => (/* binding */ getTenantHeaderInfo)\n/* harmony export */ });\nconst DEV_TENANT_SLUG = process.env.NEXT_PUBLIC_DEV_TENANT_SLUG ?? \"tenant_1\";\nfunction getTenantHeaderInfo(headerBag) {\n    const slug = headerBag.get(\"x-tenant-id\");\n    const internalId = headerBag.get(\"x-tenant-internal-id\");\n    const isDevBypass =  true && slug === DEV_TENANT_SLUG;\n    return {\n        slug,\n        internalId,\n        isDevBypass\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3RlbmFudC1oZWFkZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNQSxrQkFBa0JDLFFBQVFDLEdBQUcsQ0FBQ0MsMkJBQTJCLElBQUk7QUFFNUQsU0FBU0Msb0JBQW9CQyxTQUFrQjtJQUNwRCxNQUFNQyxPQUFPRCxVQUFVRSxHQUFHLENBQUM7SUFDM0IsTUFBTUMsYUFBYUgsVUFBVUUsR0FBRyxDQUFDO0lBQ2pDLE1BQU1FLGNBQWNSLEtBQXNDLElBQUlLLFNBQVNOO0lBQ3ZFLE9BQU87UUFBRU07UUFBTUU7UUFBWUM7SUFBWTtBQUN6QyIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL3NlcnZlci90ZW5hbnQtaGVhZGVycy50cz9mYjk5Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IERFVl9URU5BTlRfU0xVRyA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0RFVl9URU5BTlRfU0xVRyA/PyBcInRlbmFudF8xXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VGVuYW50SGVhZGVySW5mbyhoZWFkZXJCYWc6IEhlYWRlcnMpIHtcclxuICBjb25zdCBzbHVnID0gaGVhZGVyQmFnLmdldChcIngtdGVuYW50LWlkXCIpO1xyXG4gIGNvbnN0IGludGVybmFsSWQgPSBoZWFkZXJCYWcuZ2V0KFwieC10ZW5hbnQtaW50ZXJuYWwtaWRcIik7XHJcbiAgY29uc3QgaXNEZXZCeXBhc3MgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJkZXZlbG9wbWVudFwiICYmIHNsdWcgPT09IERFVl9URU5BTlRfU0xVRztcclxuICByZXR1cm4geyBzbHVnLCBpbnRlcm5hbElkLCBpc0RldkJ5cGFzcyB9O1xyXG59XHJcbiJdLCJuYW1lcyI6WyJERVZfVEVOQU5UX1NMVUciLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfREVWX1RFTkFOVF9TTFVHIiwiZ2V0VGVuYW50SGVhZGVySW5mbyIsImhlYWRlckJhZyIsInNsdWciLCJnZXQiLCJpbnRlcm5hbElkIiwiaXNEZXZCeXBhc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/tenant-headers.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/tenant-routing.ts":
/*!**************************************!*\
  !*** ./src/server/tenant-routing.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findTenantByPublicIdentifier: () => (/* binding */ findTenantByPublicIdentifier),\n/* harmony export */   resolveTenantIdFromPublicIdentifier: () => (/* binding */ resolveTenantIdFromPublicIdentifier)\n/* harmony export */ });\n/* harmony import */ var _lib_supabase_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/supabase/service */ \"(rsc)/./src/lib/supabase/service.ts\");\n\nconst CACHE_TTL_MS = 5 * 60 * 1000;\nconst tenantCache = new Map();\nfunction readCache(key) {\n    if (!key) return null;\n    const cached = tenantCache.get(key);\n    if (cached && cached.expiresAt > Date.now()) {\n        return cached.tenant;\n    }\n    if (cached) {\n        tenantCache.delete(key);\n    }\n    return null;\n}\nfunction writeCache(keys, tenant) {\n    const expiresAt = Date.now() + CACHE_TTL_MS;\n    keys.forEach((key)=>{\n        if (key) {\n            tenantCache.set(key, {\n                tenant,\n                expiresAt\n            });\n        }\n    });\n}\nasync function findTenantByPublicIdentifier(params) {\n    const normalizedSlug = params.slug?.trim().toLowerCase() ?? null;\n    const normalizedDomain = params.domain?.trim().toLowerCase() ?? null;\n    const normalizedId = params.id?.trim() ?? null;\n    const cacheKeys = [\n        normalizedId ? `id:${normalizedId}` : null,\n        normalizedSlug ? `slug:${normalizedSlug}` : null,\n        normalizedDomain ? `domain:${normalizedDomain}` : null\n    ];\n    for (const key of cacheKeys){\n        const tenant = readCache(key ?? undefined);\n        if (tenant) {\n            return tenant;\n        }\n    }\n    if (!_lib_supabase_service__WEBPACK_IMPORTED_MODULE_0__.serviceClient) {\n        console.warn(\"findTenantByPublicIdentifier: service client not configured\");\n        return null;\n    }\n    const identifiers = [];\n    if (normalizedId) {\n        identifiers.push({\n            column: \"id\",\n            value: normalizedId,\n            cacheKey: `id:${normalizedId}`\n        });\n    }\n    if (normalizedSlug) {\n        identifiers.push({\n            column: \"public_slug\",\n            value: normalizedSlug,\n            cacheKey: `slug:${normalizedSlug}`\n        });\n    }\n    if (normalizedDomain) {\n        identifiers.push({\n            column: \"custom_domain\",\n            value: normalizedDomain,\n            cacheKey: `domain:${normalizedDomain}`\n        });\n    }\n    if (identifiers.length === 0) {\n        return null;\n    }\n    let query = _lib_supabase_service__WEBPACK_IMPORTED_MODULE_0__.serviceClient.from(\"agenda_tenants\").select(\"id, name, public_slug, custom_domain, public_metadata\").limit(1);\n    if (identifiers.length === 1) {\n        const identifier = identifiers[0];\n        query = query.eq(identifier.column, identifier.value);\n    } else {\n        const orFilter = identifiers.map((item)=>`${item.column}.eq.${item.value}`).join(\",\");\n        query = query.or(orFilter);\n    }\n    const { data, error } = await query.maybeSingle();\n    if (error) {\n        console.error(\"findTenantByPublicIdentifier: query failed\", error);\n        return null;\n    }\n    if (!data) {\n        return null;\n    }\n    const tenant = data;\n    writeCache([\n        `id:${tenant.id}`,\n        tenant.public_slug ? `slug:${tenant.public_slug}` : null,\n        tenant.custom_domain ? `domain:${tenant.custom_domain}` : null\n    ], tenant);\n    return tenant;\n}\nasync function resolveTenantIdFromPublicIdentifier(params) {\n    if (params.tenantId) {\n        return params.tenantId;\n    }\n    const tenant = await findTenantByPublicIdentifier({\n        slug: params.tenantSlug ?? null,\n        domain: params.domain ?? null\n    });\n    return tenant?.id ?? null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q25CO0lBRUEsTUFBTSxFQUFFSyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1aLE1BQU1hLFdBQVc7SUFFL0MsSUFBSUQsT0FBTztRQUNUcEIsUUFBUW9CLEtBQUssQ0FBQyw4Q0FBOENBO1FBQzVELE9BQU87SUFDVDtJQUVBLElBQUksQ0FBQ0QsTUFBTTtRQUNULE9BQU87SUFDVDtJQUVBLE1BQU1yQyxTQUFTcUM7SUFDZm5DLFdBQ0U7UUFDRSxDQUFDLEdBQUcsRUFBRUYsT0FBT2UsRUFBRSxDQUFDLENBQUM7UUFDakJmLE9BQU93QyxXQUFXLEdBQUcsQ0FBQyxLQUFLLEVBQUV4QyxPQUFPd0MsV0FBVyxDQUFDLENBQUMsR0FBRztRQUNwRHhDLE9BQU95QyxhQUFhLEdBQUcsQ0FBQyxPQUFPLEVBQUV6QyxPQUFPeUMsYUFBYSxDQUFDLENBQUMsR0FBRztLQUMzRCxFQUNEekM7SUFHRixPQUFPQTtBQUNUO0FBRU8sZUFBZTBDLG9DQUFvQ25DLE1BSXpEO0lBQ0MsSUFBSUEsT0FBT29DLFFBQVEsRUFBRTtRQUNuQixPQUFPcEMsT0FBT29DLFFBQVE7SUFDeEI7SUFFQSxNQUFNM0MsU0FBUyxNQUFNTSw2QkFBNkI7UUFBRUcsTUFBTUYsT0FBT3FDLFVBQVUsSUFBSTtRQUFNL0IsUUFBUU4sT0FBT00sTUFBTSxJQUFJO0lBQUs7SUFDbkgsT0FBT2IsUUFBUWUsTUFBTTtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL3NlcnZlci90ZW5hbnQtcm91dGluZy50cz8xYzRhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNlcnZpY2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Uvc2VydmljZVwiO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gXCJAL3R5cGVzL2RhdGFiYXNlXCI7XHJcblxyXG5leHBvcnQgdHlwZSBUZW5hbnRQdWJsaWNSZWNvcmQgPSBQaWNrPFxyXG4gIERhdGFiYXNlW1wicHVibGljXCJdW1wiVGFibGVzXCJdW1wiYWdlbmRhX3RlbmFudHNcIl1bXCJSb3dcIl0sXHJcbiAgXCJpZFwiIHwgXCJuYW1lXCIgfCBcInB1YmxpY19zbHVnXCIgfCBcImN1c3RvbV9kb21haW5cIiB8IFwicHVibGljX21ldGFkYXRhXCJcclxuPjtcclxuXHJcbnR5cGUgSWRlbnRpZmllciA9IHtcclxuICBjb2x1bW46IFwiaWRcIiB8IFwicHVibGljX3NsdWdcIiB8IFwiY3VzdG9tX2RvbWFpblwiO1xyXG4gIHZhbHVlOiBzdHJpbmc7XHJcbiAgY2FjaGVLZXk6IHN0cmluZztcclxufTtcclxuXHJcbmNvbnN0IENBQ0hFX1RUTF9NUyA9IDUgKiA2MCAqIDEwMDA7XHJcbmNvbnN0IHRlbmFudENhY2hlID0gbmV3IE1hcDxzdHJpbmcsIHsgdGVuYW50OiBUZW5hbnRQdWJsaWNSZWNvcmQ7IGV4cGlyZXNBdDogbnVtYmVyIH0+KCk7XHJcblxyXG5mdW5jdGlvbiByZWFkQ2FjaGUoa2V5OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKSB7XHJcbiAgaWYgKCFrZXkpIHJldHVybiBudWxsO1xyXG4gIGNvbnN0IGNhY2hlZCA9IHRlbmFudENhY2hlLmdldChrZXkpO1xyXG4gIGlmIChjYWNoZWQgJiYgY2FjaGVkLmV4cGlyZXNBdCA+IERhdGUubm93KCkpIHtcclxuICAgIHJldHVybiBjYWNoZWQudGVuYW50O1xyXG4gIH1cclxuICBpZiAoY2FjaGVkKSB7XHJcbiAgICB0ZW5hbnRDYWNoZS5kZWxldGUoa2V5KTtcclxuICB9XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHdyaXRlQ2FjaGUoa2V5czogKHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpW10sIHRlbmFudDogVGVuYW50UHVibGljUmVjb3JkKSB7XHJcbiAgY29uc3QgZXhwaXJlc0F0ID0gRGF0ZS5ub3coKSArIENBQ0hFX1RUTF9NUztcclxuICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgaWYgKGtleSkge1xyXG4gICAgICB0ZW5hbnRDYWNoZS5zZXQoa2V5LCB7IHRlbmFudCwgZXhwaXJlc0F0IH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluZFRlbmFudEJ5UHVibGljSWRlbnRpZmllcihwYXJhbXM6IHtcclxuICBpZD86IHN0cmluZyB8IG51bGw7XHJcbiAgc2x1Zz86IHN0cmluZyB8IG51bGw7XHJcbiAgZG9tYWluPzogc3RyaW5nIHwgbnVsbDtcclxufSk6IFByb21pc2U8VGVuYW50UHVibGljUmVjb3JkIHwgbnVsbD4ge1xyXG4gIGNvbnN0IG5vcm1hbGl6ZWRTbHVnID0gcGFyYW1zLnNsdWc/LnRyaW0oKS50b0xvd2VyQ2FzZSgpID8/IG51bGw7XHJcbiAgY29uc3Qgbm9ybWFsaXplZERvbWFpbiA9IHBhcmFtcy5kb21haW4/LnRyaW0oKS50b0xvd2VyQ2FzZSgpID8/IG51bGw7XHJcbiAgY29uc3Qgbm9ybWFsaXplZElkID0gcGFyYW1zLmlkPy50cmltKCkgPz8gbnVsbDtcclxuXHJcbiAgY29uc3QgY2FjaGVLZXlzID0gW1xyXG4gICAgbm9ybWFsaXplZElkID8gYGlkOiR7bm9ybWFsaXplZElkfWAgOiBudWxsLFxyXG4gICAgbm9ybWFsaXplZFNsdWcgPyBgc2x1Zzoke25vcm1hbGl6ZWRTbHVnfWAgOiBudWxsLFxyXG4gICAgbm9ybWFsaXplZERvbWFpbiA/IGBkb21haW46JHtub3JtYWxpemVkRG9tYWlufWAgOiBudWxsLFxyXG4gIF07XHJcblxyXG4gIGZvciAoY29uc3Qga2V5IG9mIGNhY2hlS2V5cykge1xyXG4gICAgY29uc3QgdGVuYW50ID0gcmVhZENhY2hlKGtleSA/PyB1bmRlZmluZWQpO1xyXG4gICAgaWYgKHRlbmFudCkge1xyXG4gICAgICByZXR1cm4gdGVuYW50O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaWYgKCFzZXJ2aWNlQ2xpZW50KSB7XHJcbiAgICBjb25zb2xlLndhcm4oXCJmaW5kVGVuYW50QnlQdWJsaWNJZGVudGlmaWVyOiBzZXJ2aWNlIGNsaWVudCBub3QgY29uZmlndXJlZFwiKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgaWRlbnRpZmllcnM6IElkZW50aWZpZXJbXSA9IFtdO1xyXG4gIGlmIChub3JtYWxpemVkSWQpIHtcclxuICAgIGlkZW50aWZpZXJzLnB1c2goeyBjb2x1bW46IFwiaWRcIiwgdmFsdWU6IG5vcm1hbGl6ZWRJZCwgY2FjaGVLZXk6IGBpZDoke25vcm1hbGl6ZWRJZH1gIH0pO1xyXG4gIH1cclxuICBpZiAobm9ybWFsaXplZFNsdWcpIHtcclxuICAgIGlkZW50aWZpZXJzLnB1c2goeyBjb2x1bW46IFwicHVibGljX3NsdWdcIiwgdmFsdWU6IG5vcm1hbGl6ZWRTbHVnLCBjYWNoZUtleTogYHNsdWc6JHtub3JtYWxpemVkU2x1Z31gIH0pO1xyXG4gIH1cclxuICBpZiAobm9ybWFsaXplZERvbWFpbikge1xyXG4gICAgaWRlbnRpZmllcnMucHVzaCh7IGNvbHVtbjogXCJjdXN0b21fZG9tYWluXCIsIHZhbHVlOiBub3JtYWxpemVkRG9tYWluLCBjYWNoZUtleTogYGRvbWFpbjoke25vcm1hbGl6ZWREb21haW59YCB9KTtcclxuICB9XHJcblxyXG4gIGlmIChpZGVudGlmaWVycy5sZW5ndGggPT09IDApIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgbGV0IHF1ZXJ5ID0gc2VydmljZUNsaWVudFxyXG4gICAgLmZyb20oXCJhZ2VuZGFfdGVuYW50c1wiKVxyXG4gICAgLnNlbGVjdChcImlkLCBuYW1lLCBwdWJsaWNfc2x1ZywgY3VzdG9tX2RvbWFpbiwgcHVibGljX21ldGFkYXRhXCIpXHJcbiAgICAubGltaXQoMSk7XHJcblxyXG4gIGlmIChpZGVudGlmaWVycy5sZW5ndGggPT09IDEpIHtcclxuICAgIGNvbnN0IGlkZW50aWZpZXIgPSBpZGVudGlmaWVyc1swXTtcclxuICAgIHF1ZXJ5ID0gcXVlcnkuZXEoaWRlbnRpZmllci5jb2x1bW4sIGlkZW50aWZpZXIudmFsdWUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCBvckZpbHRlciA9IGlkZW50aWZpZXJzLm1hcCgoaXRlbSkgPT4gYCR7aXRlbS5jb2x1bW59LmVxLiR7aXRlbS52YWx1ZX1gKS5qb2luKFwiLFwiKTtcclxuICAgIHF1ZXJ5ID0gcXVlcnkub3Iob3JGaWx0ZXIpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiZmluZFRlbmFudEJ5UHVibGljSWRlbnRpZmllcjogcXVlcnkgZmFpbGVkXCIsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFkYXRhKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIGNvbnN0IHRlbmFudCA9IGRhdGEgYXMgVGVuYW50UHVibGljUmVjb3JkO1xyXG4gIHdyaXRlQ2FjaGUoXHJcbiAgICBbXHJcbiAgICAgIGBpZDoke3RlbmFudC5pZH1gLFxyXG4gICAgICB0ZW5hbnQucHVibGljX3NsdWcgPyBgc2x1Zzoke3RlbmFudC5wdWJsaWNfc2x1Z31gIDogbnVsbCxcclxuICAgICAgdGVuYW50LmN1c3RvbV9kb21haW4gPyBgZG9tYWluOiR7dGVuYW50LmN1c3RvbV9kb21haW59YCA6IG51bGwsXHJcbiAgICBdLFxyXG4gICAgdGVuYW50LFxyXG4gICk7XHJcblxyXG4gIHJldHVybiB0ZW5hbnQ7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXNvbHZlVGVuYW50SWRGcm9tUHVibGljSWRlbnRpZmllcihwYXJhbXM6IHtcclxuICB0ZW5hbnRJZD86IHN0cmluZyB8IG51bGw7XHJcbiAgdGVuYW50U2x1Zz86IHN0cmluZyB8IG51bGw7XHJcbiAgZG9tYWluPzogc3RyaW5nIHwgbnVsbDtcclxufSk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xyXG4gIGlmIChwYXJhbXMudGVuYW50SWQpIHtcclxuICAgIHJldHVybiBwYXJhbXMudGVuYW50SWQ7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0ZW5hbnQgPSBhd2FpdCBmaW5kVGVuYW50QnlQdWJsaWNJZGVudGlmaWVyKHsgc2x1ZzogcGFyYW1zLnRlbmFudFNsdWcgPz8gbnVsbCwgZG9tYWluOiBwYXJhbXMuZG9tYWluID8/IG51bGwgfSk7XHJcbiAgcmV0dXJuIHRlbmFudD8uaWQgPz8gbnVsbDtcclxufVxyXG4iXSwibmFtZXMiOlsic2VydmljZUNsaWVudCIsIkNBQ0hFX1RUTF9NUyIsInRlbmFudENhY2hlIiwiTWFwIiwicmVhZENhY2hlIiwia2V5IiwiY2FjaGVkIiwiZ2V0IiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsInRlbmFudCIsImRlbGV0ZSIsIndyaXRlQ2FjaGUiLCJrZXlzIiwiZm9yRWFjaCIsInNldCIsImZpbmRUZW5hbnRCeVB1YmxpY0lkZW50aWZpZXIiLCJwYXJhbXMiLCJub3JtYWxpemVkU2x1ZyIsInNsdWciLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJub3JtYWxpemVkRG9tYWluIiwiZG9tYWluIiwibm9ybWFsaXplZElkIiwiaWQiLCJjYWNoZUtleXMiLCJ1bmRlZmluZWQiLCJjb25zb2xlIiwid2FybiIsImlkZW50aWZpZXJzIiwicHVzaCIsImNvbHVtbiIsInZhbHVlIiwiY2FjaGVLZXkiLCJsZW5ndGgiLCJxdWVyeSIsImZyb20iLCJzZWxlY3QiLCJsaW1pdCIsImlkZW50aWZpZXIiLCJlcSIsIm9yRmlsdGVyIiwibWFwIiwiaXRlbSIsImpvaW4iLCJvciIsImRhdGEiLCJlcnJvciIsIm1heWJlU2luZ2xlIiwicHVibGljX3NsdWciLCJjdXN0b21fZG9tYWluIiwicmVzb2x2ZVRlbmFudElkRnJvbVB1YmxpY0lkZW50aWZpZXIiLCJ0ZW5hbnRJZCIsInRlbmFudFNsdWciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/tenant-routing.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/date-fns","vendor-chunks/tslib","vendor-chunks/iceberg-js"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Favailability%2Froute&page=%2Fapi%2Fpublic%2Favailability%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Favailability%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();