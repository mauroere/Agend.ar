"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/public/availability/route";
exports.ids = ["app/api/public/availability/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Favailability%2Froute&page=%2Fapi%2Fpublic%2Favailability%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Favailability%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Favailability%2Froute&page=%2Fapi%2Fpublic%2Favailability%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Favailability%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_rementeriama_Downloads_Code_Agend_ar_src_app_api_public_availability_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/public/availability/route.ts */ \"(rsc)/./src/app/api/public/availability/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/public/availability/route\",\n        pathname: \"/api/public/availability\",\n        filename: \"route\",\n        bundlePath: \"app/api/public/availability/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\rementeriama\\\\Downloads\\\\Code\\\\Agend.ar\\\\src\\\\app\\\\api\\\\public\\\\availability\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_rementeriama_Downloads_Code_Agend_ar_src_app_api_public_availability_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/public/availability/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwdWJsaWMlMkZhdmFpbGFiaWxpdHklMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnB1YmxpYyUyRmF2YWlsYWJpbGl0eSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnB1YmxpYyUyRmF2YWlsYWJpbGl0eSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNyZW1lbnRlcmlhbWElNUNEb3dubG9hZHMlNUNDb2RlJTVDQWdlbmQuYXIlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q3JlbWVudGVyaWFtYSU1Q0Rvd25sb2FkcyU1Q0NvZGUlNUNBZ2VuZC5hciZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDaUQ7QUFDOUg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8/ZWRiYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxyZW1lbnRlcmlhbWFcXFxcRG93bmxvYWRzXFxcXENvZGVcXFxcQWdlbmQuYXJcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccHVibGljXFxcXGF2YWlsYWJpbGl0eVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcHVibGljL2F2YWlsYWJpbGl0eS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3B1YmxpYy9hdmFpbGFiaWxpdHlcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3B1YmxpYy9hdmFpbGFiaWxpdHkvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxyZW1lbnRlcmlhbWFcXFxcRG93bmxvYWRzXFxcXENvZGVcXFxcQWdlbmQuYXJcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccHVibGljXFxcXGF2YWlsYWJpbGl0eVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvcHVibGljL2F2YWlsYWJpbGl0eS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Favailability%2Froute&page=%2Fapi%2Fpublic%2Favailability%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Favailability%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/public/availability/route.ts":
/*!**************************************************!*\
  !*** ./src/app/api/public/availability/route.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase/service */ \"(rsc)/./src/lib/supabase/service.ts\");\n/* harmony import */ var _server_availability_getSlots__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/availability/getSlots */ \"(rsc)/./src/server/availability/getSlots.ts\");\n/* harmony import */ var _server_tenant_headers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/tenant-headers */ \"(rsc)/./src/server/tenant-headers.ts\");\n/* harmony import */ var _server_tenant_routing__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/tenant-routing */ \"(rsc)/./src/server/tenant-routing.ts\");\n\n\n\n\n\nasync function GET(request) {\n    if (!_lib_supabase_service__WEBPACK_IMPORTED_MODULE_1__.serviceClient) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Service client is not configured\"\n        }, {\n            status: 500\n        });\n    }\n    const { searchParams } = new URL(request.url);\n    const headerInfo = (0,_server_tenant_headers__WEBPACK_IMPORTED_MODULE_3__.getTenantHeaderInfo)(request.headers);\n    const tenantParam = searchParams.get(\"tenantId\");\n    const tenantSlugParam = searchParams.get(\"tenantSlug\") ?? tenantParam;\n    const tenantId = headerInfo.internalId ?? await (0,_server_tenant_routing__WEBPACK_IMPORTED_MODULE_4__.resolveTenantIdFromPublicIdentifier)({\n        tenantId: tenantParam,\n        tenantSlug: tenantSlugParam\n    });\n    const dateStr = searchParams.get(\"date\");\n    const locationId = searchParams.get(\"locationId\");\n    const durationStr = searchParams.get(\"duration\");\n    const providerId = searchParams.get(\"providerId\");\n    if (!tenantId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Tenant requerido\"\n        }, {\n            status: 400\n        });\n    }\n    if (headerInfo.internalId && headerInfo.internalId !== tenantId && !headerInfo.isDevBypass) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Tenant mismatch\"\n        }, {\n            status: 403\n        });\n    }\n    if (!dateStr || !locationId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Date and Location required\"\n        }, {\n            status: 400\n        });\n    }\n    const duration = Number.parseInt(durationStr ?? \"30\", 10);\n    try {\n        const slots = await (0,_server_availability_getSlots__WEBPACK_IMPORTED_MODULE_2__.getAvailabilitySlots)({\n            db: _lib_supabase_service__WEBPACK_IMPORTED_MODULE_1__.serviceClient,\n            tenantId,\n            date: dateStr,\n            locationId,\n            durationMinutes: duration,\n            providerId\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            slots\n        });\n    } catch (error) {\n        if (error instanceof _server_availability_getSlots__WEBPACK_IMPORTED_MODULE_2__.AvailabilityError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: error.message\n            }, {\n                status: error.status\n            });\n        }\n        console.error(\"availability.public_unexpected_error\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Error inesperado\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9wdWJsaWMvYXZhaWxhYmlsaXR5L3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUF3RDtBQUNEO0FBQ2tDO0FBQzNCO0FBQ2dCO0FBRXZFLGVBQWVNLElBQUlDLE9BQW9CO0lBQzVDLElBQUksQ0FBQ04sZ0VBQWFBLEVBQUU7UUFDbEIsT0FBT0QscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQW1DLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3hGO0lBRUEsTUFBTSxFQUFFQyxZQUFZLEVBQUUsR0FBRyxJQUFJQyxJQUFJTCxRQUFRTSxHQUFHO0lBQzVDLE1BQU1DLGFBQWFWLDJFQUFtQkEsQ0FBQ0csUUFBUVEsT0FBTztJQUN0RCxNQUFNQyxjQUFjTCxhQUFhTSxHQUFHLENBQUM7SUFDckMsTUFBTUMsa0JBQWtCUCxhQUFhTSxHQUFHLENBQUMsaUJBQWlCRDtJQUMxRCxNQUFNRyxXQUFXTCxXQUFXTSxVQUFVLElBQ2hDLE1BQU1mLDJGQUFtQ0EsQ0FBQztRQUFFYyxVQUFVSDtRQUFhSyxZQUFZSDtJQUFnQjtJQUNyRyxNQUFNSSxVQUFVWCxhQUFhTSxHQUFHLENBQUM7SUFDakMsTUFBTU0sYUFBYVosYUFBYU0sR0FBRyxDQUFDO0lBQ3BDLE1BQU1PLGNBQWNiLGFBQWFNLEdBQUcsQ0FBQztJQUNyQyxNQUFNUSxhQUFhZCxhQUFhTSxHQUFHLENBQUM7SUFFcEMsSUFBSSxDQUFDRSxVQUFVO1FBQ2IsT0FBT25CLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFtQixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUN4RTtJQUVBLElBQUlJLFdBQVdNLFVBQVUsSUFBSU4sV0FBV00sVUFBVSxLQUFLRCxZQUFZLENBQUNMLFdBQVdZLFdBQVcsRUFBRTtRQUMxRixPQUFPMUIscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWtCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3ZFO0lBRUEsSUFBSSxDQUFDWSxXQUFXLENBQUNDLFlBQVk7UUFDM0IsT0FBT3ZCLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUE2QixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUNsRjtJQUVBLE1BQU1pQixXQUFXQyxPQUFPQyxRQUFRLENBQUNMLGVBQWUsTUFBTTtJQUV0RCxJQUFJO1FBQ0YsTUFBTU0sUUFBUSxNQUFNM0IsbUZBQW9CQSxDQUFDO1lBQ3ZDNEIsSUFBSTlCLGdFQUFhQTtZQUNqQmtCO1lBQ0FhLE1BQU1WO1lBQ05DO1lBQ0FVLGlCQUFpQk47WUFDakJGO1FBQ0Y7UUFFQSxPQUFPekIscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFc0I7UUFBTTtJQUNuQyxFQUFFLE9BQU9yQixPQUFPO1FBQ2QsSUFBSUEsaUJBQWlCUCw0RUFBaUJBLEVBQUU7WUFDdEMsT0FBT0YscURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBT0EsTUFBTXlCLE9BQU87WUFBQyxHQUFHO2dCQUFFeEIsUUFBUUQsTUFBTUMsTUFBTTtZQUFDO1FBQzVFO1FBRUF5QixRQUFRMUIsS0FBSyxDQUFDLHdDQUF3Q0E7UUFDdEQsT0FBT1QscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQW1CLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3hFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9hcHAvYXBpL3B1YmxpYy9hdmFpbGFiaWxpdHkvcm91dGUudHM/MmU2OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB7IHNlcnZpY2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Uvc2VydmljZVwiO1xyXG5pbXBvcnQgeyBBdmFpbGFiaWxpdHlFcnJvciwgZ2V0QXZhaWxhYmlsaXR5U2xvdHMgfSBmcm9tIFwiQC9zZXJ2ZXIvYXZhaWxhYmlsaXR5L2dldFNsb3RzXCI7XHJcbmltcG9ydCB7IGdldFRlbmFudEhlYWRlckluZm8gfSBmcm9tIFwiQC9zZXJ2ZXIvdGVuYW50LWhlYWRlcnNcIjtcclxuaW1wb3J0IHsgcmVzb2x2ZVRlbmFudElkRnJvbVB1YmxpY0lkZW50aWZpZXIgfSBmcm9tIFwiQC9zZXJ2ZXIvdGVuYW50LXJvdXRpbmdcIjtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBpZiAoIXNlcnZpY2VDbGllbnQpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlNlcnZpY2UgY2xpZW50IGlzIG5vdCBjb25maWd1cmVkXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcclxuICBjb25zdCBoZWFkZXJJbmZvID0gZ2V0VGVuYW50SGVhZGVySW5mbyhyZXF1ZXN0LmhlYWRlcnMgYXMgSGVhZGVycyk7XHJcbiAgY29uc3QgdGVuYW50UGFyYW0gPSBzZWFyY2hQYXJhbXMuZ2V0KFwidGVuYW50SWRcIik7XHJcbiAgY29uc3QgdGVuYW50U2x1Z1BhcmFtID0gc2VhcmNoUGFyYW1zLmdldChcInRlbmFudFNsdWdcIikgPz8gdGVuYW50UGFyYW07XHJcbiAgY29uc3QgdGVuYW50SWQgPSBoZWFkZXJJbmZvLmludGVybmFsSWRcclxuICAgID8/IChhd2FpdCByZXNvbHZlVGVuYW50SWRGcm9tUHVibGljSWRlbnRpZmllcih7IHRlbmFudElkOiB0ZW5hbnRQYXJhbSwgdGVuYW50U2x1ZzogdGVuYW50U2x1Z1BhcmFtIH0pKTtcclxuICBjb25zdCBkYXRlU3RyID0gc2VhcmNoUGFyYW1zLmdldChcImRhdGVcIik7XHJcbiAgY29uc3QgbG9jYXRpb25JZCA9IHNlYXJjaFBhcmFtcy5nZXQoXCJsb2NhdGlvbklkXCIpO1xyXG4gIGNvbnN0IGR1cmF0aW9uU3RyID0gc2VhcmNoUGFyYW1zLmdldChcImR1cmF0aW9uXCIpO1xyXG4gIGNvbnN0IHByb3ZpZGVySWQgPSBzZWFyY2hQYXJhbXMuZ2V0KFwicHJvdmlkZXJJZFwiKTtcclxuXHJcbiAgaWYgKCF0ZW5hbnRJZCkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiVGVuYW50IHJlcXVlcmlkb1wiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoaGVhZGVySW5mby5pbnRlcm5hbElkICYmIGhlYWRlckluZm8uaW50ZXJuYWxJZCAhPT0gdGVuYW50SWQgJiYgIWhlYWRlckluZm8uaXNEZXZCeXBhc3MpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlRlbmFudCBtaXNtYXRjaFwiIH0sIHsgc3RhdHVzOiA0MDMgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoIWRhdGVTdHIgfHwgIWxvY2F0aW9uSWQpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkRhdGUgYW5kIExvY2F0aW9uIHJlcXVpcmVkXCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGR1cmF0aW9uID0gTnVtYmVyLnBhcnNlSW50KGR1cmF0aW9uU3RyID8/IFwiMzBcIiwgMTApO1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3Qgc2xvdHMgPSBhd2FpdCBnZXRBdmFpbGFiaWxpdHlTbG90cyh7XHJcbiAgICAgIGRiOiBzZXJ2aWNlQ2xpZW50LFxyXG4gICAgICB0ZW5hbnRJZCxcclxuICAgICAgZGF0ZTogZGF0ZVN0cixcclxuICAgICAgbG9jYXRpb25JZCxcclxuICAgICAgZHVyYXRpb25NaW51dGVzOiBkdXJhdGlvbixcclxuICAgICAgcHJvdmlkZXJJZCxcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHNsb3RzIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBBdmFpbGFiaWxpdHlFcnJvcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9LCB7IHN0YXR1czogZXJyb3Iuc3RhdHVzIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUuZXJyb3IoXCJhdmFpbGFiaWxpdHkucHVibGljX3VuZXhwZWN0ZWRfZXJyb3JcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRXJyb3IgaW5lc3BlcmFkb1wiIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJzZXJ2aWNlQ2xpZW50IiwiQXZhaWxhYmlsaXR5RXJyb3IiLCJnZXRBdmFpbGFiaWxpdHlTbG90cyIsImdldFRlbmFudEhlYWRlckluZm8iLCJyZXNvbHZlVGVuYW50SWRGcm9tUHVibGljSWRlbnRpZmllciIsIkdFVCIsInJlcXVlc3QiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJoZWFkZXJJbmZvIiwiaGVhZGVycyIsInRlbmFudFBhcmFtIiwiZ2V0IiwidGVuYW50U2x1Z1BhcmFtIiwidGVuYW50SWQiLCJpbnRlcm5hbElkIiwidGVuYW50U2x1ZyIsImRhdGVTdHIiLCJsb2NhdGlvbklkIiwiZHVyYXRpb25TdHIiLCJwcm92aWRlcklkIiwiaXNEZXZCeXBhc3MiLCJkdXJhdGlvbiIsIk51bWJlciIsInBhcnNlSW50Iiwic2xvdHMiLCJkYiIsImRhdGUiLCJkdXJhdGlvbk1pbnV0ZXMiLCJtZXNzYWdlIiwiY29uc29sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/public/availability/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/constants.ts":
/*!******************************!*\
  !*** ./src/lib/constants.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   APPOINTMENT_STATUS: () => (/* binding */ APPOINTMENT_STATUS),\n/* harmony export */   APP_TIMEZONE: () => (/* binding */ APP_TIMEZONE),\n/* harmony export */   CRON_SECRET_HEADER: () => (/* binding */ CRON_SECRET_HEADER),\n/* harmony export */   DEFAULT_SLOT_DURATION_MIN: () => (/* binding */ DEFAULT_SLOT_DURATION_MIN),\n/* harmony export */   SLOT_LOOKAHEAD_DAYS: () => (/* binding */ SLOT_LOOKAHEAD_DAYS),\n/* harmony export */   WAITLIST_LOOKAHEAD_HOURS: () => (/* binding */ WAITLIST_LOOKAHEAD_HOURS)\n/* harmony export */ });\nconst APP_TIMEZONE = \"America/Argentina/Buenos_Aires\";\nconst DEFAULT_SLOT_DURATION_MIN = 30;\nconst SLOT_LOOKAHEAD_DAYS = 7;\nconst WAITLIST_LOOKAHEAD_HOURS = 48;\nconst APPOINTMENT_STATUS = [\n    \"pending\",\n    \"confirmed\",\n    \"reschedule_requested\",\n    \"canceled\",\n    \"completed\",\n    \"no_show\"\n];\nconst CRON_SECRET_HEADER = \"x-cron-secret\";\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2NvbnN0YW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBTyxNQUFNQSxlQUFlLGlDQUEwQztBQUMvRCxNQUFNQyw0QkFBNEIsR0FBRztBQUNyQyxNQUFNQyxzQkFBc0IsRUFBRTtBQUM5QixNQUFNQywyQkFBMkIsR0FBRztBQUVwQyxNQUFNQyxxQkFBcUI7SUFDaEM7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0NBQ0QsQ0FBVTtBQUlKLE1BQU1DLHFCQUFxQixnQkFBZ0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9saWIvY29uc3RhbnRzLnRzP2ZiZjkiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IEFQUF9USU1FWk9ORSA9IFwiQW1lcmljYS9BcmdlbnRpbmEvQnVlbm9zX0FpcmVzXCIgYXMgY29uc3Q7XHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NMT1RfRFVSQVRJT05fTUlOID0gMzA7XHJcbmV4cG9ydCBjb25zdCBTTE9UX0xPT0tBSEVBRF9EQVlTID0gNztcclxuZXhwb3J0IGNvbnN0IFdBSVRMSVNUX0xPT0tBSEVBRF9IT1VSUyA9IDQ4O1xyXG5cclxuZXhwb3J0IGNvbnN0IEFQUE9JTlRNRU5UX1NUQVRVUyA9IFtcclxuICBcInBlbmRpbmdcIixcclxuICBcImNvbmZpcm1lZFwiLFxyXG4gIFwicmVzY2hlZHVsZV9yZXF1ZXN0ZWRcIixcclxuICBcImNhbmNlbGVkXCIsXHJcbiAgXCJjb21wbGV0ZWRcIixcclxuICBcIm5vX3Nob3dcIixcclxuXSBhcyBjb25zdDtcclxuXHJcbmV4cG9ydCB0eXBlIEFwcG9pbnRtZW50U3RhdHVzID0gKHR5cGVvZiBBUFBPSU5UTUVOVF9TVEFUVVMpW251bWJlcl07XHJcblxyXG5leHBvcnQgY29uc3QgQ1JPTl9TRUNSRVRfSEVBREVSID0gXCJ4LWNyb24tc2VjcmV0XCI7XHJcbiJdLCJuYW1lcyI6WyJBUFBfVElNRVpPTkUiLCJERUZBVUxUX1NMT1RfRFVSQVRJT05fTUlOIiwiU0xPVF9MT09LQUhFQURfREFZUyIsIldBSVRMSVNUX0xPT0tBSEVBRF9IT1VSUyIsIkFQUE9JTlRNRU5UX1NUQVRVUyIsIkNST05fU0VDUkVUX0hFQURFUiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/constants.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/scheduling.ts":
/*!*******************************!*\
  !*** ./src/lib/scheduling.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   calculateAvailability: () => (/* binding */ calculateAvailability),\n/* harmony export */   isWithinBusinessHours: () => (/* binding */ isWithinBusinessHours)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! __barrel_optimize__?names=addMinutes,isBefore!=!date-fns */ \"(rsc)/./node_modules/date-fns/isBefore.mjs\");\n/* harmony import */ var _barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! __barrel_optimize__?names=addMinutes,isBefore!=!date-fns */ \"(rsc)/./node_modules/date-fns/addMinutes.mjs\");\n/* harmony import */ var _lib_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/constants */ \"(rsc)/./src/lib/constants.ts\");\n\n\nfunction isWithinBusinessHours(options) {\n    const { start, end, businessHours, timeZone } = options;\n    const fmt = new Intl.DateTimeFormat(\"en-US\", {\n        timeZone,\n        weekday: \"short\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hour12: false\n    });\n    const partsStart = Object.fromEntries(fmt.formatToParts(start).map((p)=>[\n            p.type,\n            p.value\n        ]));\n    const partsEnd = Object.fromEntries(fmt.formatToParts(end).map((p)=>[\n            p.type,\n            p.value\n        ]));\n    const dayKey = (partsStart.weekday ?? \"\").slice(0, 3).toLowerCase(); // mon/tue...\n    if (dayKey !== (partsEnd.weekday ?? \"\").slice(0, 3).toLowerCase()) return false;\n    const intervals = businessHours?.[dayKey];\n    if (!intervals || intervals.length === 0) return false;\n    const toMinutes = (h, m)=>Number(h) * 60 + Number(m);\n    const startMinutes = toMinutes(partsStart.hour ?? \"0\", partsStart.minute ?? \"0\");\n    const endMinutes = toMinutes(partsEnd.hour ?? \"0\", partsEnd.minute ?? \"0\");\n    return intervals.some(([from, to])=>{\n        const [fh, fm] = from.split(\":\");\n        const [th, tm] = to.split(\":\");\n        const fromM = toMinutes(fh, fm);\n        const toM = toMinutes(th, tm);\n        return startMinutes >= fromM && endMinutes <= toM;\n    });\n}\nfunction calculateAvailability({ start, end, appointments, durationMinutes = _lib_constants__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SLOT_DURATION_MIN, bufferMinutes = 0 }) {\n    const slots = [];\n    let cursor = new Date(start);\n    while((0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_1__.isBefore)((0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__.addMinutes)(cursor, durationMinutes), end)){\n        const candidateEnd = (0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__.addMinutes)(cursor, durationMinutes);\n        const overlaps = appointments.some((appt)=>{\n            const apptStart = new Date(appt.start_at);\n            const apptEnd = new Date(appt.end_at);\n            return cursor < apptEnd && candidateEnd > apptStart;\n        });\n        if (!overlaps) {\n            slots.push({\n                start: new Date(cursor),\n                end: candidateEnd\n            });\n        }\n        cursor = (0,_barrel_optimize_names_addMinutes_isBefore_date_fns__WEBPACK_IMPORTED_MODULE_2__.addMinutes)(cursor, durationMinutes + bufferMinutes);\n    }\n    return slots;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LWFwcC8uL3NyYy9saWIvc2NoZWR1bGluZy50cz8zZWYzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFkZE1pbnV0ZXMsIGlzQmVmb3JlIH0gZnJvbSBcImRhdGUtZm5zXCI7XHJcbmltcG9ydCB7IERFRkFVTFRfU0xPVF9EVVJBVElPTl9NSU4gfSBmcm9tIFwiQC9saWIvY29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSBcIkAvdHlwZXMvZGF0YWJhc2VcIjtcclxuXHJcbmV4cG9ydCB0eXBlIEFwcG9pbnRtZW50Um93ID0gRGF0YWJhc2VbXCJwdWJsaWNcIl1bXCJUYWJsZXNcIl1bXCJhZ2VuZGFfYXBwb2ludG1lbnRzXCJdW1wiUm93XCJdO1xyXG5cclxudHlwZSBCdXNpbmVzc0hvdXJzID0gUmVjb3JkPHN0cmluZywgW3N0cmluZywgc3RyaW5nXVtdPjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1dpdGhpbkJ1c2luZXNzSG91cnMob3B0aW9uczoge1xyXG4gIHN0YXJ0OiBEYXRlO1xyXG4gIGVuZDogRGF0ZTtcclxuICBidXNpbmVzc0hvdXJzOiBCdXNpbmVzc0hvdXJzO1xyXG4gIHRpbWVab25lOiBzdHJpbmc7XHJcbn0pIHtcclxuICBjb25zdCB7IHN0YXJ0LCBlbmQsIGJ1c2luZXNzSG91cnMsIHRpbWVab25lIH0gPSBvcHRpb25zO1xyXG4gIGNvbnN0IGZtdCA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KFwiZW4tVVNcIiwge1xyXG4gICAgdGltZVpvbmUsXHJcbiAgICB3ZWVrZGF5OiBcInNob3J0XCIsXHJcbiAgICBob3VyOiBcIjItZGlnaXRcIixcclxuICAgIG1pbnV0ZTogXCIyLWRpZ2l0XCIsXHJcbiAgICBob3VyMTI6IGZhbHNlLFxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBwYXJ0c1N0YXJ0ID0gT2JqZWN0LmZyb21FbnRyaWVzKGZtdC5mb3JtYXRUb1BhcnRzKHN0YXJ0KS5tYXAoKHApID0+IFtwLnR5cGUsIHAudmFsdWVdKSk7XHJcbiAgY29uc3QgcGFydHNFbmQgPSBPYmplY3QuZnJvbUVudHJpZXMoZm10LmZvcm1hdFRvUGFydHMoZW5kKS5tYXAoKHApID0+IFtwLnR5cGUsIHAudmFsdWVdKSk7XHJcblxyXG4gIGNvbnN0IGRheUtleSA9IChwYXJ0c1N0YXJ0LndlZWtkYXkgPz8gXCJcIikuc2xpY2UoMCwgMykudG9Mb3dlckNhc2UoKTsgLy8gbW9uL3R1ZS4uLlxyXG4gIGlmIChkYXlLZXkgIT09IChwYXJ0c0VuZC53ZWVrZGF5ID8/IFwiXCIpLnNsaWNlKDAsIDMpLnRvTG93ZXJDYXNlKCkpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgY29uc3QgaW50ZXJ2YWxzID0gYnVzaW5lc3NIb3Vycz8uW2RheUtleV07XHJcbiAgaWYgKCFpbnRlcnZhbHMgfHwgaW50ZXJ2YWxzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICBjb25zdCB0b01pbnV0ZXMgPSAoaDogc3RyaW5nLCBtOiBzdHJpbmcpID0+IE51bWJlcihoKSAqIDYwICsgTnVtYmVyKG0pO1xyXG4gIGNvbnN0IHN0YXJ0TWludXRlcyA9IHRvTWludXRlcyhwYXJ0c1N0YXJ0LmhvdXIgPz8gXCIwXCIsIHBhcnRzU3RhcnQubWludXRlID8/IFwiMFwiKTtcclxuICBjb25zdCBlbmRNaW51dGVzID0gdG9NaW51dGVzKHBhcnRzRW5kLmhvdXIgPz8gXCIwXCIsIHBhcnRzRW5kLm1pbnV0ZSA/PyBcIjBcIik7XHJcblxyXG4gIHJldHVybiBpbnRlcnZhbHMuc29tZSgoW2Zyb20sIHRvXSkgPT4ge1xyXG4gICAgY29uc3QgW2ZoLCBmbV0gPSBmcm9tLnNwbGl0KFwiOlwiKTtcclxuICAgIGNvbnN0IFt0aCwgdG1dID0gdG8uc3BsaXQoXCI6XCIpO1xyXG4gICAgY29uc3QgZnJvbU0gPSB0b01pbnV0ZXMoZmgsIGZtKTtcclxuICAgIGNvbnN0IHRvTSA9IHRvTWludXRlcyh0aCwgdG0pO1xyXG4gICAgcmV0dXJuIHN0YXJ0TWludXRlcyA+PSBmcm9tTSAmJiBlbmRNaW51dGVzIDw9IHRvTTtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUF2YWlsYWJpbGl0eSh7XHJcbiAgc3RhcnQsXHJcbiAgZW5kLFxyXG4gIGFwcG9pbnRtZW50cyxcclxuICBkdXJhdGlvbk1pbnV0ZXMgPSBERUZBVUxUX1NMT1RfRFVSQVRJT05fTUlOLFxyXG4gIGJ1ZmZlck1pbnV0ZXMgPSAwLFxyXG59OiB7XHJcbiAgc3RhcnQ6IERhdGU7XHJcbiAgZW5kOiBEYXRlO1xyXG4gIGFwcG9pbnRtZW50czogQXBwb2ludG1lbnRSb3dbXTtcclxuICBkdXJhdGlvbk1pbnV0ZXM/OiBudW1iZXI7XHJcbiAgYnVmZmVyTWludXRlcz86IG51bWJlcjtcclxufSkge1xyXG4gIGNvbnN0IHNsb3RzOiB7IHN0YXJ0OiBEYXRlOyBlbmQ6IERhdGUgfVtdID0gW107XHJcbiAgbGV0IGN1cnNvciA9IG5ldyBEYXRlKHN0YXJ0KTtcclxuXHJcbiAgd2hpbGUgKGlzQmVmb3JlKGFkZE1pbnV0ZXMoY3Vyc29yLCBkdXJhdGlvbk1pbnV0ZXMpLCBlbmQpKSB7XHJcbiAgICBjb25zdCBjYW5kaWRhdGVFbmQgPSBhZGRNaW51dGVzKGN1cnNvciwgZHVyYXRpb25NaW51dGVzKTtcclxuICAgIGNvbnN0IG92ZXJsYXBzID0gYXBwb2ludG1lbnRzLnNvbWUoKGFwcHQpID0+IHtcclxuICAgICAgY29uc3QgYXBwdFN0YXJ0ID0gbmV3IERhdGUoYXBwdC5zdGFydF9hdCk7XHJcbiAgICAgIGNvbnN0IGFwcHRFbmQgPSBuZXcgRGF0ZShhcHB0LmVuZF9hdCk7XHJcbiAgICAgIHJldHVybiBjdXJzb3IgPCBhcHB0RW5kICYmIGNhbmRpZGF0ZUVuZCA+IGFwcHRTdGFydDtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghb3ZlcmxhcHMpIHtcclxuICAgICAgc2xvdHMucHVzaCh7IHN0YXJ0OiBuZXcgRGF0ZShjdXJzb3IpLCBlbmQ6IGNhbmRpZGF0ZUVuZCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjdXJzb3IgPSBhZGRNaW51dGVzKGN1cnNvciwgZHVyYXRpb25NaW51dGVzICsgYnVmZmVyTWludXRlcyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc2xvdHM7XHJcbn1cclxuIl0sIm5hbWVzIjpbImFkZE1pbnV0ZXMiLCJpc0JlZm9yZSIsIkRFRkFVTFRfU0xPVF9EVVJBVElPTl9NSU4iLCJpc1dpdGhpbkJ1c2luZXNzSG91cnMiLCJvcHRpb25zIiwic3RhcnQiLCJlbmQiLCJidXNpbmVzc0hvdXJzIiwidGltZVpvbmUiLCJmbXQiLCJJbnRsIiwiRGF0ZVRpbWVGb3JtYXQiLCJ3ZWVrZGF5IiwiaG91ciIsIm1pbnV0ZSIsImhvdXIxMiIsInBhcnRzU3RhcnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImZvcm1hdFRvUGFydHMiLCJtYXAiLCJwIiwidHlwZSIsInZhbHVlIiwicGFydHNFbmQiLCJkYXlLZXkiLCJzbGljZSIsInRvTG93ZXJDYXNlIiwiaW50ZXJ2YWxzIiwibGVuZ3RoIiwidG9NaW51dGVzIiwiaCIsIm0iLCJOdW1iZXIiLCJzdGFydE1pbnV0ZXMiLCJlbmRNaW51dGVzIiwic29tZSIsImZyb20iLCJ0byIsImZoIiwiZm0iLCJzcGxpdCIsInRoIiwidG0iLCJmcm9tTSIsInRvTSIsImNhbGN1bGF0ZUF2YWlsYWJpbGl0eSIsImFwcG9pbnRtZW50cyIsImR1cmF0aW9uTWludXRlcyIsImJ1ZmZlck1pbnV0ZXMiLCJzbG90cyIsImN1cnNvciIsIkRhdGUiLCJjYW5kaWRhdGVFbmQiLCJvdmVybGFwcyIsImFwcHQiLCJhcHB0U3RhcnQiLCJzdGFydF9hdCIsImFwcHRFbmQiLCJlbmRfYXQiLCJwdXNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/scheduling.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase/service.ts":
/*!*************************************!*\
  !*** ./src/lib/supabase/service.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   serviceClient: () => (/* binding */ serviceClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n\nconst url = \"https://oaxielrsiogvnxradtsw.supabase.co\";\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!url || !serviceKey) {\n    console.warn(\"Supabase service client is not fully configured.\");\n}\nconst serviceClient = url && serviceKey ? (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, serviceKey, {\n    auth: {\n        persistSession: false\n    }\n}) : null;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlL3NlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBcUQ7QUFHckQsTUFBTUMsTUFBTUMsMENBQW9DO0FBQ2hELE1BQU1HLGFBQWFILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRXhELElBQUksQ0FBQ0wsT0FBTyxDQUFDSSxZQUFZO0lBQ3ZCRSxRQUFRQyxJQUFJLENBQUM7QUFDZjtBQUVPLE1BQU1DLGdCQUFnQlIsT0FBT0ksYUFDaENMLG1FQUFZQSxDQUFXQyxLQUFLSSxZQUFZO0lBQ3RDSyxNQUFNO1FBQUVDLGdCQUFnQjtJQUFNO0FBQ2hDLEtBQ0EsS0FBSyIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL2xpYi9zdXBhYmFzZS9zZXJ2aWNlLnRzP2MyMGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gXCJAL3R5cGVzL2RhdGFiYXNlXCI7XHJcblxyXG5jb25zdCB1cmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XHJcbmNvbnN0IHNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZO1xyXG5cclxuaWYgKCF1cmwgfHwgIXNlcnZpY2VLZXkpIHtcclxuICBjb25zb2xlLndhcm4oXCJTdXBhYmFzZSBzZXJ2aWNlIGNsaWVudCBpcyBub3QgZnVsbHkgY29uZmlndXJlZC5cIik7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzZXJ2aWNlQ2xpZW50ID0gdXJsICYmIHNlcnZpY2VLZXlcclxuICA/IGNyZWF0ZUNsaWVudDxEYXRhYmFzZT4odXJsLCBzZXJ2aWNlS2V5LCB7XHJcbiAgICAgIGF1dGg6IHsgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0sXHJcbiAgICB9KVxyXG4gIDogbnVsbDtcclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImNvbnNvbGUiLCJ3YXJuIiwic2VydmljZUNsaWVudCIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase/service.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/availability/getSlots.ts":
/*!*********************************************!*\
  !*** ./src/server/availability/getSlots.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AvailabilityError: () => (/* binding */ AvailabilityError),\n/* harmony export */   calculateDailySlots: () => (/* binding */ calculateDailySlots),\n/* harmony export */   fetchAvailabilityConfig: () => (/* binding */ fetchAvailabilityConfig),\n/* harmony export */   fetchAvailabilityData: () => (/* binding */ fetchAvailabilityData),\n/* harmony export */   findNextAvailableSlots: () => (/* binding */ findNextAvailableSlots),\n/* harmony export */   getAvailabilitySlots: () => (/* binding */ getAvailabilitySlots)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/format.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/startOfDay.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/addMinutes.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/isBefore.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/isAfter.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addMinutes,format,isAfter,isBefore,startOfDay!=!date-fns */ \"(rsc)/./node_modules/date-fns/addDays.mjs\");\n/* harmony import */ var _lib_scheduling__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/scheduling */ \"(rsc)/./src/lib/scheduling.ts\");\n\n\nclass AvailabilityError extends Error {\n    constructor(message, status = 400){\n        super(message);\n        this.status = status;\n    }\n}\n// --- Core Helper Functions ---\n/**\r\n * 1. Fetch Configuration (Location Settings + Provider Schedule Override)\r\n */ async function fetchAvailabilityConfig(db, tenantId, locationId, providerId) {\n    const { data: locationData, error: locationError } = await db.from(\"agenda_locations\").select(\"business_hours, timezone, buffer_minutes\").eq(\"tenant_id\", tenantId).eq(\"id\", locationId).maybeSingle();\n    if (locationError) {\n        console.error(\"[getSlots] fetchAvailabilityConfig Error:\", locationError);\n        throw new AvailabilityError(`Location Error: ${locationError.message}`, 400);\n    }\n    if (!locationData) throw new AvailabilityError(\"Consultorio no encontrado\", 404);\n    let businessHours = locationData.business_hours ?? {};\n    if (providerId) {\n        const { data: provider, error: providerError } = await db.from(\"agenda_providers\").select(\"metadata\").eq(\"id\", providerId).maybeSingle();\n        if (providerError) {\n            console.warn(\"[getSlots] Provider Fetch Error:\", providerError);\n        }\n        const provSchedule = provider?.metadata?.schedule;\n        if (provSchedule && Object.keys(provSchedule).length > 0) {\n            businessHours = provSchedule;\n        }\n    }\n    // Fallback default hours if empty\n    if (Object.keys(businessHours).length === 0) {\n        businessHours = {\n            mon: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            tue: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            wed: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            thu: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ],\n            fri: [\n                [\n                    \"09:00\",\n                    \"18:00\"\n                ]\n            ]\n        };\n    }\n    // Ensure \"today\" check handles timezone diffs gracefully\n    // We use the start of day of the TARGET date and compare to \"now\"\n    // If target date is today, we filter past slots.\n    return {\n        businessHours,\n        timeZone: locationData.timezone ?? \"America/Argentina/Buenos_Aires\",\n        bufferMinutes: locationData.buffer_minutes ?? 0\n    };\n}\n/**\r\n * 2. Fetch Data (Appointments + Blocks) for a specific Date Range\r\n */ async function fetchAvailabilityData(db, tenantId, startRange, endRange) {\n    // Fetch Appointments\n    let appointments = [];\n    try {\n        // 2026-01-08: REMOVED provider_id selection temporarily if column is missing\n        const { data: apptData, error: appointmentsError } = await db.from(\"agenda_appointments\").select(\"start_at, end_at, location_id\") // Removed provider_id\n        .eq(\"tenant_id\", tenantId).neq(\"status\", \"canceled\").gte(\"end_at\", startRange.toISOString()).lte(\"start_at\", endRange.toISOString());\n        if (appointmentsError) {\n            console.error(\"[getSlots] Appointments Fetch Error:\", appointmentsError);\n        // Fallback for missing column?\n        } else {\n            appointments = apptData ?? [];\n        }\n    } catch (e) {\n        console.error(\"[getSlots] Appointments Unexpected Error:\", e);\n    }\n    // Fetch Blocks\n    let blocks = [];\n    try {\n        const { data: blocksData, error: blocksError } = await db.from(\"agenda_availability_blocks\").select(\"start_at, end_at, provider_id\").eq(\"tenant_id\", tenantId).gte(\"end_at\", startRange.toISOString()).lte(\"start_at\", endRange.toISOString());\n        if (blocksError) {\n            console.warn(\"[getSlots] Blocks Fetch Error:\", blocksError);\n        } else {\n            blocks = blocksData ?? [];\n        }\n    } catch (e) {\n        console.warn(\"Availability blocks table might be missing or error\", e);\n    }\n    return {\n        appointments: appointments ?? [],\n        blocks\n    };\n}\n/**\r\n * 3. Calculate Slots for a Single Day\r\n */ function calculateDailySlots(dayOrDateStr, config, data, options) {\n    const { businessHours, timeZone, bufferMinutes } = config;\n    const { appointments, blocks } = data;\n    const { durationMinutes, locationId, providerId } = options;\n    // Determine the Target Date String (YYYY-MM-DD) for filtering\n    let targetDateString;\n    let seekStart;\n    if (typeof dayOrDateStr === \"string\") {\n        targetDateString = dayOrDateStr;\n        // Anchor at UTC noon to avoid edge cases, then scan +/- 24h\n        const anchor = new Date(`${dayOrDateStr}T12:00:00Z`);\n        if (isNaN(anchor.getTime())) {\n            // Fallback\n            targetDateString = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_1__.format)(new Date(), \"yyyy-MM-dd\");\n            seekStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__.startOfDay)(new Date());\n        } else {\n            seekStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(anchor, -12 * 60);\n        }\n    } else {\n        targetDateString = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_1__.format)(dayOrDateStr, \"yyyy-MM-dd\");\n        seekStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__.startOfDay)(dayOrDateStr);\n    }\n    // Scan window: 48 hours to be safe covering all timezones\n    // We strictly filter by \"Does this slot fall on targetDateString in targetTimeZone?\"\n    const startScan = typeof dayOrDateStr === \"string\" ? (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(new Date(`${targetDateString}T00:00:00Z`), -12 * 60) : (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__.startOfDay)(dayOrDateStr);\n    const endScan = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(startScan, 48 * 60);\n    const normalizedDuration = Math.max(5, Number.isFinite(durationMinutes) ? durationMinutes : 30);\n    const interval = 15;\n    const now = new Date();\n    console.log(`[Slots] Calc for ${targetDateString}. Scan: ${startScan.toISOString()} -> ${endScan.toISOString()}. TZ: ${timeZone}`);\n    // Pre-filter blockers for performance\n    const blockingAppointments = appointments.filter((appt)=>{\n        // If provider_id is missing from fetch, we can't filter by it.\n        // Assume appointments block the location unless we can prove otherwise.\n        /* \r\n    if (providerId) {\r\n      if (appt.provider_id === providerId) return true;\r\n      if (!appt.provider_id && appt.location_id === locationId) return true;\r\n      return false;\r\n    }\r\n    */ // Fallback: If appt is in this location, it blocks.\n        return appt.location_id === locationId;\n    });\n    const blockingBlocks = blocks.filter((b)=>{\n        if (!b.provider_id) return true;\n        if (providerId) return b.provider_id === providerId;\n        return false;\n    });\n    const slots = [];\n    let current = startScan;\n    // Intl formatter for checking the \"Local Date\" of the slot\n    const dateFormatter = new Intl.DateTimeFormat(\"en-CA\", {\n        timeZone,\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\"\n    });\n    while((0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_4__.isBefore)(current, endScan)){\n        const slotEnd = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(current, normalizedDuration);\n        // 1. Check if 'current' is actually on the target day in the requested timezone\n        let slotDateLocal;\n        try {\n            slotDateLocal = dateFormatter.format(current);\n        } catch (e) {\n            console.error(\"Intl Error\", e);\n            current = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(current, interval);\n            continue;\n        }\n        if (slotDateLocal !== targetDateString) {\n            // Skip slots not belonging to the requested day\n            current = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(current, interval);\n            continue;\n        }\n        // 2. Check Business Hours\n        const isOpen = (0,_lib_scheduling__WEBPACK_IMPORTED_MODULE_0__.isWithinBusinessHours)({\n            start: current,\n            end: slotEnd,\n            businessHours,\n            timeZone\n        });\n        if (isOpen) {\n            // 3. Check Conflicts\n            const hasApptConflict = blockingAppointments.some((appt)=>{\n                const apptStart = new Date(appt.start_at);\n                const apptEnd = new Date(appt.end_at);\n                const bufferedStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(apptStart, -bufferMinutes);\n                const bufferedEnd = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(apptEnd, bufferMinutes);\n                return current < bufferedEnd && slotEnd > bufferedStart;\n            });\n            const hasBlockConflict = blockingBlocks.some((block)=>{\n                const bStart = new Date(block.start_at);\n                const bEnd = new Date(block.end_at);\n                return current < bEnd && slotEnd > bStart;\n            });\n            if (!hasApptConflict && !hasBlockConflict) {\n                // STRICTLY disallow past slots relative to Server Time (UTC)\n                // If today is target day, hide past hours.\n                // We use 'now' (UTC).\n                if ((0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_5__.isAfter)(current, now)) {\n                    // Push time in HH:mm format. \n                    // Note: format(current, \"HH:mm\") uses Local System Time formatting by default unless we pass options?\n                    // Wait, format() from date-fns follows the Date object's values which are based on system time if inspected via getters, \n                    // but 'current' is a Date object.\n                    // If we want HH:mm in the TARGET timezone, we must use Intl or formatInTimeZone.\n                    // Let's use Intl to ensure HH:mm matches the business hours check.\n                    const timeStr = new Intl.DateTimeFormat(\"en-GB\", {\n                        timeZone,\n                        hour: \"2-digit\",\n                        minute: \"2-digit\",\n                        hour12: false\n                    }).format(current);\n                    slots.push(timeStr);\n                }\n            }\n        }\n        current = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(current, interval);\n    }\n    // Deduplicate and Sort\n    return Array.from(new Set(slots)).sort();\n}\n// --- Main Exported Functions ---\nasync function getAvailabilitySlots(options) {\n    const { db, tenantId, date, locationId, durationMinutes, providerId } = options;\n    if (!date || !locationId) throw new AvailabilityError(\"Date and location required\", 400);\n    // 1. Config\n    const config = await fetchAvailabilityConfig(db, tenantId, locationId, providerId);\n    // 2. Data Scan Range\n    // We fetch a wide range to cover potential timezone shifts (UTC-12 to UTC+14)\n    // Anchor at UTC noon of the target string\n    const anchor = new Date(`${date}T12:00:00Z`);\n    if (isNaN(anchor.getTime())) throw new AvailabilityError(\"Invalid date format (YYYY-MM-DD required)\", 400);\n    const startRange = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(anchor, -24 * 60);\n    const endRange = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_3__.addMinutes)(anchor, 48 * 60);\n    const data = await fetchAvailabilityData(db, tenantId, startRange, endRange);\n    // 3. Calculate passing the string to ensure timezone-aware filtering\n    return calculateDailySlots(date, config, data, {\n        durationMinutes,\n        locationId,\n        providerId\n    });\n}\n/**\r\n * New: Suggest upcoming slots\r\n */ async function findNextAvailableSlots(options) {\n    const { db, tenantId, fromDate, locationId, durationMinutes, providerId, daysToScan = 14, limit = 5 } = options;\n    const startDate = new Date(fromDate);\n    if (!Number.isFinite(startDate.getTime())) throw new AvailabilityError(\"Invalid date\", 400);\n    // 1. Config (Once)\n    const config = await fetchAvailabilityConfig(db, tenantId, locationId, providerId);\n    // 2. Loop in chunks (e.g. 7 days) until we find 'limit' slots or 'daysToScan' is exhausted\n    const foundSlots = [];\n    const chunkSize = 7;\n    let currentStart = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_2__.startOfDay)(startDate);\n    const maxDate = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_6__.addDays)(currentStart, daysToScan);\n    while((0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_4__.isBefore)(currentStart, maxDate) && foundSlots.length < limit){\n        const currentEnd = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_6__.addDays)(currentStart, chunkSize);\n        // Fetch 7 days of data\n        const data = await fetchAvailabilityData(db, tenantId, currentStart, currentEnd);\n        // Process each day\n        for(let i = 0; i < chunkSize; i++){\n            const day = (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_6__.addDays)(currentStart, i);\n            if ((0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_5__.isAfter)(day, maxDate)) break;\n            const dailySlots = calculateDailySlots(day, config, data, {\n                durationMinutes,\n                locationId,\n                providerId\n            });\n            if (dailySlots.length > 0) {\n                foundSlots.push({\n                    date: (0,_barrel_optimize_names_addDays_addMinutes_format_isAfter_isBefore_startOfDay_date_fns__WEBPACK_IMPORTED_MODULE_1__.format)(day, \"yyyy-MM-dd\"),\n                    slots: dailySlots.slice(0, 5) // Return top 5 slots per day? Or just the days?\n                });\n            }\n            if (foundSlots.length >= limit) break;\n        }\n        currentStart = currentEnd;\n    }\n    return foundSlots;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2F2YWlsYWJpbGl0eS9nZXRTbG90cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQTZGO0FBR3BDO0FBd0JsRCxNQUFNTywwQkFBMEJDO0lBRXJDQyxZQUFZQyxPQUFlLEVBQUVDLFNBQVMsR0FBRyxDQUFFO1FBQ3pDLEtBQUssQ0FBQ0Q7UUFDTixJQUFJLENBQUNDLE1BQU0sR0FBR0E7SUFDaEI7QUFDRjtBQUlBLGdDQUFnQztBQUVoQzs7Q0FFQyxHQUNNLGVBQWVDLHdCQUNwQkMsRUFBcUIsRUFDckJDLFFBQWdCLEVBQ2hCQyxVQUFrQixFQUNsQkMsVUFBMEI7SUFFMUIsTUFBTSxFQUFFQyxNQUFNQyxZQUFZLEVBQUVDLE9BQU9DLGFBQWEsRUFBRSxHQUFHLE1BQU1QLEdBQ3hEUSxJQUFJLENBQUMsb0JBQ0xDLE1BQU0sQ0FBQyw0Q0FDUEMsRUFBRSxDQUFDLGFBQWFULFVBQ2hCUyxFQUFFLENBQUMsTUFBTVIsWUFDVFMsV0FBVztJQUVkLElBQUlKLGVBQWU7UUFDakJLLFFBQVFOLEtBQUssQ0FBQyw2Q0FBNkNDO1FBQzNELE1BQU0sSUFBSWIsa0JBQWtCLENBQUMsZ0JBQWdCLEVBQUVhLGNBQWNWLE9BQU8sQ0FBQyxDQUFDLEVBQUU7SUFDMUU7SUFDQSxJQUFJLENBQUNRLGNBQWMsTUFBTSxJQUFJWCxrQkFBa0IsNkJBQTZCO0lBRTVFLElBQUltQixnQkFBZ0IsYUFBY0MsY0FBYyxJQUEyQyxDQUFDO0lBRTVGLElBQUlYLFlBQVk7UUFDZCxNQUFNLEVBQUVDLE1BQU1XLFFBQVEsRUFBRVQsT0FBT1UsYUFBYSxFQUFFLEdBQUcsTUFBTWhCLEdBQ3BEUSxJQUFJLENBQUMsb0JBQ0xDLE1BQU0sQ0FBQyxZQUNQQyxFQUFFLENBQUMsTUFBTVAsWUFDVFEsV0FBVztRQUVkLElBQUlLLGVBQWU7WUFDZkosUUFBUUssSUFBSSxDQUFDLG9DQUFvQ0Q7UUFDckQ7UUFFQSxNQUFNRSxlQUFnQkgsVUFBVUksVUFBa0JDO1FBQ2xELElBQUlGLGdCQUFnQkcsT0FBT0MsSUFBSSxDQUFDSixjQUFjSyxNQUFNLEdBQUcsR0FBRztZQUN4RFYsZ0JBQWdCSztRQUNsQjtJQUNGO0lBRUEsa0NBQWtDO0lBQ2xDLElBQUlHLE9BQU9DLElBQUksQ0FBQ1QsZUFBZVUsTUFBTSxLQUFLLEdBQUc7UUFDM0NWLGdCQUFnQjtZQUNkVyxLQUFLO2dCQUFDO29CQUFDO29CQUFTO2lCQUFRO2FBQUM7WUFDekJDLEtBQUs7Z0JBQUM7b0JBQUM7b0JBQVM7aUJBQVE7YUFBQztZQUN6QkMsS0FBSztnQkFBQztvQkFBQztvQkFBUztpQkFBUTthQUFDO1lBQ3pCQyxLQUFLO2dCQUFDO29CQUFDO29CQUFTO2lCQUFRO2FBQUM7WUFDekJDLEtBQUs7Z0JBQUM7b0JBQUM7b0JBQVM7aUJBQVE7YUFBQztRQUMzQjtJQUNGO0lBRUEseURBQXlEO0lBQ3pELGtFQUFrRTtJQUNsRSxpREFBaUQ7SUFDakQsT0FBTztRQUNMZjtRQUNBZ0IsVUFBVXhCLGFBQWF5QixRQUFRLElBQUk7UUFDbkNDLGVBQWUxQixhQUFhMkIsY0FBYyxJQUFJO0lBQ2hEO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLGVBQWVDLHNCQUNwQmpDLEVBQXFCLEVBQ3JCQyxRQUFnQixFQUNoQmlDLFVBQWdCLEVBQ2hCQyxRQUFjO0lBRWQscUJBQXFCO0lBQ3JCLElBQUlDLGVBQXNCLEVBQUU7SUFDNUIsSUFBSTtRQUNGLDZFQUE2RTtRQUM3RSxNQUFNLEVBQUVoQyxNQUFNaUMsUUFBUSxFQUFFL0IsT0FBT2dDLGlCQUFpQixFQUFFLEdBQUcsTUFBTXRDLEdBQ3REUSxJQUFJLENBQUMsdUJBQ0xDLE1BQU0sQ0FBQyxpQ0FBaUMsc0JBQXNCO1NBQzlEQyxFQUFFLENBQUMsYUFBYVQsVUFDaEJzQyxHQUFHLENBQUMsVUFBVSxZQUNkQyxHQUFHLENBQUMsVUFBVU4sV0FBV08sV0FBVyxJQUNwQ0MsR0FBRyxDQUFDLFlBQVlQLFNBQVNNLFdBQVc7UUFFekMsSUFBSUgsbUJBQW1CO1lBQ25CMUIsUUFBUU4sS0FBSyxDQUFDLHdDQUF3Q2dDO1FBQ3RELCtCQUErQjtRQUNuQyxPQUFPO1lBQ0hGLGVBQWVDLFlBQVksRUFBRTtRQUNqQztJQUNGLEVBQUUsT0FBT00sR0FBRztRQUNSL0IsUUFBUU4sS0FBSyxDQUFDLDZDQUE2Q3FDO0lBQy9EO0lBRUEsZUFBZTtJQUNmLElBQUlDLFNBQWdCLEVBQUU7SUFDdEIsSUFBSTtRQUNGLE1BQU0sRUFBRXhDLE1BQU15QyxVQUFVLEVBQUV2QyxPQUFPd0MsV0FBVyxFQUFFLEdBQUcsTUFBTTlDLEdBQ3BEUSxJQUFJLENBQUMsOEJBQ0xDLE1BQU0sQ0FBQyxpQ0FDUEMsRUFBRSxDQUFDLGFBQWFULFVBQ2hCdUMsR0FBRyxDQUFDLFVBQVVOLFdBQVdPLFdBQVcsSUFDcENDLEdBQUcsQ0FBQyxZQUFZUCxTQUFTTSxXQUFXO1FBRXZDLElBQUlLLGFBQWE7WUFDYmxDLFFBQVFLLElBQUksQ0FBQyxrQ0FBa0M2QjtRQUNuRCxPQUFPO1lBQ0hGLFNBQVNDLGNBQWMsRUFBRTtRQUM3QjtJQUNGLEVBQUUsT0FBT0YsR0FBRztRQUNWL0IsUUFBUUssSUFBSSxDQUFDLHVEQUF1RDBCO0lBQ3RFO0lBRUEsT0FBTztRQUNMUCxjQUFjQSxnQkFBZ0IsRUFBRTtRQUNoQ1E7SUFDRjtBQUNGO0FBRUE7O0NBRUMsR0FDTSxTQUFTRyxvQkFDZEMsWUFBMkIsRUFDM0JDLE1BQTBCLEVBQzFCN0MsSUFBc0IsRUFDdEI4QyxPQUlDO0lBRUQsTUFBTSxFQUFFckMsYUFBYSxFQUFFZ0IsUUFBUSxFQUFFRSxhQUFhLEVBQUUsR0FBR2tCO0lBQ25ELE1BQU0sRUFBRWIsWUFBWSxFQUFFUSxNQUFNLEVBQUUsR0FBR3hDO0lBQ2pDLE1BQU0sRUFBRStDLGVBQWUsRUFBRWpELFVBQVUsRUFBRUMsVUFBVSxFQUFFLEdBQUcrQztJQUVwRCw4REFBOEQ7SUFDOUQsSUFBSUU7SUFDSixJQUFJQztJQUVKLElBQUksT0FBT0wsaUJBQWlCLFVBQVU7UUFDbENJLG1CQUFtQko7UUFDbkIsNERBQTREO1FBQzVELE1BQU1NLFNBQVMsSUFBSUMsS0FBSyxDQUFDLEVBQUVQLGFBQWEsVUFBVSxDQUFDO1FBQ25ELElBQUlRLE1BQU1GLE9BQU9HLE9BQU8sS0FBSztZQUN6QixXQUFXO1lBQ1hMLG1CQUFtQmhFLDZIQUFNQSxDQUFDLElBQUltRSxRQUFRO1lBQ3RDRixZQUFZOUQsaUlBQVVBLENBQUMsSUFBSWdFO1FBQy9CLE9BQU87WUFDSEYsWUFBWWxFLGlJQUFVQSxDQUFDbUUsUUFBUSxDQUFDLEtBQUs7UUFDekM7SUFDSixPQUFPO1FBQ0hGLG1CQUFtQmhFLDZIQUFNQSxDQUFDNEQsY0FBYztRQUN4Q0ssWUFBWTlELGlJQUFVQSxDQUFDeUQ7SUFDM0I7SUFFQSwwREFBMEQ7SUFDMUQscUZBQXFGO0lBQ3JGLE1BQU1VLFlBQVksT0FBT1YsaUJBQWlCLFdBQ3BDN0QsaUlBQVVBLENBQUMsSUFBSW9FLEtBQUssQ0FBQyxFQUFFSCxpQkFBaUIsVUFBVSxDQUFDLEdBQUcsQ0FBQyxLQUFHLE1BQzFEN0QsaUlBQVVBLENBQUN5RDtJQUVqQixNQUFNVyxVQUFVeEUsaUlBQVVBLENBQUN1RSxXQUFXLEtBQUs7SUFFM0MsTUFBTUUscUJBQXFCQyxLQUFLQyxHQUFHLENBQUMsR0FBR0MsT0FBT0MsUUFBUSxDQUFDYixtQkFBbUJBLGtCQUFrQjtJQUM1RixNQUFNYyxXQUFXO0lBQ2pCLE1BQU1DLE1BQU0sSUFBSVg7SUFFaEIzQyxRQUFRdUQsR0FBRyxDQUFDLENBQUMsaUJBQWlCLEVBQUVmLGlCQUFpQixRQUFRLEVBQUVNLFVBQVVqQixXQUFXLEdBQUcsSUFBSSxFQUFFa0IsUUFBUWxCLFdBQVcsR0FBRyxNQUFNLEVBQUVaLFNBQVMsQ0FBQztJQUVqSSxzQ0FBc0M7SUFDdEMsTUFBTXVDLHVCQUF1QmhDLGFBQWFpQyxNQUFNLENBQUMsQ0FBQ0M7UUFDaEQsK0RBQStEO1FBQy9ELHdFQUF3RTtRQUN4RTs7Ozs7O0lBTUEsR0FDQSxvREFBb0Q7UUFDcEQsT0FBT0EsS0FBS0MsV0FBVyxLQUFLckU7SUFDOUI7SUFFQSxNQUFNc0UsaUJBQWlCNUIsT0FBT3lCLE1BQU0sQ0FBQyxDQUFDSTtRQUNwQyxJQUFJLENBQUNBLEVBQUVDLFdBQVcsRUFBRSxPQUFPO1FBQzNCLElBQUl2RSxZQUFZLE9BQU9zRSxFQUFFQyxXQUFXLEtBQUt2RTtRQUN6QyxPQUFPO0lBQ1Q7SUFFQSxNQUFNd0UsUUFBa0IsRUFBRTtJQUMxQixJQUFJQyxVQUFVbEI7SUFFZCwyREFBMkQ7SUFDM0QsTUFBTW1CLGdCQUFnQixJQUFJQyxLQUFLQyxjQUFjLENBQUMsU0FBUztRQUNyRGxEO1FBQ0FtRCxNQUFNO1FBQ05DLE9BQU87UUFDUEMsS0FBSztJQUNQO0lBRUEsTUFBTzVGLCtIQUFRQSxDQUFDc0YsU0FBU2pCLFNBQVU7UUFDakMsTUFBTXdCLFVBQVVoRyxpSUFBVUEsQ0FBQ3lGLFNBQVNoQjtRQUVwQyxnRkFBZ0Y7UUFDaEYsSUFBSXdCO1FBQ0osSUFBSTtZQUNBQSxnQkFBZ0JQLGNBQWN6RixNQUFNLENBQUN3RjtRQUN6QyxFQUFFLE9BQU9qQyxHQUFHO1lBQ1IvQixRQUFRTixLQUFLLENBQUMsY0FBY3FDO1lBQzVCaUMsVUFBVXpGLGlJQUFVQSxDQUFDeUYsU0FBU1g7WUFDOUI7UUFDSjtRQUVBLElBQUltQixrQkFBa0JoQyxrQkFBa0I7WUFDcEMsZ0RBQWdEO1lBQ2hEd0IsVUFBVXpGLGlJQUFVQSxDQUFDeUYsU0FBU1g7WUFDOUI7UUFDSjtRQUVBLDBCQUEwQjtRQUMxQixNQUFNb0IsU0FBUzVGLHNFQUFxQkEsQ0FBQztZQUNuQzZGLE9BQU9WO1lBQ1BXLEtBQUtKO1lBQ0x0RTtZQUNBZ0I7UUFDRjtRQUVBLElBQUl3RCxRQUFRO1lBQ1YscUJBQXFCO1lBQ3JCLE1BQU1HLGtCQUFrQnBCLHFCQUFxQnFCLElBQUksQ0FBQyxDQUFDbkI7Z0JBQ2pELE1BQU1vQixZQUFZLElBQUluQyxLQUFLZSxLQUFLcUIsUUFBUTtnQkFDeEMsTUFBTUMsVUFBVSxJQUFJckMsS0FBS2UsS0FBS3VCLE1BQU07Z0JBQ3BDLE1BQU1DLGdCQUFnQjNHLGlJQUFVQSxDQUFDdUcsV0FBVyxDQUFDM0Q7Z0JBQzdDLE1BQU1nRSxjQUFjNUcsaUlBQVVBLENBQUN5RyxTQUFTN0Q7Z0JBQ3hDLE9BQU82QyxVQUFVbUIsZUFBZVosVUFBVVc7WUFDNUM7WUFFQSxNQUFNRSxtQkFBbUJ4QixlQUFlaUIsSUFBSSxDQUFDLENBQUNRO2dCQUM1QyxNQUFNQyxTQUFTLElBQUkzQyxLQUFLMEMsTUFBTU4sUUFBUTtnQkFDdEMsTUFBTVEsT0FBTyxJQUFJNUMsS0FBSzBDLE1BQU1KLE1BQU07Z0JBQ2xDLE9BQU9qQixVQUFVdUIsUUFBUWhCLFVBQVVlO1lBQ3JDO1lBRUEsSUFBSSxDQUFDVixtQkFBbUIsQ0FBQ1Esa0JBQWtCO2dCQUN6Qyw2REFBNkQ7Z0JBQzdELDJDQUEyQztnQkFDM0Msc0JBQXNCO2dCQUN0QixJQUFJM0csOEhBQU9BLENBQUN1RixTQUFTVixNQUFNO29CQUN2Qiw4QkFBOEI7b0JBQzlCLHNHQUFzRztvQkFDdEcsMEhBQTBIO29CQUMxSCxrQ0FBa0M7b0JBQ2xDLGlGQUFpRjtvQkFDakYsbUVBQW1FO29CQUNuRSxNQUFNa0MsVUFBVSxJQUFJdEIsS0FBS0MsY0FBYyxDQUFDLFNBQVM7d0JBQzdDbEQ7d0JBQ0F3RSxNQUFNO3dCQUNOQyxRQUFRO3dCQUNSQyxRQUFRO29CQUNaLEdBQUduSCxNQUFNLENBQUN3RjtvQkFFVkQsTUFBTTZCLElBQUksQ0FBQ0o7Z0JBQ2Y7WUFDRjtRQUNGO1FBQ0F4QixVQUFVekYsaUlBQVVBLENBQUN5RixTQUFTWDtJQUNoQztJQUVBLHVCQUF1QjtJQUN2QixPQUFPd0MsTUFBTWpHLElBQUksQ0FBQyxJQUFJa0csSUFBSS9CLFFBQVFnQyxJQUFJO0FBQ3hDO0FBRUEsa0NBQWtDO0FBRTNCLGVBQWVDLHFCQUFxQjFELE9BTzFDO0lBQ0MsTUFBTSxFQUFFbEQsRUFBRSxFQUFFQyxRQUFRLEVBQUU0RyxJQUFJLEVBQUUzRyxVQUFVLEVBQUVpRCxlQUFlLEVBQUVoRCxVQUFVLEVBQUUsR0FBRytDO0lBRXhFLElBQUksQ0FBQzJELFFBQVEsQ0FBQzNHLFlBQVksTUFBTSxJQUFJUixrQkFBa0IsOEJBQThCO0lBRXBGLFlBQVk7SUFDWixNQUFNdUQsU0FBUyxNQUFNbEQsd0JBQXdCQyxJQUFJQyxVQUFVQyxZQUFZQztJQUV2RSxxQkFBcUI7SUFDckIsOEVBQThFO0lBQzlFLDBDQUEwQztJQUMxQyxNQUFNbUQsU0FBUyxJQUFJQyxLQUFLLENBQUMsRUFBRXNELEtBQUssVUFBVSxDQUFDO0lBQzNDLElBQUlyRCxNQUFNRixPQUFPRyxPQUFPLEtBQUssTUFBTSxJQUFJL0Qsa0JBQWtCLDZDQUE2QztJQUV0RyxNQUFNd0MsYUFBYS9DLGlJQUFVQSxDQUFDbUUsUUFBUSxDQUFDLEtBQUs7SUFDNUMsTUFBTW5CLFdBQVdoRCxpSUFBVUEsQ0FBQ21FLFFBQVEsS0FBSztJQUV6QyxNQUFNbEQsT0FBTyxNQUFNNkIsc0JBQXNCakMsSUFBSUMsVUFBVWlDLFlBQVlDO0lBRW5FLHFFQUFxRTtJQUNyRSxPQUFPWSxvQkFBb0I4RCxNQUFNNUQsUUFBUTdDLE1BQU07UUFDN0MrQztRQUNBakQ7UUFDQUM7SUFDRjtBQUNGO0FBRUE7O0NBRUMsR0FDTSxlQUFlMkcsdUJBQXVCNUQsT0FTNUM7SUFDRSxNQUFNLEVBQUVsRCxFQUFFLEVBQUVDLFFBQVEsRUFBRThHLFFBQVEsRUFBRTdHLFVBQVUsRUFBRWlELGVBQWUsRUFBRWhELFVBQVUsRUFBRTZHLGFBQWEsRUFBRSxFQUFFQyxRQUFRLENBQUMsRUFBRSxHQUFHL0Q7SUFFeEcsTUFBTWdFLFlBQVksSUFBSTNELEtBQUt3RDtJQUMzQixJQUFJLENBQUNoRCxPQUFPQyxRQUFRLENBQUNrRCxVQUFVekQsT0FBTyxLQUFLLE1BQU0sSUFBSS9ELGtCQUFrQixnQkFBZ0I7SUFFdkYsbUJBQW1CO0lBQ25CLE1BQU11RCxTQUFTLE1BQU1sRCx3QkFBd0JDLElBQUlDLFVBQVVDLFlBQVlDO0lBRXZFLDJGQUEyRjtJQUMzRixNQUFNZ0gsYUFBdUQsRUFBRTtJQUMvRCxNQUFNQyxZQUFZO0lBQ2xCLElBQUlDLGVBQWU5SCxpSUFBVUEsQ0FBQzJIO0lBQzlCLE1BQU1JLFVBQVU5SCw4SEFBT0EsQ0FBQzZILGNBQWNMO0lBRXRDLE1BQU8xSCwrSEFBUUEsQ0FBQytILGNBQWNDLFlBQVlILFdBQVc1RixNQUFNLEdBQUcwRixNQUFPO1FBQ2xFLE1BQU1NLGFBQWEvSCw4SEFBT0EsQ0FBQzZILGNBQWNEO1FBQ3pDLHVCQUF1QjtRQUN2QixNQUFNaEgsT0FBTyxNQUFNNkIsc0JBQXNCakMsSUFBSUMsVUFBVW9ILGNBQWNFO1FBRXJFLG1CQUFtQjtRQUNuQixJQUFLLElBQUlDLElBQUksR0FBR0EsSUFBSUosV0FBV0ksSUFBSztZQUNqQyxNQUFNdEMsTUFBTTFGLDhIQUFPQSxDQUFDNkgsY0FBY0c7WUFDbEMsSUFBSW5JLDhIQUFPQSxDQUFDNkYsS0FBS29DLFVBQVU7WUFFM0IsTUFBTUcsYUFBYTFFLG9CQUFvQm1DLEtBQUtqQyxRQUFRN0MsTUFBTTtnQkFDdkQrQztnQkFDQWpEO2dCQUNBQztZQUNIO1lBRUEsSUFBSXNILFdBQVdsRyxNQUFNLEdBQUcsR0FBRztnQkFDeEI0RixXQUFXWCxJQUFJLENBQUM7b0JBQ2JLLE1BQU16SCw2SEFBTUEsQ0FBQzhGLEtBQUs7b0JBQ2xCUCxPQUFPOEMsV0FBV0MsS0FBSyxDQUFDLEdBQUcsR0FBRyxnREFBZ0Q7Z0JBQ2pGO1lBQ0g7WUFFQSxJQUFJUCxXQUFXNUYsTUFBTSxJQUFJMEYsT0FBTztRQUNuQztRQUNBSSxlQUFlRTtJQUNsQjtJQUVBLE9BQU9KO0FBQ1YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZ2VuZGFyLWFwcC8uL3NyYy9zZXJ2ZXIvYXZhaWxhYmlsaXR5L2dldFNsb3RzLnRzPzgzMDQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYWRkTWludXRlcywgZm9ybWF0LCBpc0FmdGVyLCBpc0JlZm9yZSwgc3RhcnRPZkRheSwgYWRkRGF5cywgcGFyc2UgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcclxuaW1wb3J0IHsgU3VwYWJhc2VDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XHJcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSBcIkAvdHlwZXMvZGF0YWJhc2VcIjtcclxuaW1wb3J0IHsgaXNXaXRoaW5CdXNpbmVzc0hvdXJzIH0gZnJvbSBcIkAvbGliL3NjaGVkdWxpbmdcIjtcclxuXHJcbi8vIC0tLSBUeXBlcyAtLS1cclxuXHJcbmV4cG9ydCB0eXBlIEF2YWlsYWJpbGl0eUNvbmZpZyA9IHtcclxuICBidXNpbmVzc0hvdXJzOiBSZWNvcmQ8c3RyaW5nLCBbc3RyaW5nLCBzdHJpbmddW10+O1xyXG4gIHRpbWVab25lOiBzdHJpbmc7XHJcbiAgYnVmZmVyTWludXRlczogbnVtYmVyO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgQXZhaWxhYmlsaXR5RGF0YSA9IHtcclxuICBhcHBvaW50bWVudHM6IEFycmF5PHtcclxuICAgIHN0YXJ0X2F0OiBzdHJpbmc7XHJcbiAgICBlbmRfYXQ6IHN0cmluZztcclxuICAgIHByb3ZpZGVyX2lkOiBzdHJpbmcgfCBudWxsO1xyXG4gICAgbG9jYXRpb25faWQ6IHN0cmluZztcclxuICB9PjtcclxuICBibG9ja3M6IEFycmF5PHtcclxuICAgIHN0YXJ0X2F0OiBzdHJpbmc7XHJcbiAgICBlbmRfYXQ6IHN0cmluZztcclxuICAgIHByb3ZpZGVyX2lkOiBzdHJpbmcgfCBudWxsO1xyXG4gIH0+O1xyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIEF2YWlsYWJpbGl0eUVycm9yIGV4dGVuZHMgRXJyb3Ige1xyXG4gIHN0YXR1czogbnVtYmVyO1xyXG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgc3RhdHVzID0gNDAwKSB7XHJcbiAgICBzdXBlcihtZXNzYWdlKTtcclxuICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xyXG4gIH1cclxufVxyXG5cclxudHlwZSBBbnlTdXBhYmFzZUNsaWVudCA9IFN1cGFiYXNlQ2xpZW50PERhdGFiYXNlLCBcInB1YmxpY1wiLCBhbnk+O1xyXG5cclxuLy8gLS0tIENvcmUgSGVscGVyIEZ1bmN0aW9ucyAtLS1cclxuXHJcbi8qKlxyXG4gKiAxLiBGZXRjaCBDb25maWd1cmF0aW9uIChMb2NhdGlvbiBTZXR0aW5ncyArIFByb3ZpZGVyIFNjaGVkdWxlIE92ZXJyaWRlKVxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZldGNoQXZhaWxhYmlsaXR5Q29uZmlnKFxyXG4gIGRiOiBBbnlTdXBhYmFzZUNsaWVudCxcclxuICB0ZW5hbnRJZDogc3RyaW5nLFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBwcm92aWRlcklkPzogc3RyaW5nIHwgbnVsbFxyXG4pOiBQcm9taXNlPEF2YWlsYWJpbGl0eUNvbmZpZz4ge1xyXG4gIGNvbnN0IHsgZGF0YTogbG9jYXRpb25EYXRhLCBlcnJvcjogbG9jYXRpb25FcnJvciB9ID0gYXdhaXQgZGJcclxuICAgIC5mcm9tKFwiYWdlbmRhX2xvY2F0aW9uc1wiKVxyXG4gICAgLnNlbGVjdChcImJ1c2luZXNzX2hvdXJzLCB0aW1lem9uZSwgYnVmZmVyX21pbnV0ZXNcIilcclxuICAgIC5lcShcInRlbmFudF9pZFwiLCB0ZW5hbnRJZClcclxuICAgIC5lcShcImlkXCIsIGxvY2F0aW9uSWQpXHJcbiAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgaWYgKGxvY2F0aW9uRXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJbZ2V0U2xvdHNdIGZldGNoQXZhaWxhYmlsaXR5Q29uZmlnIEVycm9yOlwiLCBsb2NhdGlvbkVycm9yKTtcclxuICAgIHRocm93IG5ldyBBdmFpbGFiaWxpdHlFcnJvcihgTG9jYXRpb24gRXJyb3I6ICR7bG9jYXRpb25FcnJvci5tZXNzYWdlfWAsIDQwMCk7XHJcbiAgfVxyXG4gIGlmICghbG9jYXRpb25EYXRhKSB0aHJvdyBuZXcgQXZhaWxhYmlsaXR5RXJyb3IoXCJDb25zdWx0b3JpbyBubyBlbmNvbnRyYWRvXCIsIDQwNCk7XHJcblxyXG4gIGxldCBidXNpbmVzc0hvdXJzID0gKGxvY2F0aW9uRGF0YS5idXNpbmVzc19ob3VycyBhcyBSZWNvcmQ8c3RyaW5nLCBbc3RyaW5nLCBzdHJpbmddW10+KSA/PyB7fTtcclxuXHJcbiAgaWYgKHByb3ZpZGVySWQpIHtcclxuICAgIGNvbnN0IHsgZGF0YTogcHJvdmlkZXIsIGVycm9yOiBwcm92aWRlckVycm9yIH0gPSBhd2FpdCBkYlxyXG4gICAgICAuZnJvbShcImFnZW5kYV9wcm92aWRlcnNcIiBhcyBhbnkpXHJcbiAgICAgIC5zZWxlY3QoXCJtZXRhZGF0YVwiKVxyXG4gICAgICAuZXEoXCJpZFwiLCBwcm92aWRlcklkKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuICAgIFxyXG4gICAgaWYgKHByb3ZpZGVyRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oXCJbZ2V0U2xvdHNdIFByb3ZpZGVyIEZldGNoIEVycm9yOlwiLCBwcm92aWRlckVycm9yKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwcm92U2NoZWR1bGUgPSAocHJvdmlkZXI/Lm1ldGFkYXRhIGFzIGFueSk/LnNjaGVkdWxlO1xyXG4gICAgaWYgKHByb3ZTY2hlZHVsZSAmJiBPYmplY3Qua2V5cyhwcm92U2NoZWR1bGUpLmxlbmd0aCA+IDApIHtcclxuICAgICAgYnVzaW5lc3NIb3VycyA9IHByb3ZTY2hlZHVsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEZhbGxiYWNrIGRlZmF1bHQgaG91cnMgaWYgZW1wdHlcclxuICBpZiAoT2JqZWN0LmtleXMoYnVzaW5lc3NIb3VycykubGVuZ3RoID09PSAwKSB7XHJcbiAgICBidXNpbmVzc0hvdXJzID0ge1xyXG4gICAgICBtb246IFtbXCIwOTowMFwiLCBcIjE4OjAwXCJdXSxcclxuICAgICAgdHVlOiBbW1wiMDk6MDBcIiwgXCIxODowMFwiXV0sXHJcbiAgICAgIHdlZDogW1tcIjA5OjAwXCIsIFwiMTg6MDBcIl1dLFxyXG4gICAgICB0aHU6IFtbXCIwOTowMFwiLCBcIjE4OjAwXCJdXSxcclxuICAgICAgZnJpOiBbW1wiMDk6MDBcIiwgXCIxODowMFwiXV0sXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gRW5zdXJlIFwidG9kYXlcIiBjaGVjayBoYW5kbGVzIHRpbWV6b25lIGRpZmZzIGdyYWNlZnVsbHlcclxuICAvLyBXZSB1c2UgdGhlIHN0YXJ0IG9mIGRheSBvZiB0aGUgVEFSR0VUIGRhdGUgYW5kIGNvbXBhcmUgdG8gXCJub3dcIlxyXG4gIC8vIElmIHRhcmdldCBkYXRlIGlzIHRvZGF5LCB3ZSBmaWx0ZXIgcGFzdCBzbG90cy5cclxuICByZXR1cm4ge1xyXG4gICAgYnVzaW5lc3NIb3VycyxcclxuICAgIHRpbWVab25lOiBsb2NhdGlvbkRhdGEudGltZXpvbmUgPz8gXCJBbWVyaWNhL0FyZ2VudGluYS9CdWVub3NfQWlyZXNcIixcclxuICAgIGJ1ZmZlck1pbnV0ZXM6IGxvY2F0aW9uRGF0YS5idWZmZXJfbWludXRlcyA/PyAwLFxyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiAyLiBGZXRjaCBEYXRhIChBcHBvaW50bWVudHMgKyBCbG9ja3MpIGZvciBhIHNwZWNpZmljIERhdGUgUmFuZ2VcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaEF2YWlsYWJpbGl0eURhdGEoXHJcbiAgZGI6IEFueVN1cGFiYXNlQ2xpZW50LFxyXG4gIHRlbmFudElkOiBzdHJpbmcsXHJcbiAgc3RhcnRSYW5nZTogRGF0ZSxcclxuICBlbmRSYW5nZTogRGF0ZVxyXG4pOiBQcm9taXNlPEF2YWlsYWJpbGl0eURhdGE+IHtcclxuICAvLyBGZXRjaCBBcHBvaW50bWVudHNcclxuICBsZXQgYXBwb2ludG1lbnRzOiBhbnlbXSA9IFtdO1xyXG4gIHRyeSB7XHJcbiAgICAvLyAyMDI2LTAxLTA4OiBSRU1PVkVEIHByb3ZpZGVyX2lkIHNlbGVjdGlvbiB0ZW1wb3JhcmlseSBpZiBjb2x1bW4gaXMgbWlzc2luZ1xyXG4gICAgY29uc3QgeyBkYXRhOiBhcHB0RGF0YSwgZXJyb3I6IGFwcG9pbnRtZW50c0Vycm9yIH0gPSBhd2FpdCBkYlxyXG4gICAgICAgIC5mcm9tKFwiYWdlbmRhX2FwcG9pbnRtZW50c1wiIGFzIGFueSlcclxuICAgICAgICAuc2VsZWN0KFwic3RhcnRfYXQsIGVuZF9hdCwgbG9jYXRpb25faWRcIikgLy8gUmVtb3ZlZCBwcm92aWRlcl9pZFxyXG4gICAgICAgIC5lcShcInRlbmFudF9pZFwiLCB0ZW5hbnRJZClcclxuICAgICAgICAubmVxKFwic3RhdHVzXCIsIFwiY2FuY2VsZWRcIilcclxuICAgICAgICAuZ3RlKFwiZW5kX2F0XCIsIHN0YXJ0UmFuZ2UudG9JU09TdHJpbmcoKSlcclxuICAgICAgICAubHRlKFwic3RhcnRfYXRcIiwgZW5kUmFuZ2UudG9JU09TdHJpbmcoKSk7XHJcblxyXG4gICAgaWYgKGFwcG9pbnRtZW50c0Vycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIltnZXRTbG90c10gQXBwb2ludG1lbnRzIEZldGNoIEVycm9yOlwiLCBhcHBvaW50bWVudHNFcnJvcik7XHJcbiAgICAgICAgLy8gRmFsbGJhY2sgZm9yIG1pc3NpbmcgY29sdW1uP1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBhcHBvaW50bWVudHMgPSBhcHB0RGF0YSA/PyBbXTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbZ2V0U2xvdHNdIEFwcG9pbnRtZW50cyBVbmV4cGVjdGVkIEVycm9yOlwiLCBlKTtcclxuICB9XHJcblxyXG4gIC8vIEZldGNoIEJsb2Nrc1xyXG4gIGxldCBibG9ja3M6IGFueVtdID0gW107XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YTogYmxvY2tzRGF0YSwgZXJyb3I6IGJsb2Nrc0Vycm9yIH0gPSBhd2FpdCBkYlxyXG4gICAgICAuZnJvbShcImFnZW5kYV9hdmFpbGFiaWxpdHlfYmxvY2tzXCIgYXMgYW55KVxyXG4gICAgICAuc2VsZWN0KFwic3RhcnRfYXQsIGVuZF9hdCwgcHJvdmlkZXJfaWRcIilcclxuICAgICAgLmVxKFwidGVuYW50X2lkXCIsIHRlbmFudElkKVxyXG4gICAgICAuZ3RlKFwiZW5kX2F0XCIsIHN0YXJ0UmFuZ2UudG9JU09TdHJpbmcoKSlcclxuICAgICAgLmx0ZShcInN0YXJ0X2F0XCIsIGVuZFJhbmdlLnRvSVNPU3RyaW5nKCkpO1xyXG4gICAgXHJcbiAgICBpZiAoYmxvY2tzRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oXCJbZ2V0U2xvdHNdIEJsb2NrcyBGZXRjaCBFcnJvcjpcIiwgYmxvY2tzRXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBibG9ja3MgPSBibG9ja3NEYXRhID8/IFtdO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUud2FybihcIkF2YWlsYWJpbGl0eSBibG9ja3MgdGFibGUgbWlnaHQgYmUgbWlzc2luZyBvciBlcnJvclwiLCBlKTtcclxuICB9XHJcblxyXG4gIHJldHVybiB7IFxyXG4gICAgYXBwb2ludG1lbnRzOiBhcHBvaW50bWVudHMgPz8gW10sIFxyXG4gICAgYmxvY2tzIFxyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiAzLiBDYWxjdWxhdGUgU2xvdHMgZm9yIGEgU2luZ2xlIERheVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZURhaWx5U2xvdHMoXHJcbiAgZGF5T3JEYXRlU3RyOiBEYXRlIHwgc3RyaW5nLFxyXG4gIGNvbmZpZzogQXZhaWxhYmlsaXR5Q29uZmlnLFxyXG4gIGRhdGE6IEF2YWlsYWJpbGl0eURhdGEsXHJcbiAgb3B0aW9uczoge1xyXG4gICAgZHVyYXRpb25NaW51dGVzOiBudW1iZXI7XHJcbiAgICBsb2NhdGlvbklkOiBzdHJpbmc7XHJcbiAgICBwcm92aWRlcklkPzogc3RyaW5nIHwgbnVsbDtcclxuICB9XHJcbik6IHN0cmluZ1tdIHtcclxuICBjb25zdCB7IGJ1c2luZXNzSG91cnMsIHRpbWVab25lLCBidWZmZXJNaW51dGVzIH0gPSBjb25maWc7XHJcbiAgY29uc3QgeyBhcHBvaW50bWVudHMsIGJsb2NrcyB9ID0gZGF0YTtcclxuICBjb25zdCB7IGR1cmF0aW9uTWludXRlcywgbG9jYXRpb25JZCwgcHJvdmlkZXJJZCB9ID0gb3B0aW9ucztcclxuICBcclxuICAvLyBEZXRlcm1pbmUgdGhlIFRhcmdldCBEYXRlIFN0cmluZyAoWVlZWS1NTS1ERCkgZm9yIGZpbHRlcmluZ1xyXG4gIGxldCB0YXJnZXREYXRlU3RyaW5nOiBzdHJpbmc7XHJcbiAgbGV0IHNlZWtTdGFydDogRGF0ZTtcclxuXHJcbiAgaWYgKHR5cGVvZiBkYXlPckRhdGVTdHIgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHRhcmdldERhdGVTdHJpbmcgPSBkYXlPckRhdGVTdHI7XHJcbiAgICAgIC8vIEFuY2hvciBhdCBVVEMgbm9vbiB0byBhdm9pZCBlZGdlIGNhc2VzLCB0aGVuIHNjYW4gKy8tIDI0aFxyXG4gICAgICBjb25zdCBhbmNob3IgPSBuZXcgRGF0ZShgJHtkYXlPckRhdGVTdHJ9VDEyOjAwOjAwWmApO1xyXG4gICAgICBpZiAoaXNOYU4oYW5jaG9yLmdldFRpbWUoKSkpIHtcclxuICAgICAgICAgIC8vIEZhbGxiYWNrXHJcbiAgICAgICAgICB0YXJnZXREYXRlU3RyaW5nID0gZm9ybWF0KG5ldyBEYXRlKCksIFwieXl5eS1NTS1kZFwiKTtcclxuICAgICAgICAgIHNlZWtTdGFydCA9IHN0YXJ0T2ZEYXkobmV3IERhdGUoKSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBzZWVrU3RhcnQgPSBhZGRNaW51dGVzKGFuY2hvciwgLTEyICogNjApOyBcclxuICAgICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICAgIHRhcmdldERhdGVTdHJpbmcgPSBmb3JtYXQoZGF5T3JEYXRlU3RyLCBcInl5eXktTU0tZGRcIik7XHJcbiAgICAgIHNlZWtTdGFydCA9IHN0YXJ0T2ZEYXkoZGF5T3JEYXRlU3RyKTtcclxuICB9XHJcblxyXG4gIC8vIFNjYW4gd2luZG93OiA0OCBob3VycyB0byBiZSBzYWZlIGNvdmVyaW5nIGFsbCB0aW1lem9uZXNcclxuICAvLyBXZSBzdHJpY3RseSBmaWx0ZXIgYnkgXCJEb2VzIHRoaXMgc2xvdCBmYWxsIG9uIHRhcmdldERhdGVTdHJpbmcgaW4gdGFyZ2V0VGltZVpvbmU/XCJcclxuICBjb25zdCBzdGFydFNjYW4gPSB0eXBlb2YgZGF5T3JEYXRlU3RyID09PSAnc3RyaW5nJyBcclxuICAgICAgPyBhZGRNaW51dGVzKG5ldyBEYXRlKGAke3RhcmdldERhdGVTdHJpbmd9VDAwOjAwOjAwWmApLCAtMTIqNjApIFxyXG4gICAgICA6IHN0YXJ0T2ZEYXkoZGF5T3JEYXRlU3RyKTtcclxuICAgICAgXHJcbiAgY29uc3QgZW5kU2NhbiA9IGFkZE1pbnV0ZXMoc3RhcnRTY2FuLCA0OCAqIDYwKTtcclxuXHJcbiAgY29uc3Qgbm9ybWFsaXplZER1cmF0aW9uID0gTWF0aC5tYXgoNSwgTnVtYmVyLmlzRmluaXRlKGR1cmF0aW9uTWludXRlcykgPyBkdXJhdGlvbk1pbnV0ZXMgOiAzMCk7XHJcbiAgY29uc3QgaW50ZXJ2YWwgPSAxNTtcclxuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICBjb25zb2xlLmxvZyhgW1Nsb3RzXSBDYWxjIGZvciAke3RhcmdldERhdGVTdHJpbmd9LiBTY2FuOiAke3N0YXJ0U2Nhbi50b0lTT1N0cmluZygpfSAtPiAke2VuZFNjYW4udG9JU09TdHJpbmcoKX0uIFRaOiAke3RpbWVab25lfWApO1xyXG4gIFxyXG4gIC8vIFByZS1maWx0ZXIgYmxvY2tlcnMgZm9yIHBlcmZvcm1hbmNlXHJcbiAgY29uc3QgYmxvY2tpbmdBcHBvaW50bWVudHMgPSBhcHBvaW50bWVudHMuZmlsdGVyKChhcHB0KSA9PiB7XHJcbiAgICAvLyBJZiBwcm92aWRlcl9pZCBpcyBtaXNzaW5nIGZyb20gZmV0Y2gsIHdlIGNhbid0IGZpbHRlciBieSBpdC5cclxuICAgIC8vIEFzc3VtZSBhcHBvaW50bWVudHMgYmxvY2sgdGhlIGxvY2F0aW9uIHVubGVzcyB3ZSBjYW4gcHJvdmUgb3RoZXJ3aXNlLlxyXG4gICAgLyogXHJcbiAgICBpZiAocHJvdmlkZXJJZCkge1xyXG4gICAgICBpZiAoYXBwdC5wcm92aWRlcl9pZCA9PT0gcHJvdmlkZXJJZCkgcmV0dXJuIHRydWU7XHJcbiAgICAgIGlmICghYXBwdC5wcm92aWRlcl9pZCAmJiBhcHB0LmxvY2F0aW9uX2lkID09PSBsb2NhdGlvbklkKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgKi9cclxuICAgIC8vIEZhbGxiYWNrOiBJZiBhcHB0IGlzIGluIHRoaXMgbG9jYXRpb24sIGl0IGJsb2Nrcy5cclxuICAgIHJldHVybiBhcHB0LmxvY2F0aW9uX2lkID09PSBsb2NhdGlvbklkO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBibG9ja2luZ0Jsb2NrcyA9IGJsb2Nrcy5maWx0ZXIoKGIpID0+IHtcclxuICAgIGlmICghYi5wcm92aWRlcl9pZCkgcmV0dXJuIHRydWU7XHJcbiAgICBpZiAocHJvdmlkZXJJZCkgcmV0dXJuIGIucHJvdmlkZXJfaWQgPT09IHByb3ZpZGVySWQ7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IHNsb3RzOiBzdHJpbmdbXSA9IFtdO1xyXG4gIGxldCBjdXJyZW50ID0gc3RhcnRTY2FuO1xyXG5cclxuICAvLyBJbnRsIGZvcm1hdHRlciBmb3IgY2hlY2tpbmcgdGhlIFwiTG9jYWwgRGF0ZVwiIG9mIHRoZSBzbG90XHJcbiAgY29uc3QgZGF0ZUZvcm1hdHRlciA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KFwiZW4tQ0FcIiwgeyAvLyBZWVlZLU1NLUREXHJcbiAgICB0aW1lWm9uZSxcclxuICAgIHllYXI6IFwibnVtZXJpY1wiLFxyXG4gICAgbW9udGg6IFwiMi1kaWdpdFwiLFxyXG4gICAgZGF5OiBcIjItZGlnaXRcIixcclxuICB9KTtcclxuXHJcbiAgd2hpbGUgKGlzQmVmb3JlKGN1cnJlbnQsIGVuZFNjYW4pKSB7XHJcbiAgICBjb25zdCBzbG90RW5kID0gYWRkTWludXRlcyhjdXJyZW50LCBub3JtYWxpemVkRHVyYXRpb24pO1xyXG5cclxuICAgIC8vIDEuIENoZWNrIGlmICdjdXJyZW50JyBpcyBhY3R1YWxseSBvbiB0aGUgdGFyZ2V0IGRheSBpbiB0aGUgcmVxdWVzdGVkIHRpbWV6b25lXHJcbiAgICBsZXQgc2xvdERhdGVMb2NhbDogc3RyaW5nO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBzbG90RGF0ZUxvY2FsID0gZGF0ZUZvcm1hdHRlci5mb3JtYXQoY3VycmVudCk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkludGwgRXJyb3JcIiwgZSk7XHJcbiAgICAgICAgY3VycmVudCA9IGFkZE1pbnV0ZXMoY3VycmVudCwgaW50ZXJ2YWwpO1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzbG90RGF0ZUxvY2FsICE9PSB0YXJnZXREYXRlU3RyaW5nKSB7XHJcbiAgICAgICAgLy8gU2tpcCBzbG90cyBub3QgYmVsb25naW5nIHRvIHRoZSByZXF1ZXN0ZWQgZGF5XHJcbiAgICAgICAgY3VycmVudCA9IGFkZE1pbnV0ZXMoY3VycmVudCwgaW50ZXJ2YWwpO1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDIuIENoZWNrIEJ1c2luZXNzIEhvdXJzXHJcbiAgICBjb25zdCBpc09wZW4gPSBpc1dpdGhpbkJ1c2luZXNzSG91cnMoe1xyXG4gICAgICBzdGFydDogY3VycmVudCxcclxuICAgICAgZW5kOiBzbG90RW5kLFxyXG4gICAgICBidXNpbmVzc0hvdXJzLFxyXG4gICAgICB0aW1lWm9uZSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChpc09wZW4pIHtcclxuICAgICAgLy8gMy4gQ2hlY2sgQ29uZmxpY3RzXHJcbiAgICAgIGNvbnN0IGhhc0FwcHRDb25mbGljdCA9IGJsb2NraW5nQXBwb2ludG1lbnRzLnNvbWUoKGFwcHQpID0+IHtcclxuICAgICAgICBjb25zdCBhcHB0U3RhcnQgPSBuZXcgRGF0ZShhcHB0LnN0YXJ0X2F0KTtcclxuICAgICAgICBjb25zdCBhcHB0RW5kID0gbmV3IERhdGUoYXBwdC5lbmRfYXQpO1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlcmVkU3RhcnQgPSBhZGRNaW51dGVzKGFwcHRTdGFydCwgLWJ1ZmZlck1pbnV0ZXMpO1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlcmVkRW5kID0gYWRkTWludXRlcyhhcHB0RW5kLCBidWZmZXJNaW51dGVzKTtcclxuICAgICAgICByZXR1cm4gY3VycmVudCA8IGJ1ZmZlcmVkRW5kICYmIHNsb3RFbmQgPiBidWZmZXJlZFN0YXJ0O1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IGhhc0Jsb2NrQ29uZmxpY3QgPSBibG9ja2luZ0Jsb2Nrcy5zb21lKChibG9jaykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGJTdGFydCA9IG5ldyBEYXRlKGJsb2NrLnN0YXJ0X2F0KTtcclxuICAgICAgICBjb25zdCBiRW5kID0gbmV3IERhdGUoYmxvY2suZW5kX2F0KTtcclxuICAgICAgICByZXR1cm4gY3VycmVudCA8IGJFbmQgJiYgc2xvdEVuZCA+IGJTdGFydDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIWhhc0FwcHRDb25mbGljdCAmJiAhaGFzQmxvY2tDb25mbGljdCkge1xyXG4gICAgICAgIC8vIFNUUklDVExZIGRpc2FsbG93IHBhc3Qgc2xvdHMgcmVsYXRpdmUgdG8gU2VydmVyIFRpbWUgKFVUQylcclxuICAgICAgICAvLyBJZiB0b2RheSBpcyB0YXJnZXQgZGF5LCBoaWRlIHBhc3QgaG91cnMuXHJcbiAgICAgICAgLy8gV2UgdXNlICdub3cnIChVVEMpLlxyXG4gICAgICAgIGlmIChpc0FmdGVyKGN1cnJlbnQsIG5vdykpIHtcclxuICAgICAgICAgICAgLy8gUHVzaCB0aW1lIGluIEhIOm1tIGZvcm1hdC4gXHJcbiAgICAgICAgICAgIC8vIE5vdGU6IGZvcm1hdChjdXJyZW50LCBcIkhIOm1tXCIpIHVzZXMgTG9jYWwgU3lzdGVtIFRpbWUgZm9ybWF0dGluZyBieSBkZWZhdWx0IHVubGVzcyB3ZSBwYXNzIG9wdGlvbnM/XHJcbiAgICAgICAgICAgIC8vIFdhaXQsIGZvcm1hdCgpIGZyb20gZGF0ZS1mbnMgZm9sbG93cyB0aGUgRGF0ZSBvYmplY3QncyB2YWx1ZXMgd2hpY2ggYXJlIGJhc2VkIG9uIHN5c3RlbSB0aW1lIGlmIGluc3BlY3RlZCB2aWEgZ2V0dGVycywgXHJcbiAgICAgICAgICAgIC8vIGJ1dCAnY3VycmVudCcgaXMgYSBEYXRlIG9iamVjdC5cclxuICAgICAgICAgICAgLy8gSWYgd2Ugd2FudCBISDptbSBpbiB0aGUgVEFSR0VUIHRpbWV6b25lLCB3ZSBtdXN0IHVzZSBJbnRsIG9yIGZvcm1hdEluVGltZVpvbmUuXHJcbiAgICAgICAgICAgIC8vIExldCdzIHVzZSBJbnRsIHRvIGVuc3VyZSBISDptbSBtYXRjaGVzIHRoZSBidXNpbmVzcyBob3VycyBjaGVjay5cclxuICAgICAgICAgICAgY29uc3QgdGltZVN0ciA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KFwiZW4tR0JcIiwgeyAvLyBISDptbVxyXG4gICAgICAgICAgICAgICAgdGltZVpvbmUsXHJcbiAgICAgICAgICAgICAgICBob3VyOiBcIjItZGlnaXRcIixcclxuICAgICAgICAgICAgICAgIG1pbnV0ZTogXCIyLWRpZ2l0XCIsXHJcbiAgICAgICAgICAgICAgICBob3VyMTI6IGZhbHNlXHJcbiAgICAgICAgICAgIH0pLmZvcm1hdChjdXJyZW50KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHNsb3RzLnB1c2godGltZVN0cik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjdXJyZW50ID0gYWRkTWludXRlcyhjdXJyZW50LCBpbnRlcnZhbCk7XHJcbiAgfVxyXG5cclxuICAvLyBEZWR1cGxpY2F0ZSBhbmQgU29ydFxyXG4gIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQoc2xvdHMpKS5zb3J0KCk7XHJcbn1cclxuXHJcbi8vIC0tLSBNYWluIEV4cG9ydGVkIEZ1bmN0aW9ucyAtLS1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdmFpbGFiaWxpdHlTbG90cyhvcHRpb25zOiB7XHJcbiAgZGI6IEFueVN1cGFiYXNlQ2xpZW50O1xyXG4gIHRlbmFudElkOiBzdHJpbmc7XHJcbiAgZGF0ZTogc3RyaW5nO1xyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZztcclxuICBkdXJhdGlvbk1pbnV0ZXM6IG51bWJlcjtcclxuICBwcm92aWRlcklkPzogc3RyaW5nIHwgbnVsbDtcclxufSkge1xyXG4gIGNvbnN0IHsgZGIsIHRlbmFudElkLCBkYXRlLCBsb2NhdGlvbklkLCBkdXJhdGlvbk1pbnV0ZXMsIHByb3ZpZGVySWQgfSA9IG9wdGlvbnM7XHJcblxyXG4gIGlmICghZGF0ZSB8fCAhbG9jYXRpb25JZCkgdGhyb3cgbmV3IEF2YWlsYWJpbGl0eUVycm9yKFwiRGF0ZSBhbmQgbG9jYXRpb24gcmVxdWlyZWRcIiwgNDAwKTtcclxuXHJcbiAgLy8gMS4gQ29uZmlnXHJcbiAgY29uc3QgY29uZmlnID0gYXdhaXQgZmV0Y2hBdmFpbGFiaWxpdHlDb25maWcoZGIsIHRlbmFudElkLCBsb2NhdGlvbklkLCBwcm92aWRlcklkKTtcclxuXHJcbiAgLy8gMi4gRGF0YSBTY2FuIFJhbmdlXHJcbiAgLy8gV2UgZmV0Y2ggYSB3aWRlIHJhbmdlIHRvIGNvdmVyIHBvdGVudGlhbCB0aW1lem9uZSBzaGlmdHMgKFVUQy0xMiB0byBVVEMrMTQpXHJcbiAgLy8gQW5jaG9yIGF0IFVUQyBub29uIG9mIHRoZSB0YXJnZXQgc3RyaW5nXHJcbiAgY29uc3QgYW5jaG9yID0gbmV3IERhdGUoYCR7ZGF0ZX1UMTI6MDA6MDBaYCk7XHJcbiAgaWYgKGlzTmFOKGFuY2hvci5nZXRUaW1lKCkpKSB0aHJvdyBuZXcgQXZhaWxhYmlsaXR5RXJyb3IoXCJJbnZhbGlkIGRhdGUgZm9ybWF0IChZWVlZLU1NLUREIHJlcXVpcmVkKVwiLCA0MDApO1xyXG5cclxuICBjb25zdCBzdGFydFJhbmdlID0gYWRkTWludXRlcyhhbmNob3IsIC0yNCAqIDYwKTsgXHJcbiAgY29uc3QgZW5kUmFuZ2UgPSBhZGRNaW51dGVzKGFuY2hvciwgNDggKiA2MCk7XHJcblxyXG4gIGNvbnN0IGRhdGEgPSBhd2FpdCBmZXRjaEF2YWlsYWJpbGl0eURhdGEoZGIsIHRlbmFudElkLCBzdGFydFJhbmdlLCBlbmRSYW5nZSk7XHJcblxyXG4gIC8vIDMuIENhbGN1bGF0ZSBwYXNzaW5nIHRoZSBzdHJpbmcgdG8gZW5zdXJlIHRpbWV6b25lLWF3YXJlIGZpbHRlcmluZ1xyXG4gIHJldHVybiBjYWxjdWxhdGVEYWlseVNsb3RzKGRhdGUsIGNvbmZpZywgZGF0YSwge1xyXG4gICAgZHVyYXRpb25NaW51dGVzLFxyXG4gICAgbG9jYXRpb25JZCxcclxuICAgIHByb3ZpZGVySWRcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIE5ldzogU3VnZ2VzdCB1cGNvbWluZyBzbG90c1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmROZXh0QXZhaWxhYmxlU2xvdHMob3B0aW9uczoge1xyXG4gIGRiOiBBbnlTdXBhYmFzZUNsaWVudDtcclxuICB0ZW5hbnRJZDogc3RyaW5nO1xyXG4gIGZyb21EYXRlOiBzdHJpbmc7XHJcbiAgbG9jYXRpb25JZDogc3RyaW5nO1xyXG4gIGR1cmF0aW9uTWludXRlczogbnVtYmVyO1xyXG4gIHByb3ZpZGVySWQ/OiBzdHJpbmcgfCBudWxsO1xyXG4gIGRheXNUb1NjYW4/OiBudW1iZXI7XHJcbiAgbGltaXQ/OiBudW1iZXI7XHJcbn0pIHtcclxuICAgY29uc3QgeyBkYiwgdGVuYW50SWQsIGZyb21EYXRlLCBsb2NhdGlvbklkLCBkdXJhdGlvbk1pbnV0ZXMsIHByb3ZpZGVySWQsIGRheXNUb1NjYW4gPSAxNCwgbGltaXQgPSA1IH0gPSBvcHRpb25zO1xyXG4gICBcclxuICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoZnJvbURhdGUpO1xyXG4gICBpZiAoIU51bWJlci5pc0Zpbml0ZShzdGFydERhdGUuZ2V0VGltZSgpKSkgdGhyb3cgbmV3IEF2YWlsYWJpbGl0eUVycm9yKFwiSW52YWxpZCBkYXRlXCIsIDQwMCk7XHJcblxyXG4gICAvLyAxLiBDb25maWcgKE9uY2UpXHJcbiAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IGZldGNoQXZhaWxhYmlsaXR5Q29uZmlnKGRiLCB0ZW5hbnRJZCwgbG9jYXRpb25JZCwgcHJvdmlkZXJJZCk7XHJcblxyXG4gICAvLyAyLiBMb29wIGluIGNodW5rcyAoZS5nLiA3IGRheXMpIHVudGlsIHdlIGZpbmQgJ2xpbWl0JyBzbG90cyBvciAnZGF5c1RvU2NhbicgaXMgZXhoYXVzdGVkXHJcbiAgIGNvbnN0IGZvdW5kU2xvdHM6IEFycmF5PHsgZGF0ZTogc3RyaW5nOyBzbG90czogc3RyaW5nW10gfT4gPSBbXTtcclxuICAgY29uc3QgY2h1bmtTaXplID0gNztcclxuICAgbGV0IGN1cnJlbnRTdGFydCA9IHN0YXJ0T2ZEYXkoc3RhcnREYXRlKTtcclxuICAgY29uc3QgbWF4RGF0ZSA9IGFkZERheXMoY3VycmVudFN0YXJ0LCBkYXlzVG9TY2FuKTtcclxuICAgXHJcbiAgIHdoaWxlIChpc0JlZm9yZShjdXJyZW50U3RhcnQsIG1heERhdGUpICYmIGZvdW5kU2xvdHMubGVuZ3RoIDwgbGltaXQpIHtcclxuICAgICAgY29uc3QgY3VycmVudEVuZCA9IGFkZERheXMoY3VycmVudFN0YXJ0LCBjaHVua1NpemUpO1xyXG4gICAgICAvLyBGZXRjaCA3IGRheXMgb2YgZGF0YVxyXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgZmV0Y2hBdmFpbGFiaWxpdHlEYXRhKGRiLCB0ZW5hbnRJZCwgY3VycmVudFN0YXJ0LCBjdXJyZW50RW5kKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFByb2Nlc3MgZWFjaCBkYXlcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaHVua1NpemU7IGkrKykge1xyXG4gICAgICAgICBjb25zdCBkYXkgPSBhZGREYXlzKGN1cnJlbnRTdGFydCwgaSk7XHJcbiAgICAgICAgIGlmIChpc0FmdGVyKGRheSwgbWF4RGF0ZSkpIGJyZWFrO1xyXG4gICAgICAgICBcclxuICAgICAgICAgY29uc3QgZGFpbHlTbG90cyA9IGNhbGN1bGF0ZURhaWx5U2xvdHMoZGF5LCBjb25maWcsIGRhdGEsIHtcclxuICAgICAgICAgICAgZHVyYXRpb25NaW51dGVzLFxyXG4gICAgICAgICAgICBsb2NhdGlvbklkLFxyXG4gICAgICAgICAgICBwcm92aWRlcklkXHJcbiAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgaWYgKGRhaWx5U2xvdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3VuZFNsb3RzLnB1c2goe1xyXG4gICAgICAgICAgICAgICBkYXRlOiBmb3JtYXQoZGF5LCBcInl5eXktTU0tZGRcIiksXHJcbiAgICAgICAgICAgICAgIHNsb3RzOiBkYWlseVNsb3RzLnNsaWNlKDAsIDUpIC8vIFJldHVybiB0b3AgNSBzbG90cyBwZXIgZGF5PyBPciBqdXN0IHRoZSBkYXlzP1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgfVxyXG5cclxuICAgICAgICAgaWYgKGZvdW5kU2xvdHMubGVuZ3RoID49IGxpbWl0KSBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjdXJyZW50U3RhcnQgPSBjdXJyZW50RW5kO1xyXG4gICB9XHJcblxyXG4gICByZXR1cm4gZm91bmRTbG90cztcclxufVxyXG4iXSwibmFtZXMiOlsiYWRkTWludXRlcyIsImZvcm1hdCIsImlzQWZ0ZXIiLCJpc0JlZm9yZSIsInN0YXJ0T2ZEYXkiLCJhZGREYXlzIiwiaXNXaXRoaW5CdXNpbmVzc0hvdXJzIiwiQXZhaWxhYmlsaXR5RXJyb3IiLCJFcnJvciIsImNvbnN0cnVjdG9yIiwibWVzc2FnZSIsInN0YXR1cyIsImZldGNoQXZhaWxhYmlsaXR5Q29uZmlnIiwiZGIiLCJ0ZW5hbnRJZCIsImxvY2F0aW9uSWQiLCJwcm92aWRlcklkIiwiZGF0YSIsImxvY2F0aW9uRGF0YSIsImVycm9yIiwibG9jYXRpb25FcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm1heWJlU2luZ2xlIiwiY29uc29sZSIsImJ1c2luZXNzSG91cnMiLCJidXNpbmVzc19ob3VycyIsInByb3ZpZGVyIiwicHJvdmlkZXJFcnJvciIsIndhcm4iLCJwcm92U2NoZWR1bGUiLCJtZXRhZGF0YSIsInNjaGVkdWxlIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsIm1vbiIsInR1ZSIsIndlZCIsInRodSIsImZyaSIsInRpbWVab25lIiwidGltZXpvbmUiLCJidWZmZXJNaW51dGVzIiwiYnVmZmVyX21pbnV0ZXMiLCJmZXRjaEF2YWlsYWJpbGl0eURhdGEiLCJzdGFydFJhbmdlIiwiZW5kUmFuZ2UiLCJhcHBvaW50bWVudHMiLCJhcHB0RGF0YSIsImFwcG9pbnRtZW50c0Vycm9yIiwibmVxIiwiZ3RlIiwidG9JU09TdHJpbmciLCJsdGUiLCJlIiwiYmxvY2tzIiwiYmxvY2tzRGF0YSIsImJsb2Nrc0Vycm9yIiwiY2FsY3VsYXRlRGFpbHlTbG90cyIsImRheU9yRGF0ZVN0ciIsImNvbmZpZyIsIm9wdGlvbnMiLCJkdXJhdGlvbk1pbnV0ZXMiLCJ0YXJnZXREYXRlU3RyaW5nIiwic2Vla1N0YXJ0IiwiYW5jaG9yIiwiRGF0ZSIsImlzTmFOIiwiZ2V0VGltZSIsInN0YXJ0U2NhbiIsImVuZFNjYW4iLCJub3JtYWxpemVkRHVyYXRpb24iLCJNYXRoIiwibWF4IiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJpbnRlcnZhbCIsIm5vdyIsImxvZyIsImJsb2NraW5nQXBwb2ludG1lbnRzIiwiZmlsdGVyIiwiYXBwdCIsImxvY2F0aW9uX2lkIiwiYmxvY2tpbmdCbG9ja3MiLCJiIiwicHJvdmlkZXJfaWQiLCJzbG90cyIsImN1cnJlbnQiLCJkYXRlRm9ybWF0dGVyIiwiSW50bCIsIkRhdGVUaW1lRm9ybWF0IiwieWVhciIsIm1vbnRoIiwiZGF5Iiwic2xvdEVuZCIsInNsb3REYXRlTG9jYWwiLCJpc09wZW4iLCJzdGFydCIsImVuZCIsImhhc0FwcHRDb25mbGljdCIsInNvbWUiLCJhcHB0U3RhcnQiLCJzdGFydF9hdCIsImFwcHRFbmQiLCJlbmRfYXQiLCJidWZmZXJlZFN0YXJ0IiwiYnVmZmVyZWRFbmQiLCJoYXNCbG9ja0NvbmZsaWN0IiwiYmxvY2siLCJiU3RhcnQiLCJiRW5kIiwidGltZVN0ciIsImhvdXIiLCJtaW51dGUiLCJob3VyMTIiLCJwdXNoIiwiQXJyYXkiLCJTZXQiLCJzb3J0IiwiZ2V0QXZhaWxhYmlsaXR5U2xvdHMiLCJkYXRlIiwiZmluZE5leHRBdmFpbGFibGVTbG90cyIsImZyb21EYXRlIiwiZGF5c1RvU2NhbiIsImxpbWl0Iiwic3RhcnREYXRlIiwiZm91bmRTbG90cyIsImNodW5rU2l6ZSIsImN1cnJlbnRTdGFydCIsIm1heERhdGUiLCJjdXJyZW50RW5kIiwiaSIsImRhaWx5U2xvdHMiLCJzbGljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/availability/getSlots.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/tenant-headers.ts":
/*!**************************************!*\
  !*** ./src/server/tenant-headers.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getTenantHeaderInfo: () => (/* binding */ getTenantHeaderInfo)\n/* harmony export */ });\nconst DEV_TENANT_SLUG = process.env.NEXT_PUBLIC_DEV_TENANT_SLUG ?? \"tenant_1\";\nfunction getTenantHeaderInfo(headerBag) {\n    const slug = headerBag.get(\"x-tenant-id\");\n    const internalId = headerBag.get(\"x-tenant-internal-id\");\n    const isDevBypass =  true && slug === DEV_TENANT_SLUG;\n    return {\n        slug,\n        internalId,\n        isDevBypass\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3RlbmFudC1oZWFkZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNQSxrQkFBa0JDLFFBQVFDLEdBQUcsQ0FBQ0MsMkJBQTJCLElBQUk7QUFFNUQsU0FBU0Msb0JBQW9CQyxTQUFrQjtJQUNwRCxNQUFNQyxPQUFPRCxVQUFVRSxHQUFHLENBQUM7SUFDM0IsTUFBTUMsYUFBYUgsVUFBVUUsR0FBRyxDQUFDO0lBQ2pDLE1BQU1FLGNBQWNSLEtBQXNDLElBQUlLLFNBQVNOO0lBQ3ZFLE9BQU87UUFBRU07UUFBTUU7UUFBWUM7SUFBWTtBQUN6QyIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL3NlcnZlci90ZW5hbnQtaGVhZGVycy50cz9mYjk5Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IERFVl9URU5BTlRfU0xVRyA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0RFVl9URU5BTlRfU0xVRyA/PyBcInRlbmFudF8xXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VGVuYW50SGVhZGVySW5mbyhoZWFkZXJCYWc6IEhlYWRlcnMpIHtcclxuICBjb25zdCBzbHVnID0gaGVhZGVyQmFnLmdldChcIngtdGVuYW50LWlkXCIpO1xyXG4gIGNvbnN0IGludGVybmFsSWQgPSBoZWFkZXJCYWcuZ2V0KFwieC10ZW5hbnQtaW50ZXJuYWwtaWRcIik7XHJcbiAgY29uc3QgaXNEZXZCeXBhc3MgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJkZXZlbG9wbWVudFwiICYmIHNsdWcgPT09IERFVl9URU5BTlRfU0xVRztcclxuICByZXR1cm4geyBzbHVnLCBpbnRlcm5hbElkLCBpc0RldkJ5cGFzcyB9O1xyXG59XHJcbiJdLCJuYW1lcyI6WyJERVZfVEVOQU5UX1NMVUciLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfREVWX1RFTkFOVF9TTFVHIiwiZ2V0VGVuYW50SGVhZGVySW5mbyIsImhlYWRlckJhZyIsInNsdWciLCJnZXQiLCJpbnRlcm5hbElkIiwiaXNEZXZCeXBhc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/tenant-headers.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/tenant-routing.ts":
/*!**************************************!*\
  !*** ./src/server/tenant-routing.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findTenantByPublicIdentifier: () => (/* binding */ findTenantByPublicIdentifier),\n/* harmony export */   resolveTenantIdFromPublicIdentifier: () => (/* binding */ resolveTenantIdFromPublicIdentifier)\n/* harmony export */ });\n/* harmony import */ var _lib_supabase_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/supabase/service */ \"(rsc)/./src/lib/supabase/service.ts\");\n\nconst CACHE_TTL_MS = 5 * 60 * 1000;\nconst tenantCache = new Map();\nfunction readCache(key) {\n    if (!key) return null;\n    const cached = tenantCache.get(key);\n    if (cached && cached.expiresAt > Date.now()) {\n        return cached.tenant;\n    }\n    if (cached) {\n        tenantCache.delete(key);\n    }\n    return null;\n}\nfunction writeCache(keys, tenant) {\n    const expiresAt = Date.now() + CACHE_TTL_MS;\n    keys.forEach((key)=>{\n        if (key) {\n            tenantCache.set(key, {\n                tenant,\n                expiresAt\n            });\n        }\n    });\n}\nasync function findTenantByPublicIdentifier(params) {\n    const normalizedSlug = params.slug?.trim().toLowerCase() ?? null;\n    const normalizedDomain = params.domain?.trim().toLowerCase() ?? null;\n    const normalizedId = params.id?.trim() ?? null;\n    const cacheKeys = [\n        normalizedId ? `id:${normalizedId}` : null,\n        normalizedSlug ? `slug:${normalizedSlug}` : null,\n        normalizedDomain ? `domain:${normalizedDomain}` : null\n    ];\n    for (const key of cacheKeys){\n        const tenant = readCache(key ?? undefined);\n        if (tenant) {\n            return tenant;\n        }\n    }\n    if (!_lib_supabase_service__WEBPACK_IMPORTED_MODULE_0__.serviceClient) {\n        console.warn(\"findTenantByPublicIdentifier: service client not configured\");\n        return null;\n    }\n    const identifiers = [];\n    if (normalizedId) {\n        identifiers.push({\n            column: \"id\",\n            value: normalizedId,\n            cacheKey: `id:${normalizedId}`\n        });\n    }\n    if (normalizedSlug) {\n        identifiers.push({\n            column: \"public_slug\",\n            value: normalizedSlug,\n            cacheKey: `slug:${normalizedSlug}`\n        });\n    }\n    if (normalizedDomain) {\n        identifiers.push({\n            column: \"custom_domain\",\n            value: normalizedDomain,\n            cacheKey: `domain:${normalizedDomain}`\n        });\n    }\n    if (identifiers.length === 0) {\n        return null;\n    }\n    let query = _lib_supabase_service__WEBPACK_IMPORTED_MODULE_0__.serviceClient.from(\"agenda_tenants\").select(\"id, name, public_slug, custom_domain, public_metadata\").limit(1);\n    if (identifiers.length === 1) {\n        const identifier = identifiers[0];\n        query = query.eq(identifier.column, identifier.value);\n    } else {\n        const orFilter = identifiers.map((item)=>`${item.column}.eq.${item.value}`).join(\",\");\n        query = query.or(orFilter);\n    }\n    const { data, error } = await query.maybeSingle();\n    if (error) {\n        console.error(\"findTenantByPublicIdentifier: query failed\", error);\n        return null;\n    }\n    if (!data) {\n        return null;\n    }\n    const tenant = data;\n    writeCache([\n        `id:${tenant.id}`,\n        tenant.public_slug ? `slug:${tenant.public_slug}` : null,\n        tenant.custom_domain ? `domain:${tenant.custom_domain}` : null\n    ], tenant);\n    return tenant;\n}\nasync function resolveTenantIdFromPublicIdentifier(params) {\n    if (params.tenantId) {\n        return params.tenantId;\n    }\n    const tenant = await findTenantByPublicIdentifier({\n        slug: params.tenantSlug ?? null,\n        domain: params.domain ?? null\n    });\n    return tenant?.id ?? null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q25CO0lBRUEsTUFBTSxFQUFFSyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1aLE1BQU1hLFdBQVc7SUFFL0MsSUFBSUQsT0FBTztRQUNUcEIsUUFBUW9CLEtBQUssQ0FBQyw4Q0FBOENBO1FBQzVELE9BQU87SUFDVDtJQUVBLElBQUksQ0FBQ0QsTUFBTTtRQUNULE9BQU87SUFDVDtJQUVBLE1BQU1yQyxTQUFTcUM7SUFDZm5DLFdBQ0U7UUFDRSxDQUFDLEdBQUcsRUFBRUYsT0FBT2UsRUFBRSxDQUFDLENBQUM7UUFDakJmLE9BQU93QyxXQUFXLEdBQUcsQ0FBQyxLQUFLLEVBQUV4QyxPQUFPd0MsV0FBVyxDQUFDLENBQUMsR0FBRztRQUNwRHhDLE9BQU95QyxhQUFhLEdBQUcsQ0FBQyxPQUFPLEVBQUV6QyxPQUFPeUMsYUFBYSxDQUFDLENBQUMsR0FBRztLQUMzRCxFQUNEekM7SUFHRixPQUFPQTtBQUNUO0FBRU8sZUFBZTBDLG9DQUFvQ25DLE1BSXpEO0lBQ0MsSUFBSUEsT0FBT29DLFFBQVEsRUFBRTtRQUNuQixPQUFPcEMsT0FBT29DLFFBQVE7SUFDeEI7SUFFQSxNQUFNM0MsU0FBUyxNQUFNTSw2QkFBNkI7UUFBRUcsTUFBTUYsT0FBT3FDLFVBQVUsSUFBSTtRQUFNL0IsUUFBUU4sT0FBT00sTUFBTSxJQUFJO0lBQUs7SUFDbkgsT0FBT2IsUUFBUWUsTUFBTTtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL2FnZW5kYXItYXBwLy4vc3JjL3NlcnZlci90ZW5hbnQtcm91dGluZy50cz8xYzRhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNlcnZpY2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Uvc2VydmljZVwiO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gXCJAL3R5cGVzL2RhdGFiYXNlXCI7XHJcblxyXG5leHBvcnQgdHlwZSBUZW5hbnRQdWJsaWNSZWNvcmQgPSBQaWNrPFxyXG4gIERhdGFiYXNlW1wicHVibGljXCJdW1wiVGFibGVzXCJdW1wiYWdlbmRhX3RlbmFudHNcIl1bXCJSb3dcIl0sXHJcbiAgXCJpZFwiIHwgXCJuYW1lXCIgfCBcInB1YmxpY19zbHVnXCIgfCBcImN1c3RvbV9kb21haW5cIiB8IFwicHVibGljX21ldGFkYXRhXCJcclxuPjtcclxuXHJcbnR5cGUgSWRlbnRpZmllciA9IHtcclxuICBjb2x1bW46IFwiaWRcIiB8IFwicHVibGljX3NsdWdcIiB8IFwiY3VzdG9tX2RvbWFpblwiO1xyXG4gIHZhbHVlOiBzdHJpbmc7XHJcbiAgY2FjaGVLZXk6IHN0cmluZztcclxufTtcclxuXHJcbmNvbnN0IENBQ0hFX1RUTF9NUyA9IDUgKiA2MCAqIDEwMDA7XHJcbmNvbnN0IHRlbmFudENhY2hlID0gbmV3IE1hcDxzdHJpbmcsIHsgdGVuYW50OiBUZW5hbnRQdWJsaWNSZWNvcmQ7IGV4cGlyZXNBdDogbnVtYmVyIH0+KCk7XHJcblxyXG5mdW5jdGlvbiByZWFkQ2FjaGUoa2V5OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKSB7XHJcbiAgaWYgKCFrZXkpIHJldHVybiBudWxsO1xyXG4gIGNvbnN0IGNhY2hlZCA9IHRlbmFudENhY2hlLmdldChrZXkpO1xyXG4gIGlmIChjYWNoZWQgJiYgY2FjaGVkLmV4cGlyZXNBdCA+IERhdGUubm93KCkpIHtcclxuICAgIHJldHVybiBjYWNoZWQudGVuYW50O1xyXG4gIH1cclxuICBpZiAoY2FjaGVkKSB7XHJcbiAgICB0ZW5hbnRDYWNoZS5kZWxldGUoa2V5KTtcclxuICB9XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHdyaXRlQ2FjaGUoa2V5czogKHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpW10sIHRlbmFudDogVGVuYW50UHVibGljUmVjb3JkKSB7XHJcbiAgY29uc3QgZXhwaXJlc0F0ID0gRGF0ZS5ub3coKSArIENBQ0hFX1RUTF9NUztcclxuICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgaWYgKGtleSkge1xyXG4gICAgICB0ZW5hbnRDYWNoZS5zZXQoa2V5LCB7IHRlbmFudCwgZXhwaXJlc0F0IH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluZFRlbmFudEJ5UHVibGljSWRlbnRpZmllcihwYXJhbXM6IHtcclxuICBpZD86IHN0cmluZyB8IG51bGw7XHJcbiAgc2x1Zz86IHN0cmluZyB8IG51bGw7XHJcbiAgZG9tYWluPzogc3RyaW5nIHwgbnVsbDtcclxufSk6IFByb21pc2U8VGVuYW50UHVibGljUmVjb3JkIHwgbnVsbD4ge1xyXG4gIGNvbnN0IG5vcm1hbGl6ZWRTbHVnID0gcGFyYW1zLnNsdWc/LnRyaW0oKS50b0xvd2VyQ2FzZSgpID8/IG51bGw7XHJcbiAgY29uc3Qgbm9ybWFsaXplZERvbWFpbiA9IHBhcmFtcy5kb21haW4/LnRyaW0oKS50b0xvd2VyQ2FzZSgpID8/IG51bGw7XHJcbiAgY29uc3Qgbm9ybWFsaXplZElkID0gcGFyYW1zLmlkPy50cmltKCkgPz8gbnVsbDtcclxuXHJcbiAgY29uc3QgY2FjaGVLZXlzID0gW1xyXG4gICAgbm9ybWFsaXplZElkID8gYGlkOiR7bm9ybWFsaXplZElkfWAgOiBudWxsLFxyXG4gICAgbm9ybWFsaXplZFNsdWcgPyBgc2x1Zzoke25vcm1hbGl6ZWRTbHVnfWAgOiBudWxsLFxyXG4gICAgbm9ybWFsaXplZERvbWFpbiA/IGBkb21haW46JHtub3JtYWxpemVkRG9tYWlufWAgOiBudWxsLFxyXG4gIF07XHJcblxyXG4gIGZvciAoY29uc3Qga2V5IG9mIGNhY2hlS2V5cykge1xyXG4gICAgY29uc3QgdGVuYW50ID0gcmVhZENhY2hlKGtleSA/PyB1bmRlZmluZWQpO1xyXG4gICAgaWYgKHRlbmFudCkge1xyXG4gICAgICByZXR1cm4gdGVuYW50O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaWYgKCFzZXJ2aWNlQ2xpZW50KSB7XHJcbiAgICBjb25zb2xlLndhcm4oXCJmaW5kVGVuYW50QnlQdWJsaWNJZGVudGlmaWVyOiBzZXJ2aWNlIGNsaWVudCBub3QgY29uZmlndXJlZFwiKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgaWRlbnRpZmllcnM6IElkZW50aWZpZXJbXSA9IFtdO1xyXG4gIGlmIChub3JtYWxpemVkSWQpIHtcclxuICAgIGlkZW50aWZpZXJzLnB1c2goeyBjb2x1bW46IFwiaWRcIiwgdmFsdWU6IG5vcm1hbGl6ZWRJZCwgY2FjaGVLZXk6IGBpZDoke25vcm1hbGl6ZWRJZH1gIH0pO1xyXG4gIH1cclxuICBpZiAobm9ybWFsaXplZFNsdWcpIHtcclxuICAgIGlkZW50aWZpZXJzLnB1c2goeyBjb2x1bW46IFwicHVibGljX3NsdWdcIiwgdmFsdWU6IG5vcm1hbGl6ZWRTbHVnLCBjYWNoZUtleTogYHNsdWc6JHtub3JtYWxpemVkU2x1Z31gIH0pO1xyXG4gIH1cclxuICBpZiAobm9ybWFsaXplZERvbWFpbikge1xyXG4gICAgaWRlbnRpZmllcnMucHVzaCh7IGNvbHVtbjogXCJjdXN0b21fZG9tYWluXCIsIHZhbHVlOiBub3JtYWxpemVkRG9tYWluLCBjYWNoZUtleTogYGRvbWFpbjoke25vcm1hbGl6ZWREb21haW59YCB9KTtcclxuICB9XHJcblxyXG4gIGlmIChpZGVudGlmaWVycy5sZW5ndGggPT09IDApIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgbGV0IHF1ZXJ5ID0gc2VydmljZUNsaWVudFxyXG4gICAgLmZyb20oXCJhZ2VuZGFfdGVuYW50c1wiKVxyXG4gICAgLnNlbGVjdChcImlkLCBuYW1lLCBwdWJsaWNfc2x1ZywgY3VzdG9tX2RvbWFpbiwgcHVibGljX21ldGFkYXRhXCIpXHJcbiAgICAubGltaXQoMSk7XHJcblxyXG4gIGlmIChpZGVudGlmaWVycy5sZW5ndGggPT09IDEpIHtcclxuICAgIGNvbnN0IGlkZW50aWZpZXIgPSBpZGVudGlmaWVyc1swXTtcclxuICAgIHF1ZXJ5ID0gcXVlcnkuZXEoaWRlbnRpZmllci5jb2x1bW4sIGlkZW50aWZpZXIudmFsdWUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCBvckZpbHRlciA9IGlkZW50aWZpZXJzLm1hcCgoaXRlbSkgPT4gYCR7aXRlbS5jb2x1bW59LmVxLiR7aXRlbS52YWx1ZX1gKS5qb2luKFwiLFwiKTtcclxuICAgIHF1ZXJ5ID0gcXVlcnkub3Iob3JGaWx0ZXIpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiZmluZFRlbmFudEJ5UHVibGljSWRlbnRpZmllcjogcXVlcnkgZmFpbGVkXCIsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFkYXRhKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIGNvbnN0IHRlbmFudCA9IGRhdGEgYXMgVGVuYW50UHVibGljUmVjb3JkO1xyXG4gIHdyaXRlQ2FjaGUoXHJcbiAgICBbXHJcbiAgICAgIGBpZDoke3RlbmFudC5pZH1gLFxyXG4gICAgICB0ZW5hbnQucHVibGljX3NsdWcgPyBgc2x1Zzoke3RlbmFudC5wdWJsaWNfc2x1Z31gIDogbnVsbCxcclxuICAgICAgdGVuYW50LmN1c3RvbV9kb21haW4gPyBgZG9tYWluOiR7dGVuYW50LmN1c3RvbV9kb21haW59YCA6IG51bGwsXHJcbiAgICBdLFxyXG4gICAgdGVuYW50LFxyXG4gICk7XHJcblxyXG4gIHJldHVybiB0ZW5hbnQ7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXNvbHZlVGVuYW50SWRGcm9tUHVibGljSWRlbnRpZmllcihwYXJhbXM6IHtcclxuICB0ZW5hbnRJZD86IHN0cmluZyB8IG51bGw7XHJcbiAgdGVuYW50U2x1Zz86IHN0cmluZyB8IG51bGw7XHJcbiAgZG9tYWluPzogc3RyaW5nIHwgbnVsbDtcclxufSk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xyXG4gIGlmIChwYXJhbXMudGVuYW50SWQpIHtcclxuICAgIHJldHVybiBwYXJhbXMudGVuYW50SWQ7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0ZW5hbnQgPSBhd2FpdCBmaW5kVGVuYW50QnlQdWJsaWNJZGVudGlmaWVyKHsgc2x1ZzogcGFyYW1zLnRlbmFudFNsdWcgPz8gbnVsbCwgZG9tYWluOiBwYXJhbXMuZG9tYWluID8/IG51bGwgfSk7XHJcbiAgcmV0dXJuIHRlbmFudD8uaWQgPz8gbnVsbDtcclxufVxyXG4iXSwibmFtZXMiOlsic2VydmljZUNsaWVudCIsIkNBQ0hFX1RUTF9NUyIsInRlbmFudENhY2hlIiwiTWFwIiwicmVhZENhY2hlIiwia2V5IiwiY2FjaGVkIiwiZ2V0IiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsInRlbmFudCIsImRlbGV0ZSIsIndyaXRlQ2FjaGUiLCJrZXlzIiwiZm9yRWFjaCIsInNldCIsImZpbmRUZW5hbnRCeVB1YmxpY0lkZW50aWZpZXIiLCJwYXJhbXMiLCJub3JtYWxpemVkU2x1ZyIsInNsdWciLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJub3JtYWxpemVkRG9tYWluIiwiZG9tYWluIiwibm9ybWFsaXplZElkIiwiaWQiLCJjYWNoZUtleXMiLCJ1bmRlZmluZWQiLCJjb25zb2xlIiwid2FybiIsImlkZW50aWZpZXJzIiwicHVzaCIsImNvbHVtbiIsInZhbHVlIiwiY2FjaGVLZXkiLCJsZW5ndGgiLCJxdWVyeSIsImZyb20iLCJzZWxlY3QiLCJsaW1pdCIsImlkZW50aWZpZXIiLCJlcSIsIm9yRmlsdGVyIiwibWFwIiwiaXRlbSIsImpvaW4iLCJvciIsImRhdGEiLCJlcnJvciIsIm1heWJlU2luZ2xlIiwicHVibGljX3NsdWciLCJjdXN0b21fZG9tYWluIiwicmVzb2x2ZVRlbmFudElkRnJvbVB1YmxpY0lkZW50aWZpZXIiLCJ0ZW5hbnRJZCIsInRlbmFudFNsdWciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/tenant-routing.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/date-fns"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpublic%2Favailability%2Froute&page=%2Fapi%2Fpublic%2Favailability%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpublic%2Favailability%2Froute.ts&appDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crementeriama%5CDownloads%5CCode%5CAgend.ar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();