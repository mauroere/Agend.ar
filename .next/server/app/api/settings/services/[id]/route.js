"use strict";(()=>{var e={};e.id=5234,e.ids=[5234],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},515:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>_,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{DELETE:()=>c,PATCH:()=>p});var s=r(9303),a=r(8716),o=r(670),i=r(7070),u=r(1067),l=r(3719);let d=u.Ry({name:u.Z_().min(2).max(120).optional(),description:u.Z_().max(1e3).optional().nullable(),durationMinutes:u.Rx().int().min(5).max(480).optional(),price:u.Rx().nonnegative().optional().nullable(),currency:u.Z_().length(3).optional(),color:u.Z_().max(16).optional().nullable(),imageUrl:u.Z_().url().optional().nullable(),active:u.O7().optional(),sortOrder:u.Rx().int().optional()});async function p(e,{params:t}){let r=await (0,l.o)(e);if("error"in r)return r.error;let{db:n,tenantId:s}=r,a=t.id;if(!a)return i.NextResponse.json({error:"Falta ID"},{status:400});let o=await e.json().catch(()=>({})),u=d.safeParse(o);if(!u.success)return i.NextResponse.json({error:"Datos inv\xe1lidos",issues:u.error.issues},{status:400});let p={},{name:c,description:m,durationMinutes:x,price:g,currency:v,color:f,imageUrl:_,active:R,sortOrder:j}=u.data;"string"==typeof c&&(p.name=c),void 0!==m&&(p.description=m),"number"==typeof x&&(p.duration_minutes=x),void 0!==g&&(p.price_minor_units=null===g?null:Math.round(100*g)),v&&(p.currency=v.toUpperCase()),void 0!==f&&(p.color=f),void 0!==_&&(p.image_url=_),"boolean"==typeof R&&(p.active=R),"number"==typeof j&&(p.sort_order=j);let{error:h}=await n.from("agenda_services").update(p).eq("id",a).eq("tenant_id",s);return h?i.NextResponse.json({error:h.message},{status:400}):i.NextResponse.json({ok:!0})}async function c(e,{params:t}){let r=await (0,l.o)(e);if("error"in r)return r.error;let{db:n,tenantId:s}=r,a=t.id;if(!a)return i.NextResponse.json({error:"Falta ID"},{status:400});let{error:o}=await n.from("agenda_services").delete().eq("id",a).eq("tenant_id",s);return o?i.NextResponse.json({error:o.message},{status:400}):i.NextResponse.json({ok:!0})}let m=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/settings/services/[id]/route",pathname:"/api/settings/services/[id]",filename:"route",bundlePath:"app/api/settings/services/[id]/route"},resolvedPagePath:"C:\\Users\\rementeriama\\Downloads\\Code\\Agend.ar\\src\\app\\api\\settings\\services\\[id]\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:v}=m,f="/api/settings/services/[id]/route";function _(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},3837:(e,t,r)=>{r.d(t,{j:()=>a});var n=r(1615),s=r(344);function a(){return(0,s.createRouteHandlerClient)({cookies:n.cookies})}},5072:(e,t,r)=>{r.d(t,{o:()=>o});var n=r(7857);let s="https://oaxielrsiogvnxradtsw.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY;s&&a||console.warn("Supabase service client is not fully configured.");let o=s&&a?(0,n.eI)(s,a,{auth:{persistSession:!1}}):null},3719:(e,t,r)=>{r.d(t,{o:()=>o});var n=r(7070),s=r(3837),a=r(5072);async function o(e){let t=(0,s.j)(),{data:{session:r}}=await t.auth.getSession();if(!r)return{error:n.NextResponse.json({error:"Unauthorized"},{status:401})};let o=a.o??t,i=r.user.app_metadata?.tenant_id??r.user.user_metadata?.tenant_id??null;if(!i){let{data:e}=await o.from("agenda_users").select("tenant_id").eq("id",r.user.id).maybeSingle();e&&(i=e.tenant_id)}let u=e.headers.get("x-tenant-id"),l=i??u;return l?u&&i&&u!==i?{error:n.NextResponse.json({error:"Tenant mismatch"},{status:403})}:{supabase:t,db:o,tenantId:l,session:r}:{error:n.NextResponse.json({error:"Unauthorized"},{status:401})}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,7857,5972,958,1067],()=>r(515));module.exports=n})();