"use strict";(()=>{var e={};e.id=3002,e.ids=[3002],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},7382:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>_,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{POST:()=>m});var s=r(9303),n=r(8716),o=r(670),i=r(4770),u=r(7070),d=r(1067),p=r(5072);let l=d.Ry({email:d.Z_().email(),password:d.Z_().min(8),tenantName:d.Z_().min(3)});async function m(e){if(!p.o)return u.NextResponse.json({error:"Supabase service client not configured"},{status:500});let t=l.safeParse(await e.json());if(!t.success)return u.NextResponse.json({error:"Datos inv\xe1lidos",details:t.error.flatten()},{status:400});let{email:r,password:a,tenantName:s}=t.data,n=(0,i.randomUUID)(),{error:o}=await p.o.from("agenda_tenants").insert({id:n,name:s});if(o)return u.NextResponse.json({error:o.message},{status:400});let{data:d,error:m}=await p.o.auth.admin.createUser({email:r,password:a,email_confirm:!0,user_metadata:{tenant_id:n},app_metadata:{tenant_id:n}});if(m||!d.user)return await p.o.from("agenda_tenants").delete().eq("id",n),u.NextResponse.json({error:m?.message??"No se pudo crear el usuario"},{status:400});let{error:c}=await p.o.from("agenda_users").insert({id:d.user.id,tenant_id:n,role:"owner"});return c?(await p.o.auth.admin.deleteUser(d.user.id),await p.o.from("agenda_tenants").delete().eq("id",n),u.NextResponse.json({error:c.message},{status:400})):u.NextResponse.json({ok:!0})}let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\Users\\rementeriama\\Downloads\\Code\\Agend.ar\\src\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:x}=c,h="/api/auth/register/route";function _(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},5072:(e,t,r)=>{r.d(t,{o:()=>o});var a=r(7857);let s="https://oaxielrsiogvnxradtsw.supabase.co",n=process.env.SUPABASE_SERVICE_ROLE_KEY;s&&n||console.warn("Supabase service client is not fully configured.");let o=s&&n?(0,a.eI)(s,n,{auth:{persistSession:!1}}):null}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,7857,5972,1067],()=>r(7382));module.exports=a})();