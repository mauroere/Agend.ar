"use strict";(()=>{var e={};e.id=4117,e.ids=[4117],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},4297:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>p});var n=r(9303),o=r(8716),s=r(670),i=r(7070),u=r(5655),d=r(5072),l=r(4770);async function p(){let e=(0,u.b)(),{data:{user:t}}=await e.auth.getUser();if(!t)return i.NextResponse.json({error:"No est\xe1s logueado. Logueate primero (aunque te redirija al login) y luego volv\xe9 a entrar a esta URL."},{status:401});if(!d.o)return i.NextResponse.json({error:"Service client missing"},{status:500});let{data:r}=await d.o.from("agenda_users").select("*").eq("id",t.id).maybeSingle();if(r)return await d.o.auth.admin.updateUserById(t.id,{app_metadata:{tenant_id:r.tenant_id},user_metadata:{tenant_id:r.tenant_id}}),i.NextResponse.json({message:"Usuario reparado exitosamente. Metadatos actualizados.",tenantId:r.tenant_id,action:"Ahora volv\xe9 al login e ingres\xe1 normalmente."});let a=(0,l.randomUUID)(),{error:n}=await d.o.from("agenda_tenants").insert({id:a,name:"Cl\xednica Reparada"});if(n)return i.NextResponse.json({error:"Error creando tenant: "+n.message},{status:500});let{error:o}=await d.o.from("agenda_users").insert({id:t.id,tenant_id:a,role:"owner"});if(o)return i.NextResponse.json({error:"Error vinculando usuario: "+o.message},{status:500});let{data:s}=await d.o.from("agenda_locations").select("id").eq("tenant_id",a).limit(1);return s&&0!==s.length||await d.o.from("agenda_locations").insert({tenant_id:a,name:"Consultorio Principal",timezone:"America/Argentina/Buenos_Aires",business_hours:{mon:[["09:00","18:00"]],tue:[["09:00","18:00"]],wed:[["09:00","18:00"]],thu:[["09:00","18:00"]],fri:[["09:00","18:00"]]},default_duration:30,buffer_minutes:0}),i.NextResponse.json({message:"Cuenta reparada, cl\xednica y consultorio creados.",tenantId:a,action:"Ahora volv\xe9 al login e ingres\xe1 normalmente."})}let c=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/repair/route",pathname:"/api/repair",filename:"route",bundlePath:"app/api/repair/route"},resolvedPagePath:"C:\\Users\\rementeriama\\Downloads\\Code\\Agend.ar\\src\\app\\api\\repair\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:x}=c,f="/api/repair/route";function v(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}},5655:(e,t,r)=>{r.d(t,{b:()=>o});var a=r(1615),n=r(344);function o(){return(0,n.createServerComponentClient)({cookies:a.cookies})}},5072:(e,t,r)=>{r.d(t,{o:()=>s});var a=r(7857);let n="https://oaxielrsiogvnxradtsw.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY;n&&o||console.warn("Supabase service client is not fully configured.");let s=n&&o?(0,a.eI)(n,o,{auth:{persistSession:!1}}):null}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,7857,5972,958],()=>r(4297));module.exports=a})();