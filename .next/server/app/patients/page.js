(()=>{var e={};e.id=333,e.ids=[333],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},7380:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>d}),s(1279),s(2029),s(5866);var a=s(3191),n=s(8716),r=s(7922),l=s.n(r),o=s(5231),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);s.d(t,i);let d=["",{children:["patients",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,1279)),"C:\\Users\\rementeriama\\Downloads\\Code\\Agend.ar\\src\\app\\patients\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"C:\\Users\\rementeriama\\Downloads\\Code\\Agend.ar\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\rementeriama\\Downloads\\Code\\Agend.ar\\src\\app\\patients\\page.tsx"],p="/patients/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/patients/page",pathname:"/patients",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2464:(e,t,s)=>{Promise.resolve().then(s.bind(s,8964)),Promise.resolve().then(s.bind(s,2080))},8091:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},2080:(e,t,s)=>{"use strict";s.d(t,{PatientTable:()=>w});var a=s(326),n=s(7577),r=s(5047),l=s(1190),o=s(1664),i=s(9752),d=s(2264),c=s(3819),p=s(8307),u=s(4975),m=s(2881);let x=(0,m.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);var h=s(7358),f=s(1291);let j=(0,m.Z)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var g=s(8091),b=s(8443),N=s(6627);function w({data:e}){let[t,s]=(0,n.useState)(""),[m,w]=(0,n.useState)(!1),[y,_]=(0,n.useState)(e),[v,S]=(0,n.useState)(null),[T,A]=(0,n.useState)(null),C=(0,r.useRouter)(),{toast:P}=(0,N.pm)(),E=(e,t)=>{let s="boolean"==typeof e.opt_out?e.opt_out:"boolean"==typeof t?.optOut&&t.optOut,a="string"==typeof e.notes?e.notes:null===e.notes?null:t?.notes??null;return{id:e.id,fullName:e.full_name,phone:e.phone_e164,optOut:s,notes:a,nextAppointment:t?.nextAppointment??null,noShowCount:t?.noShowCount??0}},O=(0,n.useMemo)(()=>{let e=t.toLowerCase();return y.filter(t=>{let s=t.phone.replace(/\D/g,""),a=e.replace(/\D/g,""),n=t.fullName.toLowerCase().includes(e),r=a.length>2?s.includes(a):t.phone.includes(e);return n||r})},[y,t]),k=e=>{_(t=>[...t,E(e)]),P({title:"Paciente creado",description:"La ficha se agreg\xf3 a la base."}),w(!1)},D=(e,t)=>{let s=E(e,t);_(e=>e.map(e=>e.id===s.id?{...e,...s}:e)),P({title:"Paciente actualizado",description:"Los datos fueron guardados."}),S(null)};async function M(e){if(window.confirm(`\xbfEliminar a ${e.fullName}? Esta acci\xf3n es permanente.`)){A(e.id);try{let t=await fetch(`/api/patients/${e.id}`,{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"No se pudo eliminar")}_(t=>t.filter(t=>t.id!==e.id)),P({title:"Paciente eliminado"}),C.refresh()}catch(e){P({title:"Error al eliminar",description:e instanceof Error?e.message:"Intenta nuevamente.",variant:"destructive"})}finally{A(null)}}}return(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0 pb-6",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx(i.ll,{children:"Base de Pacientes"}),a.jsx(i.SZ,{children:"Visualiza y gestiona la informaci\xf3n de tus pacientes por sede."})]}),(0,a.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,a.jsxs)("div",{className:"relative flex-1 sm:w-64",children:[a.jsx(p.Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-500"}),a.jsx(l.I,{className:"pl-9",placeholder:"Buscar por nombre o tel\xe9fono...",value:t,onChange:e=>s(e.target.value)})]}),(0,a.jsxs)(o.z,{onClick:()=>w(!0),children:[a.jsx(u.Z,{className:"mr-2 h-4 w-4"})," Nuevo"]})]})]}),(0,a.jsxs)(i.aY,{children:[m&&a.jsx(d.C,{onClose:()=>w(!1),onSuccess:e=>{k(e),C.refresh()}}),v&&a.jsx(d._,{mode:"edit",patientId:v.id,defaultValues:{fullName:v.fullName,phone:v.phone,notes:v.notes,optOut:v.optOut},onClose:()=>S(null),onSuccess:e=>{D(e,v),C.refresh()}}),a.jsx("div",{className:"rounded-md border",children:(0,a.jsxs)(c.iA,{children:[a.jsx(c.xD,{children:(0,a.jsxs)(c.SC,{children:[a.jsx(c.ss,{children:"Paciente"}),a.jsx(c.ss,{children:"Contacto"}),a.jsx(c.ss,{children:"Pr\xf3ximo Turno"}),a.jsx(c.ss,{children:"Estado"}),a.jsx(c.ss,{className:"text-right",children:"Acciones"})]})}),(0,a.jsxs)(c.RM,{children:[O.map(e=>(0,a.jsxs)(c.SC,{children:[a.jsx(c.pj,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-8 w-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-semibold text-xs",children:e.fullName.slice(0,2).toUpperCase()}),e.fullName]})}),a.jsx(c.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(x,{className:"h-3 w-3"}),e.phone]})}),a.jsx(c.pj,{children:e.nextAppointment?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-blue-600 bg-blue-50 px-2 py-1 rounded-md w-fit text-xs font-medium",children:[a.jsx(h.Z,{className:"h-3 w-3"}),e.nextAppointment]}):a.jsx("span",{className:"text-slate-400 text-xs italic",children:"Sin turno agendado"})}),a.jsx(c.pj,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[e.optOut&&a.jsx(b.C,{label:"Opt-Out",color:"canceled"}),e.noShowCount>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-orange-600 font-medium",children:[a.jsx(f.Z,{className:"h-3 w-3"})," ",e.noShowCount," No-Show"]}),!e.optOut&&0===e.noShowCount&&a.jsx("span",{className:"text-slate-500 text-xs",children:"Activo"})]})}),a.jsx(c.pj,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsxs)(o.z,{size:"sm",variant:"ghost",onClick:()=>S(e),children:[a.jsx(j,{className:"mr-1 h-4 w-4"})," Editar"]}),(0,a.jsxs)(o.z,{size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>M(e),disabled:T===e.id,children:[a.jsx(g.Z,{className:"mr-1 h-4 w-4"}),T===e.id?"Eliminando":"Eliminar"]})]})})]},e.id)),0===O.length&&a.jsx(c.SC,{children:a.jsx(c.pj,{colSpan:5,className:"h-24 text-center text-slate-500",children:"No se encontraron pacientes que coincidan con tu b\xfasqueda."})})]})]})})]})]})}},3819:(e,t,s)=>{"use strict";s.d(t,{RM:()=>i,SC:()=>d,iA:()=>l,pj:()=>p,ss:()=>c,xD:()=>o});var a=s(326),n=s(7577),r=s(1223);let l=n.forwardRef(({className:e,...t},s)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:s,className:(0,r.cn)("w-full caption-bottom text-sm",e),...t})}));l.displayName="Table";let o=n.forwardRef(({className:e,...t},s)=>a.jsx("thead",{ref:s,className:(0,r.cn)("[&_tr]:border-b",e),...t}));o.displayName="TableHeader";let i=n.forwardRef(({className:e,...t},s)=>a.jsx("tbody",{ref:s,className:(0,r.cn)("[&_tr:last-child]:border-0",e),...t}));i.displayName="TableBody",n.forwardRef(({className:e,...t},s)=>a.jsx("tfoot",{ref:s,className:(0,r.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let d=n.forwardRef(({className:e,...t},s)=>a.jsx("tr",{ref:s,className:(0,r.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));d.displayName="TableRow";let c=n.forwardRef(({className:e,...t},s)=>a.jsx("th",{ref:s,className:(0,r.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));c.displayName="TableHead";let p=n.forwardRef(({className:e,...t},s)=>a.jsx("td",{ref:s,className:(0,r.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));p.displayName="TableCell",n.forwardRef(({className:e,...t},s)=>a.jsx("caption",{ref:s,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption"},6627:(e,t,s)=>{"use strict";s.d(t,{pm:()=>u});var a=s(7577);let n=0,r=new Map,l=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?l(s):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===t.toastId?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],d={toasts:[]};function c(e){d=o(d,e),i.forEach(e=>{e(d)})}function p({...e}){let t=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>c({type:"UPDATE_TOAST",id:t,toast:e})}}function u(){let[e,t]=a.useState(d);return a.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:p,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},1279:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(9510),n=s(8633);let r=(0,s(8570).createProxy)(String.raw`C:\Users\rementeriama\Downloads\Code\Agend.ar\src\components\patients\PatientTable.tsx#PatientTable`);var l=s(7115),o=s(5072);async function i(){let{supabase:e,tenantId:t}=await (0,l.a)(),s=o.o??e,i=new Date().toISOString(),[{data:d},{data:c}]=await Promise.all([s.from("agenda_patients").select("id, full_name, phone_e164, opt_out, notes").eq("tenant_id",t).order("full_name",{ascending:!0}).returns(),s.from("agenda_appointments").select("id, patient_id, start_at, status").eq("tenant_id",t).gte("start_at",i).order("start_at",{ascending:!0}).returns()]),p=new Map;for(let e of c??[])!e.patient_id||p.has(e.patient_id)||p.set(e.patient_id,new Date(e.start_at).toLocaleString("es-AR",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}));let u=(d??[]).map(e=>({id:e.id,fullName:e.full_name,phone:e.phone_e164,nextAppointment:p.get(e.id)??null,noShowCount:0,optOut:e.opt_out,notes:e.notes??null}));return a.jsx(n.N,{children:a.jsx(r,{data:u})})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[9276,7857,958,4471,6582,8431,4054,2153,1037],()=>s(7380));module.exports=a})();